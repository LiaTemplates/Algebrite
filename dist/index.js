(()=>{function $parcel$interopDefault(r){return r&&r.__esModule?r.default:r}var $parcel$global=globalThis,$parcel$modules={},$parcel$inits={},parcelRequire=$parcel$global.parcelRequire68ed;null==parcelRequire&&((parcelRequire=function(r){if(r in $parcel$modules)return $parcel$modules[r].exports;if(r in $parcel$inits){var t=$parcel$inits[r];delete $parcel$inits[r];var e={id:r,exports:{}};return $parcel$modules[r]=e,t.call(e.exports,e,e.exports),e.exports}var n=Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(r,t){$parcel$inits[r]=t},$parcel$global.parcelRequire68ed=parcelRequire);var parcelRegister=parcelRequire.register;parcelRegister("1ijf9",function(module,exports){(function(){var $,ABS,ADD,ADJ,AND,APPROXRATIO,ARCCOS,ARCCOSH,ARCSIN,ARCSINH,ARCTAN,ARCTANH,ARG,ASSUME_REAL_VARIABLES,ATOMIZE,AUTOEXPAND,BAKE,BESSELJ,BESSELY,BINDING,BINOMIAL,BINOM_check_args,BUF,C1,C2,C3,C4,C5,C6,CEILING,CHECK,CHOOSE,CIRCEXP,CLEAR,CLEARALL,CLEARPATTERNS,CLOCK,COEFF,COFACTOR,CONDENSE,CONJ,CONS,CONTRACT,COS,COSH,Condense,DEBUG,DEBUG_ABS,DEBUG_ARG,DEBUG_CLOCKFORM,DEBUG_IMAG,DEBUG_IS,DEBUG_MULTIPLY,DEBUG_POWER,DEBUG_RATIONALIZE,DEBUG_RECT,DEBUG_SIMPLIFY,DECOMP,DEFINT,DEGREE,DENOMINATOR,DERIVATIVE,DET,DET_check_arg,DIM,DIRAC,DIVISORS,DO,DOT,DOUBLE,DRAW,DRAWX,DSOLVE,E,EIGEN,EIGENVAL,EIGENVEC,EIG_N,EIG_check_arg,EIG_yydd,EIG_yyqq,ERF,ERFC,EVAL,EXP,EXPAND,EXPCOS,EXPSIN,Eval,Eval_Eval,Eval_abs,Eval_add,Eval_adj,Eval_and,Eval_approxratio,Eval_arccos,Eval_arccosh,Eval_arcsin,Eval_arcsinh,Eval_arctan,Eval_arctanh,Eval_arg,Eval_besselj,Eval_bessely,Eval_binding,Eval_binomial,Eval_ceiling,Eval_check,Eval_choose,Eval_circexp,Eval_clear,Eval_clearall,Eval_clearpatterns,Eval_clock,Eval_coeff,Eval_cofactor,Eval_condense,Eval_conj,Eval_cons,Eval_contract,Eval_cos,Eval_cosh,Eval_decomp,Eval_defint,Eval_degree,Eval_denominator,Eval_derivative,Eval_det,Eval_dim,Eval_dirac,Eval_divisors,Eval_do,Eval_dsolve,Eval_eigen,Eval_eigenval,Eval_eigenvec,Eval_erf,Eval_erfc,Eval_exp,Eval_expand,Eval_expcos,Eval_expsin,Eval_factor,Eval_factorial,Eval_factorpoly,Eval_filter,Eval_float,Eval_floor,Eval_for,Eval_function_reference,Eval_gamma,Eval_gcd,Eval_hermite,Eval_hilbert,Eval_imag,Eval_index,Eval_inner,Eval_integral,Eval_inv,Eval_invg,Eval_isinteger,Eval_isprime,Eval_laguerre,Eval_lcm,Eval_leading,Eval_legendre,Eval_log,Eval_lookup,Eval_mod,Eval_multiply,Eval_noexpand,Eval_not,Eval_nroots,Eval_number,Eval_numerator,Eval_operator,Eval_or,Eval_outer,Eval_pattern,Eval_patternsinfo,Eval_polar,Eval_power,Eval_predicate,Eval_prime,Eval_print,Eval_print2dascii,Eval_printcomputer,Eval_printhuman,Eval_printlatex,Eval_printlist,Eval_product,Eval_quote,Eval_quotient,Eval_rank,Eval_rationalize,Eval_real,Eval_rect,Eval_roots,Eval_round,Eval_setq,Eval_sgn,Eval_shape,Eval_silentpattern,Eval_simfac,Eval_simplify,Eval_sin,Eval_sinh,Eval_sqrt,Eval_stop,Eval_subst,Eval_sum,Eval_sym,Eval_symbolsinfo,Eval_tan,Eval_tanh,Eval_taylor,Eval_tensor,Eval_test,Eval_testeq,Eval_testge,Eval_testgt,Eval_testle,Eval_testlt,Eval_transpose,Eval_unit,Eval_user_function,Eval_zero,Evalpoly,FACTOR,FACTORIAL,FACTORPOLY,FILTER,FLOATF,FLOOR,FOR,FORCE_FIXED_PRINTOUT,FUNCTION,Find,GAMMA,GCD,HERMITE,HILBERT,IMAG,INDEX,INNER,INTEGRAL,INV,INVG,INV_check_arg,INV_decomp,ISINTEGER,ISPRIME,LAGUERRE,LAST,LAST_2DASCII_PRINT,LAST_FULL_PRINT,LAST_LATEX_PRINT,LAST_LIST_PRINT,LAST_PLAIN_PRINT,LAST_PRINT,LCM,LEADING,LEGENDRE,LOG,LOOKUP,M,MAXDIM,MAXPRIMETAB,MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES,MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE,MAX_FIXED_PRINTOUT_DIGITS,MAX_PROGRAM_SIZE,MEQUAL,METAA,METAB,METAX,MLENGTH,MOD,MSIGN,MULTIPLY,MZERO,N,NIL,NOT,NROOTS,NROOTS_ABS,NROOTS_DELTA,NROOTS_EPSILON,NROOTS_RANDOM,NROOTS_YMAX,NROOTS_divpoly,NSYM,NUM,NUMBER,NUMERATOR,OPERATOR,OR,OUTER,PATTERN,PATTERNSINFO,PI,POLAR,POWER,PRIME,PRINT,PRINT2DASCII,PRINTFULL,PRINTLATEX,PRINTLIST,PRINTMODE_2DASCII,PRINTMODE_COMPUTER,PRINTMODE_HUMAN,PRINTMODE_LATEX,PRINTMODE_LIST,PRINTOUTRESULT,PRINTPLAIN,PRINT_LEAVE_E_ALONE,PRINT_LEAVE_X_ALONE,PRODUCT,QUOTE,QUOTIENT,RANK,RATIONALIZE,REAL,ROOTS,ROUND,SECRETX,SELFTEST,SETQ,SGN,SHAPE,SILENTPATTERN,SIMPLIFY,SIN,SINH,SPACE_BETWEEN_COLUMNS,SPACE_BETWEEN_ROWS,SQRT,STOP,STR,SUBST,SUM,SYM,SYMBOLSINFO,SYMBOL_A,SYMBOL_A_UNDERSCORE,SYMBOL_B,SYMBOL_B_UNDERSCORE,SYMBOL_C,SYMBOL_D,SYMBOL_I,SYMBOL_IDENTITY_MATRIX,SYMBOL_J,SYMBOL_N,SYMBOL_R,SYMBOL_S,SYMBOL_T,SYMBOL_X,SYMBOL_X_UNDERSCORE,SYMBOL_Y,SYMBOL_Z,TAN,TANH,TAYLOR,TENSOR,TEST,TESTEQ,TESTGE,TESTGT,TESTLE,TESTLT,TIMING_DEBUGS,TOS,TRACE,TRANSPOSE,T_DOUBLE,T_EQ,T_FUNCTION,T_GTEQ,T_INTEGER,T_LTEQ,T_NEQ,T_NEWLINE,T_QUOTASSIGN,T_STRING,T_SYMBOL,U,UNIT,USR_SYMBOLS,VERSION,YMAX,YYE,YYRECT,ZERO,__emit_char,__emit_str,__factor_add,__factorial,__is_negative,__is_radical_number,__lcm,__legendre,__legendre2,__legendre3,__normalize_radical_factors,__rationalize_tensor,_print,abs,absValFloat,absval,absval_tensor,add,addSymbolLeftOfAssignment,addSymbolRightOfAssignment,add_all,add_factor_to_accumulator,add_numbers,add_terms,addf,adj,alloc_tensor,allocatedId,any_denominators,approxAll,approxLogs,approxLogsOfRationals,approxOneRatioOnly,approxRadicals,approxRadicalsOfRationals,approxRationalsOfLogs,approxRationalsOfPowersOfE,approxRationalsOfPowersOfPI,approxRationalsOfRadicals,approxSineOfRationalMultiplesOfPI,approxSineOfRationals,approxTrigonometric,approx_just_an_integer,approx_logarithmsOfRationals,approx_nothingUseful,approx_radicalOfRatio,approx_ratioOfRadical,approx_rationalOfE,approx_rationalOfPi,approx_rationalsOfLogarithms,approx_sine_of_pi_times_rational,approx_sine_of_rational,approxratioRecursive,arccos,arccosh,arcsin,arcsinh,arctan,arctanh,areunivarpolysfactoredorexpandedform,arg,arglist,assignmentFound,avoidCalculatingPowersIntoArctans,bake,bake_poly,bake_poly_term,besselj,bessely,bigInt,bignum_factorial,bignum_float,bignum_power_number,bignum_scan_float,bignum_scan_integer,bignum_truncate,binding,binomial,buffer,build_tensor,caaddr,caadr,caar,cadaddr,cadadr,cadar,caddaddr,caddadr,caddar,caddddr,cadddr,caddr,cadr,called_from_Algebra_block,car,cdaddr,cdadr,cdar,cddaddr,cddar,cdddaddr,cddddr,cdddr,cddr,cdr,ceiling,chainOfUserSymbolsNotFunctionsBeingEvaluated,charTabIndex,chartab,checkFloatHasWorkedOutCompletely,check_esc_flag,check_stack,check_tensor_dimensions,choose,choose_check_args,circexp,clearAlgebraEnvironment,clearRenamedVariablesToAvoidBindingToExternalScope,clear_symbols,clear_term,clearall,clockform,cmpGlyphs,cmp_args,cmp_expr,cmp_terms,cmp_terms_count,codeGen,coeff,cofactor,collectLatexStringFromReturnValue,collectUserSymbols,combine_factors,combine_gammas,combine_terms,compareState,compare_numbers,compare_rationals,compare_tensors,compatible,computeDependenciesFromAlgebra,computeResultsAndJavaScriptFromAlgebra,compute_fa,conjugate,cons,consCount,contract,convert_bignum_to_double,convert_rational_to_double,copy_tensor,cosine,cosine_of_angle,cosine_of_angle_sum,count,countOccurrencesOfSymbol,count_denominators,counter,countsize,d_scalar_scalar,d_scalar_scalar_1,d_scalar_tensor,d_tensor_scalar,d_tensor_tensor,dabs,darccos,darccosh,darcsin,darcsinh,darctan,darctanh,dbesselj0,dbesseljn,dbessely0,dbesselyn,dcos,dcosh,dd,decomp,decomp_product,decomp_sum,defineSomeHandyConstants,define_user_function,defn,defn_str,degree,denominator,derf,derfc,derivative,derivative_of_integral,det,determinant,detg,dfunction,dhermite,dirac,display,display_flag,displaychar,divide,divide_numbers,divisors,divisors_onstack,divpoly,dlog,do_clearPatterns,do_clearall,do_simplify_nested_radicals,dontCreateNewRadicalsInDenominatorWhenEvalingMultiplication,dotprod_unicode,doubleToReasonableString,dpow,dpower,dproduct,draw_flag,draw_stop_return,dsgn,dsin,dsinh,dsum,dtan,dtanh,dupl,eigen,elelmIndex,elem,emit_denominator,emit_denominators,emit_expr,emit_factor,emit_factorial_function,emit_flat_tensor,emit_fraction,emit_function,emit_index_function,emit_multiply,emit_number,emit_numerators,emit_numerical_fraction,emit_power,emit_string,emit_subexpr,emit_symbol,emit_tensor,emit_tensor_inner,emit_term,emit_top_expr,emit_unsigned_expr,emit_x,equal,equaln,equalq,erfc,errorMessage,esc_flag,evaluatingAsFloats,evaluatingPolar,exec,expand,expand_get_A,expand_get_AF,expand_get_B,expand_get_C,expand_get_CF,expand_tensor,expanding,expcos,exponential,expr_level,expsin,f1,f10,f2,f3,f4,f5,f9,f_equals_a,factor,factor_a,factor_again,factor_b,factor_number,factor_small_number,factor_term,factorial,factorpoly,factors,fill_buf,filter,filter_main,filter_sum,filter_tensor,findDependenciesInScript,findPossibleClockForm,findPossibleExponentialForm,findroot,fixup_fraction,fixup_power,flag,floatToRatioRoutine,fmt_index,fmt_level,fmt_x,frame,freeze,functionInvokationsScanningStack,gamma,gamma_of_sum,gammaf,gcd,gcd_main,gcd_numbers,gcd_polys,gcd_powers_with_same_base,gcd_product_product,gcd_product_sum,gcd_sum,gcd_sum_product,gcd_sum_sum,gen,getSimpleRoots,getStateHash,get_binding,get_factor_from_complex_root,get_factor_from_real_root,get_innerprod_factors,get_next_token,get_printname,get_size,get_token,getdisplaystr,glyph,gp,guess,hasImaginaryCoeff,hasNegativeRationalExponent,hash_addition,hash_function,hash_multiplication,hash_power,hashcode_values,hashed_itab,hermite,hilbert,i1,imag,imaginaryunit,index_function,init,initNRoots,inited,inner,inner_f,input_str,integral,integral_of_form,integral_of_product,integral_of_sum,inv,inverse,invert_number,invg,isNumberOneOverSomething,isNumericAtom,isNumericAtomOrTensor,isSimpleRoot,isSmall,isSymbolLeftOfAssignment,isSymbolReclaimable,isZeroAtom,isZeroAtomOrTensor,isZeroLikeOrNonZeroLikeOrUndetermined,isZeroTensor,is_denominator,is_factor,is_small_integer,is_square_matrix,is_usr_symbol,isadd,isalnumorunderscore,isalpha,isalphaOrUnderscore,iscomplexnumber,iscomplexnumberdouble,iscons,isdenominator,isdigit,isdouble,iseveninteger,isfactor,isfactorial,isfloating,isfraction,isidentitymatrix,isimaginarynumber,isimaginarynumberdouble,isimaginaryunit,isinnerordot,isinteger,isintegerfactor,isintegerorintegerfloat,isinv,iskeyword,isminusone,isminusoneoversqrttwo,isminusoneovertwo,isminussqrtthreeovertwo,ismultiply,isnegative,isnegativenumber,isnegativeterm,isnonnegativeinteger,isnpi,isone,isoneover,isoneoversqrttwo,isoneovertwo,isplusone,isplustwo,ispolyexpandedform,ispolyexpandedform_expr,ispolyexpandedform_factor,ispolyexpandedform_term,ispolyfactoredorexpandedform,ispolyfactoredorexpandedform_factor,ispolyfactoredorexpandedform_power,isposint,ispositivenumber,ispower,isquarterturn,isrational,isspace,issqrtthree,issqrtthreeovertwo,isstr,issymbol,issymbolic,istensor,istranspose,isunderscore,isunivarpolyfactoredorexpandedform,itab,italu_hashcode,j1,laguerre,laguerre2,lastFoundSymbol,latexErrorSign,lcm,leading,legendre,length,lessp,level,list,listLength,logarithm,logbuf,lookupsTotal,lu_decomp,madd,makePositive,makeSignSameAs,make_hashed_itab,mask,mcmp,mcmpint,mdiv,mdivrem,meta_mode,mgcd,mini_solve,mint,mmod,mmul,mod,monic,move,moveTos,mp_clr_bit,mp_denominator,mp_numerator,mp_set_bit,mpow,mprime,mroot,mshiftright,msub,mtotal,multinomial_sum,multiply,multiply_all,multiply_all_noexpand,multiply_consecutive_constants,multiply_denominators,multiply_denominators_factor,multiply_denominators_term,multiply_noexpand,multiply_numbers,n_factor_number,negate,negate_expand,negate_noexpand,negate_number,new_integer,new_string,newline_flag,nil_symbols,normaliseDots,normalisedCoeff,normalize_angle,nroots_a,nroots_b,nroots_c,nroots_df,nroots_dx,nroots_fa,nroots_fb,nroots_x,nroots_y,nterms,nthCadr,numerator,numericRootOfPolynomial,o,one,oneElement,one_as_double,out_buf,out_count,out_of_memory,outer,p0,p1,p2,p3,p4,p5,p6,p7,p8,p9,parse,parse_internal,parse_p1,parse_p2,parse_time_simplifications,partition,patternHasBeenFound,patternsinfo,performing_roots,polar,polarRectAMinusOneBase,polyform,pop,pop_double,pop_frame,pop_integer,power,power_str,power_sum,power_tensor,predefinedSymbolsInGlobalScope_doNotTrackInDependencies,prime,primetab,print2dascii,printMode,print_ABS_latex,print_ARCCOS_codegen,print_ARCSIN_codegen,print_ARCTAN_codegen,print_BINOMIAL_latex,print_COS_codegen,print_DEFINT_latex,print_DOT_codegen,print_DOT_latex,print_DO_codegen,print_FOR_codegen,print_INV_codegen,print_INV_latex,print_PRODUCT_codegen,print_PRODUCT_latex,print_SETQ_codegen,print_SIN_codegen,print_SQRT_latex,print_SUM_codegen,print_SUM_latex,print_TAN_codegen,print_TESTEQ_latex,print_TESTGE_latex,print_TESTGT_latex,print_TESTLE_latex,print_TESTLT_latex,print_TEST_codegen,print_TEST_latex,print_TRANSPOSE_codegen,print_TRANSPOSE_latex,print_UNIT_codegen,print_a_over_b,print_base,print_base_of_denom,print_char,print_denom,print_double,print_expo_of_denom,print_exponent,print_expr,print_factor,print_factorial_function,print_glyphs,print_index_function,print_list,print_multiply_sign,print_number,print_power,print_str,print_subexpr,print_tensor,print_tensor_inner,print_tensor_inner_latex,print_tensor_latex,print_term,printchar,printchar_nowrap,printline,program_buf,promote_tensor,push,pushTryNotToDuplicate,push_cars,push_double,push_factor,push_frame,push_identity_matrix,push_integer,push_rational,push_symbol,push_term_factors,push_terms,push_zero_matrix,qadd,qdiv,qmul,qpow,qpowf,quickfactor,quickpower,rational,rationalize,rationalize_coefficients,real,reciprocate,rect,recursionLevelNestedRadicalsRemoval,recursiveDependencies,ref,ref1,rememberPrint,remove_negative_exponents,reset_after_error,restore,restoreMetaBindings,rewrite_args,rewrite_args_tensor,roots,roots2,roots3,run,runUserDefinedSimplifications,save,saveMetaBindings,scalar_times_tensor,scan,scan_error,scan_expression,scan_factor,scan_function_call_with_function_name,scan_function_call_without_function_name,scan_index,scan_meta,scan_power,scan_relation,scan_stmt,scan_str,scan_string,scan_subexpr,scan_symbol,scan_tensor,scan_term,scanned,scanningParameters,setM,setSignTo,set_binding,set_component,setq_indexed,sfac_product,sfac_product_f,sgn,shape,show_power_debug,sign,sign_of_term,simfac,simfac_term,simpleComplexityMeasure,simplify,simplifyForCodeGeneration,simplify_1_in_products,simplify_main,simplify_nested_radicals,simplify_polar,simplify_polarRect,simplify_rational_expressions,simplify_rectToClock,simplify_tensor,simplify_trig,simplifyfactorials,sine,sine_of_angle,sine_of_angle_sum,skipRootVariableToBeSolved,sort_stack,square,ssqrt,stack,stackAddsCount,std_symbol,step,step2,stop,strcmp,stringsEmittedByUserPrintouts,subf,subst,subtract,subtract_numbers,swap,symbol,symbolsDependencies,symbolsHavingReassignments,symbolsInExpressionsWithoutAssignments,symbolsLeftOfAssignment,symbolsRightOfAssignment,symbolsinfo,symnum,symtab,take_care_of_nested_radicals,tangent,taylor,tensor,tensor_plus_tensor,tensor_times_scalar,testApprox,test_flag,text_metric,theRandom,token,token_buf,token_str,top,top_level_eval,tos,transform,transpose,transpose_unicode,trigmode,trivial_divide,try_kth_prime,turnErrorMessageToLatex,ucmp,unfreeze,unique,unique_f,update_token_buf,userSimplificationsInListForm,userSimplificationsInStringForm,usr_symbol,verbosing,version,will_be_displayed_as_fraction,ybinomial,ycosh,ydirac,yerf,yerfc,yfloor,yindex,yround,ysinh,yyarg,yybesselj,yybessely,yyceiling,yycondense,yycontract,yycosh,yydegree,yydetg,yydivpoly,yyerf,yyerfc,yyexpand,yyfactorpoly,yyfloat,yyfloor,yyhermite,yyhermite2,yyinvg,yylcm,yylog,yymultiply,yyouter,yypower,yyrationalize,yyround,yysgn,yysimfac,yysinh,yytangent,zero,zzfloat,hasProp={}.hasOwnProperty;for(bigInt=parcelRequire("8gM4d"),version="1.4.0",SELFTEST=1,NSYM=1e3,DEBUG=!1,PRINTOUTRESULT=!1,PRINTMODE_LATEX="PRINTMODE_LATEX",PRINTMODE_2DASCII="PRINTMODE_2DASCII",PRINTMODE_COMPUTER="PRINTMODE_COMPUTER",PRINTMODE_HUMAN="PRINTMODE_HUMAN",PRINTMODE_LIST="PRINTMODE_LIST",printMode=PRINTMODE_COMPUTER,dontCreateNewRadicalsInDenominatorWhenEvalingMultiplication=!0,recursionLevelNestedRadicalsRemoval=0,do_simplify_nested_radicals=!0,avoidCalculatingPowersIntoArctans=!0,rational=(function(){class r{}return r.prototype.a=null,r.prototype.b=null,r}).call(this),U=(function(){class r{toString(){return print_expr(this)}toLatexString(){return collectLatexStringFromReturnValue(this)}constructor(){this.cons={},this.cons.car=null,this.cons.cdr=null,this.q=new rational}}return r.prototype.cons=null,r.prototype.printname="",r.prototype.str="",r.prototype.tensor=null,r.prototype.q=null,r.prototype.d=0,r.prototype.k=0,r.prototype.tag=0,r}).call(this),errorMessage="",CONS=0,NUM=1,DOUBLE=2,STR=3,TENSOR=4,SYM=5,counter=0,ABS=counter++,ADD=counter++,ADJ=counter++,AND=counter++,APPROXRATIO=counter++,ARCCOS=counter++,ARCCOSH=counter++,ARCSIN=counter++,ARCSINH=counter++,ARCTAN=counter++,ARCTANH=counter++,ARG=counter++,ATOMIZE=counter++,BESSELJ=counter++,BESSELY=counter++,BINDING=counter++,BINOMIAL=counter++,CEILING=counter++,CHECK=counter++,CHOOSE=counter++,CIRCEXP=counter++,CLEAR=counter++,CLEARALL=counter++,CLEARPATTERNS=counter++,CLOCK=counter++,COEFF=counter++,COFACTOR=counter++,CONDENSE=counter++,CONJ=counter++,CONTRACT=counter++,COS=counter++,COSH=counter++,DECOMP=counter++,DEFINT=counter++,DEGREE=counter++,DENOMINATOR=counter++,DERIVATIVE=counter++,DET=counter++,DIM=counter++,DIRAC=counter++,DIVISORS=counter++,DO=counter++,DOT=counter++,DRAW=counter++,DSOLVE=counter++,EIGEN=counter++,EIGENVAL=counter++,EIGENVEC=counter++,ERF=counter++,ERFC=counter++,EVAL=counter++,EXP=counter++,EXPAND=counter++,EXPCOS=counter++,EXPSIN=counter++,FACTOR=counter++,FACTORIAL=counter++,FACTORPOLY=counter++,FILTER=counter++,FLOATF=counter++,FLOOR=counter++,FOR=counter++,FUNCTION=counter++,GAMMA=counter++,GCD=counter++,HERMITE=counter++,HILBERT=counter++,IMAG=counter++,INDEX=counter++,INNER=counter++,INTEGRAL=counter++,INV=counter++,INVG=counter++,ISINTEGER=counter++,ISPRIME=counter++,LAGUERRE=counter++,LCM=counter++,LEADING=counter++,LEGENDRE=counter++,LOG=counter++,LOOKUP=counter++,MOD=counter++,MULTIPLY=counter++,NOT=counter++,NROOTS=counter++,NUMBER=counter++,NUMERATOR=counter++,OPERATOR=counter++,OR=counter++,OUTER=counter++,PATTERN=counter++,PATTERNSINFO=counter++,POLAR=counter++,POWER=counter++,PRIME=counter++,PRINT_LEAVE_E_ALONE=counter++,PRINT_LEAVE_X_ALONE=counter++,PRINT=counter++,PRINT2DASCII=counter++,PRINTFULL=counter++,PRINTLATEX=counter++,PRINTLIST=counter++,PRINTPLAIN=counter++,PRODUCT=counter++,QUOTE=counter++,QUOTIENT=counter++,RANK=counter++,RATIONALIZE=counter++,REAL=counter++,ROUND=counter++,YYRECT=counter++,ROOTS=counter++,SETQ=counter++,SGN=counter++,SILENTPATTERN=counter++,SIMPLIFY=counter++,SIN=counter++,SINH=counter++,SHAPE=counter++,SQRT=counter++,STOP=counter++,SUBST=counter++,SUM=counter++,SYMBOLSINFO=counter++,TAN=counter++,TANH=counter++,TAYLOR=counter++,TEST=counter++,TESTEQ=counter++,TESTGE=counter++,TESTGT=counter++,TESTLE=counter++,TESTLT=counter++,TRANSPOSE=counter++,UNIT=counter++,ZERO=counter++,NIL=counter++,LAST=counter++,LAST_PRINT=counter++,LAST_2DASCII_PRINT=counter++,LAST_FULL_PRINT=counter++,LAST_LATEX_PRINT=counter++,LAST_LIST_PRINT=counter++,LAST_PLAIN_PRINT=counter++,AUTOEXPAND=counter++,BAKE=counter++,ASSUME_REAL_VARIABLES=counter++,TRACE=counter++,FORCE_FIXED_PRINTOUT=counter++,MAX_FIXED_PRINTOUT_DIGITS=counter++,YYE=counter++,DRAWX=counter++,METAA=counter++,METAB=counter++,METAX=counter++,SECRETX=counter++,VERSION=counter++,PI=counter++,SYMBOL_A=counter++,SYMBOL_B=counter++,SYMBOL_C=counter++,SYMBOL_D=counter++,SYMBOL_I=counter++,SYMBOL_J=counter++,SYMBOL_N=counter++,SYMBOL_R=counter++,SYMBOL_S=counter++,SYMBOL_T=counter++,SYMBOL_X=counter++,SYMBOL_Y=counter++,SYMBOL_Z=counter++,SYMBOL_IDENTITY_MATRIX=counter++,SYMBOL_A_UNDERSCORE=counter++,SYMBOL_B_UNDERSCORE=counter++,SYMBOL_X_UNDERSCORE=counter++,C1=counter++,C2=counter++,C3=counter++,C4=counter++,C5=counter++,C6=counter++,USR_SYMBOLS=counter++,E=YYE,TOS=1e5,BUF=1e4,MAX_PROGRAM_SIZE=100001,MAXPRIMETAB=1e4,MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES=5,MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE=10,MAXDIM=24,symbolsDependencies={},symbolsHavingReassignments=[],symbolsInExpressionsWithoutAssignments=[],patternHasBeenFound=!1,predefinedSymbolsInGlobalScope_doNotTrackInDependencies=["rationalize","abs","e","i","pi","sin","ceiling","cos","roots","integral","derivative","defint","sqrt","eig","cov","deig","dcov","float","floor","product","root","round","sum","test","unit"],parse_time_simplifications=!0,chainOfUserSymbolsNotFunctionsBeingEvaluated=[],stringsEmittedByUserPrintouts="",called_from_Algebra_block=!1,tensor=(function(){class r{constructor(){this.dim=function(){var r,t,e;for(r=0,e=[],t=MAXDIM;0<=t?r<=t:r>=t;0<=t?r++:r--)e.push(0);return e}(),this.elem=[]}}return r.prototype.ndim=0,r.prototype.dim=null,r.prototype.nelem=0,r.prototype.elem=null,r}).call(this),display=(function(){class r{}return r.prototype.h=0,r.prototype.w=0,r.prototype.n=0,r.prototype.a=[],r}).call(this),text_metric=(function(){class r{}return r.prototype.ascent=0,r.prototype.descent=0,r.prototype.width=0,r}).call(this),tos=0,expanding=0,evaluatingAsFloats=0,evaluatingPolar=0,fmt_x=0,fmt_index=0,fmt_level=0,verbosing=0,primetab=function(){var r,t,e,n;for(n=[2],t=3;n.length<MAXPRIMETAB;){for(e=0,r=Math.sqrt(t);e<n.length&&n[e]<=r;){if(t%n[e]==0){e=-1;break}e++}-1!==e&&n.push(t),t+=2}return n[MAXPRIMETAB]=0,n}(),esc_flag=0,draw_flag=0,mtotal=0,trigmode=0,logbuf="",program_buf="",symtab=[],binding=[],isSymbolReclaimable=[],arglist=[],stack=[],frame=0,p0=null,p1=null,p2=null,p3=null,p4=null,p5=null,p6=null,p7=null,p8=null,p9=null,zero=null,one=null,one_as_double=null,imaginaryunit=null,out_buf="",out_count=0,test_flag=0,codeGen=!1,draw_stop_return=null,userSimplificationsInListForm=[],userSimplificationsInStringForm=[],transpose_unicode=7488,dotprod_unicode=183,symbol=function(r){return symtab[r]},iscons=function(r){return r.k===CONS},isrational=function(r){return r.k===NUM},isdouble=function(r){return r.k===DOUBLE},isNumericAtom=function(r){return isrational(r)||isdouble(r)},isstr=function(r){return r.k===STR},istensor=function(r){if(null!=r)return r.k===TENSOR},isNumericAtomOrTensor=function(r){var t,e,n,o,i;if(isNumericAtom(r)||r===symbol(SYMBOL_IDENTITY_MATRIX))return 1;if(!istensor(r)&&!isNumericAtom(r))return 0;for(n=r.tensor.nelem,t=r.tensor.elem,e=o=0,i=n;0<=i?o<i:o>i;e=0<=i?++o:--o)if(!isNumericAtomOrTensor(t[e]))return 0;return 1},issymbol=function(r){return r.k===SYM},iskeyword=function(r){return issymbol(r)&&symnum(r)<NIL},car=function(r){return iscons(r)?r.cons.car:symbol(NIL)},cdr=function(r){return iscons(r)?r.cons.cdr:symbol(NIL)},caar=function(r){return car(car(r))},cadr=function(r){return car(cdr(r))},cdar=function(r){return cdr(car(r))},cddr=function(r){return cdr(cdr(r))},caadr=function(r){return car(car(cdr(r)))},caddr=function(r){return car(cdr(cdr(r)))},cadar=function(r){return car(cdr(car(r)))},cdadr=function(r){return cdr(car(cdr(r)))},cddar=function(r){return cdr(cdr(car(r)))},cdddr=function(r){return cdr(cdr(cdr(r)))},caaddr=function(r){return car(car(cdr(cdr(r))))},cadadr=function(r){return car(cdr(car(cdr(r))))},caddar=function(r){return car(cdr(cdr(car(r))))},cdaddr=function(r){return cdr(car(cdr(cdr(r))))},cadddr=function(r){return car(cdr(cdr(cdr(r))))},cddddr=function(r){return cdr(cdr(cdr(cdr(r))))},caddddr=function(r){return car(cdr(cdr(cdr(cdr(r)))))},cadaddr=function(r){return car(cdr(car(cdr(cdr(r)))))},cddaddr=function(r){return cdr(cdr(car(cdr(cdr(r)))))},caddadr=function(r){return car(cdr(cdr(car(cdr(r)))))},cdddaddr=function(r){return cdr(cdr(cdr(car(cdr(cdr(r))))))},caddaddr=function(r){return car(cdr(cdr(car(cdr(cdr(r))))))},listLength=function(r){var t;for(t=-1;iscons(r);)r=cdr(r),t++;return t},nthCadr=function(r,t){var e;for(e=0;e<=t;)r=cdr(r),e++;return car(r)},isadd=function(r){return car(r)===symbol(ADD)},ismultiply=function(r){return car(r)===symbol(MULTIPLY)},ispower=function(r){return car(r)===symbol(POWER)},isfactorial=function(r){return car(r)===symbol(FACTORIAL)},isinnerordot=function(r){return car(r)===symbol(INNER)||car(r)===symbol(DOT)},istranspose=function(r){return car(r)===symbol(TRANSPOSE)},isinv=function(r){return car(r)===symbol(INV)},isidentitymatrix=function(r){return r===symbol(SYMBOL_IDENTITY_MATRIX)},MSIGN=function(r){return r.isPositive()?1:r.isZero()?0:-1},MLENGTH=function(r){return r.toString().length},MZERO=function(r){return r.isZero()},MEQUAL=function(r,t){return r.equals(t)},reset_after_error=function(){return moveTos(0),esc_flag=0,draw_flag=0,frame=TOS,evaluatingAsFloats=0,evaluatingPolar=0},$=null!==exports?exports:this,$.version=version,$.isadd=isadd,$.ismultiply=ismultiply,$.ispower=ispower,$.isfactorial=isfactorial,$.car=car,$.cdr=cdr,$.caar=caar,$.cadr=cadr,$.cdar=cdar,$.cddr=cddr,$.caadr=caadr,$.caddr=caddr,$.cadar=cadar,$.cdadr=cdadr,$.cddar=cddar,$.cdddr=cdddr,$.caaddr=caaddr,$.cadadr=cadadr,$.caddar=caddar,$.cdaddr=cdaddr,$.cadddr=cadddr,$.cddddr=cddddr,$.caddddr=caddddr,$.cadaddr=cadaddr,$.cddaddr=cddaddr,$.caddadr=caddadr,$.cdddaddr=cdddaddr,$.caddaddr=caddaddr,$.symbol=symbol,$.iscons=iscons,$.isrational=isrational,$.isdouble=isdouble,$.isNumericAtom=isNumericAtom,$.isstr=isstr,$.istensor=istensor,$.issymbol=issymbol,$.iskeyword=iskeyword,$.CONS=CONS,$.NUM=NUM,$.DOUBLE=DOUBLE,$.STR=STR,$.TENSOR=TENSOR,$.SYM=SYM,DEBUG_ABS=!1,Eval_abs=function(){return push(cadr(p1)),Eval(),abs()},absValFloat=function(){return Eval(),absval(),Eval(),zzfloat()},abs=function(){var r;if(r=top(),DEBUG_ABS&&console.trace(">>>>  ABS of "+r),numerator(),DEBUG_ABS&&console.log("ABS numerator "+stack[tos-1]),absval(),DEBUG_ABS&&console.log("ABSVAL numerator: "+stack[tos-1]),push(r),denominator(),DEBUG_ABS&&console.log("ABS denominator: "+stack[tos-1]),absval(),DEBUG_ABS&&console.log("ABSVAL denominator: "+stack[tos-1]),divide(),DEBUG_ABS&&console.log("ABSVAL divided: "+stack[tos-1]),DEBUG_ABS)return console.log("<<<<<<<  ABS")},absval=function(){var r,t;if(save(),t=p1=pop(),DEBUG_ABS&&console.log("ABS of "+p1),isZeroAtomOrTensor(p1)){DEBUG_ABS&&console.log(" abs: "+p1+" just zero"),push(zero),DEBUG_ABS&&console.log(" --\x3e ABS of "+t+" : "+stack[tos-1]),restore();return}if(isnegativenumber(p1)){DEBUG_ABS&&console.log(" abs: "+p1+" just a negative"),push(p1),negate(),restore();return}if(ispositivenumber(p1)){DEBUG_ABS&&console.log(" abs: "+p1+" just a positive"),push(p1),DEBUG_ABS&&console.log(" --\x3e ABS of "+t+" : "+stack[tos-1]),restore();return}if(p1===symbol(PI)){DEBUG_ABS&&console.log(" abs: "+p1+" of PI"),push(p1),DEBUG_ABS&&console.log(" --\x3e ABS of "+t+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(ADD)&&(findPossibleClockForm(p1)||findPossibleExponentialForm(p1)||Find(p1,imaginaryunit))){DEBUG_ABS&&console.log(" abs: "+p1+" is a sum"),DEBUG_ABS&&console.log("abs of a sum"),push(p1),rect(),p1=pop(),push(p1),real(),push_integer(2),power(),push(p1),imag(),push_integer(2),power(),add(),push_rational(1,2),power(),simplify_trig(),DEBUG_ABS&&console.log(" --\x3e ABS of "+t+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(POWER)&&equaln(cadr(p1),-1)){DEBUG_ABS&&console.log(" abs: "+p1+" is -1 to any power"),evaluatingAsFloats?(DEBUG_ABS&&console.log(" abs: numeric, so result is 1.0"),push_double(1)):(DEBUG_ABS&&console.log(" abs: symbolic, so result is 1"),push_integer(1)),DEBUG_ABS&&console.log(" --\x3e ABS of "+t+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(POWER)&&ispositivenumber(caddr(p1))){DEBUG_ABS&&console.log(" abs: "+p1+" is something to the power of a positive number"),push(cadr(p1)),abs(),push(caddr(p1)),power(),DEBUG_ABS&&console.log(" --\x3e ABS of "+t+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(POWER)&&cadr(p1)===symbol(E)){DEBUG_ABS&&console.log(" abs: "+p1+" is an exponential"),push(caddr(p1)),real(),exponential(),DEBUG_ABS&&console.log(" --\x3e ABS of "+t+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(MULTIPLY)){for(DEBUG_ABS&&console.log(" abs: "+p1+" is a product"),r=!1,p1=cdr(p1);iscons(p1);)push(car(p1)),absval(),r&&multiply(),r=!0,p1=cdr(p1);DEBUG_ABS&&console.log(" --\x3e ABS of "+t+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(ABS)){DEBUG_ABS&&console.log(" abs: "+p1+" is abs of a abs"),push_symbol(ABS),push(cadr(p1)),list(2),DEBUG_ABS&&console.log(" --\x3e ABS of "+t+" : "+stack[tos-1]),restore();return}if(istensor(p1)){absval_tensor(),restore();return}return(isnegativeterm(p1)||car(p1)===symbol(ADD)&&isnegativeterm(cadr(p1)))&&(push(p1),negate(),p1=pop()),DEBUG_ABS&&console.log(" abs: "+p1+" is nothing decomposable"),push_symbol(ABS),push(p1),list(2),DEBUG_ABS&&console.log(" --\x3e ABS of "+t+" : "+stack[tos-1]),restore()},absval_tensor=function(){return 1!==p1.tensor.ndim&&stop("abs(tensor) with tensor rank > 1"),push(p1),push(p1),conjugate(),inner(),push_rational(1,2),power(),simplify(),Eval()},flag=0,Eval_add=function(){var r;for(r=tos,p1=cdr(p1);iscons(p1);)push(car(p1)),Eval(),p2=pop(),push_terms(p2),p1=cdr(p1);return add_terms(tos-r)},stackAddsCount=0,add_terms=function(r){var t,e,n,o,i,a,s,u,f,l;if(stackAddsCount++,e=0,f=t=tos-r,DEBUG&&console.log("stack before adding terms #"+stackAddsCount),DEBUG)for(e=i=0,a=tos;0<=a?i<a:i>a;e=0<=a?++i:--i)console.log(print_list(stack[e]));for(e=n=0;n<10&&!(r<2)&&(flag=0,(l=stack.slice(t,t+r)).sort(cmp_terms),stack=stack.slice(0,t).concat(l).concat(stack.slice(t+r)),0!==flag);e=++n)r=combine_terms(t,r);switch(moveTos(t+r),r){case 0:evaluatingAsFloats?push_double(0):push(zero);break;case 1:break;default:list(r),p1=pop(),push_symbol(ADD),push(p1),cons()}if(DEBUG&&console.log("stack after adding terms #"+stackAddsCount),DEBUG){for(u=[],e=o=0,s=tos;0<=s?o<s:o>s;e=0<=s?++o:--o)u.push(console.log(print_list(stack[e])));return u}},cmp_terms_count=0,cmp_terms=function(r,t){var e,n,o,i;if(cmp_terms_count++,e=0,isNumericAtom(r)&&isNumericAtom(t))return flag=1,0;if(istensor(r)&&istensor(t)){if(r.tensor.ndim<t.tensor.ndim)return -1;if(r.tensor.ndim>t.tensor.ndim)return 1;for(e=n=0,o=r.tensor.ndim;0<=o?n<o:n>o;e=0<=o?++n:--n){if(r.tensor.dim[e]<t.tensor.dim[e])return -1;if(r.tensor.dim[e]>t.tensor.dim[e])return 1}return flag=1,0}return car(r)===symbol(MULTIPLY)&&isNumericAtom(car(r=cdr(r)))&&(r=cdr(r),cdr(r)===symbol(NIL)&&(r=car(r))),car(t)===symbol(MULTIPLY)&&isNumericAtom(car(t=cdr(t)))&&(t=cdr(t),cdr(t)===symbol(NIL)&&(t=car(t))),0===(i=cmp_expr(r,t))&&(flag=1),i},combine_terms=function(r,t){var e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b;for(e=0;e<t-1;){if(check_esc_flag(),p3=stack[r+e],p4=stack[r+e+1],istensor(p3)&&istensor(p4)){if(push(p3),push(p4),tensor_plus_tensor(),(p1=pop())!==symbol(NIL)){for(stack[r+e]=p1,o=u=f=e+1,l=t-1;f<=l?u<l:u>l;o=f<=l?++u:--u)stack[r+o]=stack[r+o+1];t--,e--}e++;continue}if(istensor(p3)||istensor(p4)){e++;continue}if(isNumericAtom(p3)&&isNumericAtom(p4)){if(push(p3),push(p4),add_numbers(),p1=pop(),isZeroAtomOrTensor(p1)){for(o=n=c=e,p=t-2;c<=p?n<p:n>p;o=c<=p?++n:--n)stack[r+o]=stack[r+o+2];t-=2}else{for(stack[r+e]=p1,o=i=x=e+1,g=t-1;x<=g?i<g:i>g;o=x<=g?++i:--i)stack[r+o]=stack[r+o+1];t--}e--,e++;continue}if(isNumericAtom(p3)||isNumericAtom(p4)||(evaluatingAsFloats?(p1=one_as_double,p2=one_as_double):(p1=one,p2=one),b=0,car(p3)===symbol(MULTIPLY)&&(p3=cdr(p3),b=1,isNumericAtom(car(p3))&&(p1=car(p3),p3=cdr(p3),cdr(p3)===symbol(NIL)&&(p3=car(p3),b=0))),car(p4)===symbol(MULTIPLY)&&isNumericAtom(car(p4=cdr(p4)))&&(p2=car(p4),p4=cdr(p4),cdr(p4)===symbol(NIL)&&(p4=car(p4))),!equal(p3,p4))){e++;continue}if(push(p1),push(p2),add_numbers(),p1=pop(),isZeroAtomOrTensor(p1)){for(o=a=h=e,d=t-2;h<=d?a<d:a>d;o=h<=d?++a:--a)stack[r+o]=stack[r+o+2];t-=2,e--,e++;continue}for(push(p1),b?(push(symbol(MULTIPLY)),push(p3),cons()):push(p3),multiply(),stack[r+e]=pop(),o=s=m=e+1,v=t-1;m<=v?s<v:s>v;o=m<=v?++s:--s)stack[r+o]=stack[r+o+1];t--,e--,e++}return t},push_terms=function(r){var t;if(car(r)===symbol(ADD)){for(r=cdr(r),t=[];iscons(r);)push(car(r)),t.push(r=cdr(r));return t}if(!isZeroAtom(r))return push(r)},add=function(){var r;return save(),p2=pop(),p1=pop(),r=tos,push_terms(p1),push_terms(p2),add_terms(tos-r),restore()},add_all=function(r){var t,e,n,o,i;for(e=0,save(),i=tos-r,t=tos,e=n=0,o=r;0<=o?n<o:n>o;e=0<=o?++n:--n)push_terms(stack[i+e]);return add_terms(tos-t),p1=pop(),moveTos(tos-r),push(p1),restore()},subtract=function(){return negate(),add()},Eval_adj=function(){return push(cadr(p1)),Eval(),adj()},adj=function(){var r,t,e,n,o,i,a,s;for(t=0,n=0,o=0,save(),istensor(p1=pop())&&2===p1.tensor.ndim&&p1.tensor.dim[0]===p1.tensor.dim[1]?r=1:stop("adj: square matrix expected"),o=p1.tensor.dim[0],(p2=alloc_tensor(o*o)).tensor.ndim=2,p2.tensor.dim[0]=o,p2.tensor.dim[1]=o,t=i=0,a=o;0<=a?i<a:i>a;t=0<=a?++i:--i)for(n=e=0,s=o;0<=s?e<s:e>s;n=0<=s?++e:--e)cofactor(p1,o,t,n),p2.tensor.elem[o*n+t]=pop();return push(p2),restore()},Eval_approxratio=function(){var r;return r=cadr(p1),push(r),approxratioRecursive()},approxratioRecursive=function(){var r,t,e,n,o;if(r=0,save(),istensor(p1=pop())){for((p4=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,r=e=0,n=p1.tensor.ndim;0<=n?e<n:e>n;r=0<=n?++e:--e)p4.tensor.dim[r]=p1.tensor.dim[r];for(r=t=0,o=p1.tensor.nelem;0<=o?t<o:t>o;r=0<=o?++t:--t)push(p1.tensor.elem[r]),approxratioRecursive(),p4.tensor.elem[r]=pop(),check_tensor_dimensions(p4);push(p4)}else p1.k===DOUBLE?(push(p1),approxOneRatioOnly()):iscons(p1)?(push(car(p1)),approxratioRecursive(),push(cdr(p1)),approxratioRecursive(),cons()):push(p1);return restore()},approxOneRatioOnly=function(){var r,t,e,n,o;return(zzfloat(),(e=pop()).k===DOUBLE)?void(2===(t=(n=e.d).toString().split(".")).length?(r=1/Math.pow(10,t[1].length),o=floatToRatioRoutine(n,r),push_rational(o[0],o[1])):push_integer(n)):(push_symbol(APPROXRATIO),push(theArgument),list(2))},floatToRatioRoutine=function(r,t){var e,n,o,i,a,s,u;if(o=void 0,n=void 0,e=void 0,s=void 0,i=void 0,a=void 0,u=[0,0],isNaN(r))return u;if(2e308===r)return u[0]=1,u[1]=0,u;if(r===-1/0)return u[0]=-1,u[1]=0,u;if(e=r<0?-1:1,Math.abs((r=Math.abs(r))-Math.floor(r))<t)return o=r*e,n=1,u[0]=o,u[1]=n,u;if(r<1e-19)return o=e,n=1e19,u[0]=o,u[1]=n,u;if(r>1e19)return o=1e19*e,n=1,u[0]=o,u[1]=n,u;for(s=r,i=0,n=1;s=1/(s-Math.floor(s)),a=n,n=n*Math.floor(s)+i,i=a,o=Math.floor(r*n+.5),Math.abs(r-o/n)>t&&s!==Math.floor(s););return o*=e,u[0]=o,u[1]=n,u},approx_just_an_integer=0,approx_sine_of_rational=1,approx_sine_of_pi_times_rational=2,approx_rationalOfPi=3,approx_radicalOfRatio=4,approx_nothingUseful=5,approx_ratioOfRadical=6,approx_rationalOfE=7,approx_logarithmsOfRationals=8,approx_rationalsOfLogarithms=9,approxRationalsOfRadicals=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g,h;if(2!==(h=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(console.log("precision: "+(p=1/Math.pow(10,h[1].length))),t=null,l=Number.MAX_VALUE,c=0,u=(g=[2,3,5,6,7,8,10]).length;c<u;c++)for(i=g[c],s=a=1;a<=10;s=++a)Math.abs(o=Math.sqrt(i)/s)>1e-10?(f=Math.round(x=r/o),n=Math.abs(1-x/f)):(x=1,f=1,n=Math.abs(r-o)),n<2*p&&(e=simpleComplexityMeasure(f,i,s))<l&&(l=e,t=[f+" * sqrt( "+i+" ) / "+s,approx_ratioOfRadical,f,i,s]);return t},approxRadicalsOfRationals=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m;if(2!==(m=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(console.log("precision: "+(x=1/Math.pow(10,m[1].length))),t=null,c=Number.MAX_VALUE,p=0,u=(h=[1,2,3,5,6,7,8,10]).length;p<u;p++)for(a=0,i=h[p],f=(d=[1,2,3,5,6,7,8,10]).length;a<f;a++)Math.abs(o=Math.sqrt(i/(s=d[a])))>1e-10?(l=Math.round(g=r/o),n=Math.abs(1-g/l)):(g=1,l=1,n=Math.abs(r-o)),n<2*x&&(e=simpleComplexityMeasure(l,i,s))<c&&(c=e,t=[l+" * (sqrt( "+i+" / "+s+" )",approx_radicalOfRatio,l,i,s]);return t},approxRadicals=function(r){var t,e,n;return 2!==(n=r.toString().split(".")).length?[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2]:(console.log("precision: "+1/Math.pow(10,n[1].length)),null!=(e=approxRationalsOfRadicals(r)))?e:null!=(t=approxRadicalsOfRationals(r))?t:null},approxLogs=function(r){var t,e,n;return 2!==(n=r.toString().split(".")).length?[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2]:(console.log("precision: "+1/Math.pow(10,n[1].length)),null!=(e=approxRationalsOfLogs(r)))?e:null!=(t=approxLogsOfRationals(r))?t:null},approxRationalsOfLogs=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x;if(2!==(x=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(console.log("precision: "+(c=1/Math.pow(10,x[1].length))),t=null,f=Number.MAX_VALUE,i=l=2;l<=5;i=++l)for(s=a=1;a<=5;s=++a)Math.abs(o=Math.log(i)/s)>1e-10?(u=Math.round(p=r/o),n=Math.abs(1-p/u)):(p=1,u=1,n=Math.abs(r-o)),(1===u||Math.abs(Math.floor(u/s))!==Math.abs(u/s))&&n<2.2*c&&(e=simpleComplexityMeasure(u,i,s))<f&&(f=e,t=[u+" * log( "+i+" ) / "+s,approx_rationalsOfLogarithms,u,i,s]);return t},approxLogsOfRationals=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x;if(2!==(x=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(console.log("precision: "+(c=1/Math.pow(10,x[1].length))),t=null,f=Number.MAX_VALUE,i=l=1;l<=5;i=++l)for(s=a=1;a<=5;s=++a)Math.abs(o=Math.log(i/s))>1e-10?(u=Math.round(p=r/o),n=Math.abs(1-p/u)):(p=1,u=1,n=Math.abs(r-o)),n<1.96*c&&(e=simpleComplexityMeasure(u,i,s))<f&&(f=e,t=[u+" * log( "+i+" / "+s+" )",approx_logarithmsOfRationals,u,i,s]);return t},approxRationalsOfPowersOfE=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x;if(2!==(x=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(console.log("precision: "+(c=1/Math.pow(10,x[1].length))),t=null,f=Number.MAX_VALUE,i=l=1;l<=2;i=++l)for(s=a=1;a<=12;s=++a)Math.abs(o=Math.pow(Math.E,i)/s)>1e-10?(u=Math.round(p=r/o),n=Math.abs(1-p/u)):(p=1,u=1,n=Math.abs(r-o)),n<2*c&&(e=simpleComplexityMeasure(u,i,s))<f&&(f=e,t=[u+" * (e ^ "+i+" ) / "+s,approx_rationalOfE,u,i,s]);return t},approxRationalsOfPowersOfPI=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x;if(2!==(x=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(console.log("precision: "+(c=1/Math.pow(10,x[1].length))),t=null,f=Number.MAX_VALUE,i=l=1;l<=5;i=++l)for(s=a=1;a<=12;s=++a)Math.abs(o=Math.pow(Math.PI,i)/s)>1e-10?(u=Math.round(p=r/o),n=Math.abs(1-p/u)):(p=1,u=1,n=Math.abs(r-o)),n<2*c&&(e=simpleComplexityMeasure(u,i,s))<f&&(f=e,t=[u+" * (pi ^ "+i+" ) / "+s+" )",approx_rationalOfPi,u,i,s]);return t},approxTrigonometric=function(r){var t,e,n;return 2!==(n=r.toString().split(".")).length?[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2]:(console.log("precision: "+1/Math.pow(10,n[1].length)),null!=(e=approxSineOfRationals(r)))?e:null!=(t=approxSineOfRationalMultiplesOfPI(r))?t:null},approxSineOfRationals=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x;if(2!==(x=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(console.log("precision: "+(c=1/Math.pow(10,x[1].length))),t=null,f=Number.MAX_VALUE,i=l=1;l<=4;i=++l)for(s=a=1;a<=4;s=++a)Math.abs(o=Math.sin(i/s))>1e-10?(u=Math.round(p=r/o),n=Math.abs(1-p/u)):(p=1,u=1,n=Math.abs(r-o)),n<2*c&&(e=simpleComplexityMeasure(u,i,s))<f&&(f=e,t=[u+" * sin( "+i+"/"+s+" )",approx_sine_of_rational,u,i,s]);return t},approxSineOfRationalMultiplesOfPI=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x;if(2!==(x=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(console.log("precision: "+(c=1/Math.pow(10,x[1].length))),t=null,f=Number.MAX_VALUE,i=l=1;l<=13;i=++l)for(s=a=1;a<=13;s=++a)Math.abs(o=Math.sin(i/s*Math.PI))>1e-10?(u=Math.round(p=r/o),n=Math.abs(1-p/u)):(p=1,u=1,n=Math.abs(r-o)),n<23*c&&(e=simpleComplexityMeasure(u,i,s))<f&&(f=e,t=[u+" * sin( "+i+"/"+s+" * pi )",approx_sine_of_pi_times_rational,u,i,s]);return t},approxAll=function(r){var t,e,n,o,i,a,s,u,f,l;return 2!==(l=r.toString().split(".")).length?[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2]:(console.log("precision: "+1/Math.pow(10,l[1].length)),f=Number.MAX_VALUE,u=0,s=null,t=!0,null!=(n=approxRadicals(r))&&((u=simpleComplexityMeasure(n))<f?(t&&console.log("better explanation by approxRadicals: "+n+" complexity: "+u),f=u,s=n):t&&console.log("subpar explanation by approxRadicals: "+n+" complexity: "+u)),null!=(e=approxLogs(r))&&((u=simpleComplexityMeasure(e))<f?(t&&console.log("better explanation by approxLogs: "+e+" complexity: "+u),f=u,s=e):t&&console.log("subpar explanation by approxLogs: "+e+" complexity: "+u)),null!=(o=approxRationalsOfPowersOfE(r))&&((u=simpleComplexityMeasure(o))<f?(t&&console.log("better explanation by approxRationalsOfPowersOfE: "+o+" complexity: "+u),f=u,s=o):t&&console.log("subpar explanation by approxRationalsOfPowersOfE: "+o+" complexity: "+u)),null!=(i=approxRationalsOfPowersOfPI(r))&&((u=simpleComplexityMeasure(i))<f?(t&&console.log("better explanation by approxRationalsOfPowersOfPI: "+i+" complexity: "+u),f=u,s=i):t&&console.log("subpar explanation by approxRationalsOfPowersOfPI: "+i+" complexity: "+u)),null!=(a=approxTrigonometric(r))&&((u=simpleComplexityMeasure(a))<f?(t&&console.log("better explanation by approxTrigonometric: "+a+" complexity: "+u),f=u,s=a):t&&console.log("subpar explanation by approxTrigonometric: "+a+" complexity: "+u)),s)},simpleComplexityMeasure=function(r,t,e){var n;if(n=null,r instanceof Array){switch(r[1]){case approx_sine_of_pi_times_rational:n=4;break;case approx_rationalOfPi:n=Math.pow(4,Math.abs(r[3]))*Math.abs(r[2]);break;case approx_rationalOfE:n=Math.pow(3,Math.abs(r[3]))*Math.abs(r[2]);break;default:n=0}n+=Math.abs(r[2])*(Math.abs(r[3])+Math.abs(r[4]))}else n+=Math.abs(r)*(Math.abs(t)+Math.abs(e));return 1===r[2]?n-=1:n+=1,1===r[3]?n-=1:n+=1,1===r[4]?n-=1:n+=1,n<0&&(n=0),n},testApprox=function(){var r,t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k,w,M,_,A,S,E,N,O,P,I,R,T,C,L,B,j,D,z,$,U,F,Z,J,V,X,G,Y,W,Q,H,K,rr,rt,re,rn,ro;for(S=0,g=(C=[2,3,5,6,7,8,10]).length;S<g;S++)for(n=0,e=C[S],h=(L=[2,3,5,6,7,8,10]).length;n<h;n++)e!==(a=L[n])&&(console.log("testapproxRadicals testing: 1 * sqrt( "+e+" ) / "+a),t=e/a,J=(F=approxRadicals(rr=Math.sqrt(e)/a))[2]*Math.sqrt(F[3])/F[4],Math.abs(rr-J)>1e-15&&console.log("fail testapproxRadicals: 1 * sqrt( "+e+" ) / "+a+" . obtained: "+F));for(s=0,d=(B=[2,3,5,6,7,8,10]).length;s<d;s++)for(c=0,e=B[s],m=(j=[2,3,5,6,7,8,10]).length;c<m;c++)e!==(a=j[c])&&(console.log("testapproxRadicals testing with 4 digits: 1 * sqrt( "+e+" ) / "+a),t=e/a,J=(F=approxRadicals(rr=(O=Math.sqrt(e)/a).toFixed(4)))[2]*Math.sqrt(F[3])/F[4],Math.abs(O-J)>1e-15&&console.log("fail testapproxRadicals with 4 digits: 1 * sqrt( "+e+" ) / "+a+" . obtained: "+F));for(k=0,v=(D=[2,3,5,6,7,8,10]).length;k<v;k++)for(_=0,e=D[k],b=(z=[2,3,5,6,7,8,10]).length;_<b;_++)e!==(a=z[_])&&(console.log("testapproxRadicals testing: 1 * sqrt( "+e+" / "+a+" )"),t=e/a,null!=(F=approxRadicals(rr=Math.sqrt(e/a)))&&(J=F[2]*Math.sqrt(F[3]/F[4]),F[1]===approx_radicalOfRatio&&Math.abs(rr-J)>1e-15&&console.log("fail testapproxRadicals: 1 * sqrt( "+e+" / "+a+" ) . obtained: "+F)));for(E=0,y=($=[1,2,3,5,6,7,8,10]).length;E<y;E++)for(P=0,e=$[E],q=(U=[1,2,3,5,6,7,8,10]).length;P<q;P++)a=U[P],(1!==e||1!==a)&&(console.log("testapproxRadicals testing with 4 digits:: 1 * sqrt( "+e+" / "+a+" )"),t=e/a,J=(F=approxRadicals(rr=(O=Math.sqrt(e/a)).toFixed(4)))[2]*Math.sqrt(F[3]/F[4]),F[1]===approx_radicalOfRatio&&Math.abs(O-J)>1e-15&&console.log("fail testapproxRadicals with 4 digits:: 1 * sqrt( "+e+" / "+a+" ) . obtained: "+F));for(e=R=1;R<=5;e=++R)for(a=V=1;V<=5;a=++V)console.log("testApproxAll testing: 1 * log("+e+" ) / "+a),t=e/a,J=(F=approxAll(rr=Math.log(e)/a))[2]*Math.log(F[3])/F[4],Math.abs(rr-J)>1e-15&&console.log("fail testApproxAll: 1 * log("+e+" ) / "+a+" . obtained: "+F);for(e=G=1;G<=5;e=++G)for(a=W=1;W<=5;a=++W)console.log("testApproxAll testing with 4 digits: 1 * log("+e+" ) / "+a),t=e/a,J=(F=approxAll(rr=(O=Math.log(e)/a).toFixed(4)))[2]*Math.log(F[3])/F[4],Math.abs(O-J)>1e-15&&console.log("fail testApproxAll with 4 digits: 1 * log("+e+" ) / "+a+" . obtained: "+F);for(e=H=1;H<=5;e=++H)for(a=rt=1;rt<=5;a=++rt)console.log("testApproxAll testing: 1 * log("+e+" / "+a+" )"),t=e/a,J=(F=approxAll(rr=Math.log(e/a)))[2]*Math.log(F[3]/F[4]),Math.abs(rr-J)>1e-15&&console.log("fail testApproxAll: 1 * log("+e+" / "+a+" ) . obtained: "+F);for(e=rn=1;rn<=5;e=++rn)for(a=o=1;o<=5;a=++o)console.log("testApproxAll testing with 4 digits: 1 * log("+e+" / "+a+" )"),t=e/a,J=(F=approxAll(rr=(O=Math.log(e/a)).toFixed(4)))[2]*Math.log(F[3]/F[4]),Math.abs(O-J)>1e-15&&console.log("fail testApproxAll with 4 digits: 1 * log("+e+" / "+a+" ) . obtained: "+F);for(e=u=1;u<=2;e=++u)for(a=p=1;p<=12;a=++p)console.log("testApproxAll testing: 1 * (e ^ "+e+" ) / "+a),t=e/a,J=(F=approxAll(rr=Math.pow(Math.E,e)/a))[2]*Math.pow(Math.E,F[3])/F[4],Math.abs(rr-J)>1e-15&&console.log("fail testApproxAll: 1 * (e ^ "+e+" ) / "+a+" . obtained: "+F);for(e=w=1;w<=2;e=++w)for(a=A=1;A<=12;a=++A)console.log("approxRationalsOfPowersOfE testing with 4 digits: 1 * (e ^ "+e+" ) / "+a),t=e/a,J=(F=approxRationalsOfPowersOfE(rr=(O=Math.pow(Math.E,e)/a).toFixed(4)))[2]*Math.pow(Math.E,F[3])/F[4],Math.abs(O-J)>1e-15&&console.log("fail approxRationalsOfPowersOfE with 4 digits: 1 * (e ^ "+e+" ) / "+a+" . obtained: "+F);for(e=N=1;N<=2;e=++N)for(a=I=1;I<=12;a=++I)console.log("testApproxAll testing: 1 * pi ^ "+e+" / "+a),t=e/a,J=(F=approxAll(rr=Math.pow(Math.PI,e)/a))[2]*Math.pow(Math.PI,F[3])/F[4],Math.abs(rr-J)>1e-15&&console.log("fail testApproxAll: 1 * pi ^ "+e+" / "+a+" ) . obtained: "+F);for(e=T=1;T<=2;e=++T)for(a=X=1;X<=12;a=++X)console.log("approxRationalsOfPowersOfPI testing with 4 digits: 1 * pi ^ "+e+" / "+a),t=e/a,J=(F=approxRationalsOfPowersOfPI(rr=(O=Math.pow(Math.PI,e)/a).toFixed(4)))[2]*Math.pow(Math.PI,F[3])/F[4],Math.abs(O-J)>1e-15&&console.log("fail approxRationalsOfPowersOfPI with 4 digits: 1 * pi ^ "+e+" / "+a+" ) . obtained: "+F);for(e=Y=1;Y<=4;e=++Y)for(a=Q=1;Q<=4;a=++Q)console.log("testApproxAll testing: 1 * sin( "+e+"/"+a+" )"),Z=(F=approxAll(rr=Math.sin(t=e/a)))[3]/F[4],Math.abs(rr-(J=F[2]*Math.sin(Z)))>1e-15&&console.log("fail testApproxAll: 1 * sin( "+e+"/"+a+" ) . obtained: "+F);for(e=K=1;K<=4;e=++K)for(a=re=1;re<=4;a=++re)console.log("testApproxAll testing with 5 digits: 1 * sin( "+e+"/"+a+" )"),null==(F=approxAll(rr=(O=Math.sin(t=e/a)).toFixed(5)))&&console.log("fail testApproxAll with 5 digits: 1 * sin( "+e+"/"+a+" ) . obtained:  undefined "),Z=F[3]/F[4],(r=Math.abs(O-(J=F[2]*Math.sin(Z))))>1e-14&&console.log("fail testApproxAll with 5 digits: 1 * sin( "+e+"/"+a+" ) . obtained: "+F+" error: "+r);for(e=ro=1;ro<=4;e=++ro)for(a=i=1;i<=4;a=++i)console.log("testApproxAll testing with 4 digits: 1 * sin( "+e+"/"+a+" )"),null==(F=approxAll(rr=(O=Math.sin(t=e/a)).toFixed(4)))&&console.log("fail testApproxAll with 4 digits: 1 * sin( "+e+"/"+a+" ) . obtained:  undefined "),Z=F[3]/F[4],(r=Math.abs(O-(J=F[2]*Math.sin(Z))))>1e-14&&console.log("fail testApproxAll with 4 digits: 1 * sin( "+e+"/"+a+" ) . obtained: "+F+" error: "+r);for("0"!==approxAll(rr=0)[0]&&console.log("fail testApproxAll: 0"),"0"!==approxAll(rr=0)[0]&&console.log("fail testApproxAll: 0.0"),"0"!==approxAll(rr=0)[0]&&console.log("fail testApproxAll: 0.00"),"0"!==approxAll(rr=0)[0]&&console.log("fail testApproxAll: 0.000"),"0"!==approxAll(rr=0)[0]&&console.log("fail testApproxAll: 0.0000"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.0"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.00"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.000"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.0000"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.00000"),"1 * sqrt( 2 ) / 1"!==approxAll(rr=Math.sqrt(2))[0]&&console.log("fail testApproxAll: Math.sqrt(2)"),"1 * sqrt( 2 ) / 1"!==approxAll(rr=1.41)[0]&&console.log("fail testApproxAll: 1.41"),"1 * sqrt( 2 ) / 1"!==approxRadicals(rr=1.4)[0]&&console.log("fail approxRadicals: 1.4"),"1 * log( 2 ) / 1"!==approxLogs(rr=.6)[0]&&console.log("fail approxLogs: 0.6"),"1 * log( 2 ) / 1"!==approxLogs(rr=.69)[0]&&console.log("fail approxLogs: 0.69"),"1 * log( 2 ) / 1"!==approxLogs(rr=.7)[0]&&console.log("fail approxLogs: 0.7"),"1 * log( 3 ) / 1"!==approxLogs(rr=1.09)[0]&&console.log("fail approxLogs: 1.09"),"1 * log( 3 ) / 1"!==approxAll(rr=1.09)[0]&&console.log("fail approxAll: 1.09"),"1 * log( 3 ) / 1"!==approxAll(rr=1.098)[0]&&console.log("fail approxAll: 1.098"),"1 * log( 3 ) / 1"!==approxAll(rr=1.1)[0]&&console.log("fail approxAll: 1.1"),"1 * log( 3 ) / 1"!==approxAll(rr=1.11)[0]&&console.log("fail approxAll: 1.11"),"1 * sqrt( 3 ) / 1"!==approxAll(rr=Math.sqrt(3))[0]&&console.log("fail testApproxAll: Math.sqrt(3)"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.0000"),"1 * (pi ^ 1 ) / 1 )"!==approxAll(rr=3.141592)[0]&&console.log("fail testApproxAll: 3.141592"),"10 * (pi ^ 1 ) / 1 )"!==approxAll(rr=31.41592)[0]&&console.log("fail testApproxAll: 31.41592"),"100 * (pi ^ 1 ) / 1 )"!==approxAll(rr=314.1592)[0]&&console.log("fail testApproxAll: 314.1592"),"10000000 * (pi ^ 1 ) / 1 )"!==approxAll(rr=31415926.53589793)[0]&&console.log("fail testApproxAll: 31415926.53589793"),"2 * sin( 1/4 * pi )"!==approxTrigonometric(rr=Math.sqrt(2))[0]&&console.log("fail approxTrigonometric: Math.sqrt(2)"),"2 * sin( 1/3 * pi )"!==approxTrigonometric(rr=Math.sqrt(3))[0]&&console.log("fail approxTrigonometric: Math.sqrt(3)"),"1 * sin( 1/12 * pi )"!==approxAll(rr=(Math.sqrt(6)-Math.sqrt(2))/4)[0]&&console.log("fail testApproxAll: (Math.sqrt(6) - Math.sqrt(2))/4"),"1 * sin( 1/8 * pi )"!==approxAll(rr=Math.sqrt(2-Math.sqrt(2))/2)[0]&&console.log("fail testApproxAll: Math.sqrt(2 - Math.sqrt(2))/2"),"1 * sin( 5/12 * pi )"!==approxAll(rr=(Math.sqrt(6)+Math.sqrt(2))/4)[0]&&console.log("fail testApproxAll: (Math.sqrt(6) + Math.sqrt(2))/4"),"1 * sin( 5/12 * pi )"!==approxAll(rr=Math.sqrt(2+Math.sqrt(3))/2)[0]&&console.log("fail testApproxAll: Math.sqrt(2 + Math.sqrt(3))/2"),"1 * sin( 1/10 * pi )"!==approxAll(rr=(Math.sqrt(5)-1)/4)[0]&&console.log("fail testApproxAll: (Math.sqrt(5) - 1)/4"),"1 * sin( 1/5 * pi )"!==approxAll(rr=Math.sqrt(10-2*Math.sqrt(5))/4)[0]&&console.log("fail testApproxAll: Math.sqrt(10 - 2*Math.sqrt(5))/4"),"1 * sin( 1/7 * pi )"!==approxAll(rr=Math.sin(Math.PI/7))[0]&&console.log("fail testApproxAll: Math.sin(Math.PI/7)"),"1 * sin( 1/9 * pi )"!==approxAll(rr=Math.sin(Math.PI/9))[0]&&console.log("fail testApproxAll: Math.sin(Math.PI/9)"),"6 * (pi ^ 5 ) / 1 )"!==approxRationalsOfPowersOfPI(rr=1836.15267)[0]&&console.log("fail approxRationalsOfPowersOfPI: 1836.15267"),e=f=1;f<=13;e=++f)for(a=l=1;l<=13;a=++l)console.log("approxTrigonometric testing: 1 * sin( "+e+"/"+a+" * pi )"),Z=(F=approxTrigonometric(rr=Math.sin(Math.PI*(t=e/a))))[3]/F[4],Math.abs(rr-(J=F[2]*Math.sin(Math.PI*Z)))>1e-15&&console.log("fail approxTrigonometric: 1 * sin( "+e+"/"+a+" * pi ) . obtained: "+F);for(e=x=1;x<=13;e=++x)for(a=M=1;M<=13;a=++M)(5!==e||11!==a)&&(6!==e||11!==a)&&(console.log("approxTrigonometric testing with 4 digits: 1 * sin( "+e+"/"+a+" * pi )"),Z=(F=approxTrigonometric(rr=(O=Math.sin(Math.PI*(t=e/a))).toFixed(4)))[3]/F[4],(r=Math.abs(O-(J=F[2]*Math.sin(Math.PI*Z))))>1e-14&&console.log("fail approxTrigonometric with 4 digits: 1 * sin( "+e+"/"+a+" * pi ) . obtained: "+F+" error: "+r));return console.log("testApprox done")},$.approxRadicals=approxRadicals,$.approxRationalsOfLogs=approxRationalsOfLogs,$.approxAll=approxAll,$.testApprox=testApprox,Eval_arccos=function(){return push(cadr(p1)),Eval(),arccos()},arccos=function(){var r,t,e;if(e=0,r=0,save(),car(p1=pop())===symbol(COS)){push(cadr(p1)),restore();return}if(isdouble(p1)){t=0,r=Math.acos(p1.d),t&&stop("arccos function argument is not in the interval [-1,1]"),push_double(r),restore();return}if(isoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)){evaluatingAsFloats?push_double(Math.PI/4):(push_rational(1,4),push_symbol(PI),multiply()),restore();return}if(isminusoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),-1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)){evaluatingAsFloats?push_double(3*Math.PI/4):(push_rational(3,4),push_symbol(PI),multiply()),restore();return}if(issqrtthreeovertwo(p1)){evaluatingAsFloats?push_double(Math.PI/6):(push_rational(1,6),push_symbol(PI),multiply()),restore();return}if(isminussqrtthreeovertwo(p1)){evaluatingAsFloats?push_double(5*Math.PI/6):(push_rational(5,6),push_symbol(PI),multiply()),restore();return}if(!isrational(p1)){push_symbol(ARCCOS),push(p1),list(2),restore();return}switch(push(p1),push_integer(2),multiply(),e=pop_integer()){case -2:evaluatingAsFloats?push_double(Math.PI):push_symbol(PI);break;case -1:evaluatingAsFloats?push_double(2*Math.PI/3):(push_rational(2,3),push_symbol(PI),multiply());break;case 0:evaluatingAsFloats?push_double(Math.PI/2):(push_rational(1,2),push_symbol(PI),multiply());break;case 1:evaluatingAsFloats?push_double(Math.PI/3):(push_rational(1,3),push_symbol(PI),multiply());break;case 2:evaluatingAsFloats?push_double(0):push(zero);break;default:push_symbol(ARCCOS),push(p1),list(2)}return restore()},Eval_arccosh=function(){return push(cadr(p1)),Eval(),arccosh()},arccosh=function(){var r;if(r=0,save(),car(p1=pop())===symbol(COSH)){push(cadr(p1)),restore();return}if(isdouble(p1)){(r=p1.d)<1&&stop("arccosh function argument is less than 1.0"),push_double(r=Math.log(r+Math.sqrt(r*r-1))),restore();return}if(isplusone(p1)){push(zero),restore();return}return push_symbol(ARCCOSH),push(p1),list(2),restore()},Eval_arcsin=function(){return push(cadr(p1)),Eval(),arcsin()},arcsin=function(){var r,t,e;if(e=0,r=0,save(),car(p1=pop())===symbol(SIN)){push(cadr(p1)),restore();return}if(isdouble(p1)){t=0,r=Math.asin(p1.d),t&&stop("arcsin function argument is not in the interval [-1,1]"),push_double(r),restore();return}if(isoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)){push_rational(1,4),push_symbol(PI),multiply(),restore();return}if(isminusoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),-1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)){evaluatingAsFloats?push_double(-Math.PI/4):(push_rational(-1,4),push_symbol(PI),multiply()),restore();return}if(issqrtthreeovertwo(p1)){evaluatingAsFloats?push_double(Math.PI/3):(push_rational(1,3),push_symbol(PI),multiply()),restore();return}if(isminussqrtthreeovertwo(p1)){evaluatingAsFloats?push_double(-Math.PI/3):(push_rational(-1,3),push_symbol(PI),multiply()),restore();return}if(!isrational(p1)){push_symbol(ARCSIN),push(p1),list(2),restore();return}switch(push(p1),push_integer(2),multiply(),e=pop_integer()){case -2:evaluatingAsFloats?push_double(-Math.PI/2):(push_rational(-1,2),push_symbol(PI),multiply());break;case -1:evaluatingAsFloats?push_double(-Math.PI/6):(push_rational(-1,6),push_symbol(PI),multiply());break;case 0:evaluatingAsFloats?push_double(0):push(zero);break;case 1:evaluatingAsFloats?push_double(Math.PI/6):(push_rational(1,6),push_symbol(PI),multiply());break;case 2:evaluatingAsFloats?push_double(Math.PI/2):(push_rational(1,2),push_symbol(PI),multiply());break;default:push_symbol(ARCSIN),push(p1),list(2)}return restore()},Eval_arcsinh=function(){return push(cadr(p1)),Eval(),arcsinh()},arcsinh=function(){var r;if(r=0,save(),car(p1=pop())===symbol(SINH)){push(cadr(p1)),restore();return}if(isdouble(p1)){r=Math.log((r=p1.d)+Math.sqrt(r*r+1)),push_double(r),restore();return}if(isZeroAtomOrTensor(p1)){push(zero),restore();return}return push_symbol(ARCSINH),push(p1),list(2),restore()},Eval_arctan=function(){return push(cadr(p1)),Eval(),arctan()},arctan=function(){var r,t;if(r=0,save(),car(p1=pop())===symbol(TAN)){push(cadr(p1)),restore();return}if(isdouble(p1)){t=0,r=Math.atan(p1.d),t&&stop("arctan function error"),push_double(r),restore();return}if(isZeroAtomOrTensor(p1)){push(zero),restore();return}if(isnegative(p1)){push(p1),negate(),arctan(),negate(),restore();return}if(Find(p1,symbol(SIN))&&Find(p1,symbol(COS))&&(push(p1),numerator(),p2=pop(),push(p1),denominator(),p3=pop(),car(p2)===symbol(SIN)&&car(p3)===symbol(COS)&&equal(cadr(p2),cadr(p3)))){push(cadr(p2)),restore();return}if(car(p1)===symbol(POWER)&&equaln(cadr(p1),3)&&equalq(caddr(p1),-1,2)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),1,3)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),3)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)){push_rational(1,6),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),multiply(),restore();return}if(equaln(p1,1)){push_rational(1,4),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),multiply(),restore();return}if(car(p1)===symbol(POWER)&&equaln(cadr(p1),3)&&equalq(caddr(p1),1,2)){push_rational(1,3),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),multiply(),restore();return}return push_symbol(ARCTAN),push(p1),list(2),restore()},Eval_arctanh=function(){return push(cadr(p1)),Eval(),arctanh()},arctanh=function(){var r;if(r=0,save(),car(p1=pop())===symbol(TANH)){push(cadr(p1)),restore();return}if(isdouble(p1)){((r=p1.d)<-1||r>1)&&stop("arctanh function argument is not in the interval [-1,1]"),push_double(r=Math.log((1+r)/(1-r))/2),restore();return}if(isZeroAtomOrTensor(p1)){push(zero),restore();return}return push_symbol(ARCTANH),push(p1),list(2),restore()},DEBUG_ARG=!1,Eval_arg=function(){return push(cadr(p1)),Eval(),arg()},arg=function(){return save(),p1=pop(),push(p1),numerator(),yyarg(),push(p1),denominator(),yyarg(),subtract(),restore()},yyarg=function(){if(save(),p1=pop(),ispositivenumber(p1)||p1===symbol(PI))isdouble(p1)||evaluatingAsFloats?push_double(0):push_integer(0);else if(isnegativenumber(p1))isdouble(p1)||evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),negate();else if(issymbol(p1))push_symbol(ARG),push(p1),list(2);else if(car(p1)===symbol(POWER)&&equaln(cadr(p1),-1))evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),push(caddr(p1)),multiply();else if(car(p1)===symbol(POWER)&&cadr(p1)===symbol(E))push(caddr(p1)),imag();else if(car(p1)===symbol(POWER)&&isoneovertwo(caddr(p1)))DEBUG_ARG&&console.log("arg of a sqrt: "+p1),push(cadr(p1)),arg(),DEBUG_ARG&&console.log(" = 1/2 * "+stack[tos-1]),push(caddr(p1)),multiply();else if(car(p1)===symbol(MULTIPLY))for(push_integer(0),p1=cdr(p1);iscons(p1);)push(car(p1)),arg(),add(),p1=cdr(p1);else car(p1)===symbol(ADD)?(push(p1),rect(),p1=pop(),push(p1),real(),p2=pop(),push(p1),imag(),p3=pop(),isZeroAtomOrTensor(p2)?(evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),isnegative(p3)&&negate()):(push(p3),push(p2),divide(),arctan(),isnegative(p2)&&(evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),isnegative(p3)?subtract():add()))):isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))?(push_symbol(ARG),push(p1),list(2)):push_integer(0);return restore()},bake=function(){var r,t,e,n,o,i;if(r=0,t=0,e=0,n=0,o=0,i=0,expanding++,save(),p1=pop(),t=ispolyexpandedform(p1,symbol(SYMBOL_S)),e=ispolyexpandedform(p1,symbol(SYMBOL_T)),n=ispolyexpandedform(p1,symbol(SYMBOL_X)),o=ispolyexpandedform(p1,symbol(SYMBOL_Y)),i=ispolyexpandedform(p1,symbol(SYMBOL_Z)),1===t&&0===e&&0===n&&0===o&&0===i)p2=symbol(SYMBOL_S),bake_poly();else if(0===t&&1===e&&0===n&&0===o&&0===i)p2=symbol(SYMBOL_T),bake_poly();else if(0===t&&0===e&&1===n&&0===o&&0===i)p2=symbol(SYMBOL_X),bake_poly();else if(0===t&&0===e&&0===n&&1===o&&0===i)p2=symbol(SYMBOL_Y),bake_poly();else if(0===t&&0===e&&0===n&&0===o&&1===i)p2=symbol(SYMBOL_Z),bake_poly();else if(iscons(p1)&&car(p1)!==symbol(FOR)){for(r=tos,push(car(p1)),p1=cdr(p1);iscons(p1);)push(car(p1)),bake(),p1=cdr(p1);list(tos-r)}else push(p1);return restore(),expanding--},polyform=function(){var r;if(r=0,save(),p2=pop(),p1=pop(),ispolyexpandedform(p1,p2))bake_poly();else if(iscons(p1)){for(r=tos,push(car(p1)),p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),polyform(),p1=cdr(p1);list(tos-r)}else push(p1);return restore()},bake_poly=function(){var r,t,e,n,o,i,a;for(t=0,e=0,n=0,o=0,r=tos,n=coeff(p2,p1),t=tos,e=i=a=n-1;i>=0;e=i+=-1)p1=stack[r+e],bake_poly_term(e);return(o=tos-t)>1&&(list(o),push(symbol(ADD)),swap(),cons()),p1=pop(),moveTos(tos-n),push(p1)},bake_poly_term=function(r){var t,e;if(t=0,e=0,!isZeroAtomOrTensor(p1)){if(0===r){if(car(p1)===symbol(ADD))for(p1=cdr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1);else push(p1);return}if(t=tos,car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1);else equaln(p1,1)||push(p1);if(1===r?push(p2):(push(symbol(POWER)),push(p2),push_integer(r),list(3)),e=tos-t,e>1)return list(e),push(symbol(MULTIPLY)),swap(),cons()}},Eval_besselj=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),besselj()},besselj=function(){return save(),yybesselj(),restore()},yybesselj=function(){var r,t;if(r=0,t=0,p2=pop(),p1=pop(),push(p2),t=pop_integer(),isdouble(p1)&&!isNaN(t)){r=jn(t,p1.d),push_double(r);return}if(isZeroAtomOrTensor(p1)&&isZeroAtomOrTensor(p2))return void push_integer(1);if(isZeroAtomOrTensor(p1)&&!isNaN(t))return void push_integer(0);if(p2.k===NUM&&MEQUAL(p2.q.b,2)){if(MEQUAL(p2.q.a,1)){evaluatingAsFloats?push_double(2/Math.PI):(push_integer(2),push_symbol(PI),divide()),push(p1),divide(),push_rational(1,2),power(),push(p1),sine(),multiply();return}if(MEQUAL(p2.q.a,-1)){evaluatingAsFloats?push_double(2/Math.PI):(push_integer(2),push_symbol(PI),divide()),push(p1),divide(),push_rational(1,2),power(),push(p1),cosine(),multiply();return}push_integer(MSIGN(p2.q.a)),p3=pop(),push_integer(2),push(p1),divide(),push(p2),push(p3),subtract(),multiply(),push(p1),push(p2),push(p3),subtract(),besselj(),multiply(),push(p1),push(p2),push_integer(2),push(p3),multiply(),subtract(),besselj(),subtract();return}if(isnegativeterm(p1)){push(p1),negate(),push(p2),power(),push(p1),push(p2),negate(),power(),multiply(),push_symbol(BESSELJ),push(p1),negate(),push(p2),list(3),multiply();return}if(isnegativeterm(p2)){push_integer(-1),push(p2),power(),push_symbol(BESSELJ),push(p1),push(p2),negate(),list(3),multiply();return}return push(symbol(BESSELJ)),push(p1),push(p2),list(3)},Eval_bessely=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),bessely()},bessely=function(){return save(),yybessely(),restore()},yybessely=function(){var r,t;if(r=0,t=0,p2=pop(),p1=pop(),push(p2),t=pop_integer(),isdouble(p1)&&!isNaN(t)){r=yn(t,p1.d),push_double(r);return}if(isnegativeterm(p2)){push_integer(-1),push(p2),power(),push_symbol(BESSELY),push(p1),push(p2),negate(),list(3),multiply();return}push_symbol(BESSELY),push(p1),push(p2),list(3)},mint=function(r){return bigInt(r)},isSmall=function(r){return r.geq(Number.MIN_SAFE_INTEGER)&&r.leq(Number.MAX_SAFE_INTEGER)},setSignTo=function(r,t){if(r.isPositive()){if(t<0)return r.multiply(bigInt(-1))}else if(t>0)return r.multiply(bigInt(-1));return r},makeSignSameAs=function(r,t){if(r.isPositive()){if(t.isNegative())return r.multiply(bigInt(-1))}else if(t.isPositive())return r.multiply(bigInt(-1));return r},makePositive=function(r){return r.isNegative()?r.multiply(bigInt(-1)):r},add_numbers=function(){var r,t,e;return(r=1,t=1,isrational(stack[tos-1])&&isrational(stack[tos-2]))?void qadd():(save(),p2=pop(),e=(r=isdouble(p1=pop())?p1.d:convert_rational_to_double(p1))+(t=isdouble(p2)?p2.d:convert_rational_to_double(p2)),push_double(e),restore())},subtract_numbers=function(){var r,t;return(r=0,t=0,isrational(stack[tos-1])&&isrational(stack[tos-2]))?void qsub():(save(),p2=pop(),r=isdouble(p1=pop())?p1.d:convert_rational_to_double(p1),t=isdouble(p2)?p2.d:convert_rational_to_double(p2),push_double(r-t),restore())},multiply_numbers=function(){var r,t;return(r=0,t=0,isrational(stack[tos-1])&&isrational(stack[tos-2]))?void qmul():(save(),p2=pop(),r=isdouble(p1=pop())?p1.d:convert_rational_to_double(p1),t=isdouble(p2)?p2.d:convert_rational_to_double(p2),push_double(r*t),restore())},divide_numbers=function(){var r,t;return(r=0,t=0,isrational(stack[tos-1])&&isrational(stack[tos-2]))?void qdiv():(save(),p2=pop(),p1=pop(),isZeroAtomOrTensor(p2)&&stop("divide by zero"),r=isdouble(p1)?p1.d:convert_rational_to_double(p1),t=isdouble(p2)?p2.d:convert_rational_to_double(p2),push_double(r/t),restore())},invert_number=function(){var r,t;if(save(),p1=pop(),isZeroAtomOrTensor(p1)&&stop("divide by zero"),isdouble(p1)){push_double(1/p1.d),restore();return}return r=bigInt(p1.q.a),t=makeSignSameAs(t=bigInt(p1.q.b),r),r=setSignTo(r,1),(p1=new U).k=NUM,p1.q.a=t,p1.q.b=r,push(p1),restore()},compare_rationals=function(r,t){var e,n,o;return o=0,e=mmul(r.q.a,t.q.b),n=mmul(r.q.b,t.q.a),o=mcmp(e,n)},compare_numbers=function(r,t){var e,n;return(e=0,n=0,isrational(r)&&isrational(t))?compare_rationals(r,t):(e=isdouble(r)?r.d:convert_rational_to_double(r))<(n=isdouble(t)?t.d:convert_rational_to_double(t))?-1:+(e>n)},negate_number=function(){if(save(),p1=pop(),isZeroAtomOrTensor(p1)){push(p1),restore();return}switch(p1.k){case NUM:(p2=new U).k=NUM,p2.q.a=bigInt(p1.q.a.multiply(bigInt.minusOne)),p2.q.b=bigInt(p1.q.b),push(p2);break;case DOUBLE:push_double(-p1.d);break;default:stop("bug caught in mp_negate_number")}return restore()},bignum_truncate=function(){var r;return save(),p1=pop(),r=mdiv(p1.q.a,p1.q.b),(p1=new U).k=NUM,p1.q.a=r,p1.q.b=bigInt(1),push(p1),restore()},mp_numerator=function(){if(save(),(p1=pop()).k!==NUM){push(one),restore();return}return(p2=new U).k=NUM,p2.q.a=bigInt(p1.q.a),p2.q.b=bigInt(1),push(p2),restore()},mp_denominator=function(){if(save(),(p1=pop()).k!==NUM){push(one),restore();return}return(p2=new U).k=NUM,p2.q.a=bigInt(p1.q.b),p2.q.b=bigInt(1),push(p2),restore()},bignum_power_number=function(r){var t,e,n;return save(),p1=pop(),t=mpow(p1.q.a,Math.abs(r)),e=mpow(p1.q.b,Math.abs(r)),r<0&&(n=t,t=makeSignSameAs(t=e,e=n),e=setSignTo(e,1)),(p1=new U).k=NUM,p1.q.a=t,p1.q.b=e,push(p1),restore()},convert_bignum_to_double=function(r){return r.toJSNumber()},convert_rational_to_double=function(r){var t;return r.q,(t=r.q.a.divmod(r.q.b)).quotient+t.remainder/r.q.b.toJSNumber()},new_integer=function(r){var t;return(t=new U).k=NUM,t.q.a=bigInt(r),t.q.b=bigInt(1),t},push_integer=function(r){return DEBUG&&console.log("pushing integer "+r),push(new_integer(r))},push_double=function(r){return save(),(p1=new U).k=DOUBLE,p1.d=r,push(p1),restore()},push_rational=function(r,t){var e;return(e=new U).k=NUM,e.q.a=bigInt(r),e.q.b=bigInt(t),push(e)},pop_integer=function(){var r;switch(r=0/0,save(),(p1=pop()).k){case NUM:isinteger(p1)&&isSmall(p1.q.a)&&(r=p1.q.a.toJSNumber());break;case DOUBLE:DEBUG&&console.log("popping integer but double is found"),Math.floor(p1.d)===p1.d&&(DEBUG&&console.log("...altough it's an integer"),r=p1.d)}return restore(),r},print_double=function(r,t){var e,n;return e="",n=doubleToReasonableString(r.d),1===t&&"-"===n?e+=print_str(n+1):e+=print_str(n),e},bignum_scan_integer=function(r){var t,e,n;return save(),("+"===(n=r[e=0])||"-"===n)&&e++,t=bigInt(r.substring(e)),(p1=new U).k=NUM,p1.q.a=t,p1.q.b=bigInt(1),push(p1),"-"===n&&negate(),restore()},bignum_scan_float=function(r){return push_double(parseFloat(r))},print_number=function(r,t){var e,n,o,i;switch(n="",i="",o="",r.k){case NUM:e=r.q.a.toString(),t||"-"!==e[0]||(e=e.substring(1)),printMode===PRINTMODE_LATEX&&isfraction(r)&&(e="\\frac{"+e+"}{"),n+=e,isfraction(r)&&(printMode!==PRINTMODE_LATEX&&(n+="/"),i=r.q.b.toString(),printMode===PRINTMODE_LATEX&&(i+="}"),n+=i);break;case DOUBLE:e=doubleToReasonableString(r.d),t||"-"!==e[0]||(e=e.substring(1)),n+=e}return n},gcd_numbers=function(){return save(),p2=pop(),p1=pop(),(p3=new U).k=NUM,p3.q.a=mgcd(p1.q.a,p2.q.a),p3.q.b=mgcd(p1.q.b,p2.q.b),p3.q.a=setSignTo(p3.q.a,1),push(p3),restore()},pop_double=function(){var r;switch(r=0,save(),(p1=pop()).k){case NUM:r=convert_rational_to_double(p1);break;case DOUBLE:r=p1.d;break;default:r=0}return restore(),r},bignum_float=function(){var r;return r=0,r=convert_rational_to_double(pop()),push_double(r)},bignum_factorial=function(r){return save(),(p1=new U).k=NUM,p1.q.a=__factorial(r),p1.q.b=bigInt(1),push(p1),restore()},__factorial=function(r){var t,e,n,o,i;if(n=0,0===r||1===r)return bigInt(1);if(t=bigInt(2),e=bigInt(0),3<=r)for(n=o=3,i=r;3<=i?o<=i:o>=i;n=3<=i?++o:--o)e=bigInt(n),t=mmul(t,e);return t},mask=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,0x1000000,0x2000000,0x4000000,0x8000000,0x10000000,0x20000000,0x40000000,0x80000000],mp_set_bit=function(r,t){return console.log("not implemented yet"),r[t/32]|=mask[t%32]},mp_clr_bit=function(r,t){return console.log("not implemented yet"),r[t/32]&=~mask[t%32]},mshiftright=function(r){return r.shiftRight()},Eval_binomial=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),binomial()},binomial=function(){return save(),ybinomial(),restore()},ybinomial=function(){return(p2=pop(),p1=pop(),0===BINOM_check_args())?void push(zero):(push(p1),factorial(),push(p2),factorial(),divide(),push(p1),push(p2),subtract(),factorial(),divide())},BINOM_check_args=function(){return isNumericAtom(p1)&&lessp(p1,zero)||isNumericAtom(p2)&&lessp(p2,zero)?0:isNumericAtom(p1)&&isNumericAtom(p2)&&lessp(p1,p2)?0:1},Eval_ceiling=function(){return push(cadr(p1)),Eval(),ceiling()},ceiling=function(){return save(),yyceiling(),restore()},yyceiling=function(){var r;if(r=0,!isNumericAtom(p1=pop())){push_symbol(CEILING),push(p1),list(2);return}if(isdouble(p1)){r=Math.ceil(p1.d),push_double(r);return}return isinteger(p1)?void push(p1):((p3=new U).k=NUM,p3.q.a=mdiv(p1.q.a,p1.q.b),p3.q.b=mint(1),push(p3),isnegativenumber(p1))?1:(push_integer(1),add())},Eval_choose=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),choose()},choose=function(){if(save(),p2=pop(),p1=pop(),0===choose_check_args()){push_integer(0),restore();return}return push(p1),factorial(),push(p2),factorial(),divide(),push(p1),push(p2),subtract(),factorial(),divide(),restore()},choose_check_args=function(){return isNumericAtom(p1)&&lessp(p1,zero)||isNumericAtom(p2)&&lessp(p2,zero)?0:isNumericAtom(p1)&&isNumericAtom(p2)&&lessp(p1,p2)?0:1},Eval_circexp=function(){return push(cadr(p1)),Eval(),circexp(),Eval()},circexp=function(){var r,t,e,n;if(t=0,r=0,save(),car(p1=pop())===symbol(COS)){push(cadr(p1)),expcos(),restore();return}if(car(p1)===symbol(SIN)){push(cadr(p1)),expsin(),restore();return}if(car(p1)===symbol(TAN)){p1=cadr(p1),push(imaginaryunit),push(p1),multiply(),exponential(),p2=pop(),push(imaginaryunit),push(p1),multiply(),negate(),exponential(),p3=pop(),push(p3),push(p2),subtract(),push(imaginaryunit),multiply(),push(p2),push(p3),add(),divide(),restore();return}if(car(p1)===symbol(COSH)){p1=cadr(p1),push(p1),exponential(),push(p1),negate(),exponential(),add(),push_rational(1,2),multiply(),restore();return}if(car(p1)===symbol(SINH)){p1=cadr(p1),push(p1),exponential(),push(p1),negate(),exponential(),subtract(),push_rational(1,2),multiply(),restore();return}if(car(p1)===symbol(TANH)){p1=cadr(p1),push(p1),push_integer(2),multiply(),exponential(),p1=pop(),push(p1),push_integer(1),subtract(),push(p1),push_integer(1),add(),divide(),restore();return}if(iscons(p1)){for(r=tos;iscons(p1);)push(car(p1)),circexp(),p1=cdr(p1);list(tos-r),restore();return}if(p1.k===TENSOR){for(push(p1),copy_tensor(),p1=pop(),t=e=0,n=p1.tensor.nelem;0<=n?e<n:e>n;t=0<=n?++e:--e)push(p1.tensor.elem[t]),circexp(),p1.tensor.elem[t]=pop();push(p1),restore();return}return push(p1),restore()},Eval_clearall=function(){return do_clearall(),push(symbol(NIL))},do_clearall=function(){return 0===test_flag&&clear_term(),do_clearPatterns(),clear_symbols(),defn(),codeGen=!1},clearall=function(){return run("clearall")},clearRenamedVariablesToAvoidBindingToExternalScope=function(){var r,t,e,n;for(n=[],r=t=0,e=symtab.length;0<=e?t<e:t>e;r=0<=e?++t:--t)-1!==symtab[r].printname.indexOf("AVOID_BINDING_TO_EXTERNAL_SCOPE_VALUE")?(symtab[r].k=SYM,symtab[r].printname="",binding[r]=symtab[r],n.push(isSymbolReclaimable[r]=!0)):n.push(void 0);return n},Eval_clear=function(){var r,t;for(p2=cdr(p1);iscons(p2);)(t=car(p2)).k!==SYM&&stop("symbol error"),r=symtab.indexOf(t),symtab[r].k=SYM,symtab[r].printname="",binding[r]=symtab[r],isSymbolReclaimable[r]=!0,p2=cdr(p2);return push(symbol(NIL))},DEBUG_CLOCKFORM=!1,Eval_clock=function(){return push(cadr(p1)),Eval(),clockform()},clockform=function(){return save(),p1=pop(),push(p1),abs(),DEBUG_CLOCKFORM&&console.log("clockform: abs of "+p1+" : "+stack[tos-1]),push_symbol(POWER),push_integer(-1),push(p1),arg(),DEBUG_CLOCKFORM&&console.log("clockform: arg of "+p1+" : "+stack[tos-1]),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),divide(),DEBUG_CLOCKFORM&&console.log("clockform: divide : "+stack[tos-1]),list(3),DEBUG_CLOCKFORM&&console.log("clockform: power : "+stack[tos-1]),multiply(),DEBUG_CLOCKFORM&&console.log("clockform: multiply : "+stack[tos-1]),restore()},Eval_coeff=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),p3=pop(),p2=pop(),p1=pop(),p3===symbol(NIL)&&(p3=p2,p2=symbol(SYMBOL_X)),push(p1),push(p2),push(p3),power(),divide(),push(p2),filter()},coeff=function(r,t){var e,n,o,i;for(DEBUG&&console.log("coeff: "+r+" "+t),e=0;;){if(push(t),push(r),push(zero),subst(),Eval(),n=pop(),push(n),e++,push(t),push(n),subtract(),o=pop(),equal(o,zero))return DEBUG&&console.log("coeff: result: "+e),e;push(o),push(r),i=expanding,expanding=1,divide(),expanding=i,t=pop()}},Eval_cofactor=function(){var r,t,e,n;return t=0,e=0,n=0,push(cadr(p1)),Eval(),istensor(p2=pop())&&2===p2.tensor.ndim&&p2.tensor.dim[0]===p2.tensor.dim[1]?r=1:stop("cofactor: 1st arg: square matrix expected"),n=p2.tensor.dim[0],push(caddr(p1)),Eval(),((t=pop_integer())<1||t>n)&&stop("cofactor: 2nd arg: row index expected"),push(cadddr(p1)),Eval(),((e=pop_integer())<1||e>n)&&stop("cofactor: 3rd arg: column index expected"),cofactor(p2,n,t-1,e-1)},cofactor=function(r,t,e,n){var o,i,a,s,u,f;for(o=0,a=0,o=s=0,u=t;0<=u?s<u:s>u;o=0<=u?++s:--s)for(a=i=0,f=t;0<=f?i<f:i>f;a=0<=f?++i:--i)o!==e&&a!==n&&push(r.tensor.elem[t*o+a]);if(determinant(t-1),(e+n)%2)return negate()},Eval_condense=function(){return push(cadr(p1)),Eval(),Condense()},Condense=function(){var r;return r=expanding,expanding=0,save(),yycondense(),restore(),expanding=r},yycondense=function(){if(car(p1=pop())!==symbol(ADD))return void push(p1);for(p3=cdr(p1),push(car(p3)),p3=cdr(p3);iscons(p3);)push(car(p3)),DEBUG&&console.log("calculating gcd between: "+stack[tos-1]+" and "+stack[tos-2]),gcd(),DEBUG&&console.log("partial gcd: "+stack[tos-1]),p3=cdr(p3);for(DEBUG&&console.log("condense: this is the gcd of all the terms: "+stack[tos-1]),inverse(),p2=pop(),push(zero),p3=cdr(p1);iscons(p3);)push(p2),push(car(p3)),multiply_noexpand(),add(),p3=cdr(p3);return yyexpand(),push(p2),divide()},Eval_conj=function(){return(push(cadr(p1)),Eval(),p1=pop(),push(p1),Find(p1,imaginaryunit))?conjugate():(polar(),conjugate(),clockform())},conjugate=function(){return push(imaginaryunit),push(imaginaryunit),negate(),subst(),Eval()},consCount=0,cons=function(){var r;return consCount++,DEBUG&&console.log("cons tos: "+tos+" # "+consCount),(r=new U).k=CONS,r.cons.cdr=pop(),r===r.cons.cdr&&console.log("something wrong p == its cdr"),r.cons.car=pop(),push(r)},Eval_contract=function(){return push(cadr(p1)),Eval(),cddr(p1)===symbol(NIL)?(push_integer(1),push_integer(2)):(push(caddr(p1)),Eval(),push(cadddr(p1)),Eval()),contract()},contract=function(){return save(),yycontract(),restore()},yycontract=function(){var r,t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k,w,M,_,A;if(o=0,i=0,s=0,f=0,l=0,p=0,g=0,d=0,m=0,t=[],e=[],p3=pop(),p2=pop(),!istensor(p1=pop())){isZeroAtomOrTensor(p1)||stop("contract: tensor expected, 1st arg is not a tensor"),push(zero);return}for(push(p2),l=pop_integer(),push(p3),p=pop_integer(),d=p1.tensor.ndim,(l<1||l>d||p<1||p>d||l===p||p1.tensor.dim[l-1]!==p1.tensor.dim[p-1])&&stop("contract: index out of range"),l--,p--,g=p1.tensor.dim[l],m=1,i=v=0,y=d;0<=y?v<y:v>y;i=0<=y?++v:--v)i!==l&&i!==p&&(m*=p1.tensor.dim[i]);for((p2=alloc_tensor(m)).tensor.ndim=d-2,s=0,i=a=0,q=d;0<=q?a<q:a>q;i=0<=q?++a:--a)i!==l&&i!==p&&(p2.tensor.dim[s++]=p1.tensor.dim[i]);for(r=p1.tensor.elem,n=p2.tensor.elem,i=u=0,k=d;0<=k?u<k:u>k;i=0<=k?++u:--u)t[i]=0,e[i]=p1.tensor.dim[i];for(i=c=0,w=m;0<=w?c<w:c>w;i=0<=w?++c:--c){for(push(zero),s=x=0,M=g;0<=M?x<M:x>M;s=0<=M?++x:--x){for(t[l]=s,t[p]=s,o=0,f=h=0,_=d;0<=_?h<_:h>_;f=0<=_?++h:--h)o=o*e[f]+t[f];push(r[o]),add()}for(n[i]=pop(),s=b=A=d-1;A<=0?b<=0:b>=0;s=A<=0?++b:--b)if(s!==l&&s!==p){if(++t[s]<e[s])break;t[s]=0}}return 1===m?push(n[0]):push(p2)},Eval_cos=function(){return push(cadr(p1)),Eval(),cosine()},cosine=function(){return save(),car(p1=pop())===symbol(ADD)?cosine_of_angle_sum():cosine_of_angle(),restore()},cosine_of_angle_sum=function(){for(p2=cdr(p1);iscons(p2);){if(p4=car(p2),isnpi(p4)){push(p1),push(p4),subtract(),p3=pop(),push(p3),cosine(),push(p4),cosine(),multiply(),push(p3),sine(),push(p4),sine(),multiply(),subtract();return}p2=cdr(p2)}return cosine_of_angle()},cosine_of_angle=function(){var r,t;if(car(p1)===symbol(ARCCOS))return void push(cadr(p1));if(isdouble(p1)){1e-10>Math.abs(r=Math.cos(p1.d))&&(r=0),push_double(r);return}if(isnegative(p1)&&(push(p1),negate(),p1=pop()),car(p1)===symbol(ARCTAN)){push_integer(1),push(cadr(p1)),push_integer(2),power(),add(),push_rational(-1,2),power();return}if(push(p1),push_integer(180),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),divide(),(t=pop_integer())<0||isNaN(t)){push(symbol(COS)),push(p1),list(2);return}switch(t%360){case 90:case 270:return push_integer(0);case 60:case 300:return push_rational(1,2);case 120:case 240:return push_rational(-1,2);case 45:case 315:return push_rational(1,2),push_integer(2),push_rational(1,2),power(),multiply();case 135:case 225:return push_rational(-1,2),push_integer(2),push_rational(1,2),power(),multiply();case 30:case 330:return push_rational(1,2),push_integer(3),push_rational(1,2),power(),multiply();case 150:case 210:return push_rational(-1,2),push_integer(3),push_rational(1,2),power(),multiply();case 0:return push_integer(1);case 180:return push_integer(-1);default:return push(symbol(COS)),push(p1),list(2)}},Eval_cosh=function(){return push(cadr(p1)),Eval(),ycosh()},ycosh=function(){return save(),yycosh(),restore()},yycosh=function(){var r;if(r=0,car(p1=pop())===symbol(ARCCOSH))return void push(cadr(p1));if(isdouble(p1)){1e-10>Math.abs(r=Math.cosh(p1.d))&&(r=0),push_double(r);return}return isZeroAtomOrTensor(p1)?void push(one):(push_symbol(COSH),push(p1),list(2))},Eval_decomp=function(){var r;return save(),console.log("Eval_decomp is being called!!!!!!!!!!!!!!!!!!!!"),r=tos,push(symbol(NIL)),push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p1=pop())===symbol(NIL)?guess():push(p1),decomp(!1),list(tos-r),restore()},pushTryNotToDuplicate=function(r){if(tos>0&&(DEBUG&&console.log("comparing "+r+" to: "+stack[tos-1]),equal(r,stack[tos-1]))){DEBUG&&console.log("skipping "+r+" because it's already on stack ");return}return push(r)},decomp=function(r){if(save(),p2=pop(),p1=pop(),DEBUG&&console.log("DECOMPOSING "+p1),r){if(!iscons(p1)){DEBUG&&console.log(" ground thing: "+p1),pushTryNotToDuplicate(p1),restore();return}}else if(0===Find(p1,p2)){DEBUG&&console.log(" entire expression is constant"),pushTryNotToDuplicate(p1),restore();return}if(isadd(p1)){decomp_sum(r),restore();return}if(ismultiply(p1)){decomp_product(r),restore();return}for(DEBUG&&console.log(" naive decomp"),p3=cdr(p1),DEBUG&&console.log("startig p3: "+p3);iscons(p3);)r&&push(car(p3)),DEBUG&&console.log("recursive decomposition"),push(car(p3)),DEBUG&&console.log("car(p3): "+car(p3)),push(p2),DEBUG&&console.log("p2: "+p2),decomp(r),p3=cdr(p3);return restore()},decomp_sum=function(r){var t;for(DEBUG&&console.log(" decomposing the sum "),t=0,p3=cdr(p1);iscons(p3);)(Find(car(p3),p2)||r)&&(push(car(p3)),push(p2),decomp(r)),p3=cdr(p3);for(t=tos,p3=cdr(p1);iscons(p3);)0===Find(car(p3),p2)&&pushTryNotToDuplicate(car(p3)),p3=cdr(p3);if(tos-t)return add_all(tos-t),pushTryNotToDuplicate(p3=pop()),push(p3),negate()},decomp_product=function(r){var t;for(DEBUG&&console.log(" decomposing the product "),t=0,p3=cdr(p1);iscons(p3);)(Find(car(p3),p2)||r)&&(push(car(p3)),push(p2),decomp(r)),p3=cdr(p3);for(t=tos,p3=cdr(p1);iscons(p3);)0===Find(car(p3),p2)&&pushTryNotToDuplicate(car(p3)),p3=cdr(p3);if(tos-t)return multiply_all(tos-t)},define_user_function=function(){return p3=caadr(p1),p4=cdadr(p1),p5=caddr(p1),issymbol(p3)||stop("function name?"),car(p5)===symbol(EVAL)&&(push(cadr(p5)),Eval(),p5=pop()),push_symbol(FUNCTION),push(p5),push(p4),list(3),p5=pop(),set_binding(p3,p5),push_symbol(NIL)},Eval_function_reference=function(){return push(p1)},Eval_defint=function(){for(push(cadr(p1)),Eval(),p2=pop(),p1=cddr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1),Eval(),p3=pop(),push(car(p1)),p1=cdr(p1),Eval(),p4=pop(),push(car(p1)),p1=cdr(p1),Eval(),p5=pop(),push(p2),push(p3),integral(),p2=pop(),push(p2),push(p3),push(p5),subst(),Eval(),push(p2),push(p3),push(p4),subst(),Eval(),subtract(),p2=pop();return push(p2)},Eval_degree=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p1=pop())===symbol(NIL)?guess():push(p1),degree()},degree=function(){return save(),p2=pop(),p1=pop(),p3=zero,yydegree(p1),push(p3),restore()},yydegree=function(r){var t;if(equal(r,p2)){if(isZeroAtomOrTensor(p3))return p3=one}else if(car(r)===symbol(POWER)){if(equal(cadr(r),p2)&&isNumericAtom(caddr(r))&&lessp(p3,caddr(r)))return p3=caddr(r)}else if(iscons(r)){for(r=cdr(r),t=[];iscons(r);)yydegree(car(r)),t.push(r=cdr(r));return t}},Eval_denominator=function(){return push(cadr(p1)),Eval(),denominator()},denominator=function(){var r,t;if(r=0,car(t=pop())===symbol(ADD)&&(push(t),rationalize(),t=pop()),car(t)!==symbol(MULTIPLY)||isplusone(car(cdr(t))))if(isrational(t))return push(t),mp_denominator();else if(car(t)===symbol(POWER)&&isnegativeterm(caddr(t)))return push(t),reciprocate();else return push(one);for(r=tos,t=cdr(t);iscons(t);)push(car(t)),denominator(),t=cdr(t);return multiply_all(tos-r)},Eval_derivative=function(){var r,t,e,n,o,i,a;for(t=0,p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),(p2=pop())===symbol(NIL)?(guess(),push(symbol(NIL))):isNumericAtom(p2)?(guess(),push(p2)):(push(p2),p1=cdr(p1),push(car(p1)),Eval()),p5=pop(),p4=pop(),p3=pop();;){if(isNumericAtom(p5)?(push(p5),isNaN(n=pop_integer())&&stop("nth derivative: check n")):n=1,push(p3),n>=0)for(t=o=0,i=n;0<=i?o<i:o>i;t=0<=i?++o:--o)push(p4),derivative();else for(n=-n,t=e=0,a=n;0<=a?e<a:e>a;t=0<=a?++e:--e)push(p4),integral();if(p3=pop(),p5===symbol(NIL))break;if(isNumericAtom(p5)){if(p1=cdr(p1),push(car(p1)),Eval(),(p5=pop())===symbol(NIL))break;isNumericAtom(p5)?r=1:(p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop())}else p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop()}return push(p3)},derivative=function(){return save(),p2=pop(),p1=pop(),isNumericAtom(p2)&&stop("undefined function"),istensor(p1)?istensor(p2)?d_tensor_tensor():d_tensor_scalar():istensor(p2)?d_scalar_tensor():d_scalar_scalar(),restore()},d_scalar_scalar=function(){return issymbol(p2)?d_scalar_scalar_1():(push(p1),push(p2),push(symbol(SECRETX)),subst(),push(symbol(SECRETX)),derivative(),push(symbol(SECRETX)),push(p2),subst())},d_scalar_scalar_1=function(){return equal(p1,p2)?void push(one):iscons(p1)?isadd(p1)?void dsum():car(p1)===symbol(MULTIPLY)?void dproduct():car(p1)===symbol(POWER)?void dpower():car(p1)===symbol(DERIVATIVE)?void dd():car(p1)===symbol(LOG)?void dlog():car(p1)===symbol(SIN)?void dsin():car(p1)===symbol(COS)?void dcos():car(p1)===symbol(TAN)?void dtan():car(p1)===symbol(ARCSIN)?void darcsin():car(p1)===symbol(ARCCOS)?void darccos():car(p1)===symbol(ARCTAN)?void darctan():car(p1)===symbol(SINH)?void dsinh():car(p1)===symbol(COSH)?void dcosh():car(p1)===symbol(TANH)?void dtanh():car(p1)===symbol(ARCSINH)?void darcsinh():car(p1)===symbol(ARCCOSH)?void darccosh():car(p1)===symbol(ARCTANH)?void darctanh():car(p1)===symbol(ABS)?void dabs():car(p1)===symbol(SGN)?void dsgn():car(p1)===symbol(HERMITE)?void dhermite():car(p1)===symbol(ERF)?void derf():car(p1)===symbol(ERFC)?void derfc():car(p1)===symbol(BESSELJ)?void(isZeroAtomOrTensor(caddr(p1))?dbesselj0():dbesseljn()):car(p1)===symbol(BESSELY)?void(isZeroAtomOrTensor(caddr(p1))?dbessely0():dbesselyn()):car(p1)===symbol(INTEGRAL)&&caddr(p1)===p2?void derivative_of_integral():dfunction():void push(zero)},dsum=function(){var r;for(r=tos,p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),derivative(),p1=cdr(p1);return add_all(tos-r)},dproduct=function(){var r,t,e,n,o,i,a;for(r=0,e=0,n=0,n=length(p1)-1,r=o=0,i=n;0<=i?o<i:o>i;r=0<=i?++o:--o){for(p3=cdr(p1),e=t=0,a=n;0<=a?t<a:t>a;e=0<=a?++t:--t)push(car(p3)),r===e&&(push(p2),derivative()),p3=cdr(p3);multiply_all(n)}return add_all(n)},dpower=function(){return push(caddr(p1)),push(cadr(p1)),divide(),push(cadr(p1)),push(p2),derivative(),multiply(),push(cadr(p1)),logarithm(),push(caddr(p1)),push(p2),derivative(),multiply(),add(),push(p1),multiply()},dlog=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),divide()},dd=function(){return(push(cadr(p1)),push(p2),derivative(),car(p3=pop())===symbol(DERIVATIVE))?(push_symbol(DERIVATIVE),push_symbol(DERIVATIVE),push(cadr(p3)),lessp(caddr(p3),caddr(p1))?(push(caddr(p3)),list(3),push(caddr(p1))):(push(caddr(p1)),list(3),push(caddr(p3))),list(3)):(push(p3),push(caddr(p1)),derivative())},dfunction=function(){return(p3=cdr(p1))===symbol(NIL)||Find(p3,p2)?(push_symbol(DERIVATIVE),push(p1),push(p2),list(3)):push(zero)},dsin=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),cosine(),multiply()},dcos=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),sine(),multiply(),negate()},dtan=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),cosine(),push_integer(-2),power(),multiply()},darcsin=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),subtract(),push_rational(-1,2),power(),multiply()},darccos=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),subtract(),push_rational(-1,2),power(),multiply(),negate()},darctan=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),add(),inverse(),multiply(),simplify()},dsinh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),ycosh(),multiply()},dcosh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),ysinh(),multiply()},dtanh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),ycosh(),push_integer(-2),power(),multiply()},darcsinh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(2),power(),push_integer(1),add(),push_rational(-1,2),power(),multiply()},darccosh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(2),power(),push_integer(-1),add(),push_rational(-1,2),power(),multiply()},darctanh=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),subtract(),inverse(),multiply()},dabs=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),sgn(),multiply()},dsgn=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),dirac(),multiply(),push_integer(2),multiply()},dhermite=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(2),push(caddr(p1)),multiply(),multiply(),push(cadr(p1)),push(caddr(p1)),push_integer(-1),add(),hermite(),multiply()},derf=function(){return push(cadr(p1)),push_integer(2),power(),push_integer(-1),multiply(),exponential(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(-1,2),power(),multiply(),push_integer(2),multiply(),push(cadr(p1)),push(p2),derivative(),multiply()},derfc=function(){return push(cadr(p1)),push_integer(2),power(),push_integer(-1),multiply(),exponential(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(-1,2),power(),multiply(),push_integer(-2),multiply(),push(cadr(p1)),push(p2),derivative(),multiply()},dbesselj0=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(1),besselj(),multiply(),push_integer(-1),multiply()},dbesseljn=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push(caddr(p1)),push_integer(-1),add(),besselj(),push(caddr(p1)),push_integer(-1),multiply(),push(cadr(p1)),divide(),push(cadr(p1)),push(caddr(p1)),besselj(),multiply(),add(),multiply()},dbessely0=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(1),besselj(),multiply(),push_integer(-1),multiply()},dbesselyn=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push(caddr(p1)),push_integer(-1),add(),bessely(),push(caddr(p1)),push_integer(-1),multiply(),push(cadr(p1)),divide(),push(cadr(p1)),push(caddr(p1)),bessely(),multiply(),add(),multiply()},derivative_of_integral=function(){return push(cadr(p1))},DET_check_arg=function(){return istensor(p1)&&2===p1.tensor.ndim?1*(p1.tensor.dim[0]===p1.tensor.dim[1]):0},det=function(){var r,t,e,n,o,i,a;if(t=0,n=0,save(),p1=pop(),0===DET_check_arg()){push_symbol(DET),push(p1),list(2),restore();return}for(n=p1.tensor.nelem,r=p1.tensor.elem,t=o=0,i=n;(0<=i?o<i:o>i)&&isNumericAtom(r[t]);t=0<=i?++o:--o);if(t===n)yydetg();else{for(t=e=0,a=p1.tensor.nelem;0<=a?e<a:e>a;t=0<=a?++e:--e)push(p1.tensor.elem[t]);determinant(p1.tensor.dim[0])}return restore()},determinant=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g;for(n=0,o=0,a=0,s=0,f=0,p=0,x=0,g=0,t=[],n=tos-r*r,o=u=0,l=r;0<=l?u<l:u>l;o=0<=l?++u:--u)t[o]=o,t[o+r]=0,t[o+r+r]=1;for(x=1,push(zero);;){for(1===x?push_integer(1):push_integer(-1),o=i=0,c=r;0<=c?i<c:i>c;o=0<=c?++i:--i)s=r*t[o]+o,push(stack[n+s]),multiply();for(add(),a=r-1,p=0,e=!1;;){if((f=t[r+a]+t[r+r+a])<0){t[r+r+a]=-t[r+r+a],a--;continue}if(f===a+1){if(0===a){e=!0;break}p++,t[r+r+a]=-t[r+r+a],a--;continue}break}if(e)break;g=t[a-t[r+a]+p],t[a-t[r+a]+p]=t[a-f+p],t[a-f+p]=g,t[r+a]=f,x=-x}return stack[n]=stack[tos-1],moveTos(n+1)},detg=function(){if(save(),p1=pop(),0===DET_check_arg()){push_symbol(DET),push(p1),list(2),restore();return}return yydetg(),restore()},yydetg=function(){var r,t,e,n;for(r=0,t=0,t=p1.tensor.dim[0],r=e=0,n=t*t;0<=n?e<n:e>n;r=0<=n?++e:--e)push(p1.tensor.elem[r]);return lu_decomp(t),moveTos(tos-t*t),push(p1)},M=function(r,t,e,n){return stack[r+t*e+n]},setM=function(r,t,e,n,o){return stack[r+t*e+n]=o},lu_decomp=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v;for(t=0,e=0,n=0,i=0,e=tos-r*r,p1=one,t=f=0,l=r-1;0<=l?f<l:f>l;t=0<=l?++f:--f){if(equal(M(e,r,t,t),zero)){for(n=o=c=t+1,p=r;(c<=p?o<p:o>p)&&equal(M(e,r,n,t),zero);n=c<=p?++o:--o);if(n===r){p1=zero;break}for(i=a=x=t,g=r;x<=g?a<g:a>g;i=x<=g?++a:--a)p2=M(e,r,t,i),setM(e,r,t,i,M(e,r,n,i)),setM(e,r,n,i,p2);push(p1),negate(),p1=pop()}for(push(p1),push(M(e,r,t,t)),multiply(),p1=pop(),n=s=h=t+1,d=r;h<=d?s<d:s>d;n=h<=d?++s:--s)for(push(M(e,r,n,t)),push(M(e,r,t,t)),divide(),negate(),p2=pop(),setM(e,r,n,t,zero),i=u=m=t+1,v=r;m<=v?u<v:u>v;i=m<=v?++u:--u)push(M(e,r,t,i)),push(p2),multiply(),push(M(e,r,n,i)),add(),setM(e,r,n,i,pop())}return push(p1),push(M(e,r,r-1,r-1)),multiply(),p1=pop()},Eval_dirac=function(){return push(cadr(p1)),Eval(),dirac()},dirac=function(){return save(),ydirac(),restore()},ydirac=function(){if(isdouble(p1=pop()))if(0===p1.d)return void push_integer(1);else return void push_integer(0);if(isrational(p1))if(MZERO(mmul(p1.q.a,p1.q.b)))return void push_integer(1);else return void push_integer(0);if(car(p1)===symbol(POWER)){push_symbol(DIRAC),push(cadr(p1)),list(2);return}if(isnegativeterm(p1)){push_symbol(DIRAC),push(p1),negate(),list(2);return}return(isnegativeterm(p1)||car(p1)===symbol(ADD)&&isnegativeterm(cadr(p1)))&&(push(p1),negate(),p1=pop()),push_symbol(DIRAC),push(p1),list(2)},divisors=function(){var r,t,e,n,o,i;for(t=0,r=0,e=0,save(),r=tos-1,divisors_onstack(),e=tos-r,(i=stack.slice(r,r+e)).sort(cmp_expr),stack=stack.slice(0,r).concat(i).concat(stack.slice(r+e)),(p1=alloc_tensor(e)).tensor.ndim=1,p1.tensor.dim[0]=e,t=n=0,o=e;0<=o?n<o:n>o;t=0<=o?++n:--n)p1.tensor.elem[t]=stack[r+t];return moveTos(r),push(p1),restore()},divisors_onstack=function(){var r,t,e,n,o,i;if(r=0,t=0,e=0,n=0,save(),p1=pop(),r=tos,isNumericAtom(p1))push(p1),factor_small_number();else if(car(p1)===symbol(ADD))push(p1),__factor_add();else if(car(p1)===symbol(MULTIPLY))for(isNumericAtom(car(p1=cdr(p1)))&&(push(car(p1)),factor_small_number(),p1=cdr(p1));iscons(p1);)p2=car(p1),car(p2)===symbol(POWER)?(push(cadr(p2)),push(caddr(p2))):(push(p2),push(one)),p1=cdr(p1);else car(p1)===symbol(POWER)?(push(cadr(p1)),push(caddr(p1))):(push(p1),push(one));for(e=tos,push(one),gen(r,e),n=tos-e,t=o=0,i=n;0<=i?o<i:o>i;t=0<=i?++o:--o)stack[r+t]=stack[e+t];return moveTos(r+n),restore()},gen=function(r,t){var e,n,o,i;if(e=0,n=0,save(),p1=pop(),r===t){push(p1),restore();return}if(p2=stack[r+0],p3=stack[r+1],push(p3),!isNaN(e=pop_integer()))for(n=o=0,i=Math.abs(e);0<=i?o<=i:o>=i;n=0<=i?++o:--o)push(p1),push(p2),push_integer(sign(e)*n),power(),multiply(),gen(r+2,t);return restore()},__factor_add=function(){for(save(),p3=cdr(p1=pop()),push(car(p3)),p3=cdr(p3);iscons(p3);)push(car(p3)),gcd(),p3=cdr(p3);if(p2=pop(),isplusone(p2)){push(p1),push(one),restore();return}if(isNumericAtom(p2))push(p2),factor_small_number();else if(car(p2)===symbol(MULTIPLY))for(isNumericAtom(car(p3=cdr(p2)))?(push(car(p3)),factor_small_number()):(push(car(p3)),push(one)),p3=cdr(p3);iscons(p3);)push(car(p3)),push(one),p3=cdr(p3);else push(p2),push(one);for(push(p2),inverse(),p2=pop(),push(zero),p3=cdr(p1);iscons(p3);)push(p2),push(car(p3)),multiply(),add(),p3=cdr(p3);return push(one),restore()},dpow=function(){var r,t,e,n,o,i;return(r=0,t=0,e=0,n=0,o=0,i=0,n=pop_double(),0===(e=pop_double())&&n<0&&stop("divide by zero"),e>=0||n%1==0)?void push_double(o=Math.pow(e,n)):(o=Math.pow(Math.abs(e),n),i=Math.PI*n,r=n%.5==0?0:Math.cos(i),t=Math.sin(i),push_double(r*o),push_double(t*o),push(imaginaryunit),multiply(),add())},EIG_N=0,EIG_yydd=[],EIG_yyqq=[],Eval_eigen=function(){return 0===EIG_check_arg()&&stop("eigen: argument is not a square matrix"),eigen(EIGEN),p1=usr_symbol("D"),set_binding(p1,p2),p1=usr_symbol("Q"),set_binding(p1,p3),push(symbol(NIL))},Eval_eigenval=function(){if(0===EIG_check_arg()){push_symbol(EIGENVAL),push(p1),list(2);return}return eigen(EIGENVAL),push(p2)},Eval_eigenvec=function(){if(0===EIG_check_arg()){push_symbol(EIGENVEC),push(p1),list(2);return}return eigen(EIGENVEC),push(p3)},EIG_check_arg=function(){var r,t,e,n,o,i,a,s,u,f,l;if(r=0,e=0,push(cadr(p1)),Eval(),yyfloat(),Eval(),!istensor(p1=pop()))return 0;for((2!==p1.tensor.ndim||p1.tensor.dim[0]!==p1.tensor.dim[1])&&stop("eigen: argument is not a square matrix"),EIG_N=p1.tensor.dim[0],r=i=0,a=EIG_N;0<=a?i<a:i>a;r=0<=a?++i:--i)for(e=t=0,s=EIG_N;0<=s?t<s:t>s;e=0<=s?++t:--t)isdouble(p1.tensor.elem[EIG_N*r+e])||stop("eigen: matrix is not numerical");for(r=n=0,u=EIG_N-1;0<=u?n<u:n>u;r=0<=u?++n:--n)for(e=o=f=r+1,l=EIG_N;f<=l?o<l:o>l;e=f<=l?++o:--o)Math.abs(p1.tensor.elem[EIG_N*r+e].d-p1.tensor.elem[EIG_N*e+r].d)>1e-10&&stop("eigen: matrix is not symmetrical");return 1},eigen=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k,w,M;for(t=0,n=0,t=u=0,p=EIG_N*EIG_N;0<=p?u<p:u>p;t=0<=p?++u:--u)EIG_yydd[t]=0;for(t=e=0,x=EIG_N*EIG_N;0<=x?e<x:e>x;t=0<=x?++e:--e)EIG_yyqq[t]=0;for(t=o=0,h=EIG_N;0<=h?o<h:o>h;t=0<=h?++o:--o)for(EIG_yydd[EIG_N*t+t]=p1.tensor.elem[EIG_N*t+t].d,n=i=d=t+1,m=EIG_N;d<=m?i<m:i>m;n=d<=m?++i:--i)EIG_yydd[EIG_N*t+n]=p1.tensor.elem[EIG_N*t+n].d,EIG_yydd[EIG_N*n+t]=p1.tensor.elem[EIG_N*t+n].d;for(t=a=0,v=EIG_N;0<=v?a<v:a>v;t=0<=v?++a:--a)for(EIG_yyqq[EIG_N*t+t]=1,n=s=b=t+1,y=EIG_N;b<=y?s<y:s>y;n=b<=y?++s:--s)EIG_yyqq[EIG_N*t+n]=0,EIG_yyqq[EIG_N*n+t]=0;for(t=f=0;f<100&&0!==step();t=++f);if(100===t&&printstr("\nnote: eigen did not converge\n"),r===EIGEN||r===EIGENVAL)for(push(p1),copy_tensor(),p2=pop(),t=l=0,q=EIG_N;0<=q?l<q:l>q;t=0<=q?++l:--l)for(n=c=0,k=EIG_N;0<=k?c<k:c>k;n=0<=k?++c:--c)push_double(EIG_yydd[EIG_N*t+n]),p2.tensor.elem[EIG_N*t+n]=pop();if(r===EIGEN||r===EIGENVEC){for(push(p1),copy_tensor(),p3=pop(),w=[],t=M=0,g=EIG_N;0<=g?M<g:M>g;t=0<=g?++M:--M)w.push(function(){var r,e,o;for(e=[],n=o=0,r=EIG_N;0<=r?o<r:o>r;n=0<=r?++o:--o)push_double(EIG_yyqq[EIG_N*t+n]),e.push(p3.tensor.elem[EIG_N*t+n]=pop());return e}());return w}},step=function(){var r,t,e,n,o,i,a,s;for(t=0,n=0,r=0,t=o=0,i=EIG_N-1;0<=i?o<i:o>i;t=0<=i?++o:--o)for(n=e=a=t+1,s=EIG_N;a<=s?e<s:e>s;n=a<=s?++e:--e)0!==EIG_yydd[EIG_N*t+n]&&(step2(t,n),r++);return r},step2=function(r,t){var e,n,o,i,a,s,u,f,l,c,p,x,g;for(a=0,x=0,g=0,e=0,n=0,c=0,p=0,x=1/(Math.abs(g=.5*(EIG_yydd[EIG_N*r+r]-EIG_yydd[EIG_N*t+t])/EIG_yydd[EIG_N*r+t])+Math.sqrt(g*g+1)),g<0&&(x=-x),e=1/Math.sqrt(x*x+1),c=x*e,a=s=0,u=EIG_N;0<=u?s<u:s>u;a=0<=u?++s:--s)n=EIG_yydd[EIG_N*r+a],p=EIG_yydd[EIG_N*t+a],EIG_yydd[EIG_N*r+a]=e*n+c*p,EIG_yydd[EIG_N*t+a]=e*p-c*n;for(a=o=0,f=EIG_N;0<=f?o<f:o>f;a=0<=f?++o:--o)n=EIG_yydd[EIG_N*a+r],p=EIG_yydd[EIG_N*a+t],EIG_yydd[EIG_N*a+r]=e*n+c*p,EIG_yydd[EIG_N*a+t]=e*p-c*n;for(a=i=0,l=EIG_N;0<=l?i<l:i>l;a=0<=l?++i:--i)n=EIG_yyqq[EIG_N*r+a],p=EIG_yyqq[EIG_N*t+a],EIG_yyqq[EIG_N*r+a]=e*n+c*p,EIG_yyqq[EIG_N*t+a]=e*p-c*n;return EIG_yydd[EIG_N*r+t]=0,EIG_yydd[EIG_N*t+r]=0},Eval_erf=function(){return push(cadr(p1)),Eval(),yerf()},yerf=function(){return save(),yyerf(),restore()},yyerf=function(){var r;if(r=0,isdouble(p1=pop())){r=1-erfc(p1.d),push_double(r);return}if(isZeroAtomOrTensor(p1))return void push(zero);if(isnegativeterm(p1)){push_symbol(ERF),push(p1),negate(),list(2),negate();return}push_symbol(ERF),push(p1),list(2)},Eval_erfc=function(){return push(cadr(p1)),Eval(),yerfc()},yerfc=function(){return save(),yyerfc(),restore()},yyerfc=function(){var r;if(r=0,isdouble(p1=pop())){r=erfc(p1.d),push_double(r);return}isZeroAtomOrTensor(p1)?push(one):(push_symbol(ERFC),push(p1),list(2))},erfc=function(r){var t,e,n;return 0===r?1:(e=0,n=0,t=0,t=(e=1/(1+.5*(n=Math.abs(r))))*Math.exp(-n*n-1.26551223+e*(1.00002368+e*(.37409196+e*(.09678418+e*(-.18628806+e*(.27886807+e*(-1.13520398+e*(1.48851587+e*(-.82215223+.17087277*e))))))))),r>=0)?t:2-t},Eval=function(){var r;switch(check_esc_flag(),save(),p1=pop(),!evaluatingAsFloats&&isfloating(p1)&&(r=!0,evaluatingAsFloats++),p1.k){case CONS:Eval_cons();break;case NUM:evaluatingAsFloats?push_double(convert_rational_to_double(p1)):push(p1);break;case DOUBLE:case STR:push(p1);break;case TENSOR:Eval_tensor();break;case SYM:Eval_sym();break;default:stop("atom?")}return r&&evaluatingAsFloats--,restore()},Eval_sym=function(){var r,t,e,n,o,i;if(iskeyword(p1)){push(p1),push(symbol(LAST)),list(2),Eval();return}if(p1===symbol(PI)&&evaluatingAsFloats)return void push_double(Math.PI);if(p2=get_binding(p1),DEBUG&&console.log("looked up: "+p1+" which contains: "+p2),push(p2),p1!==p2){if(-1!==(n=chainOfUserSymbolsNotFunctionsBeingEvaluated.indexOf(p1))){for(r="",t=e=o=n,i=chainOfUserSymbolsNotFunctionsBeingEvaluated.length;o<=i?e<i:e>i;t=o<=i?++e:--e)r+=chainOfUserSymbolsNotFunctionsBeingEvaluated[t].printname+" -> ";r+=p1.printname,stop("recursive evaluation of symbols: "+r);return}return chainOfUserSymbolsNotFunctionsBeingEvaluated.push(p1),Eval(),chainOfUserSymbolsNotFunctionsBeingEvaluated.pop()}},Eval_cons=function(){var r;if(r=car(p1),car(r)===symbol(EVAL))return void Eval_user_function();switch(!issymbol(r)&&stop("cons?"),symnum(r)){case ABS:return Eval_abs();case ADD:return Eval_add();case ADJ:return Eval_adj();case AND:return Eval_and();case ARCCOS:return Eval_arccos();case ARCCOSH:return Eval_arccosh();case ARCSIN:return Eval_arcsin();case ARCSINH:return Eval_arcsinh();case ARCTAN:return Eval_arctan();case ARCTANH:return Eval_arctanh();case ARG:return Eval_arg();case ATOMIZE:return Eval_atomize();case BESSELJ:return Eval_besselj();case BESSELY:return Eval_bessely();case BINDING:return Eval_binding();case BINOMIAL:return Eval_binomial();case CEILING:return Eval_ceiling();case CHECK:return Eval_check();case CHOOSE:return Eval_choose();case CIRCEXP:return Eval_circexp();case CLEAR:return Eval_clear();case CLEARALL:return Eval_clearall();case CLEARPATTERNS:return Eval_clearpatterns();case CLOCK:return Eval_clock();case COEFF:return Eval_coeff();case COFACTOR:return Eval_cofactor();case CONDENSE:return Eval_condense();case CONJ:return Eval_conj();case CONTRACT:return Eval_contract();case COS:return Eval_cos();case COSH:return Eval_cosh();case DECOMP:return Eval_decomp();case DEGREE:return Eval_degree();case DEFINT:return Eval_defint();case DENOMINATOR:return Eval_denominator();case DERIVATIVE:return Eval_derivative();case DET:return Eval_det();case DIM:return Eval_dim();case DIRAC:return Eval_dirac();case DIVISORS:return Eval_divisors();case DO:return Eval_do();case DOT:return Eval_inner();case DRAW:return Eval_draw();case DSOLVE:return Eval_dsolve();case EIGEN:return Eval_eigen();case EIGENVAL:return Eval_eigenval();case EIGENVEC:return Eval_eigenvec();case ERF:return Eval_erf();case ERFC:return Eval_erfc();case EVAL:return Eval_Eval();case EXP:return Eval_exp();case EXPAND:return Eval_expand();case EXPCOS:return Eval_expcos();case EXPSIN:return Eval_expsin();case FACTOR:return Eval_factor();case FACTORIAL:return Eval_factorial();case FACTORPOLY:return Eval_factorpoly();case FILTER:return Eval_filter();case FLOATF:return Eval_float();case APPROXRATIO:return Eval_approxratio();case FLOOR:return Eval_floor();case FOR:return Eval_for();case FUNCTION:return Eval_function_reference();case GAMMA:return Eval_gamma();case GCD:return Eval_gcd();case HERMITE:return Eval_hermite();case HILBERT:return Eval_hilbert();case IMAG:return Eval_imag();case INDEX:return Eval_index();case INNER:return Eval_inner();case INTEGRAL:return Eval_integral();case INV:return Eval_inv();case INVG:return Eval_invg();case ISINTEGER:return Eval_isinteger();case ISPRIME:return Eval_isprime();case LAGUERRE:return Eval_laguerre();case LCM:return Eval_lcm();case LEADING:return Eval_leading();case LEGENDRE:return Eval_legendre();case LOG:return Eval_log();case LOOKUP:return Eval_lookup();case MOD:return Eval_mod();case MULTIPLY:return Eval_multiply();case NOT:return Eval_not();case NROOTS:return Eval_nroots();case NUMBER:return Eval_number();case NUMERATOR:return Eval_numerator();case OPERATOR:return Eval_operator();case OR:return Eval_or();case OUTER:return Eval_outer();case PATTERN:return Eval_pattern();case PATTERNSINFO:return Eval_patternsinfo();case POLAR:return Eval_polar();case POWER:return Eval_power();case PRIME:return Eval_prime();case PRINT:return Eval_print();case PRINT2DASCII:return Eval_print2dascii();case PRINTFULL:return Eval_printcomputer();case PRINTLATEX:return Eval_printlatex();case PRINTLIST:return Eval_printlist();case PRINTPLAIN:return Eval_printhuman();case PRODUCT:return Eval_product();case QUOTE:return Eval_quote();case QUOTIENT:return Eval_quotient();case RANK:return Eval_rank();case RATIONALIZE:return Eval_rationalize();case REAL:return Eval_real();case ROUND:return Eval_round();case YYRECT:return Eval_rect();case ROOTS:return Eval_roots();case SETQ:return Eval_setq();case SGN:return Eval_sgn();case SILENTPATTERN:return Eval_silentpattern();case SIMPLIFY:return Eval_simplify();case SIN:return Eval_sin();case SINH:return Eval_sinh();case SHAPE:return Eval_shape();case SQRT:return Eval_sqrt();case STOP:return Eval_stop();case SUBST:return Eval_subst();case SUM:return Eval_sum();case SYMBOLSINFO:return Eval_symbolsinfo();case TAN:return Eval_tan();case TANH:return Eval_tanh();case TAYLOR:return Eval_taylor();case TEST:return Eval_test();case TESTEQ:return Eval_testeq();case TESTGE:return Eval_testge();case TESTGT:return Eval_testgt();case TESTLE:return Eval_testle();case TESTLT:return Eval_testlt();case TRANSPOSE:return Eval_transpose();case UNIT:return Eval_unit();case ZERO:return Eval_zero();default:return Eval_user_function()}},Eval_binding=function(){return push(get_binding(cadr(p1)))},Eval_check=function(){var r;return null==(r=isZeroLikeOrNonZeroLikeOrUndetermined(cadr(p1)))?push(p1):push_integer(r)},Eval_det=function(){return push(cadr(p1)),Eval(),det()},Eval_dim=function(){var r;return(push(cadr(p1)),Eval(),p2=pop(),iscons(cddr(p1))?(push(caddr(p1)),Eval(),r=pop_integer()):r=1,istensor(p2))?r<1||r>p2.tensor.ndim?push(p1):push_integer(p2.tensor.dim[r-1]):push_integer(1)},Eval_divisors=function(){return push(cadr(p1)),Eval(),divisors()},Eval_do=function(){var r;for(push(car(p1)),p1=cdr(p1),r=[];iscons(p1);)pop(),push(car(p1)),Eval(),r.push(p1=cdr(p1));return r},Eval_dsolve=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),dsolve()},Eval_Eval=function(){for(push(cadr(p1)),Eval(),p1=cddr(p1);iscons(p1);)push(car(p1)),Eval(),push(cadr(p1)),Eval(),subst(),p1=cddr(p1);return Eval()},Eval_exp=function(){return push(cadr(p1)),Eval(),exponential()},Eval_factorial=function(){return push(cadr(p1)),Eval(),factorial()},Eval_factorpoly=function(){var r;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),factorpoly(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),factorpoly(),r.push(p1=cdr(p1));return r},Eval_hermite=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),hermite()},Eval_hilbert=function(){return push(cadr(p1)),Eval(),hilbert()},Eval_index=function(){var r,t,e;if(r=tos,t=p1,p1=cdr(p1),push(car(p1)),Eval(),isNumericAtom(e=stack[tos-1])&&stop("trying to access a scalar as a tensor"),!istensor(e)){moveTos(r),push(t);return}for(p1=cdr(p1);iscons(p1);){if(push(car(p1)),Eval(),!isintegerorintegerfloat(stack[tos-1])){moveTos(r),push(t);return}p1=cdr(p1)}return index_function(tos-r)},Eval_inv=function(){return push(cadr(p1)),Eval(),inv()},Eval_invg=function(){return push(cadr(p1)),Eval(),invg()},Eval_isinteger=function(){return(push(cadr(p1)),Eval(),isrational(p1=pop()))?void(isinteger(p1)?push(one):push(zero)):isdouble(p1)?void(Math.floor(p1.d)===p1.d?push(one):push(zero)):(push_symbol(ISINTEGER),push(p1),list(2))},Eval_number=function(){return(push(cadr(p1)),Eval(),(p1=pop()).k===NUM||p1.k===DOUBLE)?push_integer(1):push_integer(0)},Eval_operator=function(){var r;for(r=tos,push_symbol(OPERATOR),p1=cdr(p1);iscons(p1);)push(car(p1)),Eval(),p1=cdr(p1);return list(tos-r)},Eval_quote=function(){return push(cadr(p1))},Eval_rank=function(){return(push(cadr(p1)),Eval(),istensor(p1=pop()))?push_integer(p1.tensor.ndim):push(zero)},Eval_setq=function(){return caadr(p1)===symbol(INDEX)?void setq_indexed():iscons(cadr(p1))?void define_user_function():(issymbol(cadr(p1))||stop("symbol assignment: error in symbol"),push(caddr(p1)),Eval(),p2=pop(),set_binding(cadr(p1),p2),push(symbol(NIL)))},setq_indexed=function(){var r;for(issymbol(p4=cadadr(p1))||stop("indexed assignment: expected a symbol name"),r=tos,push(caddr(p1)),Eval(),p2=cdadr(p1);iscons(p2);)push(car(p2)),Eval(),p2=cdr(p2);return set_component(tos-r),p3=pop(),set_binding(p4,p3),push(symbol(NIL))},Eval_sqrt=function(){return push(cadr(p1)),Eval(),push_rational(1,2),power()},Eval_stop=function(){return stop("user stop")},Eval_subst=function(){return push(cadddr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadr(p1)),Eval(),subst(),Eval()},Eval_unit=function(){var r,t,e,n;if(r=0,t=0,push(cadr(p1)),Eval(),isNaN(t=pop_integer())||t<1)return void push(p1);for((p1=alloc_tensor(t*t)).tensor.ndim=2,p1.tensor.dim[0]=t,p1.tensor.dim[1]=t,r=e=0,n=t;0<=n?e<n:e>n;r=0<=n?++e:--e)p1.tensor.elem[t*r+r]=one;return check_tensor_dimensions(p1),push(p1)},Eval_noexpand=function(){var r;return r=expanding,expanding=0,Eval(),expanding=r},Eval_predicate=function(){return save(),car(p1=top())===symbol(SETQ)&&(pop(),push_symbol(TESTEQ),push(cadr(p1)),push(caddr(p1)),list(3)),Eval(),restore()},Eval_expand=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p2=pop())===symbol(NIL)?guess():push(p2),expand()},expand=function(){var r;if(save(),p9=pop(),istensor(p5=pop())){expand_tensor(),restore();return}if(car(p5)===symbol(ADD)){for(push_integer(0),p1=cdr(p5);iscons(p1);)push(car(p1)),push(p9),expand(),add(),p1=cdr(p1);restore();return}if(push(p5),numerator(),p3=pop(),push(p5),denominator(),p2=pop(),remove_negative_exponents(),push(p3),push(p2),push(p9),(isone(p3)||isone(p2))&&(!ispolyexpandedform(p2,p9)||isone(p2))){pop(),pop(),pop(),push(p5),restore();return}if(divpoly(),p7=pop(),push(p3),push(p2),push(p7),multiply(),subtract(),p3=pop(),isZeroAtomOrTensor(p3)){push(p7),restore();return}return push(p2),push(p9),factorpoly(),p2=pop(),expand_get_C(),expand_get_B(),expand_get_A(),istensor(p4)?(push(p4),r=expanding,expanding=1,inv(),expanding=r,push(p3),inner(),push(p2),inner()):(push(p3),push(p4),r=expanding,expanding=1,divide(),expanding=r,push(p2),multiply()),push(p7),add(),restore()},expand_tensor=function(){var r,t,e;for(r=0,push(p5),copy_tensor(),p5=pop(),r=t=0,e=p5.tensor.nelem;0<=e?t<e:t>e;r=0<=e?++t:--t)push(p5.tensor.elem[r]),push(p9),expand(),p5.tensor.elem[r]=pop();return push(p5)},remove_negative_exponents=function(){var r,t,e,n,o,i,a;for(r=0,t=0,e=0,n=0,o=0,r=tos,factors(p2),factors(p3),o=tos-r,e=0,t=i=0,a=o;0<=a?i<a:i>a;t=0<=a?++i:--i)car(p1=stack[r+t])===symbol(POWER)&&cadr(p1)===p9&&(push(caddr(p1)),!isNaN(n=pop_integer())&&n<e&&(e=n));if(moveTos(r),0!==e)return push(p2),push(p9),push_integer(-e),power(),multiply(),p2=pop(),push(p3),push(p9),push_integer(-e),power(),multiply(),p3=pop()},expand_get_C=function(){var r,t,e,n,o,i,a,s,u,f;if(t=0,e=0,o=0,i=0,t=tos,car(p2)===symbol(MULTIPLY))for(p1=cdr(p2);iscons(p1);)p5=car(p1),expand_get_CF(),p1=cdr(p1);else p5=p2,expand_get_CF();if(1==(i=tos-t)){p4=pop();return}for((p4=alloc_tensor(i*i)).tensor.ndim=2,p4.tensor.dim[0]=i,p4.tensor.dim[1]=i,r=t,e=a=0,u=i;0<=u?a<u:a>u;e=0<=u?++a:--a)for(o=n=0,f=i;0<=f?n<f:n>f;o=0<=f?++n:--n)push(stack[r+o]),push(p9),push_integer(e),power(),s=expanding,expanding=1,divide(),expanding=s,push(p9),filter(),p4.tensor.elem[i*e+o]=pop();return moveTos(tos-i)},expand_get_CF=function(){var r,t,e,n,o,i,a,s;if(r=0,t=0,e=0,n=0,Find(p5,p9)){for(i=expanding,expanding=1,trivial_divide(),expanding=i,car(p5)===symbol(POWER)?(push(caddr(p5)),n=pop_integer(),p6=cadr(p5)):(n=1,p6=p5),push(p6),push(p9),degree(),r=pop_integer(),s=[],t=o=0,a=n;0<=a?o<a:o>a;t=0<=a?++o:--o)s.push(function(){var n,o,a;for(a=[],e=n=0,o=r;0<=o?n<o:n>o;e=0<=o?++n:--n)push(p8),push(p6),push_integer(t),power(),i=expanding,expanding=1,multiply(),expanding=i,push(p9),push_integer(e),power(),i=expanding,expanding=1,multiply(),a.push(expanding=i);return a}());return s}},trivial_divide=function(){var r;if(r=0,car(p2)===symbol(MULTIPLY)){for(r=tos,p0=cdr(p2);iscons(p0);)equal(car(p0),p5)||(push(car(p0)),Eval()),p0=cdr(p0);multiply_all(tos-r)}else push_integer(1);return p8=pop()},expand_get_B=function(){var r,t,e,n,o;if(r=0,t=0,istensor(p4)){for(t=p4.tensor.dim[0],p8=alloc_tensor(t),p8.tensor.ndim=1,p8.tensor.dim[0]=t,r=e=0,o=t;0<=o?e<o:e>o;r=0<=o?++e:--e)push(p3),push(p9),push_integer(r),power(),n=expanding,expanding=1,divide(),expanding=n,push(p9),filter(),p8.tensor.elem[r]=pop();return p3=p8}},expand_get_A=function(){var r,t,e,n,o;if(r=0,t=0,e=0,!istensor(p4)){push(p2),reciprocate(),p2=pop();return}if(r=tos,car(p2)===symbol(MULTIPLY))for(p8=cdr(p2);iscons(p8);)p5=car(p8),expand_get_AF(),p8=cdr(p8);else p5=p2,expand_get_AF();for((p8=alloc_tensor(e=tos-r)).tensor.ndim=1,p8.tensor.dim[0]=e,t=n=0,o=e;0<=o?n<o:n>o;t=0<=o?++n:--n)p8.tensor.elem[t]=stack[r+t];return moveTos(r),p2=p8},expand_get_AF=function(){var r,t,e,n,o,i,a;if(r=0,t=0,e=0,n=1,Find(p5,p9)){for(car(p5)===symbol(POWER)&&(push(caddr(p5)),n=pop_integer(),p5=cadr(p5)),push(p5),push(p9),degree(),r=pop_integer(),a=[],t=o=i=n;i<=0?o<0:o>0;t=i<=0?++o:--o)a.push(function(){var n,o,i;for(i=[],e=n=0,o=r;0<=o?n<o:n>o;e=0<=o?++n:--n)push(p5),push_integer(t),power(),reciprocate(),push(p9),push_integer(e),power(),i.push(multiply());return i}());return a}},Eval_expcos=function(){return push(cadr(p1)),Eval(),expcos()},expcos=function(){return save(),p1=pop(),push(imaginaryunit),push(p1),multiply(),exponential(),push_rational(1,2),multiply(),push(imaginaryunit),negate(),push(p1),multiply(),exponential(),push_rational(1,2),multiply(),add(),restore()},Eval_expsin=function(){return push(cadr(p1)),Eval(),expsin()},expsin=function(){return save(),p1=pop(),push(imaginaryunit),push(p1),multiply(),exponential(),push(imaginaryunit),divide(),push_rational(1,2),multiply(),push(imaginaryunit),negate(),push(p1),multiply(),exponential(),push(imaginaryunit),divide(),push_rational(1,2),multiply(),subtract(),restore()},Eval_factor=function(){var r;for(push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p2=pop())===symbol(NIL)?guess():push(p2),factor(),p1=cdddr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),factor_again(),r.push(p1=cdr(p1));return r},factor_again=function(){var r,t;if(save(),p2=pop(),p1=pop(),r=tos,car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),factor_term(),p1=cdr(p1);else push(p1),push(p2),factor_term();return(t=tos-r)>1&&multiply_all_noexpand(t),restore()},factor_term=function(){if(save(),factorpoly(),car(p1=pop())===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1);else push(p1);return restore()},factor=function(){return save(),p2=pop(),p1=pop(),isinteger(p1)?(push(p1),factor_number()):(push(p1),push(p2),factorpoly()),restore()},factor_small_number=function(){var r,t,e,n,o,i;for(e=0,save(),isNaN(n=pop_integer())&&stop("number too big to factor"),n<0&&(n=-n),e=o=0,i=MAXPRIMETAB;(0<=i?o<i:o>i)&&!((r=primetab[e])>n/r);e=0<=i?++o:--o){for(t=0;n%r==0;)n/=r,t++;t&&(push_integer(r),push_integer(t))}return n>1&&(push_integer(n),push_integer(1)),restore()},factorial=function(){var r;if(r=0,save(),p1=pop(),push(p1),(r=pop_integer())<0||isNaN(r)){push_symbol(FACTORIAL),push(p1),list(2),restore();return}return bignum_factorial(r),restore()},simplifyfactorials=function(){var r;if(r=0,save(),r=expanding,expanding=0,car(p1=pop())===symbol(ADD)){for(push(zero),p1=cdr(p1);iscons(p1);)push(car(p1)),simplifyfactorials(),add(),p1=cdr(p1);expanding=r,restore();return}if(car(p1)===symbol(MULTIPLY)){sfac_product(),expanding=r,restore();return}return push(p1),expanding=r,restore()},sfac_product=function(){var r,t,e,n,o,i,a,s,u,f,l;for(r=0,e=0,o=0,l=tos,p1=cdr(p1),o=0;iscons(p1);)push(car(p1)),p1=cdr(p1),o++;for(r=i=0,a=o-1;0<=a?i<a:i>a;r=0<=a?++i:--i)if(stack[l+r]!==symbol(NIL))for(e=t=s=r+1,u=o;s<=u?t<u:t>u;e=s<=u?++t:--t)stack[l+e]!==symbol(NIL)&&sfac_product_f(l,r,e);for(push(one),r=n=0,f=o;0<=f?n<f:n>f;r=0<=f?++n:--n)stack[l+r]!==symbol(NIL)&&(push(stack[l+r]),multiply());return p1=pop(),moveTos(tos-o),push(p1)},sfac_product_f=function(r,t,e){var n,o,i,a;if(n=0,o=0,p1=stack[r+t],p2=stack[r+e],ispower(p1)?(p3=caddr(p1),p1=cadr(p1)):p3=one,ispower(p2)?(p4=caddr(p2),p2=cadr(p2)):p4=one,isfactorial(p1)&&isfactorial(p2)){if(push(p3),push(p4),add(),yyexpand(),0!==(o=pop_integer())||(push(cadr(p1)),push(cadr(p2)),subtract(),yyexpand(),0===(o=pop_integer())||isNaN(o)))return;for(o<0&&(o=-o,p5=p1,p1=p2,p2=p5,p5=p3,p3=p4,p4=p5),push(one),n=i=1,a=o;1<=a?i<=a:i>=a;n=1<=a?++i:--i)push(cadr(p2)),push_integer(n),add(),push(p3),power(),multiply();return stack[r+t]=pop(),stack[r+e]=symbol(NIL)}},factorpoly=function(){var r,t;return DEBUG&&console.log("factorpoly: "+stack[tos-1].toString()+" "+stack[tos-2].toString()),save(),t=pop(),r=pop(),Find(r,t)&&ispolyexpandedform(r,t)&&issymbol(t)?yyfactorpoly(t,r):push(r),restore()},yyfactorpoly=function(r,t){var e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k,w,M,_,A,S,E;for(DEBUG&&console.log("yyfactorpoly: "+(u=r)+" "+(S=t)),save(),c=tos,isfloating(t)&&stop("floating point numbers in polynomial"),v=tos,s=coeff(r,t)-1,DEBUG&&console.log("yyfactorpoly: "+u+" "+S+" factpoly_expo before rationalize_coefficients: "+s),m=rationalize_coefficients(c),DEBUG&&console.log("yyfactorpoly: "+u+" "+S+" factpoly_expo  after rationalize_coefficients: "+s),E="real",_=null;s>0;)if(DEBUG&&console.log("yyfactorpoly: "+u+" "+S+" factpoly_expo inside while loop: "+s),isZeroAtomOrTensor(stack[v+0])?(DEBUG&&console.log("yyfactorpoly: "+u+" "+S+" isZeroAtomOrTensor"),e=one,o=zero):"real"===E?[l,e,o]=get_factor_from_real_root(r,s,v):"complex"===E&&([f,e]=get_factor_from_complex_root(_,s,v)),"real"===E)if(0===l){E="complex";continue}else{for(push(e),push(r),multiply(),push(o),add(),n=pop(),DEBUG&&console.log("yyfactorpoly: "+u+" "+S+" success\nFACTOR="+n),push(m),push(n),multiply_noexpand(),m=pop(),yydivpoly(s,v,e,o);s&&isZeroAtomOrTensor(stack[v+s]);)s--;for(push(zero),p=d=0,q=s;0<=q?d<=q:d>=q;p=0<=q?++d:--d)push(stack[v+p]),push(r),push_integer(p),power(),multiply(),add();_=pop()}else if("complex"===E)if(0===f)break;else{if(push(e),push(r),subtract(),push(e),conjugate(),push(r),subtract(),multiply(),A=pop(),DEBUG&&console.log("yyfactorpoly: "+u+" "+S+" success\nFACTOR="+A),push(m),y=pop(),push(m),push(A),multiply_noexpand(),m=pop(),null==_){for(push(zero),p=x=0,k=s;0<=k?x<=k:x>=k;p=0<=k?++x:--x)push(stack[v+p]),push(r),push_integer(p),power(),multiply(),add();_=pop()}if(push(a=_),push(A),push(r),divpoly(),_=pop(),push(_),push(A),multiply(),i=pop(),!equal(i,a)){DEBUG&&console.log("we found a polynomial based on complex root and its conj but it doesn't divide the poly, quitting"),DEBUG&&console.log("so just returning previousFactorisation times dividend: "+y+" * "+a),push(y),push(a),b=expanding,expanding=0,yycondense(),expanding=b,multiply_noexpand(),m=pop(),stack[c]=m,moveTos(c+1),restore();return}for(p=g=0,w=s;0<=w?g<=w:g>=w;p=0<=w?++g:--g)pop();coeff(r,_),s-=2}for(DEBUG&&console.log("yyfactorpoly: "+u+" "+S+" building the remaining unfactored part of the polynomial"),push(zero),p=h=0,M=s;0<=M?h<=M:h>=M;p=0<=M?++h:--h)push(stack[v+p]),push(r),push_integer(p),power(),multiply(),add();return t=pop(),DEBUG&&console.log("yyfactorpoly: "+u+" "+S+" remaining unfactored part of the polynomial: "+t.toString()),push(t),b=expanding,expanding=0,yycondense(),expanding=b,t=pop(),DEBUG&&console.log("yyfactorpoly: "+u+" "+S+" new poly with extracted common factor: "+t.toString()),s>0&&isnegativeterm(stack[v+s])&&(push(t),negate(),t=pop(),push(m),negate_noexpand(),m=pop()),push(m),push(t),multiply_noexpand(),m=pop(),DEBUG&&console.log("yyfactorpoly: "+u+" "+S+" result: "+m),stack[c]=m,moveTos(c+1),restore()},rationalize_coefficients=function(r){var t,e,n,o,i,a,s,u,f;for(o=one,t=n=a=r,s=tos;a<=s?n<s:n>s;t=a<=s?++n:--n)push(stack[t]),denominator(),push(o),lcm(),o=pop();for(t=e=u=r,f=tos;u<=f?e<f:e>f;t=u<=f?++e:--e)push(o),push(stack[t]),multiply(),stack[t]=pop();return push(o),reciprocate(),i=pop(),DEBUG&&console.log("rationalize_coefficients result: "+i.toString()),i},get_factor_from_real_root=function(r,t,e){var n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k,w,M,_;if(DEBUG&&console.log("get_factor_from_real_root"),s=0,f=0,a=0,n=0,o=0,x=0,g=0,DEBUG){for(push(zero),s=h=0,d=t;0<=d?h<=d:h>=d;s=0<=d?++h:--h)push(stack[e+s]),push(r),push_integer(s),power(),multiply(),add();console.log("POLY="+pop())}if(a=tos,o=tos,push(stack[e+t]),divisors_onstack(),g=tos-o,n=tos,push(stack[e+0]),divisors_onstack(),x=tos-n,DEBUG){for(console.log("divisors of base term"),s=u=0,m=x;0<=m?u<m:u>m;s=0<=m?++u:--u)console.log(", "+stack[n+s]);for(console.log("divisors of leading term"),s=l=0,v=g;0<=v?l<v:l>v;s=0<=v?++l:--l)console.log(", "+stack[o+s])}for(q=c=0,b=g;0<=b?c<b:c>b;q=0<=b?++c:--c)for(k=p=0,y=x;0<=y?p<y:p>y;k=0<=y?++p:--p)if(M=stack[o+q],w=stack[n+k],push(w),push(M),divide(),negate(),_=pop(),i=Evalpoly(t,e,_),DEBUG&&(console.log("try A="+M),console.log(", B="+w),console.log(", root "+r),console.log("=-B/A="+_),console.log(", POLY("+_),console.log(")="+i)),isZeroAtomOrTensor(i)||(push(w),negate(),w=pop(),push(_),negate(),_=pop(),i=Evalpoly(t,e,_),DEBUG&&(console.log("try A="+M),console.log(", B="+w),console.log(", root "+r),console.log("=-B/A="+_),console.log(", POLY("+_),console.log(")="+i)),isZeroAtomOrTensor(i)))return moveTos(a),DEBUG&&console.log("get_factor_from_real_root returning 1"),[1,M,w];return moveTos(a),DEBUG&&console.log("get_factor_from_real_root returning"),[0,null,null]},get_factor_from_complex_root=function(r,t,e){var n,o,i,a,s,u,f,l,c,p,x,g,h;if(s=0,f=0,a=0,n=0,o=0,l=0,c=0,t<=2)return DEBUG&&console.log("no more factoring via complex roots to be found in polynomial of degree <= 2"),[0,null];if(DEBUG&&console.log("complex root finding for POLY="+r),a=tos,o=tos,push_integer(-1),push_rational(2,3),power(),rect(),h=pop(),DEBUG&&console.log("complex root finding: trying with "+h),push(h),i=Evalpoly(t,e,h),DEBUG&&console.log("complex root finding result: "+i),isZeroAtomOrTensor(i)||(push_integer(1),push_rational(2,3),power(),rect(),h=pop(),DEBUG&&console.log("complex root finding: trying with "+h),push(h),i=Evalpoly(t,e,h),DEBUG&&console.log("complex root finding result: "+i),isZeroAtomOrTensor(i)))return moveTos(a),DEBUG&&console.log("get_factor_from_complex_root returning 1"),[1,h];for(x=p=-10;p<=10;x=++p)for(g=u=1;u<=5;g=++u)if(push_integer(x),push_integer(g),push(imaginaryunit),multiply(),add(),rect(),h=pop(),DEBUG&&console.log("complex root finding: trying simple complex combination "+h),push(h),i=Evalpoly(t,e,h),isZeroAtomOrTensor(i))return moveTos(a),DEBUG&&console.log("found complex root: "+i),[1,h];return moveTos(a),DEBUG&&console.log("get_factor_from_complex_root returning 0"),[0,null]},yydivpoly=function(r,t,e,n){var o,i,a,s;for(o=zero,i=a=s=r;s<=0?a<0:a>0;i=s<=0?++a:--a)push(stack[t+i]),stack[t+i]=o,push(e),divide(),o=pop(),push(stack[t+i-1]),push(o),push(n),multiply(),subtract(),stack[t+i-1]=pop();if(stack[t+0]=o,DEBUG)return console.log("yydivpoly Q: "+o.toString())},Evalpoly=function(r,t,e){var n,o,i;for(push(zero),n=o=i=r;i<=0?o<=0:o>=0;n=i<=0?++o:--o)push(e),multiply(),push(stack[t+n]),add();return pop()},factors=function(r){var t;if(t=tos,car(r)===symbol(ADD))for(r=cdr(r);iscons(r);)push_term_factors(car(r)),r=cdr(r);else push_term_factors(r);return tos-t},push_term_factors=function(r){var t;if(car(r)!==symbol(MULTIPLY))return push(r);for(r=cdr(r),t=[];iscons(r);)push(car(r)),t.push(r=cdr(r));return t},Eval_filter=function(){var r;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),filter(),r.push(p1=cdr(p1));return r},filter=function(){return save(),p2=pop(),p1=pop(),filter_main(),restore()},filter_main=function(){return car(p1)===symbol(ADD)?filter_sum():istensor(p1)?filter_tensor():Find(p1,p2)?push_integer(0):push(p1)},filter_sum=function(){var r;for(push_integer(0),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),push(p2),filter(),add(),r.push(p1=cdr(p1));return r},filter_tensor=function(){var r,t,e,n,o,i;for(r=0,e=0,e=p1.tensor.nelem,(p3=alloc_tensor(e)).tensor.ndim=p1.tensor.ndim,r=n=0,o=p1.tensor.ndim;0<=o?n<o:n>o;r=0<=o?++n:--n)p3.tensor.dim[r]=p1.tensor.dim[r];for(r=t=0,i=e;0<=i?t<i:t>i;r=0<=i?++t:--t)push(p1.tensor.elem[r]),push(p2),filter(),p3.tensor.elem[r]=pop();return push(p3)},Eval_float=function(){return evaluatingAsFloats++,push(cadr(p1)),Eval(),yyfloat(),Eval(),evaluatingAsFloats--},checkFloatHasWorkedOutCompletely=function(r){var t,e,n,o,i;if(o=countOccurrencesOfSymbol(symbol(POWER),r),n=countOccurrencesOfSymbol(symbol(PI),r),t=countOccurrencesOfSymbol(symbol(E),r),e=countOccurrencesOfSymbol(symbol(MULTIPLY),r),i=countOccurrencesOfSymbol(symbol(ADD),r),DEBUG&&(console.log("     ... numberOfPowers: "+o),console.log("     ... numberOfPIs: "+n),console.log("     ... numberOfEs: "+t),console.log("     ... numberOfMults: "+e),console.log("     ... numberOfSums: "+i)),o>1||n>0||t>0||e>1||i>1)return stop("float: some unevalued parts in "+r)},zzfloat=function(){return save(),evaluatingAsFloats++,Eval(),yyfloat(),Eval(),evaluatingAsFloats--,restore()},yyfloat=function(){var r,t,e,n;if(t=0,r=0,evaluatingAsFloats++,save(),iscons(p1=pop())){for(r=tos;iscons(p1);)push(car(p1)),yyfloat(),p1=cdr(p1);list(tos-r)}else if(p1.k===TENSOR){for(push(p1),copy_tensor(),p1=pop(),t=e=0,n=p1.tensor.nelem;0<=n?e<n:e>n;t=0<=n?++e:--e)push(p1.tensor.elem[t]),yyfloat(),p1.tensor.elem[t]=pop();push(p1)}else p1.k===NUM?(push(p1),bignum_float()):p1===symbol(PI)?push_double(Math.PI):p1===symbol(E)?push_double(Math.E):push(p1);return restore(),evaluatingAsFloats--},Eval_floor=function(){return push(cadr(p1)),Eval(),yfloor()},yfloor=function(){return save(),yyfloor(),restore()},yyfloor=function(){var r;if(r=0,!isNumericAtom(p1=pop())){push_symbol(FLOOR),push(p1),list(2);return}if(isdouble(p1)){r=Math.floor(p1.d),push_double(r);return}return isinteger(p1)?void push(p1):((p3=new U).k=NUM,p3.q.a=mdiv(p1.q.a,p1.q.b),p3.q.b=mint(1),push(p3),isnegativenumber(p1))?(push_integer(-1),add()):void 0},Eval_for=function(){var r,t,e,n,o,i,a;if(r=0,t=0,e=0,issymbol(n=caddr(p1))||stop("for: 2nd arg should be the variable to loop over"),push(cadddr(p1)),Eval(),isNaN(t=pop_integer())||(push(caddddr(p1)),Eval(),isNaN(e=pop_integer())))return void push(p1);for(p4=get_binding(n),r=o=i=t,a=e;i<=a?o<=a:o>=a;r=i<=a?++o:--o)push_integer(r),p5=pop(),set_binding(n,p5),push(cadr(p1)),Eval(),pop();return set_binding(n,p4),push_symbol(NIL)},Eval_gamma=function(){return push(cadr(p1)),Eval(),gamma()},gamma=function(){return save(),gammaf(),restore()},gammaf=function(){if(isrational(p1=pop())&&MEQUAL(p1.q.a,1)&&MEQUAL(p1.q.b,2)){evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(1,2),power();return}if(isrational(p1)&&MEQUAL(p1.q.a,3)&&MEQUAL(p1.q.b,2)){evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(1,2),power(),push_rational(1,2),multiply();return}if(isnegativeterm(p1)){evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_integer(-1),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push(p1),multiply(),sine(),push(p1),multiply(),push(p1),negate(),gamma(),multiply(),divide();return}car(p1)===symbol(ADD)?gamma_of_sum():(push_symbol(GAMMA),push(p1),list(2))},gamma_of_sum=function(){return isrational(car(p3=cdr(p1)))&&MEQUAL(car(p3).q.a,1)&&MEQUAL(car(p3).q.b,1)?(push(cadr(p3)),push(cadr(p3)),gamma(),multiply()):isrational(car(p3))&&MEQUAL(car(p3).q.a,-1)&&MEQUAL(car(p3).q.b,1)?(push(cadr(p3)),gamma(),push(cadr(p3)),push_integer(-1),add(),divide()):void(push_symbol(GAMMA),push(p1),list(2))},Eval_gcd=function(){var r;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),gcd(),r.push(p1=cdr(p1));return r},gcd=function(){var r;return r=expanding,save(),gcd_main(),restore(),expanding=r},gcd_main=function(){var r;if(expanding=1,p2=pop(),p1=pop(),DEBUG&&console.log("gcd_main: p1: "+p1+" p2: "+p2),equal(p1,p2))return void push(p1);if(isrational(p1)&&isrational(p2)){push(p1),push(p2),gcd_numbers();return}return(r=areunivarpolysfactoredorexpandedform(p1,p2))?void gcd_polys(r):car(p1)===symbol(ADD)&&car(p2)===symbol(ADD)?void gcd_sum_sum():(car(p1)===symbol(ADD)&&(gcd_sum(p1),p1=pop()),car(p2)===symbol(ADD)&&(gcd_sum(p2),p2=pop()),car(p1)===symbol(MULTIPLY))?void gcd_sum_product():car(p2)===symbol(MULTIPLY)?void gcd_product_sum():car(p1)===symbol(MULTIPLY)&&car(p2)===symbol(MULTIPLY)?void gcd_product_product():gcd_powers_with_same_base()},areunivarpolysfactoredorexpandedform=function(r,t){var e;return DEBUG&&console.log("areunivarpolysfactoredorexpandedform: p1: "+r+" p2: "+t),!!((e=isunivarpolyfactoredorexpandedform(r))&&isunivarpolyfactoredorexpandedform(t,e))&&e},gcd_polys=function(r){return(DEBUG&&console.log("gcd_polys: p1: "+p1+" polyVar: "+r),push(p1),push(r),factorpoly(),p1=pop(),push(p2),push(r),factorpoly(),p2=pop(),DEBUG&&console.log("GCD: factored polys:"),DEBUG&&console.log("  p1:"+p1.toString()),DEBUG&&console.log("  p2:"+p2.toString()),(car(p1)===symbol(MULTIPLY)||car(p2)===symbol(MULTIPLY))&&(car(p1)!==symbol(MULTIPLY)&&(push_symbol(MULTIPLY),push(p1),push(one),list(3),p1=pop()),car(p2)!==symbol(MULTIPLY)&&(push_symbol(MULTIPLY),push(p2),push(one),list(3),p2=pop())),car(p1)===symbol(MULTIPLY)&&car(p2)===symbol(MULTIPLY))?void gcd_product_product():(gcd_powers_with_same_base(),!0)},gcd_product_product=function(){var r;for(push(one),p3=cdr(p1),r=[];iscons(p3);){for(p4=cdr(p2);iscons(p4);)push(car(p3)),push(car(p4)),gcd(),multiply(),p4=cdr(p4);r.push(p3=cdr(p3))}return r},gcd_powers_with_same_base=function(){if(car(p1)===symbol(POWER)?(p3=caddr(p1),p1=cadr(p1)):p3=one,car(p2)===symbol(POWER)?(p4=caddr(p2),p2=cadr(p2)):p4=one,!equal(p1,p2))return void push(one);if(isNumericAtom(p3)&&isNumericAtom(p4)){push(p1),lessp(p3,p4)?push(p3):push(p4),power();return}if(push(p3),push(p4),divide(),isNumericAtom(p5=pop())){push(p1),p5=car(p3)===symbol(MULTIPLY)&&isNumericAtom(cadr(p3))?cadr(p3):one,p6=car(p4)===symbol(MULTIPLY)&&isNumericAtom(cadr(p4))?cadr(p4):one,lessp(p5,p6)?push(p3):push(p4),power();return}return(push(p3),push(p4),subtract(),isNumericAtom(p5=pop()))?(push(p1),isnegativenumber(p5)?push(p3):push(p4),power()):void push(one)},gcd_sum_sum=function(){if(length(p1)!==length(p2))return void push(one);for(p3=cdr(p1),push(car(p3)),p3=cdr(p3);iscons(p3);)push(car(p3)),gcd(),p3=cdr(p3);for(p3=pop(),p4=cdr(p2),push(car(p4)),p4=cdr(p4);iscons(p4);)push(car(p4)),gcd(),p4=cdr(p4);return(p4=pop(),push(p1),push(p3),divide(),p5=pop(),push(p2),push(p4),divide(),p6=pop(),equal(p5,p6))?(push(p5),push(p3),push(p4),gcd(),multiply()):push(one)},gcd_sum=function(r){var t;for(r=cdr(r),push(car(r)),r=cdr(r),t=[];iscons(r);)push(car(r)),gcd(),t.push(r=cdr(r));return t},gcd_sum_product=function(){var r;for(push(one),p3=cdr(p1),r=[];iscons(p3);)push(car(p3)),push(p2),gcd(),multiply(),r.push(p3=cdr(p3));return r},gcd_product_sum=function(){var r;for(push(one),p4=cdr(p2),r=[];iscons(p4);)push(p1),push(car(p4)),gcd(),multiply(),r.push(p4=cdr(p4));return r},guess=function(){var r;if(r=pop(),push(r),Find(r,symbol(SYMBOL_X)))return push_symbol(SYMBOL_X);if(Find(r,symbol(SYMBOL_Y)))return push_symbol(SYMBOL_Y);if(Find(r,symbol(SYMBOL_Z)))return push_symbol(SYMBOL_Z);if(Find(r,symbol(SYMBOL_T)))return push_symbol(SYMBOL_T);if(Find(r,symbol(SYMBOL_S)))return push_symbol(SYMBOL_S);else return push_symbol(SYMBOL_X)},hermite=function(){return save(),yyhermite(),restore()},yyhermite=function(){var r;if(r=0,p2=pop(),p1=pop(),push(p2),(r=pop_integer())<0||isNaN(r)){push_symbol(HERMITE),push(p1),push(p2),list(3);return}return issymbol(p1)?yyhermite2(r):(p3=p1,p1=symbol(SECRETX),yyhermite2(r),p1=p3,push(symbol(SECRETX)),push(p1),subst(),Eval())},yyhermite2=function(r){var t,e,n,o;for(t=0,push_integer(1),push_integer(0),p4=pop(),o=[],t=e=0,n=r;0<=n?e<n:e>n;t=0<=n?++e:--e)p5=p4,p4=pop(),push(p1),push(p4),multiply(),push_integer(t),push(p5),multiply(),subtract(),push_integer(2),o.push(multiply());return o},hilbert=function(){var r,t,e,n,o,i,a;if(r=0,e=0,n=0,save(),p2=pop(),push(p2),(n=pop_integer())<2){push_symbol(HILBERT),push(p2),list(2),restore();return}for(push_zero_matrix(n,n),p1=pop(),r=o=0,i=n;0<=i?o<i:o>i;r=0<=i?++o:--o)for(e=t=0,a=n;0<=a?t<a:t>a;e=0<=a?++t:--t)push_integer(r+e+1),inverse(),p1.tensor.elem[r*n+e]=pop();return push(p1),restore()},DEBUG_IMAG=!1,Eval_imag=function(){return push(cadr(p1)),Eval(),imag()},imag=function(){return save(),rect(),p1=pop(),DEBUG_IMAG&&console.log("IMAGE of "+p1),push(p1),push(p1),conjugate(),DEBUG_IMAG&&console.log(" image: conjugate result: "+stack[tos-1]),subtract(),push_integer(2),divide(),DEBUG_IMAG&&console.log(" image: 1st divide result: "+stack[tos-1]),push(imaginaryunit),divide(),DEBUG_IMAG&&console.log(" image: 2nd divide result: "+stack[tos-1]),restore()},index_function=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y;for(t=0,o=0,a=0,u=0,f=0,y=0,save(),u=(p1=stack[b=tos-r]).tensor.ndim,(a=r-1)>u&&stop("too many indices for tensor"),o=0,t=l=0,c=a;0<=c?l<c:l>c;t=0<=c?++l:--l)push(stack[b+t+1]),((y=pop_integer())<1||y>p1.tensor.dim[t])&&stop("index out of range"),o=o*p1.tensor.dim[t]+y-1;if(u===a){moveTos(tos-r),push(p1.tensor.elem[o]),restore();return}for(t=e=p=a,x=u;p<=x?e<x:e>x;t=p<=x?++e:--e)o=o*p1.tensor.dim[t]+0;for(f=1,t=n=g=a,h=u;g<=h?n<h:n>h;t=g<=h?++n:--n)f*=p1.tensor.dim[t];for((p2=alloc_tensor(f)).tensor.ndim=u-a,t=i=d=a,m=u;d<=m?i<m:i>m;t=d<=m?++i:--i)p2.tensor.dim[t-a]=p1.tensor.dim[t];for(t=s=0,v=f;0<=v?s<v:s>v;t=0<=v?++s:--s)p2.tensor.elem[t]=p1.tensor.elem[o+t];return check_tensor_dimensions(p1),check_tensor_dimensions(p2),moveTos(tos-r),push(p2),restore()},set_component=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b;for(t=0,o=0,a=0,f=0,b=0,save(),r<3&&stop("error in indexed assign"),p2=stack[v=tos-r],istensor(p1=stack[v+1])||stop("error in indexed assign: assigning to something that is not a tensor"),f=p1.tensor.ndim,(a=r-2)>f&&stop("error in indexed assign"),o=0,t=l=0,c=a;0<=c?l<c:l>c;t=0<=c?++l:--l)push(stack[v+t+2]),((b=pop_integer())<1||b>p1.tensor.dim[t])&&stop("error in indexed assign\n"),o=o*p1.tensor.dim[t]+b-1;for(t=e=p=a,x=f;p<=x?e<x:e>x;t=p<=x?++e:--e)o=o*p1.tensor.dim[t]+0;for((p3=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,t=n=0,g=p1.tensor.ndim;0<=g?n<g:n>g;t=0<=g?++n:--n)p3.tensor.dim[t]=p1.tensor.dim[t];for(t=i=0,h=p1.tensor.nelem;0<=h?i<h:i>h;t=0<=h?++i:--i)p3.tensor.elem[t]=p1.tensor.elem[t];if(check_tensor_dimensions(p1),check_tensor_dimensions(p3),p1=p3,f===a){istensor(p2)&&stop("error in indexed assign"),p1.tensor.elem[o]=p2,check_tensor_dimensions(p1),moveTos(tos-r),push(p1),restore();return}for(istensor(p2)||stop("error in indexed assign"),f-a!==p2.tensor.ndim&&stop("error in indexed assign"),t=s=0,d=p2.tensor.ndim;0<=d?s<d:s>d;t=0<=d?++s:--s)p1.tensor.dim[a+t]!==p2.tensor.dim[t]&&stop("error in indexed assign");for(t=u=0,m=p2.tensor.nelem;0<=m?u<m:u>m;t=0<=m?++u:--u)p1.tensor.elem[o+t]=p2.tensor.elem[t];return check_tensor_dimensions(p1),check_tensor_dimensions(p2),moveTos(tos-r),push(p1),restore()},Eval_inner=function(){var r,t,e,n,o,i,a,s,u,f,l,c,p,x,g,h;for((h=[]).push(car(cdr(p1))),car(cdr(cdr(p1)))===symbol(NIL)&&stop("pattern needs at least a template and a transformed version"),i=cdr(cdr(p1));i!==symbol(NIL);)h.push(car(i)),i=cdr(i);if(h.length>2){for(push_symbol(INNER),push(h[h.length-2]),push(h[h.length-1]),list(3),t=a=2,u=h.length;2<=u?a<u:a>u;t=2<=u?++a:--a)push_symbol(INNER),swap(),push(h[h.length-t-1]),swap(),list(3);p1=pop(),Eval_inner();return}for(get_innerprod_factors(p1,s=[]),p=[],t=e=0,f=s.length;0<=f?e<f:e>f;t=0<=f?++e:--e)if(s[t]===symbol(SYMBOL_IDENTITY_MATRIX))continue;else p.push(s[t]);if(s=p,p=[],s.length>1){for(g=0,t=n=0,l=s.length;(0<=l?n<l:n>l)&&t+g+1<=s.length-1&&(isNumericAtomOrTensor(s[t+g])||isNumericAtomOrTensor(s[t+g+1])?p.push(s[t+g]):(push(s[t+g]),Eval(),inv(),push(s[t+g+1]),Eval(),subtract(),r=pop(),isZeroAtomOrTensor(r)?g+=1:p.push(s[t+g])),t+g===s.length-2&&p.push(s[s.length-1]),!(t+g>=s.length-1));t=0<=l?++n:--n);s=p}if(push(symbol(INNER)),s.length>0)for(t=o=0,c=s.length;0<=c?o<c:o>c;t=0<=c?++o:--o)push(s[t]);else{pop(),push(symbol(SYMBOL_IDENTITY_MATRIX));return}for(list(s.length+1),p1=cdr(p1=pop()),push(car(p1)),Eval(),p1=cdr(p1),x=[];iscons(p1);)push(car(p1)),Eval(),inner(),x.push(p1=cdr(p1));return x},inner=function(){var r,t,e,n;if(save(),p2=pop(),p1=pop(),isnegativeterm(p2)&&isnegativeterm(p1)&&(push(p2),negate(),p2=pop(),push(p1),negate(),p1=pop()),isinnerordot(p1)&&(r=car(cdr(p1)),t=car(cdr(cdr(p1))),e=p2,p1=r,push(t),push(e),inner(),p2=pop()),p1===symbol(SYMBOL_IDENTITY_MATRIX)){push(p2),restore();return}if(p2===symbol(SYMBOL_IDENTITY_MATRIX)){push(p1),restore();return}if(istensor(p1)&&istensor(p2))inner_f();else{if(!(isNumericAtomOrTensor(p1)||isNumericAtomOrTensor(p2))&&(push(p1),push(p2),inv(),subtract(),n=pop(),isZeroAtomOrTensor(n))){push_symbol(SYMBOL_IDENTITY_MATRIX),restore();return}if(expanding&&isadd(p1)){for(p1=cdr(p1),push(zero);iscons(p1);)push(car(p1)),push(p2),inner(),add(),p1=cdr(p1);restore();return}if(expanding&&isadd(p2)){for(p2=cdr(p2),push(zero);iscons(p2);)push(p1),push(car(p2)),inner(),add(),p2=cdr(p2);restore();return}if(push(p1),push(p2),istensor(p1)&&isNumericAtom(p2))tensor_times_scalar();else if(isNumericAtom(p1)&&istensor(p2))scalar_times_tensor();else if(isNumericAtom(p1)||isNumericAtom(p2))multiply();else{pop(),pop(),push_symbol(INNER),push(p1),push(p2),list(3),restore();return}}return restore()},inner_f=function(){var r,t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k,w;for(i=0,(p=p1.tensor.dim[p1.tensor.ndim-1])!==p2.tensor.dim[0]&&stop("inner: tensor dimension check"),(g=p1.tensor.ndim+p2.tensor.ndim-2)>MAXDIM&&stop("inner: rank of result exceeds maximum"),r=p1.tensor.elem,e=p2.tensor.elem,t=1,i=h=0,m=p1.tensor.ndim-1;0<=m?h<m:h>m;i=0<=m?++h:--h)t*=p1.tensor.dim[i];for(n=1,i=a=1,v=p2.tensor.ndim;1<=v?a<v:a>v;i=1<=v?++a:--a)n*=p2.tensor.dim[i];for(o=(p3=alloc_tensor(t*n)).tensor.elem,i=u=0,b=t;0<=b?u<b:u>b;i=0<=b?++u:--u)for(s=l=0,y=p;0<=y?l<y:l>y;s=0<=y?++l:--l)if(!isZeroAtomOrTensor(r[i*p+s]))for(f=c=0,q=n;0<=q?c<q:c>q;f=0<=q?++c:--c)push(r[i*p+s]),push(e[s*n+f]),multiply(),push(o[i*n+f]),add(),o[i*n+f]=pop();if(0===g)return push(p3.tensor.elem[0]);for(p3.tensor.ndim=g,s=0,i=x=0,k=p1.tensor.ndim-1;0<=k?x<k:x>k;i=0<=k?++x:--x)p3.tensor.dim[i]=p1.tensor.dim[i];for(s=p1.tensor.ndim-1,i=d=0,w=p2.tensor.ndim-1;0<=w?d<w:d>w;i=0<=w?++d:--d)p3.tensor.dim[s+i]=p2.tensor.dim[i+1];return push(p3)},get_innerprod_factors=function(r,t){if(!iscons(r))return void add_factor_to_accumulator(r,t);if(cdr(r)===symbol(NIL)){r=get_innerprod_factors(car(r),t);return}if(isinnerordot(r)){get_innerprod_factors(car(cdr(r)),t),get_innerprod_factors(cdr(cdr(r)),t);return}return add_factor_to_accumulator(r,t)},add_factor_to_accumulator=function(r,t){if(r!==symbol(NIL))return t.push(r)},itab=["f(a,a*x)","f(1/x,log(x))","f(x^a,x^(a+1)/(a+1))","f(x^(-2),-x^(-1))","f(x^(-1/2),2*x^(1/2))","f(x^(1/2),2/3*x^(3/2))","f(x,x^2/2)","f(x^2,x^3/3)","f(exp(a*x),1/a*exp(a*x))","f(exp(a*x+b),1/a*exp(a*x+b))","f(x*exp(a*x^2),exp(a*x^2)/(2*a))","f(x*exp(a*x^2+b),exp(a*x^2+b)/(2*a))","f(log(a*x),x*log(a*x)-x)","f(a^x,a^x/log(a),or(not(number(a)),a>0))","f(1/(a+x^2),1/sqrt(a)*arctan(x/sqrt(a)),or(not(number(a)),a>0))","f(1/(a-x^2),1/sqrt(a)*arctanh(x/sqrt(a)))","f(1/sqrt(a-x^2),arcsin(x/(sqrt(a))))","f(1/sqrt(a+x^2),log(x+sqrt(a+x^2)))","f(1/(a+b*x),1/b*log(a+b*x))","f(1/(a+b*x)^2,-1/(b*(a+b*x)))","f(1/(a+b*x)^3,-1/(2*b)*1/(a+b*x)^2)","f(x/(a+b*x),x/b-a*log(a+b*x)/b/b)","f(x/(a+b*x)^2,1/b^2*(log(a+b*x)+a/(a+b*x)))","f(x^2/(a+b*x),1/b^2*(1/2*(a+b*x)^2-2*a*(a+b*x)+a^2*log(a+b*x)))","f(x^2/(a+b*x)^2,1/b^3*(a+b*x-2*a*log(a+b*x)-a^2/(a+b*x)))","f(x^2/(a+b*x)^3,1/b^3*(log(a+b*x)+2*a/(a+b*x)-1/2*a^2/(a+b*x)^2))","f(1/x*1/(a+b*x),-1/a*log((a+b*x)/x))","f(1/x*1/(a+b*x)^2,1/a*1/(a+b*x)-1/a^2*log((a+b*x)/x))","f(1/x*1/(a+b*x)^3,1/a^3*(1/2*((2*a+b*x)/(a+b*x))^2+log(x/(a+b*x))))","f(1/x^2*1/(a+b*x),-1/(a*x)+b/a^2*log((a+b*x)/x))","f(1/x^3*1/(a+b*x),(2*b*x-a)/(2*a^2*x^2)+b^2/a^3*log(x/(a+b*x)))","f(1/x^2*1/(a+b*x)^2,-(a+2*b*x)/(a^2*x*(a+b*x))+2*b/a^3*log((a+b*x)/x))","f(1/(a+b*x^2),1/sqrt(a*b)*arctan(x*sqrt(a*b)/a),or(not(number(a*b)),a*b>0))","f(1/(a+b*x^2),1/(2*sqrt(-a*b))*log((a+x*sqrt(-a*b))/(a-x*sqrt(-a*b))),or(not(number(a*b)),a*b<0))","f(x/(a+b*x^2),1/2*1/b*log(a+b*x^2))","f(x^2/(a+b*x^2),x/b-a/b*integral(1/(a+b*x^2),x))","f(1/(a+b*x^2)^2,x/(2*a*(a+b*x^2))+1/2*1/a*integral(1/(a+b*x^2),x))","f(1/x*1/(a+b*x^2),1/2*1/a*log(x^2/(a+b*x^2)))","f(1/x^2*1/(a+b*x^2),-1/(a*x)-b/a*integral(1/(a+b*x^2),x))","f(1/(a+b*x^3),1/3*1/a*(a/b)^(1/3)*(1/2*log(((a/b)^(1/3)+x)^3/(a+b*x^3))+sqrt(3)*arctan((2*x-(a/b)^(1/3))*(a/b)^(-1/3)/sqrt(3))))","f(x^2/(a+b*x^3),1/3*1/b*log(a+b*x^3))","f(x/(a+b*x^4),1/2*sqrt(b/a)/b*arctan(x^2*sqrt(b/a)),or(not(number(a*b)),a*b>0))","f(x/(a+b*x^4),1/4*sqrt(-b/a)/b*log((x^2-sqrt(-a/b))/(x^2+sqrt(-a/b))),or(not(number(a*b)),a*b<0))","f(x^3/(a+b*x^4),1/4*1/b*log(a+b*x^4))","f(sqrt(a+b*x),2/3*1/b*sqrt((a+b*x)^3))","f(x*sqrt(a+b*x),-2*(2*a-3*b*x)*sqrt((a+b*x)^3)/15/b^2)","f(x^2*sqrt(a+b*x),2*(8*a^2-12*a*b*x+15*b^2*x^2)*sqrt((a+b*x)^3)/105/b^3)","f(sqrt(a+b*x)/x,2*sqrt(a+b*x)+a*integral(1/x*1/sqrt(a+b*x),x))","f(sqrt(a+b*x)/x^2,-sqrt(a+b*x)/x+b/2*integral(1/x*1/sqrt(a+b*x),x))","f(1/sqrt(a+b*x),2*sqrt(a+b*x)/b)","f(x/sqrt(a+b*x),-2/3*(2*a-b*x)*sqrt(a+b*x)/b^2)","f(x^2/sqrt(a+b*x),2/15*(8*a^2-4*a*b*x+3*b^2*x^2)*sqrt(a+b*x)/b^3)","f(1/x*1/sqrt(a+b*x),1/sqrt(a)*log((sqrt(a+b*x)-sqrt(a))/(sqrt(a+b*x)+sqrt(a))),or(not(number(a)),a>0))","f(1/x*1/sqrt(a+b*x),2/sqrt(-a)*arctan(sqrt(-(a+b*x)/a)),or(not(number(a)),a<0))","f(1/x^2*1/sqrt(a+b*x),-sqrt(a+b*x)/a/x-1/2*b/a*integral(1/x*1/sqrt(a+b*x),x))","f(sqrt(x^2+a),1/2*(x*sqrt(x^2+a)+a*log(x+sqrt(x^2+a))))","f(1/sqrt(x^2+a),log(x+sqrt(x^2+a)))","f(1/x*1/sqrt(x^2+a),arcsec(x/sqrt(-a))/sqrt(-a),or(not(number(a)),a<0))","f(1/x*1/sqrt(x^2+a),-1/sqrt(a)*log((sqrt(a)+sqrt(x^2+a))/x),or(not(number(a)),a>0))","f(sqrt(x^2+a)/x,sqrt(x^2+a)-sqrt(a)*log((sqrt(a)+sqrt(x^2+a))/x),or(not(number(a)),a>0))","f(sqrt(x^2+a)/x,sqrt(x^2+a)-sqrt(-a)*arcsec(x/sqrt(-a)),or(not(number(a)),a<0))","f(x/sqrt(x^2+a),sqrt(x^2+a))","f(x*sqrt(x^2+a),1/3*sqrt((x^2+a)^3))","f(sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/4*(x*sqrt((x^2+a^(1/3))^3)+3/2*a^(1/3)*x*sqrt(x^2+a^(1/3))+3/2*a^(2/3)*log(x+sqrt(x^2+a^(1/3)))))","f(sqrt(-a+x^6-3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/4*(x*sqrt((x^2-a^(1/3))^3)-3/2*a^(1/3)*x*sqrt(x^2-a^(1/3))+3/2*a^(2/3)*log(x+sqrt(x^2-a^(1/3)))))","f(1/sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),x/a^(1/3)/sqrt(x^2+a^(1/3)))","f(x/sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),-1/sqrt(x^2+a^(1/3)))","f(x*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/5*sqrt((x^2+a^(1/3))^5))","f(x^2*sqrt(x^2+a),1/4*x*sqrt((x^2+a)^3)-1/8*a*x*sqrt(x^2+a)-1/8*a^2*log(x+sqrt(x^2+a)))","f(x^3*sqrt(x^2+a),(1/5*x^2-2/15*a)*sqrt((x^2+a)^3),and(number(a),a>0))","f(x^3*sqrt(x^2+a),sqrt((x^2+a)^5)/5-a*sqrt((x^2+a)^3)/3,and(number(a),a<0))","f(x^2/sqrt(x^2+a),1/2*x*sqrt(x^2+a)-1/2*a*log(x+sqrt(x^2+a)))","f(x^3/sqrt(x^2+a),1/3*sqrt((x^2+a)^3)-a*sqrt(x^2+a))","f(1/x^2*1/sqrt(x^2+a),-sqrt(x^2+a)/a/x)","f(1/x^3*1/sqrt(x^2+a),-1/2*sqrt(x^2+a)/a/x^2+1/2*log((sqrt(a)+sqrt(x^2+a))/x)/a^(3/2),or(not(number(a)),a>0))","f(1/x^3*1/sqrt(x^2-a),1/2*sqrt(x^2-a)/a/x^2+1/2*1/(a^(3/2))*arcsec(x/(a^(1/2))),or(not(number(a)),a>0))","f(x^2*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/6*x*sqrt((x^2+a^(1/3))^5)-1/24*a^(1/3)*x*sqrt((x^2+a^(1/3))^3)-1/16*a^(2/3)*x*sqrt(x^2+a^(1/3))-1/16*a*log(x+sqrt(x^2+a^(1/3))),or(not(number(a)),a>0))","f(x^2*sqrt(-a-3*a^(1/3)*x^4+3*a^(2/3)*x^2+x^6),1/6*x*sqrt((x^2-a^(1/3))^5)+1/24*a^(1/3)*x*sqrt((x^2-a^(1/3))^3)-1/16*a^(2/3)*x*sqrt(x^2-a^(1/3))+1/16*a*log(x+sqrt(x^2-a^(1/3))),or(not(number(a)),a>0))","f(x^3*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/7*sqrt((x^2+a^(1/3))^7)-1/5*a^(1/3)*sqrt((x^2+a^(1/3))^5),or(not(number(a)),a>0))","f(x^3*sqrt(-a-3*a^(1/3)*x^4+3*a^(2/3)*x^2+x^6),1/7*sqrt((x^2-a^(1/3))^7)+1/5*a^(1/3)*sqrt((x^2-a^(1/3))^5),or(not(number(a)),a>0))","f(1/(x-a)/sqrt(x^2-a^2),-sqrt(x^2-a^2)/a/(x-a))","f(1/(x+a)/sqrt(x^2-a^2),sqrt(x^2-a^2)/a/(x+a))","f(sqrt(a-x^2),1/2*(x*sqrt(a-x^2)+a*arcsin(x/sqrt(abs(a)))))","f(1/x*1/sqrt(a-x^2),-1/sqrt(a)*log((sqrt(a)+sqrt(a-x^2))/x),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x,sqrt(a-x^2)-sqrt(a)*log((sqrt(a)+sqrt(a-x^2))/x),or(not(number(a)),a>0))","f(x/sqrt(a-x^2),-sqrt(a-x^2))","f(x*sqrt(a-x^2),-1/3*sqrt((a-x^2)^3))","f(x^2*sqrt(a-x^2),-x/4*sqrt((a-x^2)^3)+1/8*a*(x*sqrt(a-x^2)+a*arcsin(x/sqrt(a))),or(not(number(a)),a>0))","f(x^3*sqrt(a-x^2),(-1/5*x^2-2/15*a)*sqrt((a-x^2)^3),or(not(number(a)),a>0))","f(x^2/sqrt(a-x^2),-x/2*sqrt(a-x^2)+a/2*arcsin(x/sqrt(a)),or(not(number(a)),a>0))","f(1/x^2*1/sqrt(a-x^2),-sqrt(a-x^2)/a/x,or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^2,-sqrt(a-x^2)/x-arcsin(x/sqrt(a)),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^3,-1/2*sqrt(a-x^2)/x^2+1/2*log((sqrt(a)+sqrt(a-x^2))/x)/sqrt(a),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^4,-1/3*sqrt((a-x^2)^3)/a/x^3,or(not(number(a)),a>0))","f(sqrt(a*x^2+b),x*sqrt(a*x^2+b)/2+b*log(x*sqrt(a)+sqrt(a*x^2+b))/2/sqrt(a),and(number(a),a>0))","f(sqrt(a*x^2+b),x*sqrt(a*x^2+b)/2+b*arcsin(x*sqrt(-a/b))/2/sqrt(-a),and(number(a),a<0))","f(sin(a*x),-cos(a*x)/a)","f(cos(a*x),sin(a*x)/a)","f(tan(a*x),-log(cos(a*x))/a)","f(1/tan(a*x),log(sin(a*x))/a)","f(1/cos(a*x),log(tan(pi/4+a*x/2))/a)","f(1/sin(a*x),log(tan(a*x/2))/a)","f(sin(a*x)^2,x/2-sin(2*a*x)/(4*a))","f(sin(a*x)^3,-cos(a*x)*(sin(a*x)^2+2)/(3*a))","f(sin(a*x)^4,3/8*x-sin(2*a*x)/(4*a)+sin(4*a*x)/(32*a))","f(cos(a*x)^2,x/2+sin(2*a*x)/(4*a))","f(cos(a*x)^3,sin(a*x)*(cos(a*x)^2+2)/(3*a))","f(cos(a*x)^4,3/8*x+sin(2*a*x)/(4*a)+sin(4*a*x)/(32*a))","f(1/sin(a*x)^2,-1/(a*tan(a*x)))","f(1/cos(a*x)^2,tan(a*x)/a)","f(sin(a*x)*cos(a*x),sin(a*x)^2/(2*a))","f(sin(a*x)^2*cos(a*x)^2,-sin(4*a*x)/(32*a)+x/8)","f(sin(a*x)/cos(a*x)^2,1/(a*cos(a*x)))","f(sin(a*x)^2/cos(a*x),(log(tan(pi/4+a*x/2))-sin(a*x))/a)","f(cos(a*x)/sin(a*x)^2,-1/(a*sin(a*x)))","f(1/(sin(a*x)*cos(a*x)),log(tan(a*x))/a)","f(1/(sin(a*x)*cos(a*x)^2),(1/cos(a*x)+log(tan(a*x/2)))/a)","f(1/(sin(a*x)^2*cos(a*x)),(log(tan(pi/4+a*x/2))-1/sin(a*x))/a)","f(1/(sin(a*x)^2*cos(a*x)^2),-2/(a*tan(2*a*x)))","f(sin(a+b*x),-cos(a+b*x)/b)","f(cos(a+b*x),sin(a+b*x)/b)","f(1/(b+b*sin(a*x)),-tan(pi/4-a*x/2)/a/b)","f(1/(b-b*sin(a*x)),tan(pi/4+a*x/2)/a/b)","f(1/(b+b*cos(a*x)),tan(a*x/2)/a/b)","f(1/(b-b*cos(a*x)),-1/tan(a*x/2)/a/b)","f(1/(a+b*sin(x)),1/sqrt(b^2-a^2)*log((a*tan(x/2)+b-sqrt(b^2-a^2))/(a*tan(x/2)+b+sqrt(b^2-a^2))),b^2-a^2)","f(1/(a+b*cos(x)),1/sqrt(b^2-a^2)*log((sqrt(b^2-a^2)*tan(x/2)+a+b)/(sqrt(b^2-a^2)*tan(x/2)-a-b)),b^2-a^2)","f(x*sin(a*x),sin(a*x)/a^2-x*cos(a*x)/a)","f(x^2*sin(a*x),2*x*sin(a*x)/a^2-(a^2*x^2-2)*cos(a*x)/a^3)","f(x*cos(a*x),cos(a*x)/a^2+x*sin(a*x)/a)","f(x^2*cos(a*x),2*x*cos(a*x)/a^2+(a^2*x^2-2)*sin(a*x)/a^3)","f(arcsin(a*x),x*arcsin(a*x)+sqrt(1-a^2*x^2)/a)","f(arccos(a*x),x*arccos(a*x)-sqrt(1-a^2*x^2)/a)","f(arctan(a*x),x*arctan(a*x)-1/2*log(1+a^2*x^2)/a)","f(x*log(a*x),x^2*log(a*x)/2-x^2/4)","f(x^2*log(a*x),x^3*log(a*x)/3-1/9*x^3)","f(log(x)^2,x*log(x)^2-2*x*log(x)+2*x)","f(1/x*1/(a+log(x)),log(a+log(x)))","f(log(a*x+b),(a*x+b)*log(a*x+b)/a-x)","f(log(a*x+b)/x^2,a/b*log(x)-(a*x+b)*log(a*x+b)/b/x)","f(sinh(x),cosh(x))","f(cosh(x),sinh(x))","f(tanh(x),log(cosh(x)))","f(x*sinh(x),x*cosh(x)-sinh(x))","f(x*cosh(x),x*sinh(x)-cosh(x))","f(sinh(x)^2,sinh(2*x)/4-x/2)","f(tanh(x)^2,x-tanh(x))","f(cosh(x)^2,sinh(2*x)/4+x/2)","f(x^3*exp(a*x^2),exp(a*x^2)*(x^2/a-1/(a^2))/2)","f(x^3*exp(a*x^2+b),exp(a*x^2)*exp(b)*(x^2/a-1/(a^2))/2)","f(exp(a*x^2),-i*sqrt(pi)*erf(i*sqrt(a)*x)/sqrt(a)/2)","f(erf(a*x),x*erf(a*x)+exp(-a^2*x^2)/a/sqrt(pi))","f(x^2*(1-x^2)^(3/2),(x*sqrt(1-x^2)*(-8*x^4+14*x^2-3)+3*arcsin(x))/48)","f(x^2*(1-x^2)^(5/2),(x*sqrt(1-x^2)*(48*x^6-136*x^4+118*x^2-15)+15*arcsin(x))/384)","f(x^4*(1-x^2)^(3/2),(-x*sqrt(1-x^2)*(16*x^6-24*x^4+2*x^2+3)+3*arcsin(x))/128)","f(x*exp(a*x),exp(a*x)*(a*x-1)/(a^2))","f(x*exp(a*x+b),exp(a*x+b)*(a*x-1)/(a^2))","f(x^2*exp(a*x),exp(a*x)*(a^2*x^2-2*a*x+2)/(a^3))","f(x^2*exp(a*x+b),exp(a*x+b)*(a^2*x^2-2*a*x+2)/(a^3))","f(x^3*exp(a*x),exp(a*x)*x^3/a-3/a*integral(x^2*exp(a*x),x))","f(x^3*exp(a*x+b),exp(a*x+b)*x^3/a-3/a*integral(x^2*exp(a*x+b),x))",0],Eval_integral=function(){var r,t,e,n,o,i,a;for(t=0,n=0,p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),(p2=pop())===symbol(NIL)?(guess(),push(symbol(NIL))):isNumericAtom(p2)?(guess(),push(p2)):(push(p2),p1=cdr(p1),push(car(p1)),Eval()),p5=pop(),p4=pop(),p3=pop();;){if(isNumericAtom(p5)?(push(p5),isNaN(n=pop_integer())&&stop("nth integral: check n")):n=1,push(p3),n>=0)for(t=o=0,i=n;0<=i?o<i:o>i;t=0<=i?++o:--o)push(p4),integral();else for(n=-n,t=e=0,a=n;0<=a?e<a:e>a;t=0<=a?++e:--e)push(p4),derivative();if(p3=pop(),p5===symbol(NIL))break;if(isNumericAtom(p5)){if(p1=cdr(p1),push(car(p1)),Eval(),(p5=pop())===symbol(NIL))break;isNumericAtom(p5)?r=1:(p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop())}else p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop()}return push(p3)},integral=function(){return save(),p2=pop(),car(p1=pop())===symbol(ADD)?integral_of_sum():car(p1)===symbol(MULTIPLY)?integral_of_product():integral_of_form(),p1=pop(),Find(p1,symbol(INTEGRAL))&&stop("integral: sorry, could not find a solution"),push(p1),simplify(),Eval(),restore()},integral_of_sum=function(){var r;for(p1=cdr(p1),push(car(p1)),push(p2),integral(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),push(p2),integral(),add(),r.push(p1=cdr(p1));return r},integral_of_product=function(){return push(p1),push(p2),partition(),p1=pop(),integral_of_form(),multiply()},integral_of_form=function(){var r;if(!(r=hashed_itab[italu_hashcode(p1,p2).toFixed(6)])){push_symbol(INTEGRAL),push(p1),push(p2),list(3);return}return(push(p1),push(p2),transform(r,!1),(p3=pop())===symbol(NIL))?(push_symbol(INTEGRAL),push(p1),push(p2),list(3)):push(p3)},hashcode_values={x:.95532,constexp:1.43762,constant:1.1441659362941434,constbase:1.2036412230421882,sin:1.7330548251830322,arcsin:1.6483368529465805,cos:1.0586721236863401,arccos:1.8405225918106694,tan:1.1224943776292506,arctan:1.1297397925394963,sinh:1.8176164926060079,cosh:1.9404934661708022,tanh:1.6421307715103122,log:1.477443701354924,erf:1.0825269225702916},italu_hashcode=function(r,t){var e;if(issymbol(r)){if(equal(r,t))return hashcode_values.x}else if(iscons(r))switch(symnum(car(r))){case ADD:return hash_addition(cdr(r),t);case MULTIPLY:return hash_multiplication(cdr(r),t);case POWER:return hash_power(cadr(r),caddr(r),t);case EXP:return hash_power(symbol(E),cadr(r),t);case SQRT:return push_double(.5),e=pop(),hash_power(cadr(r),e,t);default:return hash_function(r,t)}return hashcode_values.constant},hash_function=function(r,t){var e,n,o;if(!Find(cadr(r),t))return hashcode_values.constant;if(o=car(r),e=italu_hashcode(cadr(r),t),!(n=hashcode_values[o.printname]))throw Error("Unsupported function "+o.printname);return Math.pow(n,e)},hash_addition=function(r,t){var e,n,o,i,a,s;for(a={};iscons(r);)o=car(r),r=cdr(r),i=0,a[(i=Find(o,t)?italu_hashcode(o,t):hashcode_values.constant).toFixed(6)]=!0;for(e in n=0,a)hasProp.call(a,e)&&(s=a[e],n+=parseFloat(e,10));return n},hash_multiplication=function(r,t){var e,n;for(e=1;iscons(r);)n=car(r),r=cdr(r),Find(n,t)&&(e*=italu_hashcode(n,t));return e},hash_power=function(r,t,e){var n,o;if(n=hashcode_values.constant,o=hashcode_values.constexp,Find(r,e)&&(n=italu_hashcode(r,e)),Find(t,e))o=italu_hashcode(t,e);else{if(n===hashcode_values.constant)return hashcode_values.constant;isminusone(t)?o=-1:isoneovertwo(t)?o=.5:isminusoneovertwo(t)?o=-.5:equalq(t,2,1)?o=2:equalq(t,-2,1)&&(o=-2)}return Math.pow(n,o)},make_hashed_itab=function(){var r,t,e,n,o,i;for(e=0,o={},t=itab.length;e<t&&(n=itab[e]);e++)scan_meta(n),i=cadr(pop()),o[r=italu_hashcode(i,symbol(METAX)).toFixed(6)]||(o[r]=[]),o[r].push(n);return console.log("hashed_itab = "+JSON.stringify(o,null,2)),o},$.make_hashed_itab=make_hashed_itab,hashed_itab={"1.144166":["f(a,a*x)"],"1.046770":["f(1/x,log(x))"],"0.936400":["f(x^a,x^(a+1)/(a+1))"],"1.095727":["f(x^(-2),-x^(-1))"],"1.023118":["f(x^(-1/2),2*x^(1/2))"],"0.977405":["f(x^(1/2),2/3*x^(3/2))"],"0.955320":["f(x,x^2/2)"],"0.912636":["f(x^2,x^3/3)"],"1.137302":["f(exp(a*x),1/a*exp(a*x))","f(a^x,a^x/log(a),or(not(number(a)),a>0))"],"1.326774":["f(exp(a*x+b),1/a*exp(a*x+b))"],"1.080259":["f(x*exp(a*x^2),exp(a*x^2)/(2*a))"],"1.260228":["f(x*exp(a*x^2+b),exp(a*x^2+b)/(2*a))"],"1.451902":["f(log(a*x),x*log(a*x)-x)"],"0.486192":["f(1/(a+x^2),1/sqrt(a)*arctan(x/sqrt(a)),or(not(number(a)),a>0))","f(1/(a-x^2),1/sqrt(a)*arctanh(x/sqrt(a)))","f(1/(a+b*x^2),1/sqrt(a*b)*arctan(x*sqrt(a*b)/a),or(not(number(a*b)),a*b>0))","f(1/(a+b*x^2),1/(2*sqrt(-a*b))*log((a+x*sqrt(-a*b))/(a-x*sqrt(-a*b))),or(not(number(a*b)),a*b<0))"],"0.697274":["f(1/sqrt(a-x^2),arcsin(x/(sqrt(a))))","f(1/sqrt(a+x^2),log(x+sqrt(a+x^2)))","f(1/sqrt(x^2+a),log(x+sqrt(x^2+a)))"],"0.476307":["f(1/(a+b*x),1/b*log(a+b*x))"],"0.226868":["f(1/(a+b*x)^2,-1/(b*(a+b*x)))"],"2.904531":["f(1/(a+b*x)^3,-1/(2*b)*1/(a+b*x)^2)"],"0.455026":["f(x/(a+b*x),x/b-a*log(a+b*x)/b/b)"],"0.216732":["f(x/(a+b*x)^2,1/b^2*(log(a+b*x)+a/(a+b*x)))"],"0.434695":["f(x^2/(a+b*x),1/b^2*(1/2*(a+b*x)^2-2*a*(a+b*x)+a^2*log(a+b*x)))"],"0.207048":["f(x^2/(a+b*x)^2,1/b^3*(a+b*x-2*a*log(a+b*x)-a^2/(a+b*x)))"],"2.650781":["f(x^2/(a+b*x)^3,1/b^3*(log(a+b*x)+2*a/(a+b*x)-1/2*a^2/(a+b*x)^2))"],"0.498584":["f(1/x*1/(a+b*x),-1/a*log((a+b*x)/x))"],"0.237479":["f(1/x*1/(a+b*x)^2,1/a*1/(a+b*x)-1/a^2*log((a+b*x)/x))"],"3.040375":["f(1/x*1/(a+b*x)^3,1/a^3*(1/2*((2*a+b*x)/(a+b*x))^2+log(x/(a+b*x))))"],"0.521902":["f(1/x^2*1/(a+b*x),-1/(a*x)+b/a^2*log((a+b*x)/x))"],"0.446014":["f(1/x^3*1/(a+b*x),(2*b*x-a)/(2*a^2*x^2)+b^2/a^3*log(x/(a+b*x)))"],"0.248586":["f(1/x^2*1/(a+b*x)^2,-(a+2*b*x)/(a^2*x*(a+b*x))+2*b/a^3*log((a+b*x)/x))"],"0.464469":["f(x/(a+b*x^2),1/2*1/b*log(a+b*x^2))"],"0.443716":["f(x^2/(a+b*x^2),x/b-a/b*integral(1/(a+b*x^2),x))"],"0.236382":["f(1/(a+b*x^2)^2,x/(2*a*(a+b*x^2))+1/2*1/a*integral(1/(a+b*x^2),x))"],"0.508931":["f(1/x*1/(a+b*x^2),1/2*1/a*log(x^2/(a+b*x^2)))"],"0.532733":["f(1/x^2*1/(a+b*x^2),-1/(a*x)-b/a*integral(1/(a+b*x^2),x))"],"0.480638":["f(1/(a+b*x^3),1/3*1/a*(a/b)^(1/3)*(1/2*log(((a/b)^(1/3)+x)^3/(a+b*x^3))+sqrt(3)*arctan((2*x-(a/b)^(1/3))*(a/b)^(-1/3)/sqrt(3))))"],"0.438648":["f(x^2/(a+b*x^3),1/3*1/b*log(a+b*x^3))"],"0.459164":["f(x/(a+b*x^4),1/2*sqrt(b/a)/b*arctan(x^2*sqrt(b/a)),or(not(number(a*b)),a*b>0))","f(x/(a+b*x^4),1/4*sqrt(-b/a)/b*log((x^2-sqrt(-a/b))/(x^2+sqrt(-a/b))),or(not(number(a*b)),a*b<0))"],"0.450070":["f(x^3/(a+b*x^4),1/4*1/b*log(a+b*x^4))"],"1.448960":["f(sqrt(a+b*x),2/3*1/b*sqrt((a+b*x)^3))"],"1.384221":["f(x*sqrt(a+b*x),-2*(2*a-3*b*x)*sqrt((a+b*x)^3)/15/b^2)"],"1.322374":["f(x^2*sqrt(a+b*x),2*(8*a^2-12*a*b*x+15*b^2*x^2)*sqrt((a+b*x)^3)/105/b^3)"],"1.516728":["f(sqrt(a+b*x)/x,2*sqrt(a+b*x)+a*integral(1/x*1/sqrt(a+b*x),x))"],"1.587665":["f(sqrt(a+b*x)/x^2,-sqrt(a+b*x)/x+b/2*integral(1/x*1/sqrt(a+b*x),x))"],"0.690150":["f(1/sqrt(a+b*x),2*sqrt(a+b*x)/b)"],"0.659314":["f(x/sqrt(a+b*x),-2/3*(2*a-b*x)*sqrt(a+b*x)/b^2)"],"0.629856":["f(x^2/sqrt(a+b*x),2/15*(8*a^2-4*a*b*x+3*b^2*x^2)*sqrt(a+b*x)/b^3)"],"0.722428":["f(1/x*1/sqrt(a+b*x),1/sqrt(a)*log((sqrt(a+b*x)-sqrt(a))/(sqrt(a+b*x)+sqrt(a))),or(not(number(a)),a>0))","f(1/x*1/sqrt(a+b*x),2/sqrt(-a)*arctan(sqrt(-(a+b*x)/a)),or(not(number(a)),a<0))"],"0.756216":["f(1/x^2*1/sqrt(a+b*x),-sqrt(a+b*x)/a/x-1/2*b/a*integral(1/x*1/sqrt(a+b*x),x))"],"1.434156":["f(sqrt(x^2+a),1/2*(x*sqrt(x^2+a)+a*log(x+sqrt(x^2+a))))","f(sqrt(a-x^2),1/2*(x*sqrt(a-x^2)+a*arcsin(x/sqrt(abs(a)))))","f(sqrt(a*x^2+b),x*sqrt(a*x^2+b)/2+b*log(x*sqrt(a)+sqrt(a*x^2+b))/2/sqrt(a),and(number(a),a>0))","f(sqrt(a*x^2+b),x*sqrt(a*x^2+b)/2+b*arcsin(x*sqrt(-a/b))/2/sqrt(-a),and(number(a),a<0))"],"0.729886":["f(1/x*1/sqrt(x^2+a),arcsec(x/sqrt(-a))/sqrt(-a),or(not(number(a)),a<0))","f(1/x*1/sqrt(x^2+a),-1/sqrt(a)*log((sqrt(a)+sqrt(x^2+a))/x),or(not(number(a)),a>0))","f(1/x*1/sqrt(a-x^2),-1/sqrt(a)*log((sqrt(a)+sqrt(a-x^2))/x),or(not(number(a)),a>0))"],"1.501230":["f(sqrt(x^2+a)/x,sqrt(x^2+a)-sqrt(a)*log((sqrt(a)+sqrt(x^2+a))/x),or(not(number(a)),a>0))","f(sqrt(x^2+a)/x,sqrt(x^2+a)-sqrt(-a)*arcsec(x/sqrt(-a)),or(not(number(a)),a<0))","f(sqrt(a-x^2)/x,sqrt(a-x^2)-sqrt(a)*log((sqrt(a)+sqrt(a-x^2))/x),or(not(number(a)),a>0))"],"0.666120":["f(x/sqrt(x^2+a),sqrt(x^2+a))","f(x/sqrt(a-x^2),-sqrt(a-x^2))"],"1.370077":["f(x*sqrt(x^2+a),1/3*sqrt((x^2+a)^3))","f(x*sqrt(a-x^2),-1/3*sqrt((a-x^2)^3))"],"1.730087":["f(sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/4*(x*sqrt((x^2+a^(1/3))^3)+3/2*a^(1/3)*x*sqrt(x^2+a^(1/3))+3/2*a^(2/3)*log(x+sqrt(x^2+a^(1/3)))))","f(sqrt(-a+x^6-3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/4*(x*sqrt((x^2-a^(1/3))^3)-3/2*a^(1/3)*x*sqrt(x^2-a^(1/3))+3/2*a^(2/3)*log(x+sqrt(x^2-a^(1/3)))))"],"0.578006":["f(1/sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),x/a^(1/3)/sqrt(x^2+a^(1/3)))"],"0.552180":["f(x/sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),-1/sqrt(x^2+a^(1/3)))"],"1.652787":["f(x*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/5*sqrt((x^2+a^(1/3))^5))"],"1.308862":["f(x^2*sqrt(x^2+a),1/4*x*sqrt((x^2+a)^3)-1/8*a*x*sqrt(x^2+a)-1/8*a^2*log(x+sqrt(x^2+a)))","f(x^2*sqrt(a-x^2),-x/4*sqrt((a-x^2)^3)+1/8*a*(x*sqrt(a-x^2)+a*arcsin(x/sqrt(a))),or(not(number(a)),a>0))"],"1.342944":["f(x^3*sqrt(x^2+a),(1/5*x^2-2/15*a)*sqrt((x^2+a)^3),and(number(a),a>0))","f(x^3*sqrt(x^2+a),sqrt((x^2+a)^5)/5-a*sqrt((x^2+a)^3)/3,and(number(a),a<0))","f(x^3*sqrt(a-x^2),(-1/5*x^2-2/15*a)*sqrt((a-x^2)^3),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^3,-1/2*sqrt(a-x^2)/x^2+1/2*log((sqrt(a)+sqrt(a-x^2))/x)/sqrt(a),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^4,-1/3*sqrt((a-x^2)^3)/a/x^3,or(not(number(a)),a>0))"],"0.636358":["f(x^2/sqrt(x^2+a),1/2*x*sqrt(x^2+a)-1/2*a*log(x+sqrt(x^2+a)))","f(x^2/sqrt(a-x^2),-x/2*sqrt(a-x^2)+a/2*arcsin(x/sqrt(a)),or(not(number(a)),a>0))"],"0.652928":["f(x^3/sqrt(x^2+a),1/3*sqrt((x^2+a)^3)-a*sqrt(x^2+a))","f(1/x^3*1/sqrt(x^2+a),-1/2*sqrt(x^2+a)/a/x^2+1/2*log((sqrt(a)+sqrt(x^2+a))/x)/a^(3/2),or(not(number(a)),a>0))","f(1/x^3*1/sqrt(x^2-a),1/2*sqrt(x^2-a)/a/x^2+1/2*1/(a^(3/2))*arcsec(x/(a^(1/2))),or(not(number(a)),a>0))"],"0.764022":["f(1/x^2*1/sqrt(x^2+a),-sqrt(x^2+a)/a/x)","f(1/x^2*1/sqrt(a-x^2),-sqrt(a-x^2)/a/x,or(not(number(a)),a>0))"],"1.578940":["f(x^2*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/6*x*sqrt((x^2+a^(1/3))^5)-1/24*a^(1/3)*x*sqrt((x^2+a^(1/3))^3)-1/16*a^(2/3)*x*sqrt(x^2+a^(1/3))-1/16*a*log(x+sqrt(x^2+a^(1/3))),or(not(number(a)),a>0))","f(x^2*sqrt(-a-3*a^(1/3)*x^4+3*a^(2/3)*x^2+x^6),1/6*x*sqrt((x^2-a^(1/3))^5)+1/24*a^(1/3)*x*sqrt((x^2-a^(1/3))^3)-1/16*a^(2/3)*x*sqrt(x^2-a^(1/3))+1/16*a*log(x+sqrt(x^2-a^(1/3))),or(not(number(a)),a>0))"],"1.620055":["f(x^3*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/7*sqrt((x^2+a^(1/3))^7)-1/5*a^(1/3)*sqrt((x^2+a^(1/3))^5),or(not(number(a)),a>0))","f(x^3*sqrt(-a-3*a^(1/3)*x^4+3*a^(2/3)*x^2+x^6),1/7*sqrt((x^2-a^(1/3))^7)+1/5*a^(1/3)*sqrt((x^2-a^(1/3))^5),or(not(number(a)),a>0))"],"0.332117":["f(1/(x-a)/sqrt(x^2-a^2),-sqrt(x^2-a^2)/a/(x-a))","f(1/(x+a)/sqrt(x^2-a^2),sqrt(x^2-a^2)/a/(x+a))"],"1.571443":["f(sqrt(a-x^2)/x^2,-sqrt(a-x^2)/x-arcsin(x/sqrt(a)),or(not(number(a)),a>0))"],"1.690994":["f(sin(a*x),-cos(a*x)/a)"],"1.055979":["f(cos(a*x),sin(a*x)/a)"],"1.116714":["f(tan(a*x),-log(cos(a*x))/a)"],"0.895484":["f(1/tan(a*x),log(sin(a*x))/a)"],"0.946989":["f(1/cos(a*x),log(tan(pi/4+a*x/2))/a)"],"0.591368":["f(1/sin(a*x),log(tan(a*x/2))/a)"],"2.859462":["f(sin(a*x)^2,x/2-sin(2*a*x)/(4*a))"],"2.128050":["f(sin(a*x)^3,-cos(a*x)*(sin(a*x)^2+2)/(3*a))","f(sin(a*x)^4,3/8*x-sin(2*a*x)/(4*a)+sin(4*a*x)/(32*a))"],"1.115091":["f(cos(a*x)^2,x/2+sin(2*a*x)/(4*a))"],"1.081452":["f(cos(a*x)^3,sin(a*x)*(cos(a*x)^2+2)/(3*a))","f(cos(a*x)^4,3/8*x+sin(2*a*x)/(4*a)+sin(4*a*x)/(32*a))"],"0.349716":["f(1/sin(a*x)^2,-1/(a*tan(a*x)))"],"0.896788":["f(1/cos(a*x)^2,tan(a*x)/a)"],"1.785654":["f(sin(a*x)*cos(a*x),sin(a*x)^2/(2*a))"],"3.188560":["f(sin(a*x)^2*cos(a*x)^2,-sin(4*a*x)/(32*a)+x/8)"],"1.516463":["f(sin(a*x)/cos(a*x)^2,1/(a*cos(a*x)))"],"2.707879":["f(sin(a*x)^2/cos(a*x),(log(tan(pi/4+a*x/2))-sin(a*x))/a)"],"0.369293":["f(cos(a*x)/sin(a*x)^2,-1/(a*sin(a*x)))"],"0.560019":["f(1/(sin(a*x)*cos(a*x)),log(tan(a*x))/a)"],"0.530332":["f(1/(sin(a*x)*cos(a*x)^2),(1/cos(a*x)+log(tan(a*x/2)))/a)"],"0.331177":["f(1/(sin(a*x)^2*cos(a*x)),(log(tan(pi/4+a*x/2))-1/sin(a*x))/a)"],"0.313621":["f(1/(sin(a*x)^2*cos(a*x)^2),-2/(a*tan(2*a*x)))"],"3.172365":["f(sin(a+b*x),-cos(a+b*x)/b)"],"1.127162":["f(cos(a+b*x),sin(a+b*x)/b)"],"0.352714":["f(1/(b+b*sin(a*x)),-tan(pi/4-a*x/2)/a/b)","f(1/(b-b*sin(a*x)),tan(pi/4+a*x/2)/a/b)","f(1/(a+b*sin(x)),1/sqrt(b^2-a^2)*log((a*tan(x/2)+b-sqrt(b^2-a^2))/(a*tan(x/2)+b+sqrt(b^2-a^2))),b^2-a^2)"],"0.454515":["f(1/(b+b*cos(a*x)),tan(a*x/2)/a/b)","f(1/(b-b*cos(a*x)),-1/tan(a*x/2)/a/b)","f(1/(a+b*cos(x)),1/sqrt(b^2-a^2)*log((sqrt(b^2-a^2)*tan(x/2)+a+b)/(sqrt(b^2-a^2)*tan(x/2)-a-b)),b^2-a^2)"],"1.615441":["f(x*sin(a*x),sin(a*x)/a^2-x*cos(a*x)/a)"],"1.543263":["f(x^2*sin(a*x),2*x*sin(a*x)/a^2-(a^2*x^2-2)*cos(a*x)/a^3)"],"1.008798":["f(x*cos(a*x),cos(a*x)/a^2+x*sin(a*x)/a)"],"0.963724":["f(x^2*cos(a*x),2*x*cos(a*x)/a^2+(a^2*x^2-2)*sin(a*x)/a^3)"],"1.611938":["f(arcsin(a*x),x*arcsin(a*x)+sqrt(1-a^2*x^2)/a)"],"1.791033":["f(arccos(a*x),x*arccos(a*x)-sqrt(1-a^2*x^2)/a)"],"1.123599":["f(arctan(a*x),x*arctan(a*x)-1/2*log(1+a^2*x^2)/a)"],"1.387031":["f(x*log(a*x),x^2*log(a*x)/2-x^2/4)"],"1.325058":["f(x^2*log(a*x),x^3*log(a*x)/3-1/9*x^3)"],"2.108018":["f(log(x)^2,x*log(x)^2-2*x*log(x)+2*x)"],"0.403214":["f(1/x*1/(a+log(x)),log(a+log(x)))"],"2.269268":["f(log(a*x+b),(a*x+b)*log(a*x+b)/a-x)"],"2.486498":["f(log(a*x+b)/x^2,a/b*log(x)-(a*x+b)*log(a*x+b)/b/x)"],"1.769733":["f(sinh(x),cosh(x))"],"1.883858":["f(cosh(x),sinh(x))"],"1.606140":["f(tanh(x),log(cosh(x)))"],"1.690661":["f(x*sinh(x),x*cosh(x)-sinh(x))"],"1.799688":["f(x*cosh(x),x*sinh(x)-cosh(x))"],"3.131954":["f(sinh(x)^2,sinh(2*x)/4-x/2)"],"2.579685":["f(tanh(x)^2,x-tanh(x))"],"3.548923":["f(cosh(x)^2,sinh(2*x)/4+x/2)"],"1.058866":["f(x^3*exp(a*x^2),exp(a*x^2)*(x^2/a-1/(a^2))/2)"],"1.235270":["f(x^3*exp(a*x^2+b),exp(a*x^2)*exp(b)*(x^2/a-1/(a^2))/2)"],"1.130783":["f(exp(a*x^2),-i*sqrt(pi)*erf(i*sqrt(a)*x)/sqrt(a)/2)"],"1.078698":["f(erf(a*x),x*erf(a*x)+exp(-a^2*x^2)/a/sqrt(pi))"],"2.573650":["f(x^2*(1-x^2)^(3/2),(x*sqrt(1-x^2)*(-8*x^4+14*x^2-3)+3*arcsin(x))/48)","f(x^2*(1-x^2)^(5/2),(x*sqrt(1-x^2)*(48*x^6-136*x^4+118*x^2-15)+15*arcsin(x))/384)"],"2.640666":["f(x^4*(1-x^2)^(3/2),(-x*sqrt(1-x^2)*(16*x^6-24*x^4+2*x^2+3)+3*arcsin(x))/128)"],"1.086487":["f(x*exp(a*x),exp(a*x)*(a*x-1)/(a^2))"],"1.267493":["f(x*exp(a*x+b),exp(a*x+b)*(a*x-1)/(a^2))"],"1.037943":["f(x^2*exp(a*x),exp(a*x)*(a^2*x^2-2*a*x+2)/(a^3))"],"1.210862":["f(x^2*exp(a*x+b),exp(a*x+b)*(a^2*x^2-2*a*x+2)/(a^3))"],"1.064970":["f(x^3*exp(a*x),exp(a*x)*x^3/a-3/a*integral(x^2*exp(a*x),x))"],"1.242392":["f(x^3*exp(a*x+b),exp(a*x+b)*x^3/a-3/a*integral(x^2*exp(a*x+b),x))"]},INV_check_arg=function(){return istensor(p1)&&2===p1.tensor.ndim?1*(p1.tensor.dim[0]===p1.tensor.dim[1]):0},inv=function(){var r,t,e,n,o,i;if(e=0,n=0,save(),isinv(p1=pop())){push(car(cdr(p1))),restore();return}if(isidentitymatrix(p1)){push(p1),restore();return}if(expanding&&isinnerordot(p1)){for(p1=cdr(p1),r=[];iscons(p1);)r.push(car(p1)),p1=cdr(p1);for(t=o=i=r.length-1;i<=0?o<=0:o>=0;t=i<=0?++o:--o)push(r[t]),inv(),t!==r.length-1&&inner();restore();return}if(0===INV_check_arg()){push_symbol(INV),push(p1),list(2),restore();return}return isNumericAtomOrTensor(p1)?yyinvg():(push(p1),adj(),push(p1),det(),p2=pop(),isZeroAtomOrTensor(p2)&&stop("inverse of singular matrix"),push(p2),divide()),restore()},invg=function(){if(save(),p1=pop(),0===INV_check_arg()){push_symbol(INVG),push(p1),list(2),restore();return}return yyinvg(),restore()},yyinvg=function(){var r,t,e,n,o,i,a,s,u,f,l,c;for(r=0,t=0,n=0,a=0,a=p1.tensor.dim[0],r=tos,t=s=0,u=a;0<=u?s<u:s>u;t=0<=u?++s:--s)for(n=e=0,f=a;0<=f?e<f:e>f;n=0<=f?++e:--e)t===n?push(one):push(zero);for(t=o=0,l=a*a;0<=l?o<l:o>l;t=0<=l?++o:--o)push(p1.tensor.elem[t]);for(INV_decomp(a),(p1=alloc_tensor(a*a)).tensor.ndim=2,p1.tensor.dim[0]=a,p1.tensor.dim[1]=a,t=i=0,c=a*a;0<=c?i<c:i>c;t=0<=c?++i:--i)p1.tensor.elem[t]=stack[r+t];return moveTos(tos-2*a*a),push(p1)},INV_decomp=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g,h;for(t=0,e=0,n=0,i=0,h=0,h=(t=tos-r*r)-r*r,g=[],e=u=0,f=r;0<=f?u<f:u>f;e=0<=f?++u:--u){if(equal(stack[t+r*e+e],zero)){for(n=o=l=e+1,c=r;(l<=c?o<c:o>c)&&equal(stack[t+r*n+e],zero);n=l<=c?++o:--o);for(n===r&&stop("inverse of singular matrix"),i=a=0,p=r;0<=p?a<p:a>p;i=0<=p?++a:--a)p2=stack[t+r*e+i],stack[t+r*e+i]=stack[t+r*n+i],stack[t+r*n+i]=p2,p2=stack[h+r*e+i],stack[h+r*e+i]=stack[h+r*n+i],stack[h+r*n+i]=p2}for(p2=stack[t+r*e+e],i=s=0,x=r;0<=x?s<x:s>x;i=0<=x?++s:--s)i>e&&(push(stack[t+r*e+i]),push(p2),divide(),stack[t+r*e+i]=pop()),push(stack[h+r*e+i]),push(p2),divide(),stack[h+r*e+i]=pop();g.push(function(){var o,a,s;for(s=[],n=o=0,a=r;0<=a?o<a:o>a;n=0<=a?++o:--o)n!==e&&(p2=stack[t+r*n+e],s.push(function(){var o,a,s;for(s=[],i=o=0,a=r;0<=a?o<a:o>a;i=0<=a?++o:--o)i>e&&(push(stack[t+r*n+i]),push(stack[t+r*e+i]),push(p2),multiply(),subtract(),stack[t+r*n+i]=pop()),push(stack[h+r*n+i]),push(stack[h+r*e+i]),push(p2),multiply(),subtract(),s.push(stack[h+r*n+i]=pop());return s}()));return s}())}return g},DEBUG_IS=!1,isZeroAtom=function(r){switch(r.k){case NUM:return MZERO(r.q.a);case DOUBLE:return 0===r.d;default:return!1}},isZeroTensor=function(r){var t,e,n;if(r.k!==TENSOR)return 0;for(t=e=0,n=r.tensor.nelem;0<=n?e<n:e>n;t=0<=n?++e:--e)if(!isZeroAtomOrTensor(r.tensor.elem[t]))return 0;return 1},isZeroAtomOrTensor=function(r){return isZeroAtom(r)||isZeroTensor(r)},isZeroLikeOrNonZeroLikeOrUndetermined=function(r){var t;if(push(r),Eval_predicate(),t=pop(),isZeroAtomOrTensor(t))return 0;if(isNumericAtomOrTensor(t))return 1;if(push(t),zzfloat(),t=pop(),isZeroAtomOrTensor(t))return 0;if(isNumericAtomOrTensor(t))return 1;if(Find(t,imaginaryunit)){if(push(t),absValFloat(),Eval_predicate(),t=pop(),isZeroAtomOrTensor(t))return 0;if(isNumericAtomOrTensor(t))return 1}return null},isnegativenumber=function(r){switch(r.k){case NUM:if(-1===MSIGN(r.q.a))return 1;break;case DOUBLE:if(r.d<0)return 1}return 0},ispositivenumber=function(r){switch(r.k){case NUM:if(1===MSIGN(r.q.a))return 1;break;case DOUBLE:if(r.d>0)return 1}return 0},isplustwo=function(r){switch(r.k){case NUM:if(MEQUAL(r.q.a,2)&&MEQUAL(r.q.b,1))return 1;break;case DOUBLE:if(2===r.d)return 1}return 0},isplusone=function(r){switch(r.k){case NUM:if(MEQUAL(r.q.a,1)&&MEQUAL(r.q.b,1))return 1;break;case DOUBLE:if(1===r.d)return 1}return 0},isminusone=function(r){switch(r.k){case NUM:if(MEQUAL(r.q.a,-1)&&MEQUAL(r.q.b,1))return 1;break;case DOUBLE:if(-1===r.d)return 1}return 0},isone=function(r){return isplusone(r)||isminusone(r)},isinteger=function(r){return r.k===NUM&&MEQUAL(r.q.b,1)?1:0},isintegerorintegerfloat=function(r){return r.k===DOUBLE?+(r.d===Math.round(r.d)):isinteger(r)},isnonnegativeinteger=function(r){return isrational(r)&&MEQUAL(r.q.b,1)&&1===MSIGN(r.q.a)?1:0},isposint=function(r){return isinteger(r)&&1===MSIGN(r.q.a)?1:0},isunivarpolyfactoredorexpandedform=function(r,t){return(DEBUG&&console.log("isunivarpolyfactoredorexpandedform: p: "+r+" x: "+t),null==t&&(push(r),guess(),t=pop(),pop()),ispolyfactoredorexpandedform(r,t)&&Find(r,symbol(SYMBOL_X))+Find(r,symbol(SYMBOL_Y))+Find(r,symbol(SYMBOL_Z))===1)?t:0},ispolyfactoredorexpandedform=function(r,t){return ispolyfactoredorexpandedform_factor(r,t)},ispolyfactoredorexpandedform_factor=function(r,t){if(car(r)!==symbol(MULTIPLY))return ispolyfactoredorexpandedform_power(r,t);for(r=cdr(r);iscons(r);){if(DEBUG&&console.log("ispolyfactoredorexpandedform_factor testing "+car(r)),!ispolyfactoredorexpandedform_power(car(r),t))return DEBUG&&console.log("... tested negative:"+car(r)),0;r=cdr(r)}return 1},ispolyfactoredorexpandedform_power=function(r,t){return car(r)===symbol(POWER)?(DEBUG&&console.log("ispolyfactoredorexpandedform_power (isposint(caddr(p)) "+(isposint(caddr(r)),DEBUG?console.log("ispolyfactoredorexpandedform_power ispolyexpandedform_expr(cadr(p), x)) "+ispolyexpandedform_expr(cadr(r),t)):void 0)),isposint(caddr(r))&&ispolyexpandedform_expr(cadr(r),t)):(DEBUG&&console.log("ispolyfactoredorexpandedform_power not a power, testing if this is exp form: "+r),ispolyexpandedform_expr(r,t))},ispolyexpandedform=function(r,t){return Find(r,t)?ispolyexpandedform_expr(r,t):0},ispolyexpandedform_expr=function(r,t){if(car(r)!==symbol(ADD))return ispolyexpandedform_term(r,t);for(r=cdr(r);iscons(r);){if(!ispolyexpandedform_term(car(r),t))return 0;r=cdr(r)}return 1},ispolyexpandedform_term=function(r,t){if(car(r)!==symbol(MULTIPLY))return ispolyexpandedform_factor(r,t);for(r=cdr(r);iscons(r);){if(!ispolyexpandedform_factor(car(r),t))return 0;r=cdr(r)}return 1},ispolyexpandedform_factor=function(r,t){if(equal(r,t))return 1;if(car(r)===symbol(POWER)&&equal(cadr(r),t))if(isposint(caddr(r)))return 1;else return 0;return+!Find(r,t)},isnegativeterm=function(r){return isnegativenumber(r)||car(r)===symbol(MULTIPLY)&&isnegativenumber(cadr(r))?1:0},hasNegativeRationalExponent=function(r){return car(r)===symbol(POWER)&&isrational(car(cdr(cdr(r))))&&isnegativenumber(car(cdr(r)))?(DEBUG_IS&&console.log("hasNegativeRationalExponent: "+r.toString()+" has imaginary component"),1):(DEBUG_IS&&console.log("hasNegativeRationalExponent: "+r.toString()+" has NO imaginary component"),0)},isimaginarynumberdouble=function(r){return car(r)===symbol(MULTIPLY)&&3===length(r)&&isdouble(cadr(r))&&hasNegativeRationalExponent(caddr(r))||equal(r,imaginaryunit)?1:0},isimaginarynumber=function(r){return car(r)===symbol(MULTIPLY)&&3===length(r)&&isNumericAtom(cadr(r))&&equal(caddr(r),imaginaryunit)||equal(r,imaginaryunit)||hasNegativeRationalExponent(caddr(r))?(DEBUG_IS&&console.log("isimaginarynumber: "+r.toString()+" is imaginary number"),1):(DEBUG_IS&&console.log("isimaginarynumber: "+r.toString()+" isn't an imaginary number"),0)},iscomplexnumberdouble=function(r){return car(r)===symbol(ADD)&&3===length(r)&&isdouble(cadr(r))&&isimaginarynumberdouble(caddr(r))||isimaginarynumberdouble(r)?1:0},iscomplexnumber=function(r){return car(r)===symbol(ADD)&&3===length(r)&&isNumericAtom(cadr(r))&&isimaginarynumber(caddr(r))||isimaginarynumber(r)?(DEBUG&&console.log("iscomplexnumber: "+r.toString()+" is imaginary number"),1):(DEBUG&&console.log("iscomplexnumber: "+r.toString()+" is imaginary number"),0)},iseveninteger=function(r){return isinteger(r)&&r.q.a.isEven()?1:0},isnegative=function(r){return car(r)===symbol(ADD)&&isnegativeterm(cadr(r))?1:+!!isnegativeterm(r)},issymbolic=function(r){if(issymbol(r))return 1;for(;iscons(r);){if(issymbolic(car(r)))return 1;r=cdr(r)}return 0},isintegerfactor=function(r){return isinteger(r)||car(r)===symbol(POWER)&&isinteger(cadr(r))&&isinteger(caddr(r))},isNumberOneOverSomething=function(r){return isfraction(r)&&MEQUAL(r.q.a.abs(),1)},isoneover=function(r){return car(r)===symbol(POWER)&&isminusone(caddr(r))},isfraction=function(r){return r.k===NUM&&!MEQUAL(r.q.b,1)},equaln=function(r,t){switch(r.k){case NUM:return MEQUAL(r.q.a,t)&&MEQUAL(r.q.b,1);case DOUBLE:return r.d===t;default:return!1}},equalq=function(r,t,e){switch(r.k){case NUM:return MEQUAL(r.q.a,t)&&MEQUAL(r.q.b,e);case DOUBLE:return r.d===t/e;default:return!1}},isoneovertwo=function(r){return equalq(r,1,2)},isminusoneovertwo=function(r){return equalq(r,-1,2)},isoneoversqrttwo=function(r){return car(r)===symbol(POWER)&&equaln(cadr(r),2)&&equalq(caddr(r),-1,2)},isminusoneoversqrttwo=function(r){return car(r)===symbol(MULTIPLY)&&equaln(cadr(r),-1)&&isoneoversqrttwo(caddr(r))&&3===length(r)},issqrtthreeovertwo=function(r){return car(r)===symbol(MULTIPLY)&&isoneovertwo(cadr(r))&&issqrtthree(caddr(r))&&3===length(r)},isminussqrtthreeovertwo=function(r){return car(r)===symbol(MULTIPLY)&&isminusoneovertwo(cadr(r))&&issqrtthree(caddr(r))&&3===length(r)},issqrtthree=function(r){return car(r)===symbol(POWER)&&equaln(cadr(r),3)&&isoneovertwo(caddr(r))},isfloating=function(r){if(r.k===DOUBLE||r===symbol(FLOATF))return 1;for(;iscons(r);){if(isfloating(car(r)))return 1;r=cdr(r)}return 0},isimaginaryunit=function(r){return+!!equal(r,imaginaryunit)},isquarterturn=function(r){var t,e;if(e=0,t=0,car(r)!==symbol(MULTIPLY))return 0;if(equal(cadr(r),imaginaryunit))return 2*(caddr(r)===symbol(PI)&&3===length(r));if(!isNumericAtom(cadr(r))||!equal(caddr(r),imaginaryunit)||cadddr(r)!==symbol(PI)||4!==length(r)||(push(cadr(r)),push_integer(2),multiply(),isNaN(e=pop_integer())))return 0;switch(e<1&&(t=1,e=-e),e%4){case 0:e=1;break;case 1:e=t?4:3;break;case 2:e=2;break;case 3:e=t?3:4}return e},isnpi=function(r){var t,e;return(e=0,r===symbol(PI))?2:car(r)===symbol(MULTIPLY)&&isNumericAtom(cadr(r))&&caddr(r)===symbol(PI)&&3===length(r)?(t=0,push(cadr(r)),push_integer(2),multiply(),isNaN(e=pop_integer()))?0:e=e<0?4- -e%4:1+(e-1)%4:0},$.isZeroAtomOrTensor=isZeroAtomOrTensor,$.isnegativenumber=isnegativenumber,$.isplusone=isplusone,$.isminusone=isminusone,$.isinteger=isinteger,$.isnonnegativeinteger=isnonnegativeinteger,$.isposint=isposint,$.isnegativeterm=isnegativeterm,$.isimaginarynumber=isimaginarynumber,$.iscomplexnumber=iscomplexnumber,$.iseveninteger=iseveninteger,$.isnegative=isnegative,$.issymbolic=issymbolic,$.isintegerfactor=isintegerfactor,$.isoneover=isoneover,$.isfraction=isfraction,$.isoneoversqrttwo=isoneoversqrttwo,$.isminusoneoversqrttwo=isminusoneoversqrttwo,$.isfloating=isfloating,$.isimaginaryunit=isimaginaryunit,$.isquarterturn=isquarterturn,$.isnpi=isnpi,Eval_isprime=function(){return(push(cadr(p1)),Eval(),isnonnegativeinteger(p1=pop())&&mprime(p1.q.a))?push_integer(1):push_integer(0)},Eval_laguerre=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),(p2=pop())===symbol(NIL)?push_integer(0):push(p2),laguerre()},laguerre=function(){var r;if(r=0,save(),p3=pop(),p2=pop(),p1=pop(),push(p2),(r=pop_integer())<0||isNaN(r)){push_symbol(LAGUERRE),push(p1),push(p2),push(p3),list(4),restore();return}return issymbol(p1)?laguerre2(r):(p4=p1,p1=symbol(SECRETX),laguerre2(r),p1=p4,push(symbol(SECRETX)),push(p1),subst(),Eval()),restore()},laguerre2=function(r){var t,e,n,o;for(t=0,push_integer(1),push_integer(0),p6=pop(),o=[],t=e=0,n=r;0<=n?e<n:e>n;t=0<=n?++e:--e)p5=p6,p6=pop(),push_integer(2*t+1),push(p1),subtract(),push(p3),add(),push(p6),multiply(),push_integer(t),push(p3),add(),push(p5),multiply(),subtract(),push_integer(t+1),o.push(divide());return o},Eval_lcm=function(){var r;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),lcm(),r.push(p1=cdr(p1));return r},lcm=function(){var r;return r=expanding,save(),yylcm(),restore(),expanding=r},yylcm=function(){return expanding=1,p2=pop(),p1=pop(),push(p1),push(p2),gcd(),push(p1),divide(),push(p2),divide(),inverse()},Eval_leading=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p1=pop())===symbol(NIL)?guess():push(p1),leading()},leading=function(){return save(),p2=pop(),p1=pop(),push(p1),push(p2),degree(),p3=pop(),push(p1),push(p2),push(p3),power(),divide(),push(p2),filter(),restore()},Eval_legendre=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),(p2=pop())===symbol(NIL)?push_integer(0):push(p2),legendre()},legendre=function(){return save(),__legendre(),restore()},__legendre=function(){var r,t;if(r=0,t=0,p3=pop(),p2=pop(),p1=pop(),push(p2),t=pop_integer(),push(p3),r=pop_integer(),t<0||isNaN(t)||r<0||isNaN(r)){push_symbol(LEGENDRE),push(p1),push(p2),push(p3),list(4);return}return issymbol(p1)?__legendre2(t,r):(p4=p1,p1=symbol(SECRETX),__legendre2(t,r),p1=p4,push(symbol(SECRETX)),push(p1),subst(),Eval()),__legendre3(r)},__legendre2=function(r,t){var e,n,o,i,a,s;for(e=0,push_integer(1),push_integer(0),p6=pop(),e=o=0,i=r;0<=i?o<i:o>i;e=0<=i?++o:--o)p5=p6,p6=pop(),push_integer(2*e+1),push(p1),multiply(),push(p6),multiply(),push_integer(e),push(p5),multiply(),subtract(),push_integer(e+1),divide();for(s=[],e=n=0,a=t;0<=a?n<a:n>a;e=0<=a?++n:--n)push(p1),s.push(derivative());return s},__legendre3=function(r){if(0!==r&&(car(p1)===symbol(COS)?(push(cadr(p1)),sine(),square()):car(p1)===symbol(SIN)?(push(cadr(p1)),cosine(),square()):(push_integer(1),push(p1),square(),subtract()),push_integer(r),push_rational(1,2),multiply(),power(),multiply(),r%2))return negate()},list=function(r){var t,e,n,o;for(t=0,push(symbol(NIL)),o=[],t=e=0,n=r;0<=n?e<n:e>n;t=0<=n?++e:--e)o.push(cons());return o},Eval_log=function(){return push(cadr(p1)),Eval(),logarithm()},logarithm=function(){return save(),yylog(),restore()},yylog=function(){var r;if(r=0,(p1=pop())===symbol(E))return void push_integer(1);if(equaln(p1,1))return void push_integer(0);if(isnegativenumber(p1)){push(p1),negate(),logarithm(),push(imaginaryunit),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),multiply(),add();return}if(isdouble(p1)){r=Math.log(p1.d),push_double(r);return}if(isfraction(p1)){push(p1),numerator(),logarithm(),push(p1),denominator(),logarithm(),subtract();return}if(car(p1)===symbol(POWER)){push(caddr(p1)),push(cadr(p1)),logarithm(),multiply();return}if(car(p1)===symbol(MULTIPLY)){for(push_integer(0),p1=cdr(p1);iscons(p1);)push(car(p1)),logarithm(),add(),p1=cdr(p1);return}return push_symbol(LOG),push(p1),list(2)},Eval_lookup=function(){return iscons(p1=cadr(p1))||cadr(p1).k!==SYM||(p1=get_binding(p1)),push(p1)},madd=function(r,t){return r.add(t)},msub=function(r,t){return r.subtract(t)},addf=function(r,t){return r.add(t)},subf=function(r,t){return r.subtract(t)},ucmp=function(r,t){return r.compareAbs(t)},mgcd=function(r,t){return bigInt.gcd(r,t)},new_string=function(r){var t;return(t=new U).k=STR,t.str=r,t},out_of_memory=function(){return stop("out of memory")},push_zero_matrix=function(r,t){return push(alloc_tensor(r*t)),stack[tos-1].tensor.ndim=2,stack[tos-1].tensor.dim[0]=r,stack[tos-1].tensor.dim[1]=t},push_identity_matrix=function(r){var t,e,n;for(push_zero_matrix(r,r),t=e=0,n=r;0<=n?e<n:e>n;t=0<=n?++e:--e)stack[tos-1].tensor.elem[t*r+t]=one;return check_tensor_dimensions(stack[tos-1])},push_cars=function(r){var t;for(t=[];iscons(r);)push(car(r)),t.push(r=cdr(r));return t},equal=function(r,t){return+(0===cmp_expr(r,t))},lessp=function(r,t){return+(0>cmp_expr(r,t))},sign=function(r){return r<0?-1:+(r>0)},cmp_expr=function(r,t){var e;if(e=0,r===t)return 0;if(r===symbol(NIL))return -1;if(t===symbol(NIL))return 1;if(isNumericAtom(r)&&isNumericAtom(t))return sign(compare_numbers(r,t));if(isNumericAtom(r))return -1;if(isNumericAtom(t))return 1;if(isstr(r)&&isstr(t))return sign(strcmp(r.str,t.str));if(isstr(r))return -1;if(isstr(t))return 1;if(issymbol(r)&&issymbol(t))return sign(strcmp(get_printname(r),get_printname(t)));if(issymbol(r))return -1;if(issymbol(t))return 1;if(istensor(r)&&istensor(t))return compare_tensors(r,t);if(istensor(r))return -1;if(istensor(t))return 1;for(;iscons(r)&&iscons(t);){if(0!==(e=cmp_expr(car(r),car(t))))return e;r=cdr(r),t=cdr(t)}return iscons(t)?-1:+!!iscons(r)},length=function(r){var t;for(t=0;iscons(r);)r=cdr(r),t++;return t},unique=function(r){return save(),p1=symbol(NIL),p2=symbol(NIL),unique_f(r),p2!==symbol(NIL)&&(p1=symbol(NIL)),r=p1,restore(),r},unique_f=function(r){if(isstr(r))return void(p1===symbol(NIL)?p1=r:r!==p1&&(p2=r));for(;iscons(r);){if(unique_f(car(r)),p2!==symbol(NIL))return;r=cdr(r)}},ssqrt=function(){return push_rational(1,2),power()},yyexpand=function(){var r;return r=expanding,expanding=1,Eval(),expanding=r},exponential=function(){return push_symbol(E),swap(),power()},square=function(){return push_integer(2),power()},sort_stack=function(r){var t,e;return t=tos-r,(e=stack.slice(t,t+r)).sort(cmp_expr),stack=stack.slice(0,t).concat(e).concat(stack.slice(t+r))},$.equal=equal,$.length=length,mmul=function(r,t){return r.multiply(t)},mdiv=function(r,t){return r.divide(t)},mmod=function(r,t){return r.mod(t)},mdivrem=function(r,t){var e;return[(e=r.divmod(t)).quotient,e.remainder]},Eval_mod=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),mod()},mod=function(){var r;if(r=0,save(),p2=pop(),p1=pop(),isZeroAtomOrTensor(p2)&&stop("mod function: divide by zero"),!isNumericAtom(p1)||!isNumericAtom(p2)){push_symbol(MOD),push(p1),push(p2),list(3),restore();return}return isdouble(p1)&&(push(p1),isNaN(r=pop_integer())&&stop("mod function: cannot convert float value to integer"),push_integer(r),p1=pop()),isdouble(p2)&&(push(p2),isNaN(r=pop_integer())&&stop("mod function: cannot convert float value to integer"),push_integer(r),p2=pop()),isinteger(p1)&&isinteger(p2)||stop("mod function: integer arguments expected"),(p3=new U).k=NUM,p3.q.a=mmod(p1.q.a,p2.q.a),p3.q.b=mint(1),push(p3),restore()},mpow=function(r,t){return r.pow(t)},mprime=function(r){return r.isProbablePrime()},mroot=function(r,t){var e,n,o,i,a,s,u;for(r=r.abs(),e=0,n=0,o=0,0===t&&stop("root index is zero"),o=0;r.shiftRight(o)>0;)o++;if(0===o)return mint(0);for(s=bigInt(n=Math.floor((o=Math.floor((o-1)/t))/32+1)),e=i=0,a=n;0<=a?i<a:i>a;e=0<=a?++i:--i)s=s.and(bigInt(1).shiftLeft(e).not());for(;o>=0;){switch(s=s.or(bigInt(1).shiftLeft(o)),u=mpow(s,t),mcmp(u,r)){case 0:return s;case 1:s=s.and(bigInt(1).shiftLeft(o).not())}o--}return 0},DEBUG_MULTIPLY=!1,Eval_multiply=function(){var r;for(push(cadr(p1)),Eval(),p1=cddr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),multiply(),r.push(p1=cdr(p1));return r},multiply=function(){return(esc_flag&&stop("escape key stop"),isNumericAtom(stack[tos-2])&&isNumericAtom(stack[tos-1]))?multiply_numbers():(save(),yymultiply(),restore())},yymultiply=function(){var r,t,e,n,o,i;if(r=0,t=0,e=0,p2=pop(),p1=pop(),r=tos,isZeroAtom(p1)||isZeroAtom(p2))return void(evaluatingAsFloats?push_double(0):push(zero));if(expanding&&isadd(p1)){for(p1=cdr(p1),evaluatingAsFloats?push_double(0):push(zero);iscons(p1);)push(car(p1)),push(p2),multiply(),add(),p1=cdr(p1);return}if(expanding&&isadd(p2)){for(p2=cdr(p2),evaluatingAsFloats?push_double(0):push(zero);iscons(p2);)push(p1),push(car(p2)),multiply(),add(),p2=cdr(p2);return}if(!istensor(p1)&&istensor(p2)){push(p1),push(p2),scalar_times_tensor();return}if(istensor(p1)&&!istensor(p2)){push(p1),push(p2),tensor_times_scalar();return}for(car(p1)===symbol(MULTIPLY)?p1=cdr(p1):(push(p1),list(1),p1=pop()),car(p2)===symbol(MULTIPLY)?p2=cdr(p2):(push(p2),list(1),p2=pop()),isNumericAtom(car(p1))&&isNumericAtom(car(p2))?(push(car(p1)),push(car(p2)),multiply_numbers(),p1=cdr(p1),p2=cdr(p2)):isNumericAtom(car(p1))?(push(car(p1)),p1=cdr(p1)):isNumericAtom(car(p2))?(push(car(p2)),p2=cdr(p2)):evaluatingAsFloats?push_double(1):push(one),parse_p1(),parse_p2();iscons(p1)&&iscons(p2);){if(caar(p1)===symbol(OPERATOR)&&caar(p2)===symbol(OPERATOR)){push_symbol(OPERATOR),push(cdar(p1)),push(cdar(p2)),append(),cons(),p1=cdr(p1),p2=cdr(p2),parse_p1(),parse_p2();continue}switch(cmp_expr(p3,p4)){case -1:push(car(p1)),p1=cdr(p1),parse_p1();break;case 1:push(car(p2)),p2=cdr(p2),parse_p2();break;case 0:combine_factors(r),p1=cdr(p1),p2=cdr(p2),parse_p1(),parse_p2();break;default:stop("internal error 2")}}for(;iscons(p1);)push(car(p1)),p1=cdr(p1);for(;iscons(p2);)push(car(p2)),p2=cdr(p2);if(__normalize_radical_factors(r),expanding){for(t=n=o=r,i=tos;o<=i?n<i:n>i;t=o<=i?++n:--n)if(isadd(stack[t]))return void multiply_all(tos-r)}if(1!=(e=tos-r))return isrational(stack[r])&&equaln(stack[r],1)?void(2===e?(p7=pop(),pop(),push(p7)):(stack[r]=symbol(MULTIPLY),list(e))):(list(e),p7=pop(),push_symbol(MULTIPLY),push(p7),cons())},parse_p1=function(){if(p3=car(p1),p5=evaluatingAsFloats?one_as_double:one,car(p3)===symbol(POWER))return p5=caddr(p3),p3=cadr(p3)},parse_p2=function(){if(p4=car(p2),p6=evaluatingAsFloats?one_as_double:one,car(p4)===symbol(POWER))return p6=caddr(p4),p4=cadr(p4)},combine_factors=function(r){return(push(p4),push(p5),push(p6),add(),power(),isNumericAtom(p7=pop()))?(push(stack[r]),push(p7),multiply_numbers(),stack[r]=pop()):car(p7)!==symbol(MULTIPLY)?push(p7):isNumericAtom(cadr(p7))&&cdddr(p7)===symbol(NIL)?(push(stack[r]),push(cadr(p7)),multiply_numbers(),stack[r]=pop(),push(caddr(p7))):push(p7)},gp=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,-6,-7,-8,-3,-4,-5,13,14,15,-16,9,10,11,-12],[0,0,6,-1,-11,10,-2,-15,14,12,-5,4,-9,16,-8,7,-13],[0,0,7,11,-1,-9,15,-2,-13,5,12,-3,-10,8,16,-6,-14],[0,0,8,-10,9,-1,-14,13,-2,-4,3,12,-11,-7,6,16,-15],[0,0,3,2,15,-14,1,11,-10,16,-8,7,13,12,-5,4,9],[0,0,4,-15,2,13,-11,1,9,8,16,-6,14,5,12,-3,10],[0,0,5,14,-13,2,10,-9,1,-7,6,16,15,-4,3,12,11],[0,0,13,12,-5,4,16,-8,7,-1,-11,10,-3,-2,-15,14,-6],[0,0,14,5,12,-3,8,16,-6,11,-1,-9,-4,15,-2,-13,-7],[0,0,15,-4,3,12,-7,6,16,-10,9,-1,-5,-14,13,-2,-8],[0,0,16,-9,-10,-11,-13,-14,-15,-3,-4,-5,1,-6,-7,-8,2],[0,0,9,-16,8,-7,-12,5,-4,-2,-15,14,6,-1,-11,10,3],[0,0,10,-8,-16,6,-5,-12,3,15,-2,-13,7,11,-1,-9,4],[0,0,11,7,-6,-16,4,-3,-12,-14,13,-2,8,-10,9,-1,5],[0,0,12,13,14,15,9,10,11,-6,-7,-8,-2,-3,-4,-5,-1]],combine_gammas=function(r){var t;if((t=gp[Math.floor(p1.gamma)][Math.floor(p2.gamma)])<0&&(t=-t,push(stack[r]),negate(),stack[r]=pop()),t>1)return push(_gamma[t])},multiply_noexpand=function(){var r;return r=expanding,expanding=0,multiply(),expanding=r},multiply_all=function(r){var t,e,n,o;if(e=0,1!==r){if(0===r)return void push(evaluatingAsFloats?one_as_double:one);for(t=tos-r,push(stack[t]),e=n=1,o=r;1<=o?n<o:n>o;e=1<=o?++n:--n)push(stack[t+e]),multiply();return stack[t]=pop(),moveTos(t+1)}},multiply_all_noexpand=function(r){var t;return t=expanding,expanding=0,multiply_all(r),expanding=t},divide=function(){return isNumericAtom(stack[tos-2])&&isNumericAtom(stack[tos-1])?divide_numbers():(inverse(),multiply())},inverse=function(){return isNumericAtom(stack[tos-1])?invert_number():(push_integer(-1),power())},reciprocate=function(){return inverse()},negate=function(){return isNumericAtom(stack[tos-1])?negate_number():(evaluatingAsFloats?push_double(-1):push_integer(-1),multiply())},negate_expand=function(){var r;return r=expanding,expanding=1,negate(),expanding=r},negate_noexpand=function(){var r;return r=expanding,expanding=0,negate(),expanding=r},__normalize_radical_factors=function(r){var t,e,n,o,i,a,s,u,f,l;if(t=0,!(isplusone(stack[r])||isminusone(stack[r])||isdouble(stack[r]))){for(t=o=i=r+1,a=tos;(i<=a?o<a:o>a)&&!__is_radical_number(stack[t]);t=i<=a?++o:--o);if(t!==tos){for(save(),push(stack[r]),mp_numerator(),DEBUG_MULTIPLY&&console.log("__normalize_radical_factors numerator: "+stack[tos-1]),p1=pop(),t=e=s=r+1,u=tos;(s<=u?e<u:e>u)&&!(isplusone(p1)||isminusone(p1));t=s<=u?++e:--e){if(__is_radical_number(stack[t]))p3=cadr(stack[t]),p4=caddr(stack[t]),isnegativenumber(p4)&&(push(p1),push(p3),divide(),p5=pop(),isinteger(p5)&&(p1=p5,push_symbol(POWER),push(p3),push(evaluatingAsFloats?one_as_double:one),push(p4),add(),list(3),stack[t]=pop()))}for(push(stack[r]),mp_denominator(),DEBUG_MULTIPLY&&console.log("__normalize_radical_factors denominator: "+stack[tos-1]),p2=pop(),t=n=f=r+1,l=tos;(f<=l?n<l:n>l)&&!isplusone(p2);t=f<=l?++n:--n){if(__is_radical_number(stack[t])){if((p3=cadr(stack[t]),p4=caddr(stack[t]),!isnegativenumber(p4))&&(push(p2),push(p3),divide(),p5=pop(),isinteger(p5))){if(DEBUG_MULTIPLY&&console.log("__new radical p5: "+p5.toString()),DEBUG_MULTIPLY&&console.log("__new radical top stack: "+stack[tos-1]),p2=p5,push_symbol(POWER),push(p3),push(p4),DEBUG_MULTIPLY&&console.log("__new radical p3: "+p3.toString()),DEBUG_MULTIPLY&&console.log("__new radical p4: "+p4.toString()),push(one),subtract(),dontCreateNewRadicalsInDenominatorWhenEvalingMultiplication&&isinteger(p3)&&!isinteger(stack[tos-1])&&isnegativenumber(stack[tos-1])){pop(),pop(),pop(),push(p1),push(p3),divide(),p1=pop();break}DEBUG_MULTIPLY&&console.log("__new radical exponent: "+stack[tos-1]),list(3),stack[t]=pop()}}}return push(p1),push(p2),divide(),stack[r]=pop(),restore()}}},__is_radical_number=function(r){return car(r)===symbol(POWER)&&isNumericAtom(cadr(r))&&isfraction(caddr(r))&&!isminusone(cadr(r))},NROOTS_YMAX=101,NROOTS_DELTA=1e-6,NROOTS_EPSILON=1e-9,NROOTS_ABS=function(r){return Math.sqrt(r.r*r.r+r.i*r.i)},theRandom=0,NROOTS_RANDOM=function(){return 4*Math.random()-2},numericRootOfPolynomial=(function(){class r{}return r.prototype.r=0,r.prototype.i=0,r}).call(this),nroots_a=new numericRootOfPolynomial,nroots_b=new numericRootOfPolynomial,nroots_x=new numericRootOfPolynomial,nroots_y=new numericRootOfPolynomial,nroots_fa=new numericRootOfPolynomial,nroots_fb=new numericRootOfPolynomial,nroots_dx=new numericRootOfPolynomial,nroots_df=new numericRootOfPolynomial,nroots_c=[],initNRoots=o=0,ref=NROOTS_YMAX;0<=ref?o<ref:o>ref;initNRoots=0<=ref?++o:--o)nroots_c[initNRoots]=new numericRootOfPolynomial;for(Eval_nroots=function(){var r,t,e,n,o,i,a,s,u,f;for(r=0,t=0,o=0,a=0,push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p2=pop())===symbol(NIL)?guess():push(p2),p2=pop(),p1=pop(),ispolyexpandedform(p1,p2)||stop("nroots: polynomial?"),r=tos,(a=coeff(p2,p1))>NROOTS_YMAX&&stop("nroots: degree?"),t=e=0,s=a;0<=s?e<s:e>s;t=0<=s?++e:--e)push(stack[r+t]),real(),yyfloat(),Eval(),p1=pop(),push(stack[r+t]),imag(),yyfloat(),Eval(),p2=pop(),isdouble(p1)&&isdouble(p2)||stop("nroots: coefficients?"),nroots_c[t].r=p1.d,nroots_c[t].i=p2.d;for(moveTos(r),monic(a),o=n=u=a;n>1;o=n+=-1)findroot(o),Math.abs(nroots_a.r)<NROOTS_DELTA&&(nroots_a.r=0),Math.abs(nroots_a.i)<NROOTS_DELTA&&(nroots_a.i=0),push_double(nroots_a.r),push_double(nroots_a.i),push(imaginaryunit),multiply(),add(),NROOTS_divpoly(o);if((a=tos-r)>1){for(sort_stack(a),(p1=alloc_tensor(a)).tensor.ndim=1,p1.tensor.dim[0]=a,t=i=0,f=a;0<=f?i<f:i>f;t=0<=f?++i:--i)p1.tensor.elem[t]=stack[r+t];return moveTos(r),push(p1)}},monic=function(r){var t,e,n,o;for(e=0,o=0,nroots_y.r=nroots_c[r-1].r,nroots_y.i=nroots_c[r-1].i,o=nroots_y.r*nroots_y.r+nroots_y.i*nroots_y.i,e=t=0,n=r-1;0<=n?t<n:t>n;e=0<=n?++t:--t)nroots_c[e].r=(nroots_c[e].r*nroots_y.r+nroots_c[e].i*nroots_y.i)/o,nroots_c[e].i=(nroots_c[e].i*nroots_y.r-nroots_c[e].r*nroots_y.i)/o;return nroots_c[r-1].r=1,nroots_c[r-1].i=0},findroot=function(r){var t,e,n,o,i,a;if(e=0,o=0,a=0,NROOTS_ABS(nroots_c[0])<NROOTS_DELTA){nroots_a.r=0,nroots_a.i=0;return}for(e=t=0;t<100;e=++t)for(nroots_a.r=NROOTS_RANDOM(),nroots_a.i=NROOTS_RANDOM(),compute_fa(r),nroots_b.r=nroots_a.r,nroots_b.i=nroots_a.i,nroots_fb.r=nroots_fa.r,nroots_fb.i=nroots_fa.i,nroots_a.r=NROOTS_RANDOM(),nroots_a.i=NROOTS_RANDOM(),o=n=0;n<1e3;o=++n){if(compute_fa(r),i=NROOTS_ABS(nroots_fa),DEBUG&&console.log("nrabs: "+i),i<NROOTS_EPSILON)return;if(NROOTS_ABS(nroots_fa)<NROOTS_ABS(nroots_fb)&&(nroots_x.r=nroots_a.r,nroots_x.i=nroots_a.i,nroots_a.r=nroots_b.r,nroots_a.i=nroots_b.i,nroots_b.r=nroots_x.r,nroots_b.i=nroots_x.i,nroots_x.r=nroots_fa.r,nroots_x.i=nroots_fa.i,nroots_fa.r=nroots_fb.r,nroots_fa.i=nroots_fb.i,nroots_fb.r=nroots_x.r,nroots_fb.i=nroots_x.i),nroots_dx.r=nroots_b.r-nroots_a.r,nroots_dx.i=nroots_b.i-nroots_a.i,nroots_df.r=nroots_fb.r-nroots_fa.r,nroots_df.i=nroots_fb.i-nroots_fa.i,0==(a=nroots_df.r*nroots_df.r+nroots_df.i*nroots_df.i))break;nroots_y.r=(nroots_dx.r*nroots_df.r+nroots_dx.i*nroots_df.i)/a,nroots_y.i=(nroots_dx.i*nroots_df.r-nroots_dx.r*nroots_df.i)/a,nroots_a.r=nroots_b.r-(nroots_y.r*nroots_fb.r-nroots_y.i*nroots_fb.i),nroots_a.i=nroots_b.i-(nroots_y.r*nroots_fb.i+nroots_y.i*nroots_fb.r)}return stop("nroots: convergence error")},compute_fa=function(r){var t,e,n,o,i;for(e=0,i=0,nroots_x.r=nroots_a.r,nroots_x.i=nroots_a.i,nroots_fa.r=nroots_c[0].r+nroots_c[1].r*nroots_x.r-nroots_c[1].i*nroots_x.i,nroots_fa.i=nroots_c[0].i+nroots_c[1].r*nroots_x.i+nroots_c[1].i*nroots_x.r,o=[],e=t=2,n=r;2<=n?t<n:t>n;e=2<=n?++t:--t)i=nroots_a.r*nroots_x.r-nroots_a.i*nroots_x.i,nroots_x.i=nroots_a.r*nroots_x.i+nroots_a.i*nroots_x.r,nroots_x.r=i,nroots_fa.r+=nroots_c[e].r*nroots_x.r-nroots_c[e].i*nroots_x.i,o.push(nroots_fa.i+=nroots_c[e].r*nroots_x.i+nroots_c[e].i*nroots_x.r);return o},NROOTS_divpoly=function(r){var t,e,n,o,i,a;for(n=0,n=t=o=r-1;o<=0?t<0:t>0;n=o<=0?++t:--t)nroots_c[n-1].r+=nroots_c[n].r*nroots_a.r-nroots_c[n].i*nroots_a.i,nroots_c[n-1].i+=nroots_c[n].i*nroots_a.r+nroots_c[n].r*nroots_a.i;for(NROOTS_ABS(nroots_c[0])>NROOTS_DELTA&&stop("nroots: residual error"),a=[],n=e=0,i=r-1;0<=i?e<i:e>i;n=0<=i?++e:--e)nroots_c[n].r=nroots_c[n+1].r,a.push(nroots_c[n].i=nroots_c[n+1].i);return a},Eval_numerator=function(){return push(cadr(p1)),Eval(),numerator()},numerator=function(){var r,t;if(r=0,car(t=pop())===symbol(ADD)&&(push(t),rationalize(),t=pop()),car(t)!==symbol(MULTIPLY)||isplusone(car(cdr(t))))if(isrational(t))return push(t),mp_numerator();else if(car(t)===symbol(POWER)&&isnegativeterm(caddr(t)))return push(one);else return push(t);for(r=tos,t=cdr(t);iscons(t);)push(car(t)),numerator(),t=cdr(t);return multiply_all(tos-r)},Eval_outer=function(){var r;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),outer(),r.push(p1=cdr(p1));return r},outer=function(){return save(),p2=pop(),istensor(p1=pop())&&istensor(p2)?yyouter():(push(p1),push(p2),istensor(p1)?tensor_times_scalar():istensor(p2)?scalar_times_tensor():multiply()),restore()},yyouter=function(){var r,t,e,n,o,i,a,s,u,f,l,c,p;for(r=0,e=0,o=0,s=0,u=0,(s=p1.tensor.ndim+p2.tensor.ndim)>MAXDIM&&stop("outer: rank of result exceeds maximum"),u=p1.tensor.nelem*p2.tensor.nelem,(p3=alloc_tensor(u)).tensor.ndim=s,r=t=0,f=p1.tensor.ndim;0<=f?t<f:t>f;r=0<=f?++t:--t)p3.tensor.dim[r]=p1.tensor.dim[r];for(e=r,r=n=0,l=p2.tensor.ndim;0<=l?n<l:n>l;r=0<=l?++n:--n)p3.tensor.dim[e+r]=p2.tensor.dim[r];for(o=0,r=i=0,c=p1.tensor.nelem;0<=c?i<c:i>c;r=0<=c?++i:--i)for(e=a=0,p=p2.tensor.nelem;0<=p?a<p:a>p;e=0<=p?++a:--a)push(p1.tensor.elem[r]),push(p2.tensor.elem[e]),multiply(),p3.tensor.elem[o++]=pop();return push(p3)},partition=function(){for(save(),p2=pop(),p1=pop(),push_integer(1),p4=p3=pop(),p1=cdr(p1);iscons(p1);)Find(car(p1),p2)?(push(p4),push(car(p1)),multiply(),p4=pop()):(push(p3),push(car(p1)),multiply(),p3=pop()),p1=cdr(p1);return push(p3),push(p4),restore()},Eval_silentpattern=function(){return Eval_pattern(),pop(),push_symbol(NIL)},Eval_pattern=function(){var r,t,e,n,o;return iscons(cdr(p1))||stop("pattern needs at least a template and a transformed version"),r=car(cdr(p1)),(e=car(cdr(cdr(p1))))===symbol(NIL)&&stop("pattern needs at least a template and a transformed version"),o=iscons(cdr(cdr(p1)))?car(cdr(cdr(cdr(p1)))):symbol(NIL),equal(r,e)&&stop("recursive pattern"),n="template: "+print_list(r)+" tests: "+print_list(o),DEBUG&&console.log("pattern stringkey: "+n),-1===(t=userSimplificationsInStringForm.indexOf(n))?(userSimplificationsInStringForm.push(n),userSimplificationsInListForm.push(cdr(p1))):(DEBUG&&console.log("pattern already exists, replacing. "+cdr(p1)),userSimplificationsInStringForm[t]=n,userSimplificationsInListForm[t]=cdr(p1)),push_symbol(PATTERN),push(cdr(p1)),list(2)},do_clearPatterns=function(){return userSimplificationsInListForm=[],userSimplificationsInStringForm=[]},Eval_clearpatterns=function(){return do_clearPatterns(),push_symbol(NIL)},Eval_patternsinfo=function(){var r;return""!==(r=patternsinfo())?push(new_string(r)):push_symbol(NIL)},patternsinfo=function(){var r,t,e,n;for(t=0,n="",e=userSimplificationsInListForm.length;t<e;t++)r=userSimplificationsInListForm[t],n+=userSimplificationsInListForm+"\n";return n},Eval_polar=function(){return push(cadr(p1)),Eval(),polar()},polar=function(){return evaluatingPolar++,save(),p1=pop(),push(p1),abs(),push(imaginaryunit),push(p1),arg(),multiply(),exponential(),multiply(),evaluatingPolar--,restore()},n_factor_number=0,factor_number=function(){var r;if(r=0,save(),p1=pop(),equaln(p1,0)||equaln(p1,1)||equaln(p1,-1)){push(p1),restore();return}return n_factor_number=p1.q.a,r=tos,factor_a(),tos-r>1&&(list(tos-r),push_symbol(MULTIPLY),swap(),cons()),restore()},factor_a=function(){var r,t;for(t=0,n_factor_number.isNegative()&&(n_factor_number=setSignTo(n_factor_number,1),push_integer(-1)),t=r=0;r<1e4;t=++r)if(try_kth_prime(t),0===n_factor_number.compare(1))return;return factor_b()},try_kth_prime=function(r){var t,e,n,o;for(t=0,e=mint(primetab[r]),t=0;;){if(0===n_factor_number.compare(1)){t&&push_factor(e,t);return}if([n,o]=mdivrem(n_factor_number,e),o.isZero())t++,n_factor_number=n;else break}if(t&&push_factor(e,t),-1===mcmp(n,e))return push_factor(n_factor_number,1),n_factor_number=mint(1)},factor_b=function(){var r,t,e,n,o,i,a;for(e=0,n=0,r=mint(1),i=mint(5),a=mint(2),e=1,n=1;;){if(mprime(n_factor_number))return push_factor(n_factor_number,1),0;for(;;){if(esc_flag&&stop("esc"),o=setSignTo(o=msub(a,i),1),MEQUAL(t=mgcd(o,n_factor_number),1)){0==--e&&(a=i,n*=2,e=n),i=o=mmod(i=madd(o=mmul(i,i),r),n_factor_number);continue}if(push_factor(t,1),0===mcmp(t,n_factor_number))return -1;i=o=mmod(i,n_factor_number=o=mdiv(n_factor_number,t)),a=o=mmod(a,n_factor_number);break}}},push_factor=function(r,t){if((p1=new U).k=NUM,p1.q.a=r,p1.q.b=mint(1),push(p1),t>1)return push_symbol(POWER),swap(),(p1=new U).k=NUM,p1.q.a=mint(t),p1.q.b=mint(1),push(p1),list(3)},DEBUG_POWER=!1,Eval_power=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),power()},power=function(){return save(),yypower(),restore()},yypower=function(){var r,t,e,n,o,i,a;if(a=0,p2=pop(),p1=pop(),n=p2,e=p1,DEBUG_POWER&&console.log("POWER: "+p1+" ^ "+p2),equal(p1,one)||isZeroAtomOrTensor(p2)){evaluatingAsFloats?push_double(1):push(one),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(equal(p2,one)){push(p1),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(isminusone(p1)&&isminusone(p2)){evaluatingAsFloats?push_double(1):push(one),negate(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(isminusone(p1)&&isoneovertwo(p2)){push(imaginaryunit),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(isminusone(p1)&&isminusoneovertwo(p2)){push(imaginaryunit),negate(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(isminusone(p1)&&!isdouble(p1)&&isrational(p2)&&!isinteger(p2)&&ispositivenumber(p2)&&!evaluatingAsFloats){DEBUG_POWER&&console.log("   power: -1 ^ rational"),DEBUG_POWER&&console.log(" trick: p2.q.a , p2.q.b "+p2.q.a+" , "+p2.q.b),p2.q.a<p2.q.b?(push_symbol(POWER),push(p1),push(p2),list(3)):(push_symbol(MULTIPLY),push(p1),push_symbol(POWER),push(p1),push_rational(p2.q.a.mod(p2.q.b),p2.q.b),list(3),list(3),DEBUG_POWER&&console.log(" trick applied : "+stack[tos-1])),rect(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(isrational(p1)&&isrational(p2)){DEBUG_POWER&&console.log("   power: isrational(p1) && isrational(p2)"),push(p1),push(p2),qpow(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(isNumericAtom(p1)&&isNumericAtom(p2)){DEBUG_POWER&&console.log("   power: both base and exponent are either rational or double "),DEBUG_POWER&&console.log("POWER - isNumericAtom(p1) && isNumericAtom(p2)"),push(p1),push(p2),dpow(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(istensor(p1)){DEBUG_POWER&&console.log("   power: istensor(p1) "),power_tensor(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(car(p1)===symbol(ABS)&&iseveninteger(p2)&&!isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))){DEBUG_POWER&&console.log("   power: even power of absolute of real value "),push(cadr(p1)),push(p2),power(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(p1===symbol(E)&&car(p2)===symbol(LOG)){push(cadr(p2)),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(p1===symbol(E)&&isdouble(p2)){DEBUG_POWER&&console.log("   power: p1 == symbol(E) && isdouble(p2) "),push_double(Math.exp(p2.d)),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(p1===symbol(E)&&0!==Find(p2,imaginaryunit)&&0!==Find(p2,symbol(PI))&&!evaluatingPolar&&(push_symbol(POWER),push(p1),push(p2),list(3),DEBUG_POWER&&console.log("   power: turning complex exponential to rect: "+stack[tos-1]),rect(),t=pop(),0===Find(t,symbol(PI)))){DEBUG_POWER&&console.log("   power: turned complex exponential to rect: "+t),push(t);return}if(car(p1)===symbol(MULTIPLY)&&isinteger(p2)){for(DEBUG_POWER&&console.log("   power: (a * b) ^ c  ->  (a ^ c) * (b ^ c) "),p1=cdr(p1),push(car(p1)),push(p2),power(),p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),power(),multiply(),p1=cdr(p1);DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(i=!1,isNumericAtom(cadr(p1))&&(i=sign(compare_numbers(cadr(p1),zero))),car(p1)===symbol(POWER)&&(isinteger(p2)||i)){push(cadr(p1)),push(caddr(p1)),push(p2),multiply(),power(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(r=!1,iseveninteger(caddr(p1))&&(push(caddr(p1)),push(p2),multiply(),o=pop(),isone(o)&&(r=!0)),car(p1)===symbol(POWER)&&r){DEBUG_POWER&&console.log("   power: car(p1) == symbol(POWER) && b_isEven_and_c_isItsInverse "),push(cadr(p1)),abs(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(expanding&&isadd(p1)&&isNumericAtom(p2)&&(push(p2),(a=pop_integer())>1&&!isNaN(a))){DEBUG_POWER&&console.log("   power: expanding && isadd(p1) && isNumericAtom(p2) "),power_sum(a),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(1===trigmode&&car(p1)===symbol(SIN)&&iseveninteger(p2)){DEBUG_POWER&&console.log("   power: trigmode == 1 && car(p1) == symbol(SIN) && iseveninteger(p2) "),push_integer(1),push(cadr(p1)),cosine(),push_integer(2),power(),subtract(),push(p2),push_rational(1,2),multiply(),power(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(2===trigmode&&car(p1)===symbol(COS)&&iseveninteger(p2)){DEBUG_POWER&&console.log("   power: trigmode == 2 && car(p1) == symbol(COS) && iseveninteger(p2) "),push_integer(1),push(cadr(p1)),sine(),push_integer(2),power(),subtract(),push(p2),push_rational(1,2),multiply(),power(),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(iscomplexnumber(p1)){if(DEBUG_POWER&&console.log(" power - handling the case (a + ib) ^ n"),isinteger(p2)){push(p1),conjugate(),p3=pop(),push(p3),push(p3),push(p1),multiply(),divide(),isone(p2)||(push(p2),negate(),power()),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}if(isNumericAtom(p2)){push(p1),abs(),push(p2),power(),push_integer(-1),push(p1),arg(),push(p2),multiply(),evaluatingAsFloats||iscomplexnumberdouble(p1)&&isdouble(p2)?push_double(Math.PI):push(symbol(PI)),divide(),power(),multiply(),avoidCalculatingPowersIntoArctans&&Find(stack[tos-1],symbol(ARCTAN))&&(pop(),push_symbol(POWER),push(p1),push(p2),list(3)),DEBUG_POWER&&console.log("   power of "+e+" ^ "+n+": "+stack[tos-1]);return}}if(simplify_polar()){DEBUG_POWER&&console.log("   power: using simplify_polar");return}if(DEBUG_POWER&&console.log("   power: nothing can be done "),push_symbol(POWER),push(p1),push(p2),list(3),DEBUG_POWER)return console.log("   power of "+e+" ^ "+n+": "+stack[tos-1])},power_sum=function(r){var t,e,n,o,i,a,s,u,f,l;for(t=[],e=0,o=0,a=0,a=length(p1)-1,push_frame(a*(r+1)),p1=cdr(p1),e=n=0,u=a;0<=u?n<u:n>u;e=0<=u?++n:--n){for(o=i=0,f=r;0<=f?i<=f:i>=f;o=0<=f?++i:--i)push(car(p1)),push_integer(o),power(),stack[frame+e*(r+1)+o]=pop();p1=cdr(p1)}for(push_integer(r),factorial(),p1=pop(),e=s=0,l=a;0<=l?s<l:s>l;e=0<=l?++s:--s)t[e]=0;return push(zero),multinomial_sum(a,r,t,0,r),pop_frame(a*(r+1))},multinomial_sum=function(r,t,e,n,o){var i,a,s,u,f,l,c;if(a=0,n<r-1){for(a=i=0,f=o;0<=f?i<=f:i>=f;a=0<=f?++i:--i)e[n]=a,multinomial_sum(r,t,e,n+1,o-a);return}for(e[n]=o,push(p1),a=s=0,l=r;0<=l?s<l:s>l;a=0<=l?++s:--s)push_integer(e[a]),factorial(),divide();for(a=u=0,c=r;0<=c?u<c:u>c;a=0<=c?++u:--u)push(stack[frame+a*(t+1)+e[a]]),multiply();return add()},simplify_polar=function(){var r,t;switch(t=0,t=isquarterturn(p2)){case 0:r=1;break;case 1:return push_integer(1),1;case 2:return push_integer(-1),1;case 3:return push(imaginaryunit),1;case 4:return push(imaginaryunit),negate(),1}if(car(p2)===symbol(ADD)){for(p3=cdr(p2);iscons(p3)&&!(t=isquarterturn(car(p3)));)p3=cdr(p3);switch(t){case 0:return 0;case 1:push_integer(1);break;case 2:push_integer(-1);break;case 3:push(imaginaryunit);break;case 4:push(imaginaryunit),negate()}return push(p2),push(car(p3)),subtract(),exponential(),multiply(),1}return 0},Eval_prime=function(){return push(cadr(p1)),Eval(),prime()},prime=function(){var r;return r=0,((r=pop_integer())<1||r>MAXPRIMETAB)&&stop("prime: Argument out of range."),r=primetab[r-1],push_integer(r)},power_str="^",codeGen=!1,Eval_print=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),printMode),push(symbol(NIL))},Eval_print2dascii=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_2DASCII),push(symbol(NIL))},Eval_printcomputer=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_COMPUTER),push(symbol(NIL))},Eval_printlatex=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_LATEX),push(symbol(NIL))},Eval_printhuman=function(){var r;return r=test_flag,test_flag=0,stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_HUMAN),test_flag=r,push(symbol(NIL))},Eval_printlist=function(){var r;return r=_print(cdr(p1),PRINTMODE_LIST),stringsEmittedByUserPrintouts+=r,push(symbol(NIL))},_print=function(r,t){var e,n;for(e="";iscons(r);)push(car(r)),Eval(),p2=pop(),n=printMode,t===PRINTMODE_COMPUTER?(printMode=PRINTMODE_COMPUTER,e=printline(p2),rememberPrint(e,LAST_FULL_PRINT)):t===PRINTMODE_HUMAN?(printMode=PRINTMODE_HUMAN,e=printline(p2),rememberPrint(e,LAST_PLAIN_PRINT)):t===PRINTMODE_2DASCII?(printMode=PRINTMODE_2DASCII,e=print2dascii(p2),rememberPrint(e,LAST_2DASCII_PRINT)):t===PRINTMODE_LATEX?(printMode=PRINTMODE_LATEX,e=printline(p2),rememberPrint(e,LAST_LATEX_PRINT)):t===PRINTMODE_LIST&&(printMode=PRINTMODE_LIST,e=print_list(p2),rememberPrint(e,LAST_LIST_PRINT)),printMode=n,r=cdr(r);return DEBUG&&console.log("emttedString from display: "+stringsEmittedByUserPrintouts),e},rememberPrint=function(r,t){var e;return scan('"'+r+'"'),e=pop(),set_binding(symbol(t),e)},print_str=function(r){return DEBUG&&console.log("emttedString from print_str: "+stringsEmittedByUserPrintouts),r},print_char=function(r){return r},collectLatexStringFromReturnValue=function(r){var t,e,n;return t=printMode,printMode=PRINTMODE_LATEX,e=codeGen,codeGen=!1,n=(n=print_expr(r)).replace(/_/g,"\\_"),printMode=t,codeGen=e,DEBUG&&console.log("emttedString from collectLatexStringFromReturnValue: "+stringsEmittedByUserPrintouts),n},printline=function(r){var t;return""+print_expr(r)},print_base_of_denom=function(r){var t;return t="",isfraction(r)||car(r)===symbol(ADD)||car(r)===symbol(MULTIPLY)||car(r)===symbol(POWER)||lessp(r,zero)?(t+=print_char("("),t+=print_expr(r),t+=print_char(")")):t+=print_expr(r),t},print_expo_of_denom=function(r){var t;return t="",isfraction(r)||car(r)===symbol(ADD)||car(r)===symbol(MULTIPLY)||car(r)===symbol(POWER)?(t+=print_char("("),t+=print_expr(r),t+=print_char(")")):t+=print_expr(r),t},print_denom=function(r,t){var e;return(e="",save(),p1=cadr(r),p2=caddr(r),isminusone(p2))?e+=print_base_of_denom(p1):(1===t&&(e+=print_char("(")),push(p2),negate(),p2=pop(),e+=print_power(p1,p2),1===t&&(e+=print_char(")"))),restore(),e},print_a_over_b=function(r){var t,e,n,o;for(t="",flag=0,o=0,e=0,save(),o=0,e=0,isrational(p2=car(p1=cdr(r)))?(push(p2),mp_numerator(),absval(),p3=pop(),push(p2),mp_denominator(),p4=pop(),!isplusone(p3)&&o++,!isplusone(p4)&&e++,p1=cdr(p1)):(p3=one,p4=one);iscons(p1);)p2=car(p1),is_denominator(p2)?e++:o++,p1=cdr(p1);if(printMode===PRINTMODE_LATEX&&(t+=print_str("\\frac{")),0===o)t+=print_char("1");else for(flag=0,isrational(car(p1=cdr(r)))&&(p1=cdr(p1)),isplusone(p3)||(t+=print_factor(p3),flag=1);iscons(p1);)p2=car(p1),is_denominator(p2)?n=1:(flag&&(t+=print_multiply_sign()),t+=print_factor(p2),flag=1),p1=cdr(p1);for(printMode===PRINTMODE_LATEX?t+=print_str("}{"):printMode!==PRINTMODE_HUMAN||test_flag?t+=print_str("/"):t+=print_str(" / "),e>1&&printMode!==PRINTMODE_LATEX&&(t+=print_char("(")),flag=0,isrational(car(p1=cdr(r)))&&(p1=cdr(p1)),isplusone(p4)||(t+=print_factor(p4),flag=1);iscons(p1);)p2=car(p1),is_denominator(p2)&&(flag&&(t+=print_multiply_sign()),t+=print_denom(p2,e),flag=1),p1=cdr(p1);return e>1&&printMode!==PRINTMODE_LATEX&&(t+=print_char(")")),printMode===PRINTMODE_LATEX&&(t+=print_str("}")),restore(),t},print_expr=function(r){var t;if(t="",isadd(r))for(r=cdr(r),"-"===sign_of_term(car(r))&&(t+=print_str("-")),t+=print_term(car(r)),r=cdr(r);iscons(r);)"+"===sign_of_term(car(r))?printMode!==PRINTMODE_HUMAN||test_flag?t+=print_str("+"):t+=print_str(" + "):printMode!==PRINTMODE_HUMAN||test_flag?t+=print_str("-"):t+=print_str(" - "),t+=print_term(car(r)),r=cdr(r);else"-"===sign_of_term(r)&&(t+=print_str("-")),t+=print_term(r);return t},sign_of_term=function(r){var t;return t="",car(r)===symbol(MULTIPLY)&&isNumericAtom(cadr(r))&&lessp(cadr(r),zero)||isNumericAtom(r)&&lessp(r,zero)?t+="-":t+="+",t},print_term=function(r){var t,e,n,o,i;if(t="",car(r)===symbol(MULTIPLY)&&any_denominators(r))return t+print_a_over_b(r);if(car(r)===symbol(MULTIPLY)){for(r=cdr(r),isminusone(car(r))&&(r=cdr(r)),i=!1,isNumericAtom(car(r))&&(i=!0),n=!1,printMode===PRINTMODE_LATEX&&iscons(cdr(r))&&isNumberOneOverSomething(car(r))&&(n=!0,e=car(r).q.b.toString()),n?(o=t,t=""):t+=print_factor(car(r)),r=cdr(r);iscons(r);)printMode===PRINTMODE_LATEX&&i&&caar(r)===symbol(POWER)&&isNumericAtom(car(cdr(car(r))))&&!isfraction(car(cdr(cdr(car(r)))))&&(t+=" \\cdot "),t+=print_multiply_sign(),t+=print_factor(car(r),!1,!0),i=!1,isNumericAtom(car(r))&&(i=!0),r=cdr(r);n&&(t=o+"\\frac{"+t+"}{"+e+"}")}else t+=print_factor(r);return t},print_subexpr=function(r){var t;return""+print_char("(")+print_expr(r)+print_char(")")},print_factorial_function=function(r){var t;return t="",r=cadr(r),isfraction(r)||car(r)===symbol(ADD)||car(r)===symbol(MULTIPLY)||car(r)===symbol(POWER)||car(r)===symbol(FACTORIAL)?t+=print_subexpr(r):t+=print_expr(r),t+=print_char("!")},print_ABS_latex=function(r){var t;return""+print_str("\\left |")+print_expr(cadr(r))+print_str(" \\right |")},print_BINOMIAL_latex=function(r){var t;return""+print_str("\\binom{")+print_expr(cadr(r))+print_str("}{")+print_expr(caddr(r))+print_str("} ")},print_DOT_latex=function(r){var t;return""+print_expr(cadr(r))+print_str(" \\cdot ")+print_expr(caddr(r))},print_DOT_codegen=function(r){var t;return"dot("+print_expr(cadr(r))+", "+print_expr(caddr(r))+")"},print_SIN_codegen=function(r){var t;return"Math.sin("+print_expr(cadr(r))+")"},print_COS_codegen=function(r){var t;return"Math.cos("+print_expr(cadr(r))+")"},print_TAN_codegen=function(r){var t;return"Math.tan("+print_expr(cadr(r))+")"},print_ARCSIN_codegen=function(r){var t;return"Math.asin("+print_expr(cadr(r))+")"},print_ARCCOS_codegen=function(r){var t;return"Math.acos("+print_expr(cadr(r))+")"},print_ARCTAN_codegen=function(r){var t;return"Math.atan("+print_expr(cadr(r))+")"},print_SQRT_latex=function(r){var t;return""+print_str("\\sqrt{")+print_expr(cadr(r))+print_str("} ")},print_TRANSPOSE_latex=function(r){var t;return t=""+print_str("{"),iscons(cadr(r))&&(t+=print_str("(")),t+=print_expr(cadr(r)),iscons(cadr(r))&&(t+=print_str(")")),t+=print_str("}"),t+=print_str("^T")},print_TRANSPOSE_codegen=function(r){var t;return""+print_str("transpose(")+print_expr(cadr(r))+print_str(")")},print_UNIT_codegen=function(r){var t;return""+print_str("identity(")+print_expr(cadr(r))+print_str(")")},print_INV_latex=function(r){var t;return t=""+print_str("{"),iscons(cadr(r))&&(t+=print_str("(")),t+=print_expr(cadr(r)),iscons(cadr(r))&&(t+=print_str(")")),t+=print_str("}"),t+=print_str("^{-1}")},print_INV_codegen=function(r){var t;return""+print_str("inv(")+print_expr(cadr(r))+print_str(")")},print_DEFINT_latex=function(r){var t,e,n,o,i,a,s,u,f;for(t="",e=car(cdr(r)),a=r=cdr(r),i=0;iscons(cdr(cdr(r)));)i++,u=cdr(cdr(r)),t+=print_str("\\int^{"),t+=print_expr(car(cdr(u))),t+=print_str("}_{"),t+=print_expr(car(u)),t+=print_str("} \\! "),r=cdr(u);for(t+=print_expr(e),t+=print_str(" \\,"),r=a,n=o=1,s=i;1<=s?o<=s:o>=s;n=1<=s?++o:--o)f=cdr(r),t+=print_str(" \\mathrm{d} "),t+=print_expr(car(f)),n<i&&(t+=print_str(" \\, ")),r=cdr(cdr(f));return t},print_tensor=function(r){var t;return""+print_tensor_inner(r,0,0)[1]},print_tensor_inner=function(r,t,e){var n,o,i,a,s,u,f;if(n=""+print_str("["),t<r.tensor.ndim-1)for(o=i=0,s=r.tensor.dim[t];0<=s?i<s:i>s;o=0<=s?++i:--i)[e,f]=print_tensor_inner(r,t+1,e),n+=f,o!==r.tensor.dim[t]-1&&(n+=print_str(","));else for(o=a=0,u=r.tensor.dim[t];0<=u?a<u:a>u;o=0<=u?++a:--a)n+=print_expr(r.tensor.elem[e]),o!==r.tensor.dim[t]-1&&(n+=print_str(",")),e++;return[e,n+=print_str("]")]},print_tensor_latex=function(r){var t;return t="",r.tensor.ndim<=2&&(t+=print_tensor_inner_latex(!0,r,0,0)[1]),t},print_tensor_inner_latex=function(r,t,e,n){var o,i,a,s,u,f,l;if(o="",r&&(o+="\\begin{bmatrix} "),e<t.tensor.ndim-1)for(i=a=0,u=t.tensor.dim[e];0<=u?a<u:a>u;i=0<=u?++a:--a)[n,l]=print_tensor_inner_latex(0,t,e+1,n),o+=l,i!==t.tensor.dim[e]-1&&(o+=print_str(" \\\\ "));else for(i=s=0,f=t.tensor.dim[e];0<=f?s<f:s>f;i=0<=f?++s:--s)o+=print_expr(t.tensor.elem[n]),i!==t.tensor.dim[e]-1&&(o+=print_str(" & ")),n++;return r&&(o+=" \\end{bmatrix}"),[n,o]},print_SUM_latex=function(r){var t;return"\\sum_{"+print_expr(caddr(r))+"="+print_expr(cadddr(r))+"}^{"+print_expr(caddddr(r))+"}{"+print_expr(cadr(r))+"}"},print_SUM_codegen=function(r){var t,e,n,o;return t=cadr(r),o=caddr(r),e=cadddr(r),n=caddddr(r),"(function(){ var "+o+";  var holderSum = 0;  var lowerlimit = "+print_expr(e)+";  var upperlimit = "+print_expr(n)+";  for ("+o+" = lowerlimit; "+o+" < upperlimit; "+o+"++) {    holderSum += "+print_expr(t)+"; }  return holderSum;})()"},print_TEST_latex=function(r){var t;for(t="\\left\\{ \\begin{array}{ll}",r=cdr(r);iscons(r);){if(cdr(r)===symbol(NIL)){t+="{",t+=print_expr(car(r)),t+="} & otherwise ",t+=" \\\\\\\\";break}t+="{",t+=print_expr(cadr(r)),t+="} & if & ",t+=print_expr(car(r)),t+=" \\\\\\\\",r=cddr(r)}return(t=t.substring(0,t.length-4))+"\\end{array} \\right."},print_TEST_codegen=function(r){var t,e;for(t="(function(){",r=cdr(r),e=0;iscons(r);){if(cdr(r)===symbol(NIL)){t+="else {return ("+print_expr(car(r))+");}";break}e&&(t+=" else "),t+="if ("+print_expr(car(r))+"){"+("return ("+print_expr(cadr(r)))+");}",e++,r=cddr(r)}return t+"})()"},print_TESTLT_latex=function(r){var t;return(t="{"+print_expr(cadr(r))+"} < {"+print_expr(caddr(r)))+"}"},print_TESTLE_latex=function(r){var t;return(t="{"+print_expr(cadr(r))+"} \\leq {"+print_expr(caddr(r)))+"}"},print_TESTGT_latex=function(r){var t;return(t="{"+print_expr(cadr(r))+"} > {"+print_expr(caddr(r)))+"}"},print_TESTGE_latex=function(r){var t;return(t="{"+print_expr(cadr(r))+"} \\geq {"+print_expr(caddr(r)))+"}"},print_TESTEQ_latex=function(r){var t;return(t="{"+print_expr(cadr(r))+"} = {"+print_expr(caddr(r)))+"}"},print_FOR_codegen=function(r){var t,e,n,o;return t=cadr(r),o=caddr(r),e=cadddr(r),n=caddddr(r),"(function(){ var "+o+";  var lowerlimit = "+print_expr(e)+";  var upperlimit = "+print_expr(n)+";  for ("+o+" = lowerlimit; "+o+" < upperlimit; "+o+"++) {    "+print_expr(t)+" } })()"},print_DO_codegen=function(r){var t;for(t="",r=cdr(r);iscons(r);)t+=print_expr(car(r)),r=cdr(r);return t},print_SETQ_codegen=function(r){var t;return""+print_expr(cadr(r))+" = "+print_expr(caddr(r))+"; "},print_PRODUCT_latex=function(r){var t;return"\\prod_{"+print_expr(caddr(r))+"="+print_expr(cadddr(r))+"}^{"+print_expr(caddddr(r))+"}{"+print_expr(cadr(r))+"}"},print_PRODUCT_codegen=function(r){var t,e,n,o;return t=cadr(r),o=caddr(r),e=cadddr(r),n=caddddr(r),"(function(){ var "+o+";  var holderProduct = 1;  var lowerlimit = "+print_expr(e)+";  var upperlimit = "+print_expr(n)+";  for ("+o+" = lowerlimit; "+o+" < upperlimit; "+o+"++) {    holderProduct *= "+print_expr(t)+"; }  return holderProduct;})()"},print_base=function(r){var t;return t="",isadd(cadr(r))||caadr(r)===symbol(MULTIPLY)||caadr(r)===symbol(POWER)||isnegativenumber(cadr(r))?(t+=print_str("("),t+=print_expr(cadr(r)),t+=print_str(")")):isNumericAtom(cadr(r))&&(lessp(cadr(r),zero)||isfraction(cadr(r)))?(t+=print_str("("),t+=print_factor(cadr(r)),t+=print_str(")")):t+=print_factor(cadr(r)),t},print_exponent=function(r){var t;return t="",iscons(caddr(r))||isfraction(caddr(r))||isNumericAtom(caddr(r))&&lessp(caddr(r),zero)?(t+=print_str("("),t+=print_expr(caddr(r)),t+=print_str(")")):t+=print_factor(caddr(r)),t},print_power=function(r,t){var e,n,o;if(e="",DEBUG&&console.log("power base: "+r+"  exponent: "+t),isoneovertwo(t)){if(equaln(r,2)){if(codeGen)return e+print_str("Math.SQRT2")}else if(printMode===PRINTMODE_LATEX)return e+=print_str("\\sqrt{"),e+=print_expr(r),e+=print_str("}");else if(codeGen)return e+=print_str("Math.sqrt("),e+=print_expr(r),e+=print_str(")")}if(equaln(get_binding(symbol(PRINT_LEAVE_E_ALONE)),1)&&r===symbol(E))return codeGen?(e+=print_str("Math.exp("),e+=print_expo_of_denom(t),e+=print_str(")")):(printMode===PRINTMODE_LATEX?(e+=print_str("e^{"),e+=print_expr(t),e+=print_str("}")):(e+=print_str("exp("),e+=print_expr(t),e+=print_str(")")),e);if(codeGen)return e+=print_str("Math.pow("),e+=print_base_of_denom(r),e+=print_str(", "),e+=print_expo_of_denom(t),e+=print_str(")");if(equaln(get_binding(symbol(PRINT_LEAVE_X_ALONE)),0)||"x"!==r.printname){if(r!==symbol(E)){if(isminusone(t))return printMode===PRINTMODE_LATEX?e+=print_str("\\frac{1}{"):printMode!==PRINTMODE_HUMAN||test_flag?e+=print_str("1/"):e+=print_str("1 / "),iscons(r)&&printMode!==PRINTMODE_LATEX?(e+=print_str("("),e+=print_expr(r),e+=print_str(")")):e+=print_expr(r),printMode===PRINTMODE_LATEX&&(e+=print_str("}")),e;if(isnegativeterm(t))return printMode===PRINTMODE_LATEX?e+=print_str("\\frac{1}{"):printMode!==PRINTMODE_HUMAN||test_flag?e+=print_str("1/"):e+=print_str("1 / "),push(t),push_integer(-1),multiply(),o=pop(),iscons(r)&&printMode!==PRINTMODE_LATEX?(e+=print_str("("),e+=print_power(r,o),e+=print_str(")")):e+=print_power(r,o),printMode===PRINTMODE_LATEX&&(e+=print_str("}")),e}if(isfraction(t)&&printMode===PRINTMODE_LATEX)return e+=print_str("\\sqrt"),push(t),denominator(),isplustwo(n=pop())||(e+=print_str("["),e+=print_expr(n),e+=print_str("]")),e+=print_str("{"),push(t),numerator(),t=pop(),e+=print_power(r,t),e+=print_str("}")}return printMode===PRINTMODE_LATEX&&isplusone(t)?e+=print_expr(r):(isadd(r)||isnegativenumber(r)?(e+=print_str("("),e+=print_expr(r),e+=print_str(")")):car(r)===symbol(MULTIPLY)||car(r)===symbol(POWER)?(printMode!==PRINTMODE_LATEX&&(e+=print_str("(")),e+=print_factor(r,!0),printMode!==PRINTMODE_LATEX&&(e+=print_str(")"))):isNumericAtom(r)&&(lessp(r,zero)||isfraction(r))?(e+=print_str("("),e+=print_factor(r),e+=print_str(")")):e+=print_factor(r),printMode!==PRINTMODE_HUMAN||test_flag?e+=print_str("^"):e+=print_str(power_str),printMode===PRINTMODE_LATEX?print_expr(t).length>1?(e+=print_str("{"),e+=print_expr(t),e+=print_str("}")):e+=print_expr(t):iscons(t)||isfraction(t)||isNumericAtom(t)&&lessp(t,zero)?(e+=print_str("("),e+=print_expr(t),e+=print_str(")")):e+=print_factor(t)),e},print_index_function=function(r){var t;if(t="",caar(r=cdr(r))===symbol(ADD)||caar(r)===symbol(MULTIPLY)||caar(r)===symbol(POWER)||caar(r)===symbol(FACTORIAL)?t+=print_subexpr(car(r)):t+=print_expr(car(r)),t+=print_str("["),iscons(r=cdr(r)))for(t+=print_expr(car(r)),r=cdr(r);iscons(r);)t+=print_str(","),t+=print_expr(car(r)),r=cdr(r);return t+print_str("]")},print_factor=function(r,t,e){var n,o,i,a,s;if(n="",isNumericAtom(r))return e&&lessp(r,zero)&&(n+="("),n+=print_number(r,e),e&&lessp(r,zero)&&(n+=")"),n;if(isstr(r))return n+=print_str('"'),n+=print_str(r.str),n+=print_str('"');if(istensor(r))return printMode===PRINTMODE_LATEX?n+=print_tensor_latex(r):n+=print_tensor(r),n;if(car(r)===symbol(MULTIPLY))return t||"-"!==sign_of_term(r)&&printMode===PRINTMODE_LATEX||(printMode===PRINTMODE_LATEX?n+=print_str(" \\left ("):n+=print_str("(")),n+=print_expr(r),t||"-"!==sign_of_term(r)&&printMode===PRINTMODE_LATEX||(printMode===PRINTMODE_LATEX?n+=print_str(" \\right ) "):n+=print_str(")")),n;if(isadd(r))return t||(n+=print_str("(")),n+=print_expr(r),t||(n+=print_str(")")),n;if(car(r)===symbol(POWER))return o=cadr(r),i=caddr(r),n+=print_power(o,i);if(car(r)===symbol(FUNCTION))return a=cadr(r),codeGen||(s=caddr(r),n+=print_str("function "),DEBUG&&console.log("emittedString from print_factor "+stringsEmittedByUserPrintouts),n+=print_list(s),n+=print_str(" -> ")),n+=print_expr(a);if(car(r)===symbol(PATTERN))return n+=print_expr(caadr(r)),printMode===PRINTMODE_LATEX?n+=print_str(" \\rightarrow "):printMode!==PRINTMODE_HUMAN||test_flag?n+=print_str("->"):n+=print_str(" -> "),n+=print_expr(car(cdr(cadr(r))));if(car(r)===symbol(INDEX)&&issymbol(cadr(r)))return n+print_index_function(r);if(car(r)===symbol(FACTORIAL))return n+print_factorial_function(r);if(car(r)===symbol(ABS)&&printMode===PRINTMODE_LATEX)return n+print_ABS_latex(r);if(car(r)===symbol(SQRT)&&printMode===PRINTMODE_LATEX)return n+print_SQRT_latex(r);if(car(r)===symbol(TRANSPOSE)){if(printMode===PRINTMODE_LATEX)return n+print_TRANSPOSE_latex(r);else if(codeGen)return n+print_TRANSPOSE_codegen(r)}else if(car(r)===symbol(UNIT)){if(codeGen)return n+print_UNIT_codegen(r)}else if(car(r)===symbol(INV)){if(printMode===PRINTMODE_LATEX)return n+print_INV_latex(r);else if(codeGen)return n+print_INV_codegen(r)}else if(car(r)===symbol(BINOMIAL)&&printMode===PRINTMODE_LATEX)return n+print_BINOMIAL_latex(r);else if(car(r)===symbol(DEFINT)&&printMode===PRINTMODE_LATEX)return n+print_DEFINT_latex(r);else if(isinnerordot(r)){if(printMode===PRINTMODE_LATEX)return n+print_DOT_latex(r);else if(codeGen)return n+print_DOT_codegen(r)}else if(car(r)===symbol(SIN)){if(codeGen)return n+print_SIN_codegen(r)}else if(car(r)===symbol(COS)){if(codeGen)return n+print_COS_codegen(r)}else if(car(r)===symbol(TAN)){if(codeGen)return n+print_TAN_codegen(r)}else if(car(r)===symbol(ARCSIN)){if(codeGen)return n+print_ARCSIN_codegen(r)}else if(car(r)===symbol(ARCCOS)){if(codeGen)return n+print_ARCCOS_codegen(r)}else if(car(r)===symbol(ARCTAN)){if(codeGen)return n+print_ARCTAN_codegen(r)}else if(car(r)===symbol(SUM)){if(printMode===PRINTMODE_LATEX)return n+print_SUM_latex(r);else if(codeGen)return n+print_SUM_codegen(r)}else if(car(r)===symbol(PRODUCT)){if(printMode===PRINTMODE_LATEX)return n+print_PRODUCT_latex(r);else if(codeGen)return n+print_PRODUCT_codegen(r)}else if(car(r)===symbol(FOR)){if(codeGen)return n+print_FOR_codegen(r)}else if(car(r)===symbol(DO)){if(codeGen)return n+print_DO_codegen(r)}else if(car(r)===symbol(TEST)){if(codeGen)return n+print_TEST_codegen(r);if(printMode===PRINTMODE_LATEX)return n+print_TEST_latex(r)}else if(car(r)===symbol(TESTLT)){if(codeGen)return n+("(("+print_expr(cadr(r))+") < ("+print_expr(caddr(r))+"))");if(printMode===PRINTMODE_LATEX)return n+print_TESTLT_latex(r)}else if(car(r)===symbol(TESTLE)){if(codeGen)return n+("(("+print_expr(cadr(r))+") <= ("+print_expr(caddr(r))+"))");if(printMode===PRINTMODE_LATEX)return n+print_TESTLE_latex(r)}else if(car(r)===symbol(TESTGT)){if(codeGen)return n+("(("+print_expr(cadr(r))+") > ("+print_expr(caddr(r))+"))");if(printMode===PRINTMODE_LATEX)return n+print_TESTGT_latex(r)}else if(car(r)===symbol(TESTGE)){if(codeGen)return n+("(("+print_expr(cadr(r))+") >= ("+print_expr(caddr(r))+"))");if(printMode===PRINTMODE_LATEX)return n+print_TESTGE_latex(r)}else if(car(r)===symbol(TESTEQ)){if(codeGen)return n+("(("+print_expr(cadr(r))+") === ("+print_expr(caddr(r))+"))");if(printMode===PRINTMODE_LATEX)return n+print_TESTEQ_latex(r)}else if(car(r)===symbol(FLOOR)){if(codeGen)return n+("Math.floor("+print_expr(cadr(r))+")");if(printMode===PRINTMODE_LATEX)return n+(" \\lfloor {"+print_expr(cadr(r))+"} \\rfloor ")}else if(car(r)===symbol(CEILING)){if(codeGen)return n+("Math.ceiling("+print_expr(cadr(r))+")");if(printMode===PRINTMODE_LATEX)return n+(" \\lceil {"+print_expr(cadr(r))+"} \\rceil ")}else if(car(r)===symbol(ROUND)){if(codeGen)return n+("Math.round("+print_expr(cadr(r))+")")}else if(car(r)===symbol(SETQ))if(codeGen)return n+print_SETQ_codegen(r);else return n+=print_expr(cadr(r)),n+=print_str("="),n+=print_expr(caddr(r));if(iscons(r)){if(n+=print_factor(car(r)),r=cdr(r),t||(n+=print_str("(")),iscons(r))for(n+=print_expr(car(r)),r=cdr(r);iscons(r);)n+=print_str(","),n+=print_expr(car(r)),r=cdr(r);return t||(n+=print_str(")")),n}return r===symbol(DERIVATIVE)?n+=print_char("d"):r===symbol(E)?codeGen?n+=print_str("Math.E"):n+=print_str("e"):r===symbol(PI)?printMode===PRINTMODE_LATEX?n+=print_str("\\pi"):n+=print_str("pi"):n+=print_str(get_printname(r)),n},print_list=function(r){var t;switch(t="",r.k){case CONS:for(t+="(",t+=print_list(car(r)),r===cdr(r)&&r!==symbol(NIL)&&console.log("oh no recursive!"),r=cdr(r);iscons(r);)t+=" ",t+=print_list(car(r)),(r=cdr(r))===cdr(r)&&r!==symbol(NIL)&&console.log("oh no recursive!");r!==symbol(NIL)&&(t+=" . ",t+=print_list(r)),t+=")";break;case STR:t+=r.str;break;case NUM:case DOUBLE:t+=print_number(r,!0);break;case SYM:t+=get_printname(r);break;default:t+="<tensor>"}return t},print_multiply_sign=function(){var r;if(r="",printMode===PRINTMODE_LATEX)if(printMode!==PRINTMODE_HUMAN||test_flag)return r;else r+=print_str(" ");return printMode!==PRINTMODE_HUMAN||test_flag||codeGen?r+=print_str("*"):r+=print_str(" "),r},is_denominator=function(r){return car(r)===symbol(POWER)&&cadr(r)!==symbol(E)&&isnegativeterm(caddr(r))?1:0},any_denominators=function(r){var t;for(r=cdr(r);iscons(r);){if(t=car(r),is_denominator(t))return 1;r=cdr(r)}return 0},YMAX=1e4,glyph=(function(){class r{}return r.prototype.c=0,r.prototype.x=0,r.prototype.y=0,r}).call(this),chartab=[],charTabIndex=i1=0,ref1=YMAX;0<=ref1?i1<ref1:i1>ref1;charTabIndex=0<=ref1?++i1:--i1)chartab[charTabIndex]=new glyph;for(yindex=0,level=0,emit_x=0,expr_level=0,display_flag=0,printchar_nowrap=function(r){var t;return""+r},printchar=function(r){return printchar_nowrap(r)},print2dascii=function(r){var t,e,n,o;if(e=0,n=0,o=0,save(),yindex=0,level=0,emit_x=0,emit_top_expr(r),[e,n,o]=get_size(0,yindex),n>100){printline(r),restore();return}return t=print_glyphs(),restore(),t},emit_top_expr=function(r){if(car(r)===symbol(SETQ)){emit_expr(cadr(r)),__emit_str(" = "),emit_expr(caddr(r));return}return istensor(r)?emit_tensor(r):emit_expr(r)},will_be_displayed_as_fraction=function(r){if(level>0)return 0;if(isfraction(r))return 1;if(car(r)!==symbol(MULTIPLY))return 0;if(isfraction(cadr(r)))return 1;for(;iscons(r);){if(isdenominator(car(r)))return 1;r=cdr(r)}return 0},emit_expr=function(r){if(expr_level++,car(r)===symbol(ADD))for(r=cdr(r),__is_negative(car(r))&&(__emit_char("-"),will_be_displayed_as_fraction(car(r))&&__emit_char(" ")),emit_term(car(r)),r=cdr(r);iscons(r);)__is_negative(car(r))?(__emit_char(" "),__emit_char("-")):(__emit_char(" "),__emit_char("+")),__emit_char(" "),emit_term(car(r)),r=cdr(r);else __is_negative(r)&&(__emit_char("-"),will_be_displayed_as_fraction(r)&&__emit_char(" ")),emit_term(r);return expr_level--},emit_unsigned_expr=function(r){var t;if(car(r)!==symbol(ADD))return emit_term(r);for(r=cdr(r),emit_term(car(r)),r=cdr(r),t=[];iscons(r);)__is_negative(car(r))?(__emit_char(" "),__emit_char("-")):(__emit_char(" "),__emit_char("+")),__emit_char(" "),emit_term(car(r)),t.push(r=cdr(r));return t},__is_negative=function(r){return isnegativenumber(r)||car(r)===symbol(MULTIPLY)&&isnegativenumber(cadr(r))?1:0},emit_term=function(r){var t;return car(r)!==symbol(MULTIPLY)?emit_factor(r):(t=count_denominators(r))&&0===level?emit_fraction(r,t):emit_multiply(r,t)},isdenominator=function(r){return car(r)===symbol(POWER)&&cadr(r)!==symbol(E)&&__is_negative(caddr(r))?1:0},count_denominators=function(r){var t,e;for(t=0,r=cdr(r);iscons(r);)e=car(r),isdenominator(e)&&t++,r=cdr(r);return t},emit_multiply=function(r,t){var e;if(0===t){for(r=cdr(r),(isplusone(car(r))||isminusone(car(r)))&&(r=cdr(r)),emit_factor(car(r)),r=cdr(r),e=[];iscons(r);)__emit_char(" "),emit_factor(car(r)),e.push(r=cdr(r));return e}return(emit_numerators(r),__emit_char("/"),t>1||isfraction(cadr(r)))?(__emit_char("("),emit_denominators(r),__emit_char(")")):emit_denominators(r)},emit_fraction=function(r,t){var e,n,o,i,a,s;for(e=0,o=0,i=0,a=0,s=0,save(),p3=one,p4=one,isrational(cadr(r))&&(push(cadr(r)),mp_numerator(),absval(),p3=pop(),push(cadr(r)),mp_denominator(),p4=pop()),isdouble(cadr(r))&&(push(cadr(r)),absval(),p3=pop()),a=+!isplusone(p3),isNumericAtom(car(p1=cdr(r)))&&(p1=cdr(p1));iscons(p1);)p2=car(p1),isdenominator(p2)?n=1:a++,p1=cdr(p1);for(s=emit_x,o=yindex,e=0,!isplusone(p3)&&(emit_number(p3,0),e++),isNumericAtom(car(p1=cdr(r)))&&(p1=cdr(p1));iscons(p1);)p2=car(p1),isdenominator(p2)?n=1:(e>0&&__emit_char(" "),1===a?emit_expr(p2):emit_factor(p2),e++),p1=cdr(p1);for(0===e&&__emit_char("1"),i=yindex,e=0,!isplusone(p4)&&(emit_number(p4,0),e++,t++),isrational(car(p1=cdr(r)))&&(p1=cdr(p1));iscons(p1);)p2=car(p1),isdenominator(p2)&&(e>0&&__emit_char(" "),emit_denominator(p2,t),e++),p1=cdr(p1);return fixup_fraction(s,o,i),restore()},emit_numerators=function(r){var t,e;for(save(),e=0,p1=one,isrational(car(r=cdr(r)))?(push(car(r)),mp_numerator(),absval(),p1=pop(),r=cdr(r)):isdouble(car(r))&&(push(car(r)),absval(),p1=pop(),r=cdr(r)),e=0,!isplusone(p1)&&(emit_number(p1,0),e++);iscons(r);)isdenominator(car(r))?t=1:(e>0&&__emit_char(" "),emit_factor(car(r)),e++),r=cdr(r);return 0===e&&__emit_char("1"),restore()},emit_denominators=function(r){var t;for(save(),t=0,r=cdr(r),isfraction(car(r))&&(push(car(r)),mp_denominator(),p1=pop(),emit_number(p1,0),t++,r=cdr(r));iscons(r);)isdenominator(car(r))&&(t>0&&__emit_char(" "),emit_denominator(car(r),0),t++),r=cdr(r);return restore()},emit_factor=function(r){istensor(r)?emit_flat_tensor(r):isdouble(r)?emit_number(r,0):car(r)===symbol(ADD)||car(r)===symbol(MULTIPLY)?emit_subexpr(r):car(r)===symbol(POWER)?emit_power(r):iscons(r)?emit_function(r):isNumericAtom(r)?0===level?emit_numerical_fraction(r):emit_number(r,0):issymbol(r)?emit_symbol(r):isstr(r)&&emit_string(r)},emit_numerical_fraction=function(r){var t,e,n;if(t=0,e=0,n=0,save(),push(r),mp_numerator(),absval(),p3=pop(),push(r),mp_denominator(),p4=pop(),isplusone(p4)){emit_number(p3,0),restore();return}return n=emit_x,t=yindex,emit_number(p3,0),e=yindex,emit_number(p4,0),fixup_fraction(n,t,e),restore()},isfactor=function(r){return iscons(r)&&car(r)!==symbol(ADD)&&car(r)!==symbol(MULTIPLY)&&car(r)!==symbol(POWER)||issymbol(r)?1:isfraction(r)||isnegativenumber(r)?0:+!!isNumericAtom(r)},emit_power=function(r){var t,e,n;if(t=0,e=0,n=0,cadr(r)===symbol(E)){__emit_str("exp("),emit_expr(caddr(r)),__emit_char(")");return}if(level>0)return void(isminusone(caddr(r))?(__emit_char("1"),__emit_char("/"),isfactor(cadr(r))?emit_factor(cadr(r)):emit_subexpr(cadr(r))):(isfactor(cadr(r))?emit_factor(cadr(r)):emit_subexpr(cadr(r)),__emit_char("^"),isfactor(caddr(r))?emit_factor(caddr(r)):emit_subexpr(caddr(r))));if(__is_negative(caddr(r))){n=emit_x,t=yindex,__emit_char("1"),e=yindex,emit_denominator(r,1),fixup_fraction(n,t,e);return}return t=yindex,isfactor(cadr(r))?emit_factor(cadr(r)):emit_subexpr(cadr(r)),e=yindex,level++,emit_expr(caddr(r)),level--,fixup_power(t,e)},emit_denominator=function(r,t){var e,n;return(e=0,n=0,isminusone(caddr(r)))?void(1===t?emit_expr(cadr(r)):emit_factor(cadr(r))):(e=yindex,isfactor(cadr(r))?emit_factor(cadr(r)):emit_subexpr(cadr(r)),n=yindex,level++,emit_unsigned_expr(caddr(r)),level--,fixup_power(e,n))},emit_function=function(r){if(car(r)===symbol(INDEX)&&issymbol(cadr(r)))return void emit_index_function(r);if(car(r)===symbol(FACTORIAL))return void emit_factorial_function(r);if(car(r)===symbol(DERIVATIVE)?__emit_char("d"):emit_symbol(car(r)),__emit_char("("),iscons(r=cdr(r)))for(emit_expr(car(r)),r=cdr(r);iscons(r);)__emit_char(","),emit_expr(car(r)),r=cdr(r);return __emit_char(")")},emit_index_function=function(r){if(caar(r=cdr(r))===symbol(ADD)||caar(r)===symbol(MULTIPLY)||caar(r)===symbol(POWER)||caar(r)===symbol(FACTORIAL)?emit_subexpr(car(r)):emit_expr(car(r)),__emit_char("["),iscons(r=cdr(r)))for(emit_expr(car(r)),r=cdr(r);iscons(r);)__emit_char(","),emit_expr(car(r)),r=cdr(r);return __emit_char("]")},emit_factorial_function=function(r){return r=cadr(r),isfraction(r)||car(r)===symbol(ADD)||car(r)===symbol(MULTIPLY)||car(r)===symbol(POWER)||car(r)===symbol(FACTORIAL)?emit_subexpr(r):emit_expr(r),__emit_char("!")},emit_subexpr=function(r){return __emit_char("("),emit_expr(r),__emit_char(")")},emit_symbol=function(r){var t,e,n,o,i;if(t=0,r===symbol(E))return void __emit_str("exp(1)");for(n=get_printname(r),i=[],t=e=0,o=n.length;0<=o?e<o:e>o;t=0<=o?++e:--e)i.push(__emit_char(n[t]));return i},emit_string=function(r){var t,e,n,o;for(t=0,n=r.str,__emit_char('"'),t=e=0,o=n.length;0<=o?e<o:e>o;t=0<=o?++e:--e)__emit_char(n[t]);return __emit_char('"')},fixup_fraction=function(r,t,e){var n,o,i,a,s,u,f,l,c,p,x,g,h,d;for(n=0,o=0,s=0,c=0,g=0,i=0,p=0,h=0,a=0,x=0,d=0,[i,p,h]=get_size(t,e),[a,x,d]=get_size(e,yindex),n=x>p?(x-p)/2:0,n++,o=-(g=h+i-1)-1,move(t,e,n,o),n=x>p?-p:-p+(p-x)/2,n++,move(e,yindex,n,o=-d+1),c=(x>p?x:p)+2,emit_x=r,l=[],s=u=0,f=c;0<=f?u<f:u>f;s=0<=f?++u:--u)l.push(__emit_char("-"));return l},fixup_power=function(r,t){var e,n,o,i,a,s,u;return e=0,n=0,i=0,s=0,o=0,a=0,u=0,[n,i,s]=get_size(r,t),[o,a,u]=get_size(t,yindex),move(t,yindex,0,e=-u-o+1+(s-1))},move=function(r,t,e,n){var o,i,a,s,u;for(o=0,u=[],o=i=a=r,s=t;a<=s?i<s:i>s;o=a<=s?++i:--i)chartab[o].x+=e,u.push(chartab[o].y+=n);return u},get_size=function(r,t){var e,n,o,i,a,s,u,f;for(e=0,a=chartab[r].x,o=chartab[r].x,s=chartab[r].y,i=chartab[r].y,e=n=u=r+1,f=t;u<=f?n<f:n>f;e=u<=f?++n:--n)chartab[e].x<a&&(a=chartab[e].x),chartab[e].x>o&&(o=chartab[e].x),chartab[e].y<s&&(s=chartab[e].y),chartab[e].y>i&&(i=chartab[e].y);return[i-s+1,o-a+1,s]},displaychar=function(r){return __emit_char(r)},__emit_char=function(r){if(yindex!==YMAX)return chartab[yindex],chartab[yindex].c=r,chartab[yindex].x=emit_x,chartab[yindex].y=0,yindex++,emit_x++},__emit_str=function(r){var t,e,n,o;for(t=0,o=[],t=e=0,n=r.length;0<=n?e<n:e>n;t=0<=n?++e:--e)o.push(__emit_char(r[t]));return o},emit_number=function(r,t){var e,n,o,i,a,s,u,f,l,c;switch(c="",e=0,r.k){case NUM:for("-"===(c=r.q.a.toString())[0]&&0===t&&(c=c.substring(1)),e=n=0,a=c.length;0<=a?n<a:n>a;e=0<=a?++n:--n)__emit_char(c[e]);if("1"===(c=r.q.b.toString()))break;for(__emit_char("/"),f=[],e=o=0,s=c.length;0<=s?o<s:o>s;e=0<=s?++o:--o)f.push(__emit_char(c[e]));return f;case DOUBLE:for("-"===(c=doubleToReasonableString(r.d))[0]&&0===t&&(c=c.substring(1)),l=[],e=i=0,u=c.length;0<=u?i<u:i>u;e=0<=u?++i:--i)l.push(__emit_char(c[e]));return l}},cmpGlyphs=function(r,t){return r.y<t.y?-1:r.y>t.y?1:r.x<t.x?-1:+(r.x>t.x)},print_glyphs=function(){var r,t,e,n,o,i,a;for(t=0,r="",(o=chartab.slice(0,yindex)).sort(cmpGlyphs),chartab=[].concat(o).concat(chartab.slice(yindex)),i=0,a=chartab[0].y,t=e=0,n=yindex;0<=n?e<n:e>n;t=0<=n?++e:--e){for(;chartab[t].y>a;)r+=printchar("\n"),i=0,a++;for(;chartab[t].x>i;)r+=printchar_nowrap(" "),i++;r+=printchar_nowrap(chartab[t].c),i++}return r},buffer="",getdisplaystr=function(){return yindex=0,level=0,emit_x=0,emit_expr(pop()),fill_buf(),buffer},fill_buf=function(){var r,t,e,n,o,i,a,s;for(i=buffer,n=0,r=0,(o=chartab.slice(0,yindex)).sort(cmpGlyphs),chartab=[].concat(o).concat(chartab.slice(yindex)),a=0,s=chartab[0].y,r=t=0,e=yindex;0<=e?t<e:t>e;r=0<=e?++t:--t){for(;chartab[r].y>s;)i[n++]="\n",a=0,s++;for(;chartab[r].x>a;)i[n++]=" ",a++;i[n++]=chartab[r].c,a++}return i[n++]="\n"},N=100,oneElement=(function(){class r{}return r.prototype.x=0,r.prototype.y=0,r.prototype.h=0,r.prototype.w=0,r.prototype.index=0,r.prototype.count=0,r}).call(this),elem=[],elelmIndex=j1=0;j1<1e4;elelmIndex=++j1)elem[elelmIndex]=new oneElement;SPACE_BETWEEN_COLUMNS=3,SPACE_BETWEEN_ROWS=1,emit_tensor=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k;if(s=0,l=0,x=0,p=0,q=0,k=0,a=0,y=0,e=0,n=0,o=0,i=0,b=0,t=0,r.tensor.ndim>2||(l=(x=r.tensor.dim[0])*(p=2===r.tensor.ndim?r.tensor.dim[1]:1))>N)return void emit_flat_tensor(r);for(q=emit_x,s=u=0,h=l;0<=h?u<h:u>h;s=0<=h?++u:--u)elem[s].index=yindex,elem[s].x=emit_x,emit_expr(r.tensor.elem[s]),elem[s].count=yindex-elem[s].index,[elem[s].h,elem[s].w,elem[s].y]=get_size(elem[s].index,yindex);for(o=0,i=0,s=f=0,d=l;0<=d?f<d:f>d;s=0<=d?++f:--f)elem[s].h>o&&(o=elem[s].h),elem[s].w>i&&(i=elem[s].w);for(a=x*o+(x-1)*SPACE_BETWEEN_ROWS,y=p*i+(p-1)*SPACE_BETWEEN_COLUMNS,k=-(a/2),b=c=0,m=x;0<=m?c<m:c>m;b=0<=m?++c:--c)for(t=g=0,v=p;0<=v?g<v:g>v;t=0<=v?++g:--g)e=q-elem[s=b*p+t].x,n=k-elem[s].y,move(elem[s].index,elem[s].index+elem[s].count,e,n),e=0,t>0&&(e=t*(i+SPACE_BETWEEN_COLUMNS)),n=0,b>0&&(n=b*(o+SPACE_BETWEEN_ROWS)),e+=(i-elem[s].w)/2,n+=(o-elem[s].h)/2,move(elem[s].index,elem[s].index+elem[s].count,e,n);return emit_x=q+y},emit_flat_tensor=function(r){return emit_tensor_inner(r,0,0)},emit_tensor_inner=function(r,t,e){var n,o,i;for(n=0,__emit_char("("),n=o=0,i=r.tensor.dim[t];0<=i?o<i:o>i;n=0<=i?++o:--o)t+1===r.tensor.ndim?(emit_expr(r.tensor.elem[e]),e+=1):e=emit_tensor_inner(r,t+1,e),n+1<r.tensor.dim[t]&&__emit_char(",");return __emit_char(")"),e},Eval_product=function(){var r,t,e,n,o,i,a,s,u;if(t=0,n=0,o=0,r=cadr(p1),issymbol(e=caddr(p1))||stop("sum: 2nd arg?"),push(cadddr(p1)),Eval(),isNaN(n=pop_integer())||(push(caddddr(p1)),Eval(),isNaN(o=pop_integer())))return void push(p1);for(a=get_binding(e),push_integer(1),t=i=s=n,u=o;s<=u?i<=u:i>=u;t=s<=u?++i:--i)push_integer(t),p5=pop(),set_binding(e,p5),push(r),Eval(),DEBUG&&(console.log("product - factor 1: "+stack[tos-1].toString()),console.log("product - factor 2: "+stack[tos-2].toString())),multiply(),DEBUG&&console.log("product - result: "+stack[tos-1].toString());return set_binding(e,a)},qadd=function(){var r,t,e,n,o,i;return(n=pop(),e=pop(),MZERO(o=madd(mmul(e.q.a,n.q.b),mmul(e.q.b,n.q.a))))?void push(zero):(t=mmul(e.q.b,n.q.b),r=makeSignSameAs(r=mgcd(o,t),t),(i=new U).k=NUM,i.q.a=mdiv(o,r),i.q.b=mdiv(t,r),push(i))},qdiv=function(){var r,t,e;if(save(),p2=pop(),p1=pop(),MZERO(p2.q.a)&&stop("divide by zero"),MZERO(p1.q.a)){push(zero),restore();return}return r=mmul(p1.q.a,p2.q.b),t=mmul(p1.q.b,p2.q.a),e=makeSignSameAs(e=mgcd(r,t),t),(p1=new U).k=NUM,p1.q.a=mdiv(r,e),p1.q.b=mdiv(t,e),push(p1),restore()},qmul=function(){var r,t,e;if(save(),p2=pop(),MZERO((p1=pop()).q.a)||MZERO(p2.q.a)){push(zero),restore();return}return r=mmul(p1.q.a,p2.q.a),t=mmul(p1.q.b,p2.q.b),e=makeSignSameAs(e=mgcd(r,t),t),(p1=new U).k=NUM,p1.q.a=mdiv(r,e),p1.q.b=mdiv(t,e),push(p1),restore()},qpow=function(){return save(),qpowf(),restore()},qpowf=function(){var r,t,e,n,o,i;if(e=0,p2=pop(),p1=pop(),isplusone(p1)||isZeroAtomOrTensor(p2))return void push_integer(1);if(isminusone(p1)&&isoneovertwo(p2))return void push(imaginaryunit);if(isZeroAtomOrTensor(p1)){isnegativenumber(p2)&&stop("divide by zero"),push(zero);return}if(isplusone(p2))return void push(p1);if(isinteger(p2)){if(push(p2),isNaN(e=pop_integer())){push_symbol(POWER),push(p1),push(p2),list(3);return}o=mpow(p1.q.a,Math.abs(e)),i=mpow(p1.q.b,Math.abs(e)),e<0&&(n=o,o=makeSignSameAs(o=i,i=n),i=makePositive(i)),(p3=new U).k=NUM,p3.q.a=o,p3.q.b=i,push(p3);return}if(isminusone(p1)){push(p2),normalize_angle();return}if(isnegativenumber(p1)){push(p1),negate(),push(p2),qpow(),push_integer(-1),push(p2),qpow(),multiply();return}if(!isinteger(p1)){push(p1),mp_numerator(),push(p2),qpow(),push(p1),mp_denominator(),push(p2),negate(),qpow(),multiply();return}if(is_small_integer(p1)){push(p1),push(p2),quickfactor();return}if(!isSmall(p2.q.a)||!isSmall(p2.q.b)||(r=p2.q.a,t=p2.q.b,0===(o=mroot(p1.q.a,t)))){push_symbol(POWER),push(p1),push(p2),list(3);return}return i=mpow(o,r),(p3=new U).k=NUM,p2.q.a.isNegative()?(p3.q.a=bigInt(1),p3.q.b=i):(p3.q.a=i,p3.q.b=bigInt(1)),push(p3)},normalize_angle=function(){if(save(),p1=pop(),isinteger(p1)){p1.q.a.isOdd()?push_integer(-1):push_integer(1),restore();return}return push(p1),bignum_truncate(),p2=pop(),isnegativenumber(p1)&&(push(p2),push_integer(-1),add(),p2=pop()),push(p1),push(p2),subtract(),p3=pop(),push_symbol(POWER),push_integer(-1),push(p3),list(3),p2.q.a.isOdd()&&negate(),restore()},is_small_integer=function(r){return isSmall(r.q.a)},quickfactor=function(){var r,t,e,n,o,i;for(t=0,save(),p2=pop(),p1=pop(),r=tos,push(p1),factor_small_number(),n=tos-r,i=r,t=e=0,o=n;e<o;t=e+=2)push(stack[i+t]),push(stack[i+t+1]),push(p2),multiply(),quickpower();return multiply_all(tos-r-n),p1=pop(),moveTos(r),push(p1),restore()},quickpower=function(){var r;if(r=0,save(),p2=pop(),p1=pop(),push(p2),bignum_truncate(),p3=pop(),push(p2),push(p3),subtract(),p4=pop(),isZeroAtomOrTensor(p4)||(push_symbol(POWER),push(p1),push(p4),list(3)),push(p3),isNaN(r=pop_integer())){push_symbol(POWER),push(p1),push(p3),list(3),restore();return}return 0===r?void restore():(push(p1),bignum_power_number(r),restore())},Eval_quotient=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),(p1=pop())===symbol(NIL)&&(p1=symbol(SYMBOL_X)),push(p1),divpoly()},divpoly=function(){var r,t,e,n,o,i,a,s,u;for(e=0,n=0,i=0,a=0,u=0,save(),p3=pop(),p2=pop(),p1=pop(),e=tos,r=tos,i=coeff(p3,p1)-1,t=tos,u=i-(a=coeff(p3,p2)-1),push_integer(0),p5=pop();u>=0;){for(push(stack[r+i]),push(stack[t+a]),divide(),p4=pop(),n=o=0,s=a;0<=s?o<=s:o>=s;n=0<=s?++o:--o)push(stack[r+u+n]),push(stack[t+n]),push(p4),multiply(),subtract(),stack[r+u+n]=pop();push(p5),push(p4),push(p3),push_integer(u),power(),multiply(),add(),p5=pop(),i--,u--}return moveTos(e),push(p5),restore()},DEBUG_RATIONALIZE=!1,Eval_rationalize=function(){return push(cadr(p1)),Eval(),rationalize()},rationalize=function(){var r;return r=expanding,yyrationalize(),expanding=r},yyrationalize=function(){var r,t,e;if(istensor(e=pop()))return void __rationalize_tensor(e);if(expanding=0,car(e)!==symbol(ADD))return void push(e);for(DEBUG_RATIONALIZE&&console.log("rationalize: this is the input expr: "+e),push(one),multiply_denominators(e),r=pop(),DEBUG_RATIONALIZE&&console.log("rationalize: this is the new denominator: "+r),push(zero),t=cdr(e);iscons(t);)DEBUG_RATIONALIZE&&console.log("term: "+car(t)),push(r),push(car(t)),multiply(),add(),t=cdr(t);if(DEBUG_RATIONALIZE&&console.log("rationalize: original terms times new denominator: "+stack[tos-1]),Condense(),DEBUG_RATIONALIZE&&console.log("rationalize: after factoring: "+stack[tos-1]),push(r),divide(),DEBUG_RATIONALIZE)return console.log("rationalize: after dividing by new denom. (and we're done): "+stack[tos-1])},multiply_denominators=function(r){var t;if(car(r)!==symbol(ADD))return multiply_denominators_term(r);for(r=cdr(r),t=[];iscons(r);)multiply_denominators_term(car(r)),t.push(r=cdr(r));return t},multiply_denominators_term=function(r){var t;if(car(r)!==symbol(MULTIPLY))return multiply_denominators_factor(r);for(r=cdr(r),t=[];iscons(r);)multiply_denominators_factor(car(r)),t.push(r=cdr(r));return t},multiply_denominators_factor=function(r){if(car(r)===symbol(POWER)){if(push(r),r=caddr(r),isnegativenumber(r)||car(r)===symbol(MULTIPLY)&&isnegativenumber(cadr(r))){inverse(),__lcm();return}return pop()}},__rationalize_tensor=function(r){var t,e,n,o;if(t=0,push(r),Eval(),!istensor(r=pop()))return void push(r);for(n=r.tensor.nelem,t=e=0,o=n;0<=o?e<o:e>o;t=0<=o?++e:--e)push(r.tensor.elem[t]),rationalize(),r.tensor.elem[t]=pop();return check_tensor_dimensions(r),push(r)},__lcm=function(){return save(),p1=pop(),p2=pop(),push(p1),push(p2),multiply(),push(p1),push(p2),gcd(),divide(),restore()},Eval_real=function(){return push(cadr(p1)),Eval(),real()},real=function(){return save(),rect(),p1=pop(),push(p1),push(p1),conjugate(),add(),push_integer(2),divide(),restore()},DEBUG_RECT=!1,Eval_rect=function(){return push(cadr(p1)),Eval(),rect()},rect=function(){var r;if(save(),r=p1=pop(),DEBUG_RECT&&console.log("RECT of "+r),DEBUG_RECT&&console.log("any clock forms in : "+r+" ? "+findPossibleClockForm(r)),issymbol(p1))DEBUG_RECT&&console.log(" rect: simple symbol: "+r),isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))?(push_symbol(YYRECT),push(p1),list(2)):push(p1);else if(isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))||findPossibleExponentialForm(p1)||findPossibleClockForm(p1)||Find(p1,symbol(SIN))&&Find(p1,symbol(COS))&&Find(p1,imaginaryunit))if(car(p1)===symbol(MULTIPLY)&&isimaginaryunit(cadr(p1))&&!isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES))))push(p1);else if(car(p1)===symbol(ADD))for(DEBUG_RECT&&console.log(" rect - "+r+" is a sum "),push_integer(0),p1=cdr(p1);iscons(p1);)push(car(p1)),rect(),add(),p1=cdr(p1);else DEBUG_RECT&&console.log(" rect - "+r+" is NOT a sum "),push(p1),abs(),DEBUG_RECT&&console.log(" rect - "+r+" abs: "+stack[tos-1].toString()),push(p1),arg(),DEBUG_RECT&&console.log(" rect - "+r+" arg of "+p1+" : "+stack[tos-1].toString()),p1=pop(),push(p1),cosine(),DEBUG_RECT&&console.log(" rect - "+r+" cosine: "+stack[tos-1].toString()),push(imaginaryunit),push(p1),sine(),DEBUG_RECT&&console.log(" rect - "+r+" sine: "+stack[tos-1].toString()),multiply(),DEBUG_RECT&&console.log(" rect - "+r+" i * sine: "+stack[tos-1].toString()),add(),DEBUG_RECT&&console.log(" rect - "+r+" cos + i * sine: "+stack[tos-1].toString()),multiply();else DEBUG_RECT&&console.log(" rect: simple symbol: "+r),push(p1);if(restore(),DEBUG_RECT)return console.log("rect of "+r+" : "+stack[tos-1])},show_power_debug=!1,performing_roots=!1,Eval_roots=function(){return car(p2=cadr(p1))===symbol(SETQ)||car(p2)===symbol(TESTEQ)?(push(cadr(p2)),Eval(),push(caddr(p2)),Eval(),subtract()):(push(p2),Eval(),car(p2=pop())===symbol(SETQ)||car(p2)===symbol(TESTEQ)?(push(cadr(p2)),Eval(),push(caddr(p2)),Eval(),subtract()):push(p2)),push(caddr(p1)),Eval(),(p2=pop())===symbol(NIL)?guess():push(p2),p2=pop(),p1=pop(),ispolyexpandedform(p1,p2)||stop("roots: 1st argument is not a polynomial in the variable "+p2),push(p1),push(p2),roots()},hasImaginaryCoeff=function(r){var t,e,n,o,i;for(n=!1,t=tos,e=o=i=r;o>0;e=o+=-1)if(iscomplexnumber(stack[tos-e])){n=!0;break}return n},isSimpleRoot=function(r){var t,e,n,o,i;if(r>2){for(n=!0,t=tos,isZeroAtomOrTensor(stack[tos-r])&&(n=!1),e=o=i=r-1;o>1;e=o+=-1)if(!isZeroAtomOrTensor(stack[tos-e])){n=!1;break}}else n=!1;return n},normalisedCoeff=function(r,t){var e,n,o,i,a,s,u,f;for(o=coeff(r,t),e=stack[tos-1],s=[],n=i=1,u=o;1<=u?i<=u:i>=u;n=1<=u?++i:--i)s.push(pop());for(n=a=f=o-1;f<=0?a<=0:a>=0;n=f<=0?++a:--a)push(s[n]),push(e),divide();return o},roots=function(){var r,t,e,n,o,i,a,s;if(r=0,t=0,a=0,DEBUG&&console.log("roots: "+stack[tos-1].toString()+" "+stack[tos-2].toString()),save(),recursionLevelNestedRadicalsRemoval>1){pop(),pop(),push(symbol(NIL)),restore();return}if(performing_roots=!0,r=tos-2,DEBUG&&console.log("roots checking if "+stack[tos-1].toString()+" is a case of simple roots"),p2=pop(),p1=pop(),push(p1),push(p2),isSimpleRoot(e=normalisedCoeff(p2,p1))?(DEBUG&&console.log("yes, "+stack[tos-1].toString()+" is a case of simple roots"),o=stack[tos-e],i=stack[tos-1],moveTos(tos-e),pop(),pop(),getSimpleRoots(e,i,o)):(moveTos(tos-e),roots2()),0==(a=tos-r)&&stop("roots: the polynomial is not factorable, try nroots"),1===a){performing_roots=!1,restore();return}for(sort_stack(a),(p1=alloc_tensor(a)).tensor.ndim=1,p1.tensor.dim[0]=a,t=n=0,s=a;0<=s?n<s:n>s;t=0<=s?++n:--n)p1.tensor.elem[t]=stack[r+t];return moveTos(r),push(p1),restore(),performing_roots=!1},getSimpleRoots=function(r,t,e){var n,o,i,a,s,u,f;if(DEBUG&&console.log("getSimpleRoots"),save(),r-=1,push(e),push_rational(1,r),power(),push(t),push_rational(1,r),power(),divide(),o=pop(),r%2==0)for(f=i=1,s=r;i<=s;f=i+=2)push(o),push_integer(-1),push_rational(f,r),power(),multiply(),n=pop(),push(n),push(n),negate();else for(f=a=1,u=r;1<=u?a<=u:a>=u;f=1<=u?++a:--a)push(o),push_integer(-1),push_rational(f,r),power(),multiply(),f%2==0&&negate();return restore()},roots2=function(){var r;if(save(),DEBUG&&console.log("roots2: "+stack[tos-1].toString()+" "+stack[tos-2].toString()),p2=pop(),p1=pop(),push(p1),push(p2),hasImaginaryCoeff(r=normalisedCoeff(p2,p1))?(moveTos(tos-r),pop(),pop()):(moveTos(tos-r),factorpoly(),p1=pop()),car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),roots3(),p1=cdr(p1);else push(p1),push(p2),roots3();return restore()},roots3=function(){var r;return save(),p2=pop(),car(p1=pop())===symbol(POWER)&&ispolyexpandedform(cadr(p1),p2)&&isposint(caddr(p1))?(r=normalisedCoeff(p2,cadr(p1)),mini_solve(r)):ispolyexpandedform(p1,p2)&&(r=normalisedCoeff(p2,p1),mini_solve(r)),restore()},mini_solve=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k,w,M,_,A,S,E,N,O,P,I,R,T,C,L,B,j,D,z,$,U,F,Z,J,V,X,G,Y,W,Q,H,K,rr,rt,re,rn,ro,ri,ra,rs,ru,rf,rl,rc,rp,rx;if(save(),2===r){p3=pop(),p4=pop(),push(p4),push(p3),divide(),negate(),restore();return}if(3===r){p3=pop(),p4=pop(),p5=pop(),push(p4),push_integer(2),power(),push_integer(4),push(p3),multiply(),push(p5),multiply(),subtract(),push_rational(1,2),power(),p6=pop(),push(p6),push(p4),subtract(),push(p3),push_integer(2),multiply(),divide(),push(p6),push(p4),add(),negate(),push(p3),divide(),push_rational(1,2),multiply(),restore();return}if(4===r||5===r){if(p3=pop(),p4=pop(),p5=pop(),p6=pop(),push(p5),push(p5),multiply(),N=pop(),push(N),push(p5),multiply(),O=pop(),push(p4),push(p4),multiply(),_=pop(),push(_),push(p4),multiply(),S=pop(),push(S),push(p6),multiply(),E=pop(),push(E),push_integer(-4),multiply(),j=pop(),push(S),push_integer(2),multiply(),o=pop(),push(p3),push(p3),multiply(),v=pop(),push(v),push(p3),multiply(),q=pop(),push_integer(3),push(p3),multiply(),i=pop(),push(v),push(p6),multiply(),b=pop(),push(b),push(p6),multiply(),y=pop(),push(b),push_integer(27),multiply(),n=pop(),push(y),push_integer(-27),multiply(),L=pop(),push(i),push_integer(2),multiply(),f=pop(),push(p3),push(p5),multiply(),M=pop(),push(M),push(p4),multiply(),k=pop(),push(k),push(p6),multiply(),w=pop(),push(M),push_integer(3),multiply(),s=pop(),push_integer(-4),push(p3),push(O),multiply(),multiply(),B=pop(),push(k),push_integer(9),multiply(),negate(),D=pop(),push(w),push_integer(18),multiply(),e=pop(),push(_),push(s),subtract(),g=pop(),push(_),push(N),multiply(),A=pop(),push(p4),negate(),push(i),divide(),z=pop(),4===r){if(DEBUG&&console.log(">>>>>>>>>>>>>>>> actually using cubic formula <<<<<<<<<<<<<<< "),DEBUG&&console.log("cubic: D0: "+g.toString()),push(g),push_integer(3),power(),push_integer(4),multiply(),u=pop(),push(g),simplify(),absValFloat(),h=pop(),DEBUG&&console.log("cubic: D0 as float: "+h.toString()),push(e),push(j),push(A),push(B),push(L),add(),add(),add(),add(),simplify(),absValFloat(),I=pop(),DEBUG&&console.log("cubic: DETERMINANT: "+I.toString()),push(o),push(D),push(n),add(),add(),d=pop(),DEBUG&&console.log("cubic: D1: "+d.toString()),push(d),push_integer(2),power(),push(u),subtract(),push_rational(1,2),power(),simplify(),m=pop(),isZeroAtomOrTensor(I))if(isZeroAtomOrTensor(h)){DEBUG&&console.log(" cubic: DETERMINANT IS ZERO and delta0 is zero"),push(z),restore();return}else{DEBUG&&console.log(" cubic: DETERMINANT IS ZERO and delta0 is not zero"),push(p3),push(p6),push_integer(9),multiply(),multiply(),push(p4),push(p5),multiply(),subtract(),push(g),push_integer(2),multiply(),divide(),rc=pop(),push(rc),push(rc),push(k),push_integer(4),multiply(),push(p3),push(p3),push(p6),push_integer(9),multiply(),multiply(),multiply(),negate(),push(S),negate(),add(),add(),push(p3),push(g),multiply(),divide(),restore();return}for(t=!1,Q=!1;!t;)push(m),Q&&negate(),push(d),add(),push_rational(1,2),multiply(),push_rational(1,3),power(),simplify(),c=pop(),DEBUG&&console.log("cubic: C: "+c.toString()),push(c),simplify(),absValFloat(),x=pop(),DEBUG&&console.log("cubic: C as absval and float: "+x.toString()),isZeroAtomOrTensor(x)?(DEBUG&&console.log(" cubic: C IS ZERO flipping the sign"),Q=!0):t=!0;push(c),push(i),multiply(),a=pop(),push(a),push_integer(2),multiply(),l=pop(),push(imaginaryunit),push_integer(3),push_rational(1,2),power(),multiply(),H=pop(),push_integer(1),push(H),add(),ra=pop(),push_integer(1),push(H),subtract(),ri=pop(),push(c),push(i),divide(),p=pop(),push(z),push(p),negate(),push(g),push(a),divide(),negate(),add(),add(),simplify(),push(z),push(p),push(ra),multiply(),push_integer(2),divide(),push(ri),push(g),multiply(),push(l),divide(),add(),add(),simplify(),push(z),push(p),push(ri),multiply(),push_integer(2),divide(),push(ra),push(g),multiply(),push(l),divide(),add(),add(),simplify(),restore();return}if(5===r){if(DEBUG&&console.log(">>>>>>>>>>>>>>>> actually using quartic formula <<<<<<<<<<<<<<< "),p7=pop(),isZeroAtomOrTensor(p4)&&isZeroAtomOrTensor(p6)&&!isZeroAtomOrTensor(p5)&&!isZeroAtomOrTensor(p7)){for(DEBUG&&console.log("biquadratic case"),push(p3),push(symbol(SECRETX)),push_integer(2),power(),multiply(),push(p5),push(symbol(SECRETX)),multiply(),push(p7),add(),add(),push(symbol(SECRETX)),roots(),K=0,rr=(rs=pop().tensor.elem).length;K<rr;K++)W=rs[K],push(W),push_rational(1,2),power(),simplify(),push(W),push_rational(1,2),power(),negate(),simplify();restore();return}if(push(p6),push(p6),multiply(),P=pop(),push(p7),push(p7),multiply(),R=pop(),push(R),push(p7),multiply(),T=pop(),push_integer(256),push(q),push(T),multiply(),multiply(),push_integer(-192),push(b),push(R),push(p4),multiply(),multiply(),multiply(),push_integer(-128),push(v),push(N),push(R),multiply(),multiply(),multiply(),push_integer(144),push(y),push(p5),push(p7),multiply(),multiply(),multiply(),push(L),push(P),multiply(),push_integer(144),push(k),push(p4),push(R),multiply(),multiply(),multiply(),push_integer(-6),push(p3),push(_),push(P),push(p7),multiply(),multiply(),multiply(),multiply(),push_integer(-80),push(w),push(p5),push(p7),multiply(),multiply(),multiply(),push_integer(18),push(w),push(P),multiply(),multiply(),push_integer(16),push(M),push(O),push(p7),multiply(),multiply(),multiply(),push_integer(-4),push(M),push(N),push(P),multiply(),multiply(),multiply(),push_integer(-27),push(S),push(p4),push(R),multiply(),multiply(),multiply(),push_integer(18),push(E),push(p5),push(p7),multiply(),multiply(),multiply(),push(j),push(P),multiply(),push_integer(-4),push(A),push(p5),push(p7),multiply(),multiply(),multiply(),push(A),push(P),multiply(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),I=pop(),DEBUG&&console.log("R_determinant: "+I.toString()),push(N),push_integer(-3),push(p4),push(p6),multiply(),multiply(),push_integer(12),push(p3),push(p7),multiply(),multiply(),add(),add(),g=pop(),DEBUG&&console.log("R_DELTA0: "+g.toString()),push_integer(2),push(O),multiply(),push_integer(-9),push(p4),push(p5),push(p6),multiply(),multiply(),multiply(),push_integer(27),push(_),push(p7),multiply(),multiply(),push_integer(27),push(p3),push(P),multiply(),multiply(),push_integer(-72),push(M),push(p7),multiply(),multiply(),add(),add(),add(),add(),d=pop(),DEBUG&&console.log("R_DELTA1: "+d.toString()),push_integer(8),push(M),multiply(),push_integer(-3),push(_),multiply(),add(),push_integer(8),push(v),multiply(),divide(),$=pop(),DEBUG&&console.log("p: "+$.toString()),push(S),push_integer(-4),push(k),multiply(),push_integer(8),push(b),multiply(),add(),add(),push_integer(8),push(q),multiply(),divide(),U=pop(),DEBUG&&console.log("q: "+U.toString()),DEBUG&&console.log("tos 1 "+tos),isZeroAtomOrTensor(p4)){for($=p5,U=p6,F=p7,push_rational(5,2),push($),multiply(),V=pop(),push_integer(2),push($),push_integer(2),power(),multiply(),push(F),subtract(),X=pop(),push($),push_integer(3),power(),push_integer(2),divide(),push_rational(-1,2),push($),push(F),multiply(),multiply(),push_rational(-1,8),push(U),push_integer(2),power(),multiply(),add(),add(),G=pop(),push(symbol(SECRETX)),push_integer(3),power(),push(V),push(symbol(SECRETX)),push_integer(2),power(),multiply(),push(X),push(symbol(SECRETX)),multiply(),push(G),add(),add(),add(),DEBUG&&console.log("resolventCubic: "+stack[tos-1].toString()),push(symbol(SECRETX)),roots(),rl=pop(),DEBUG&&console.log("resolventCubicSolutions: "+rl),C=null,ro=0,re=(rf=rl.tensor.elem).length;ro<re;ro++)if(W=rf[ro],DEBUG&&console.log("examining solution: "+W),push(W),push_integer(2),multiply(),push($),add(),absValFloat(),rx=pop(),DEBUG&&console.log("abs value is: "+W),!isZeroAtomOrTensor(rx)){C=W;break}DEBUG&&console.log("chosen solution: "+C),push(C),push_integer(2),multiply(),push($),add(),push_rational(1,2),power(),simplify(),rp=pop(),push(U),push_integer(2),multiply(),push(rp),divide(),simplify(),J=pop(),push($),push_integer(3),multiply(),push(C),push_integer(2),multiply(),add(),Z=pop(),push(rp),push(Z),push(J),add(),negate(),push_rational(1,2),power(),simplify(),add(),push_integer(2),divide(),push(rp),push(Z),push(J),add(),negate(),push_rational(1,2),power(),simplify(),subtract(),push_integer(2),divide(),push(rp),negate(),push(Z),push(J),subtract(),negate(),push_rational(1,2),power(),simplify(),add(),push_integer(2),divide(),push(rp),negate(),push(Z),push(J),subtract(),negate(),push_rational(1,2),power(),simplify(),subtract(),push_integer(2),divide(),restore();return}for(DEBUG&&console.log("tos 2 "+tos),push_integer(8),push(p5),push(p3),multiply(),multiply(),push_integer(-3),push(p4),push_integer(2),power(),multiply(),add(),push_integer(8),push(p3),push_integer(2),power(),multiply(),divide(),$=pop(),DEBUG&&console.log("p for depressed quartic: "+$.toString()),push(p4),push_integer(3),power(),push_integer(-4),push(p3),push(p4),push(p5),multiply(),multiply(),multiply(),push_integer(8),push(p6),push(p3),push_integer(2),power(),multiply(),multiply(),add(),add(),push_integer(8),push(p3),push_integer(3),power(),multiply(),divide(),U=pop(),DEBUG&&console.log("q for depressed quartic: "+U.toString()),push(p4),push_integer(4),power(),push_integer(-3),multiply(),push_integer(256),push(q),push(p7),multiply(),multiply(),push_integer(-64),push(b),push(p4),multiply(),multiply(),push_integer(16),push(_),push(p3),push(p5),multiply(),multiply(),multiply(),add(),add(),add(),push_integer(256),push(p3),push_integer(4),power(),multiply(),divide(),F=pop(),DEBUG&&console.log("r for depressed quartic: "+F.toString()),DEBUG&&console.log("tos 4 "+tos),push(symbol(SECRETX)),push_integer(4),power(),DEBUG&&console.log("4 * x^4: "+stack[tos-1].toString()),push($),push(symbol(SECRETX)),push_integer(2),power(),multiply(),DEBUG&&console.log("R_p * x^2: "+stack[tos-1].toString()),push(U),push(symbol(SECRETX)),multiply(),DEBUG&&console.log("R_q * x: "+stack[tos-1].toString()),push(F),DEBUG&&console.log("R_r: "+stack[tos-1].toString()),add(),add(),add(),simplify(),DEBUG&&console.log("solving depressed quartic: "+stack[tos-1].toString()),push(symbol(SECRETX)),roots(),Y=pop(),DEBUG&&console.log("depressedSolutions: "+Y),rn=0,rt=(ru=Y.tensor.elem).length;rn<rt;rn++)W=ru[rn],push(W),push(p4),push_integer(4),push(p3),multiply(),divide(),subtract(),simplify(),DEBUG&&console.log("solution from depressed: "+stack[tos-1].toString());restore();return}}return moveTos(tos-r),restore()},Eval_round=function(){return push(cadr(p1)),Eval(),yround()},yround=function(){return save(),yyround(),restore()},yyround=function(){var r;if(r=0,!isNumericAtom(p1=pop())){push_symbol(ROUND),push(p1),list(2);return}if(isdouble(p1)){r=Math.round(p1.d),push_double(r);return}return isinteger(p1)?void push(p1):(push(p1),yyfloat(),p1=pop(),push_integer(Math.round(p1.d)))},T_INTEGER=1001,T_DOUBLE=1002,T_SYMBOL=1003,T_FUNCTION=1004,T_NEWLINE=1006,T_STRING=1007,T_GTEQ=1008,T_LTEQ=1009,T_EQ=1010,T_NEQ=1011,T_QUOTASSIGN=1012,token="",newline_flag=0,meta_mode=0,input_str=0,scan_str=0,token_str=0,token_buf=0,lastFoundSymbol=null,symbolsRightOfAssignment=null,symbolsLeftOfAssignment=null,isSymbolLeftOfAssignment=null,scanningParameters=null,functionInvokationsScanningStack=null,skipRootVariableToBeSolved=!1,assignmentFound=null,scanned="",scan=function(r){return(DEBUG&&console.log("#### scanning "+r),lastFoundSymbol=null,symbolsRightOfAssignment=[],symbolsLeftOfAssignment=[],isSymbolLeftOfAssignment=!0,scanningParameters=[],functionInvokationsScanningStack=[""],assignmentFound=!1,scanned=r,meta_mode=0,expanding++,input_str=0,scan_str=0,get_next_token(),""===token)?(push(symbol(NIL)),expanding--,0):(scan_stmt(),expanding--,assignmentFound||(symbolsInExpressionsWithoutAssignments=symbolsInExpressionsWithoutAssignments.concat(symbolsLeftOfAssignment)),token_str-input_str)},scan_meta=function(r){return(scanned=r,meta_mode=1,expanding++,input_str=0,scan_str=0,get_next_token(),""===token)?(push(symbol(NIL)),expanding--,0):(scan_stmt(),expanding--,token_str-input_str)},scan_stmt=function(){var r,t,e,n,o,i,a,s,u;if(scan_relation(),r=!1,token===T_QUOTASSIGN&&(r=!0),(token===T_QUOTASSIGN||"="===token)&&(u=lastFoundSymbol,DEBUG&&console.log("assignment!"),assignmentFound=!0,isSymbolLeftOfAssignment=!1,get_next_token(),push_symbol(SETQ),swap(),r&&push_symbol(QUOTE),scan_relation(),r&&list(2),list(3),isSymbolLeftOfAssignment=!0,codeGen)){if(-1!==(n=symbolsRightOfAssignment.indexOf(u))&&(symbolsRightOfAssignment.splice(n,1),symbolsHavingReassignments.push(u)),DEBUG)for(console.log("locally, "+u+" depends on: "),o=0,i=symbolsRightOfAssignment.length;o<i;o++)console.log("  "+(e=symbolsRightOfAssignment[o]));for(null==symbolsDependencies[u]&&(symbolsDependencies[u]=[]),t=symbolsDependencies[u],s=0,a=symbolsRightOfAssignment.length;s<a;s++)e=symbolsRightOfAssignment[s],-1===t.indexOf(e)&&t.push(e);return symbolsRightOfAssignment=[]}},scan_relation=function(){switch(scan_expression(),token){case T_EQ:return push_symbol(TESTEQ),swap(),get_next_token(),scan_expression(),list(3);case T_NEQ:return push_symbol(NOT),swap(),push_symbol(TESTEQ),swap(),get_next_token(),scan_expression(),list(3),list(2);case T_LTEQ:return push_symbol(TESTLE),swap(),get_next_token(),scan_expression(),list(3);case T_GTEQ:return push_symbol(TESTGE),swap(),get_next_token(),scan_expression(),list(3);case"<":return push_symbol(TESTLT),swap(),get_next_token(),scan_expression(),list(3);case">":return push_symbol(TESTGT),swap(),get_next_token(),scan_expression(),list(3)}},scan_expression=function(){var r;switch(r=tos,token){case"+":get_next_token(),scan_term();break;case"-":get_next_token(),scan_term(),negate();break;default:scan_term()}for(;0===newline_flag&&("+"===token||"-"===token);)"+"===token?(get_next_token(),scan_term()):(get_next_token(),scan_term(),negate());if(tos-r>1)return list(tos-r),push_symbol(ADD),swap(),cons()},is_factor=function(){if(("function"==typeof token.charCodeAt?token.charCodeAt(0):void 0)===dotprod_unicode)return 1;switch(token){case"*":case"/":return 1;case"(":case T_SYMBOL:case T_FUNCTION:case T_INTEGER:case T_DOUBLE:case T_STRING:if(!newline_flag)return 1;scan_str=token_str}return 0},simplify_1_in_products=function(r,t){if(r>t&&isrational(stack[r-1])&&equaln(stack[r-1],1))return pop()},multiply_consecutive_constants=function(r,t){if(r>t+1&&isNumericAtom(stack[r-2])&&isNumericAtom(stack[r-1]))return multiply()},scan_term=function(){var r;for(r=tos,scan_factor(),parse_time_simplifications&&simplify_1_in_products(tos,r);is_factor();)"*"===token?(get_next_token(),scan_factor()):"/"===token?(simplify_1_in_products(tos,r),get_next_token(),scan_factor(),inverse()):("function"==typeof token.charCodeAt?token.charCodeAt(0):void 0)===dotprod_unicode?(get_next_token(),push_symbol(INNER),swap(),scan_factor(),list(3)):scan_factor(),parse_time_simplifications&&(multiply_consecutive_constants(tos,r),simplify_1_in_products(tos,r));return r===tos?push_integer(1):tos-r>1?(list(tos-r),push_symbol(MULTIPLY),swap(),cons()):void 0},scan_power=function(){if("^"===token)return get_next_token(),push_symbol(POWER),swap(),scan_factor(),list(3)},scan_index=function(r){for(get_next_token(),push_symbol(INDEX),swap(),scan_expression();","===token;)get_next_token(),scan_expression();return"]"!==token&&scan_error("] expected"),get_next_token(),list(tos-r)},scan_factor=function(){var r,t;for(t=tos,r=!1,"("===token?scan_subexpr():token===T_SYMBOL?scan_symbol():token===T_FUNCTION?scan_function_call_with_function_name():"["===token?scan_tensor():token===T_INTEGER?(r=!0,bignum_scan_integer(token_buf),get_next_token()):token===T_DOUBLE?(r=!0,bignum_scan_float(token_buf),get_next_token()):token===T_STRING?scan_string():scan_error("syntax error");"["===token||"("===token&&0===newline_flag&&!r;)"["===token?scan_index(t):"("===token&&scan_function_call_without_function_name();for(;"!"===token;)get_next_token(),push_symbol(FACTORIAL),swap(),list(2);for(;("function"==typeof token.charCodeAt?token.charCodeAt(0):void 0)===transpose_unicode;)get_next_token(),push_symbol(TRANSPOSE),swap(),list(2);return scan_power()},addSymbolRightOfAssignment=function(r){var t,e,n,o;if(-1===predefinedSymbolsInGlobalScope_doNotTrackInDependencies.indexOf(r)&&-1===symbolsRightOfAssignment.indexOf(r)&&-1===symbolsRightOfAssignment.indexOf("'"+r)&&!skipRootVariableToBeSolved){for(DEBUG&&console.log("... adding symbol: "+r+" to the set of the symbols right of assignment"),n="",t=e=1,o=functionInvokationsScanningStack.length;1<=o?e<o:e>o;t=1<=o?++e:--e)""!==functionInvokationsScanningStack[t]&&(n+=functionInvokationsScanningStack[t]+"_"+t+"_");return r=n+r,symbolsRightOfAssignment.push(r)}},addSymbolLeftOfAssignment=function(r){var t,e,n,o;if(-1===predefinedSymbolsInGlobalScope_doNotTrackInDependencies.indexOf(r)&&-1===symbolsLeftOfAssignment.indexOf(r)&&-1===symbolsLeftOfAssignment.indexOf("'"+r)&&!skipRootVariableToBeSolved){for(DEBUG&&console.log("... adding symbol: "+r+" to the set of the symbols left of assignment"),n="",t=e=1,o=functionInvokationsScanningStack.length;1<=o?e<o:e>o;t=1<=o?++e:--e)""!==functionInvokationsScanningStack[t]&&(n+=functionInvokationsScanningStack[t]+"_"+t+"_");return r=n+r,symbolsLeftOfAssignment.push(r)}},scan_symbol=function(){if(token!==T_SYMBOL&&scan_error("symbol expected"),meta_mode&&1===token_buf.length)switch(token_buf[0]){case"a":push(symbol(METAA));break;case"b":push(symbol(METAB));break;case"x":push(symbol(METAX));break;default:push(usr_symbol(token_buf))}else push(usr_symbol(token_buf));return 0===scanningParameters.length?(DEBUG&&console.log("out of scanning parameters, processing "+token_buf),lastFoundSymbol=token_buf,isSymbolLeftOfAssignment&&addSymbolLeftOfAssignment(token_buf)):(DEBUG&&console.log("still scanning parameters, skipping "+token_buf),isSymbolLeftOfAssignment&&addSymbolRightOfAssignment("'"+token_buf)),DEBUG&&console.log("found symbol: "+token_buf+" left of assignment: "+isSymbolLeftOfAssignment),isSymbolLeftOfAssignment||addSymbolRightOfAssignment(token_buf),get_next_token()},scan_string=function(){return push(new_string(token_buf)),get_next_token()},scan_function_call_with_function_name=function(){var r,t,e,n,o,i;if(DEBUG&&console.log("-- scan_function_call_with_function_name start"),n=1,o=new U,o=usr_symbol(token_buf),push(o),("roots"===(r=token_buf)||"defint"===r||"sum"===r||"product"===r||"for"===r)&&functionInvokationsScanningStack.push(token_buf),lastFoundSymbol=token_buf,isSymbolLeftOfAssignment||addSymbolRightOfAssignment(token_buf),get_next_token(),get_next_token(),scanningParameters.push(!0),")"!==token){for(scan_stmt(),n++;","===token;)get_next_token(),2===n&&-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("roots")&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!RegExp("roots_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(r)}),skipRootVariableToBeSolved=!0),2===n&&-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("sum")&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!RegExp("sum_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(r)}),skipRootVariableToBeSolved=!0),2===n&&-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("product")&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!RegExp("product_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(r)}),skipRootVariableToBeSolved=!0),2===n&&-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("for")&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!RegExp("for_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(r)}),skipRootVariableToBeSolved=!0),-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("defint")&&(2===n||n>2&&(n-2)%3==0)&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!RegExp("defint_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(r)}),skipRootVariableToBeSolved=!0),scan_stmt(),skipRootVariableToBeSolved=!1,n++;2===n&&-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("roots")&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!RegExp("roots_"+(functionInvokationsScanningStack.length-1)+"_x").test(r)}))}for(scanningParameters.pop(),t=e=0,i=symbolsRightOfAssignment.length;0<=i?e<=i:e>=i;t=0<=i?++e:--e)null!=symbolsRightOfAssignment[t]&&("roots"===r&&(symbolsRightOfAssignment[t]=symbolsRightOfAssignment[t].replace(RegExp("roots_"+(functionInvokationsScanningStack.length-1)+"_"),"")),"defint"===r&&(symbolsRightOfAssignment[t]=symbolsRightOfAssignment[t].replace(RegExp("defint_"+(functionInvokationsScanningStack.length-1)+"_"),"")),"sum"===r&&(symbolsRightOfAssignment[t]=symbolsRightOfAssignment[t].replace(RegExp("sum_"+(functionInvokationsScanningStack.length-1)+"_"),"")),"product"===r&&(symbolsRightOfAssignment[t]=symbolsRightOfAssignment[t].replace(RegExp("product_"+(functionInvokationsScanningStack.length-1)+"_"),"")),"for"===r&&(symbolsRightOfAssignment[t]=symbolsRightOfAssignment[t].replace(RegExp("for_"+(functionInvokationsScanningStack.length-1)+"_"),"")));if(")"!==token&&scan_error(") expected"),get_next_token(),list(n),("roots"===r||"defint"===r||"sum"===r||"product"===r||"for"===r)&&functionInvokationsScanningStack.pop(),r===symbol(PATTERN).printname&&(patternHasBeenFound=!0),DEBUG)return console.log("-- scan_function_call_with_function_name end")},scan_function_call_without_function_name=function(){var r;if(DEBUG&&console.log("-- scan_function_call_without_function_name start"),push_symbol(EVAL),swap(),list(2),r=1,get_next_token(),scanningParameters.push(!0),")"!==token)for(scan_stmt(),r++;","===token;)get_next_token(),scan_stmt(),r++;if(scanningParameters.pop(),")"!==token&&scan_error(") expected"),get_next_token(),list(r),DEBUG)return console.log("-- scan_function_call_without_function_name end: "+stack[tos-1])},scan_subexpr=function(){var r;return r=0,"("!==token&&scan_error("( expected"),get_next_token(),scan_stmt(),")"!==token&&scan_error(") expected"),get_next_token()},scan_tensor=function(){var r;for(r=0,"["!==token&&scan_error("[ expected"),get_next_token(),scan_stmt(),r=1;","===token;)get_next_token(),scan_stmt(),r++;return build_tensor(r),"]"!==token&&scan_error("] expected"),get_next_token()},scan_error=function(r){for(errorMessage="";input_str!==scan_str&&("\n"!==scanned[input_str]&&"\r"!==scanned[input_str]||input_str+1!==scan_str);)errorMessage+=scanned[input_str++];for(errorMessage+=" ? ";scanned[input_str]&&"\n"!==scanned[input_str]&&"\r"!==scanned[input_str];)errorMessage+=scanned[input_str++];return errorMessage+="\n",stop(r)},build_tensor=function(r){var t,e,n;for(t=0,save(),(p2=alloc_tensor(r)).tensor.ndim=1,p2.tensor.dim[0]=r,t=e=0,n=r;0<=n?e<n:e>n;t=0<=n?++e:--e)p2.tensor.elem[t]=stack[tos-r+t];return check_tensor_dimensions(p2),moveTos(tos-r),push(p2),restore()},get_next_token=function(){for(newline_flag=0;get_token(),token===T_NEWLINE;)newline_flag=1;if(DEBUG)return console.log("get_next_token token: "+token)},get_token=function(){for(;isspace(scanned[scan_str]);){if("\n"===scanned[scan_str]||"\r"===scanned[scan_str]){token=T_NEWLINE,scan_str++;return}scan_str++}if(token_str=scan_str,scan_str===scanned.length){token="";return}if(isdigit(scanned[scan_str])||"."===scanned[scan_str]){for(;isdigit(scanned[scan_str]);)scan_str++;if("."===scanned[scan_str]){for(scan_str++;isdigit(scanned[scan_str]);)scan_str++;if("e"===scanned[scan_str]&&("+"===scanned[scan_str+1]||"-"===scanned[scan_str+1]||isdigit(scanned[scan_str+1])))for(scan_str+=2;isdigit(scanned[scan_str]);)scan_str++;token=T_DOUBLE}else token=T_INTEGER;update_token_buf(token_str,scan_str);return}if(isalpha(scanned[scan_str])){for(;isalnumorunderscore(scanned[scan_str]);)scan_str++;token="("===scanned[scan_str]?T_FUNCTION:T_SYMBOL,update_token_buf(token_str,scan_str);return}if('"'===scanned[scan_str]){for(scan_str++;'"'!==scanned[scan_str];)scan_str===scanned.length-1&&(scan_str++,scan_error("runaway string"),scan_str--),scan_str++;scan_str++,token=T_STRING,update_token_buf(token_str+1,scan_str-1);return}if("#"===scanned[scan_str]||"-"===scanned[scan_str]&&"-"===scanned[scan_str+1]){for(;scanned[scan_str]&&"\n"!==scanned[scan_str]&&"\r"!==scanned[scan_str];)scan_str++;scanned[scan_str]&&scan_str++,token=T_NEWLINE;return}if(":"===scanned[scan_str]&&"="===scanned[scan_str+1]){scan_str+=2,token=T_QUOTASSIGN;return}if("="===scanned[scan_str]&&"="===scanned[scan_str+1]){scan_str+=2,token=T_EQ;return}if("!"===scanned[scan_str]&&"="===scanned[scan_str+1]){scan_str+=2,token=T_NEQ;return}if("<"===scanned[scan_str]&&"="===scanned[scan_str+1]){scan_str+=2,token=T_LTEQ;return}if(">"===scanned[scan_str]&&"="===scanned[scan_str+1]){scan_str+=2,token=T_GTEQ;return}return token=scanned[scan_str++]},update_token_buf=function(r,t){return token_buf=scanned.substring(r,t)},$.scan=scan,Eval_sgn=function(){return push(cadr(p1)),Eval(),sgn()},sgn=function(){return save(),yysgn(),restore()},yysgn=function(){if(isdouble(p1=pop()))if(p1.d>0)return void push_integer(1);else if(0===p1.d)return void push_integer(1);else return void push_integer(-1);if(isrational(p1))if(-1===MSIGN(mmul(p1.q.a,p1.q.b)))return void push_integer(-1);else if(MZERO(mmul(p1.q.a,p1.q.b)))return void push_integer(0);else return void push_integer(1);if(iscomplexnumber(p1)){push_integer(-1),push(p1),absval(),power(),push(p1),multiply();return}if(isnegativeterm(p1)){push_symbol(SGN),push(p1),negate(),list(2),push_integer(-1),multiply();return}return push_symbol(SGN),push(p1),list(2)},Eval_shape=function(){return push(cadr(p1)),Eval(),shape()},shape=function(){var r,t,e,n,o,i,a,s,u;for(e=0,i=0,u=0,r=[],t=[],e=n=0,a=MAXDIM;0<=a?n<a:n>a;e=0<=a?++n:--n)r[e]=0,t[e]=0;if(save(),!istensor(p1=pop())){isZeroAtomOrTensor(p1)||stop("transpose: tensor expected, 1st arg is not a tensor"),push(zero),restore();return}for(i=p1.tensor.ndim,(p2=alloc_tensor(i)).tensor.ndim=1,p2.tensor.dim[0]=i,e=o=0,s=i;0<=s?o<s:o>s;e=0<=s?++o:--o)push_integer(p1.tensor.dim[e]),p2.tensor.elem[e]=pop();return push(p2),restore()},Eval_simfac=function(){return push(cadr(p1)),Eval(),simfac()},simfac=function(){var r;if(r=0,save(),car(p1=pop())===symbol(ADD)){for(r=tos,p1=cdr(p1);p1!==symbol(NIL);)push(car(p1)),simfac_term(),p1=cdr(p1);add_all(tos-r)}else push(p1),simfac_term();return restore()},simfac_term=function(){var r,t;if(t=0,save(),car(p1=pop())!==symbol(MULTIPLY)){push(p1),restore();return}for(t=tos,p1=cdr(p1);p1!==symbol(NIL);)push(car(p1)),p1=cdr(p1);for(;yysimfac(t);)r=1;return multiply_all_noexpand(tos-t),restore()},yysimfac=function(r){var t,e,n,o,i,a,s,u;for(t=0,e=0,t=n=i=r,a=tos;i<=a?n<a:n>a;t=i<=a?++n:--n)for(p1=stack[t],e=o=s=r,u=tos;s<=u?o<u:o>u;e=s<=u?++o:--o)if(t!==e){if(p2=stack[e],car(p1)===symbol(FACTORIAL)&&car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&equal(cadr(p1),cadr(p2)))return push(cadr(p1)),push(one),subtract(),factorial(),stack[t]=pop(),stack[e]=one,1;if(car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&caadr(p2)===symbol(FACTORIAL)&&equal(p1,cadadr(p2)))return push(p1),push_integer(-1),add(),factorial(),reciprocate(),stack[t]=pop(),stack[e]=one,1;if(car(p2)===symbol(FACTORIAL)&&(push(p1),push(cadr(p2)),subtract(),p3=pop(),isplusone(p3)))return push(p1),factorial(),stack[t]=pop(),stack[e]=one,1;if(car(p1)===symbol(POWER)&&isminusone(caddr(p1))&&car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&caadr(p2)===symbol(FACTORIAL)&&(push(cadr(p1)),push(cadr(cadr(p2))),subtract(),p3=pop(),isplusone(p3)))return push(cadr(p1)),factorial(),reciprocate(),stack[t]=pop(),stack[e]=one,1;if(car(p1)===symbol(FACTORIAL)&&car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&caadr(p2)===symbol(FACTORIAL)){if(push(cadr(p1)),push(cadr(cadr(p2))),subtract(),p3=pop(),isplusone(p3))return stack[t]=cadr(p1),stack[e]=one,1;if(isminusone(p3))return push(cadr(cadr(p2))),reciprocate(),stack[t]=pop(),stack[e]=one,1;if(equaln(p3,2))return stack[t]=cadr(p1),push(cadr(p1)),push_integer(-1),add(),stack[e]=pop(),1;if(equaln(p3,-2))return push(cadr(cadr(p2))),reciprocate(),stack[t]=pop(),push(cadr(cadr(p2))),push_integer(-1),add(),reciprocate(),stack[e]=pop(),1}}return 0},DEBUG_SIMPLIFY=!1,Eval_simplify=function(){return push(cadr(p1)),runUserDefinedSimplifications(),Eval(),simplify()},runUserDefinedSimplifications=function(){var r,t,e,n,o,i,a,s,u,f;if(0!==userSimplificationsInListForm.length&&!Find(cadr(p1),symbol(INTEGRAL))){for(u=expanding,expanding=!1,DEBUG_SIMPLIFY&&console.log("runUserDefinedSimplifications passed: "+stack[tos-1].toString()),Eval(),DEBUG_SIMPLIFY&&console.log("runUserDefinedSimplifications after eval no expanding: "+stack[tos-1].toString()),expanding=u,p1=stack[tos-1],DEBUG_SIMPLIFY&&console.log("patterns to be checked: "),n=0,o=userSimplificationsInListForm.length;n<o;n++)e=userSimplificationsInListForm[n],DEBUG_SIMPLIFY&&console.log("..."+e);for(r=!0,s=0;r&&s<MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES;)for(r=!1,s++,a=0,i=userSimplificationsInListForm.length;a<i;a++){for(e=userSimplificationsInListForm[a],f=!0,t=0;f&&t<MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE;)t++,DEBUG_SIMPLIFY&&console.log("simplify - tos: "+tos+" checking pattern: "+e+" on: "+p1),push_symbol(NIL),(f=transform(e,!0))&&(r=!0),p1=stack[tos-1],DEBUG_SIMPLIFY&&console.log("p1 at this stage of simplification: "+p1);t===MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE&&stop("maximum application of single transformation rule exceeded: "+e)}if(s===MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES&&stop("maximum application of all transformation rules exceeded "),DEBUG_SIMPLIFY&&console.log("METAX = "+get_binding(symbol(METAX))),DEBUG_SIMPLIFY&&console.log("METAA = "+get_binding(symbol(METAA))),DEBUG_SIMPLIFY)return console.log("METAB = "+get_binding(symbol(METAB)))}},simplifyForCodeGeneration=function(){return save(),runUserDefinedSimplifications(),codeGen=!0,simplify_main(),codeGen=!1,restore()},simplify=function(){return save(),simplify_main(),restore()},simplify_main=function(){var args,fbody;if(p1=pop(),codeGen&&car(p1)===symbol(FUNCTION)&&(fbody=cadr(p1),push(fbody),eval(),simplify(),p3=pop(),args=caddr(p1),push_symbol(FUNCTION),push(p3),push(args),list(3),p1=pop()),istensor(p1))return void simplify_tensor();if(Find(p1,symbol(FACTORIAL))&&(push(p1),simfac(),p2=pop(),push(p1),rationalize(),simfac(),p3=pop(),p1=count(p2)<count(p3)?p2:p3),f10(),DEBUG_SIMPLIFY&&console.log("f10: "+p1.toString()),f1(),DEBUG_SIMPLIFY&&console.log("f1: "+p1.toString()),f2(),DEBUG_SIMPLIFY&&console.log("f2: "+p1.toString()),f3(),DEBUG_SIMPLIFY&&console.log("f3: "+p1.toString()),f4(),DEBUG_SIMPLIFY&&console.log("f4: "+p1.toString()),f5(),DEBUG_SIMPLIFY&&console.log("f5: "+p1.toString()),f9(),DEBUG_SIMPLIFY&&console.log("f9: "+p1.toString()),simplify_polarRect(),do_simplify_nested_radicals&&simplify_nested_radicals()){DEBUG_SIMPLIFY&&console.log("de-nesting successful into: "+p1.toString()),push(p1),simplify();return}return simplify_rectToClock(),simplify_rational_expressions(),push(p1)},simplify_tensor=function(){var r,t,e,n,o;for(r=0,(p2=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,r=t=0,n=p1.tensor.ndim;0<=n?t<n:t>n;r=0<=n?++t:--t)p2.tensor.dim[r]=p1.tensor.dim[r];for(r=e=0,o=p1.tensor.nelem;0<=o?e<o:e>o;r=0<=o?++e:--e)push(p1.tensor.elem[r]),simplify(),p2.tensor.elem[r]=pop();return check_tensor_dimensions(p2),isZeroAtomOrTensor(p2)&&(p2=zero),push(p2)},f1=function(){if(car(p1)===symbol(ADD)&&(push(p1),rationalize(),p2=pop(),count(p2)<count(p1)))return p1=p2},f2=function(){if(car(p1)===symbol(ADD)&&(push(p1),Condense(),p2=pop(),count(p2)<=count(p1)))return p1=p2},f3=function(){if(push(p1),rationalize(),negate(),rationalize(),negate(),rationalize(),p2=pop(),count(p2)<count(p1))return p1=p2},f10=function(){var r,t,e,n,o;if(e=car(p1),n=cdr(p1),(e===symbol(MULTIPLY)||isinnerordot(p1))&&car(car(cdr(p1)))===symbol(TRANSPOSE)&&car(car(cdr(cdr(p1))))===symbol(TRANSPOSE)&&(DEBUG_SIMPLIFY&&console.log("maybe collecting a transpose "+p1),r=cadr(car(cdr(p1))),t=cadr(car(cdr(cdr(p1)))),e===symbol(MULTIPLY)?(push(r),push(t),multiply()):isinnerordot(p1)&&(push(t),push(r),inner()),push_integer(1),push_integer(2),o=expanding,expanding=!1,transpose(),expanding=o,p2=pop(),count(p2)<count(p1)&&(p1=p2),DEBUG_SIMPLIFY))return console.log("collecting a transpose "+p2)},f4=function(){if(!isZeroAtomOrTensor(p1)&&(push(p1),rationalize(),inverse(),rationalize(),inverse(),rationalize(),p2=pop(),count(p2)<count(p1)))return p1=p2},simplify_trig=function(){return save(),p1=pop(),f5(),push(p1),restore()},f5=function(){if((0!==Find(p1,symbol(SIN))||0!==Find(p1,symbol(COS)))&&(trigmode=1,push(p2=p1),Eval(),p3=pop(),trigmode=2,push(p2),Eval(),p4=pop(),trigmode=0,(count(p4)<count(p3)||nterms(p4)<nterms(p3))&&(p3=p4),count(p3)<count(p1)||nterms(p3)<nterms(p1)))return p1=p3},f9=function(){var r,t;if(car(p1)===symbol(ADD)){for(push_integer(0),p2=cdr(p1);iscons(p2);)push(car(p2)),simplify(),add(),r=p1,t=p2,p1=pop(),simplify_rational_expressions(),push(p1),p1=r,p2=cdr(p2=t);if(p2=pop(),count(p2)<count(p1))return p1=p2}},simplify_rational_expressions=function(){var r,t,e,n,o;if(push(p1),denominator(),r=pop(),!isone(r)){if((push(p1),numerator(),t=pop(),!isone(t)&&(e=areunivarpolysfactoredorexpandedform(t,r)))&&(push(t),push(r),gcd(),push(e),factor(),o=pop(),!isone(o)&&(push(t),push(e),factor(),push(o),inverse(),multiply_noexpand(),simplify(),n=stack[tos-1].toString(),push(r),push(e),factor(),push(o),inverse(),multiply_noexpand(),simplify(),n=stack[tos-1].toString(),divide(),Condense(),n=stack[tos-1].toString(),p2=pop(),count(p2)<count(p1))))return p1=p2}},simplify_rectToClock=function(){if((0!==Find(p1,symbol(SIN))||0!==Find(p1,symbol(COS)))&&(push(p1),Eval(),clockform(),p2=pop(),DEBUG_SIMPLIFY&&console.log("before simplification clockform: "+p1+" after: "+p2),count(p2)<count(p1)))return p1=p2},simplify_polarRect=function(){if(push(p1),polarRectAMinusOneBase(),Eval(),p2=pop(),count(p2)<count(p1))return p1=p2},polarRectAMinusOneBase=function(){var r;if(save(),isimaginaryunit(p1=pop())){push(p1),restore();return}if(equal(car(p1),symbol(POWER))&&isminusone(cadr(p1)))push(one),negate(),push(caddr(p1)),polarRectAMinusOneBase(),power(),polar(),rect();else if(iscons(p1)){for(r=tos;iscons(p1);)push(car(p1)),polarRectAMinusOneBase(),p1=cdr(p1);list(tos-r)}else push(p1);restore()},nterms=function(r){return car(r)!==symbol(ADD)?1:length(r)-1},simplify_nested_radicals=function(){var r,t,e,n;return recursionLevelNestedRadicalsRemoval>0?(DEBUG_SIMPLIFY&&console.log("denesting bailing out because of too much recursion"),!1):(push(p1),n=take_care_of_nested_radicals(),e=stack[tos-1],r=expanding,expanding=0,yycondense(),expanding=r,t=pop(),countOccurrencesOfSymbol(symbol(POWER),e)<countOccurrencesOfSymbol(symbol(POWER),t)?push(e):push(t),p1=pop(),n)},take_care_of_nested_radicals=function(){var r,t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k,w,M,_,A,S,E,N,O,P,I,R,T,C,L,B;if(recursionLevelNestedRadicalsRemoval>0)return DEBUG_SIMPLIFY&&console.log("denesting bailing out because of too much recursion"),!1;if(save(),p1=pop(),equal(car(p1),symbol(POWER))){if(i=cadr(p1),c=caddr(p1),!(!isminusone(c)&&equal(car(i),symbol(ADD))&&isfraction(c)&&(equalq(c,1,3)||equalq(c,1,2))))return push(p1),restore(),!1;for(p=cadr(i),push(p),take_care_of_nested_radicals(),pop(),C=caddr(i),push(C),take_care_of_nested_radicals(),pop(),A=0,f=i;cdr(f)!==symbol(NIL);)A++,f=cdr(f);if(A>2)return push(p1),restore(),!1;if(u=null,s=[],B=[],car(C)===symbol(MULTIPLY)){if(iscons(L=cdr(C)))for(;iscons(L);)I=car(L),car(I)===symbol(POWER)?(h=cadr(I),d=caddr(I),equalq(d,1,2)&&(null==u?(u=d,s.push(h)):equal(d,u)&&s.push(h))):B.push(I),L=cdr(L)}else car(C)===symbol(POWER)&&(h=cadr(C),d=caddr(C),null==u&&equalq(d,1,2)&&(u=d,s.push(h)));if(0===s.length)return push(p1),restore(),!1;for(r=p,push_integer(1),m=0,v=s.length;m<v;m++)g=s[m],push(g),multiply();for(e=pop(),push_integer(1),M=0,b=B.length;M<b;M++)g=B[M],push(g),multiply();if(t=pop(),equalq(c,1,3)){if(push(r),negate(),push(e),multiply(),push(t),divide(),a=pop(),push(a),real(),yyfloat(),Math.abs(pop().d)>0x100000000)return push(p1),restore(),!1;if(push(a),push_integer(3),push(e),multiply(),a=pop(),push(a),real(),yyfloat(),Math.abs(pop().d)>0x100000000)return pop(),push(p1),restore(),!1;if(push(a),push(symbol(SECRETX)),multiply(),push_integer(-3),push(r),multiply(),push(t),divide(),a=pop(),push(a),real(),yyfloat(),Math.abs(pop().d)>0x100000000)return pop(),pop(),push(p1),restore(),!1;push(a),push(symbol(SECRETX)),push_integer(2),power(),multiply(),push_integer(1),push(symbol(SECRETX)),push_integer(3),power(),multiply(),add(),add(),add()}else if(equalq(c,1,2)){if(push(e),a=pop(),push(a),real(),yyfloat(),Math.abs(pop().d)>0x100000000)return push(p1),restore(),!1;if(push(a),push_integer(-2),push(r),multiply(),push(t),divide(),a=pop(),push(a),real(),yyfloat(),Math.abs(pop().d)>0x100000000)return pop(),push(p1),restore(),!1;push(a),push(symbol(SECRETX)),multiply(),push_integer(1),push(symbol(SECRETX)),push_integer(2),power(),multiply(),add(),add()}if(push(symbol(SECRETX)),recursionLevelNestedRadicalsRemoval++,roots(),recursionLevelNestedRadicalsRemoval--,equal(stack[tos-1],symbol(NIL)))return DEBUG_SIMPLIFY&&console.log("roots bailed out because of too much recursion"),pop(),push(p1),restore(),!1;for(_=0,P=[],y=(T=stack[tos-1].tensor.elem).length;_<y;_++)l=T[_],Find(l,symbol(POWER))||P.push(l);if(pop(),0===P.length)return push(p1),restore(),!1;for(S=0,O=[],R=[],q=P.length;S<q;S++)g=P[S],push(g),real(),yyfloat(),O.push(g),R.push(pop().d);return(n=O[R.indexOf(Math.max.apply(Math,R))],equalq(c,1,3)?(push(r),push(n),push_integer(3),power(),push_integer(3),push(e),multiply(),push(n),multiply(),add(),divide(),push_rational(1,3),power()):equalq(c,1,2)&&(push(r),push(n),push_integer(2),power(),push(e),add(),divide(),push_rational(1,2),power()),null==(w=pop()))?(push(p1),restore(),!1):(push(w),push(n),multiply(),equalq(c,1,3)?(k=pop(),push(w),push(e),push_rational(1,2),power(),multiply(),push(k),add(),simplify()):equalq(c,1,2)&&(k=pop(),push(w),push(e),push_rational(1,2),power(),multiply(),push(k),add(),simplify(),E=pop(),push(E),real(),yyfloat(),N=pop(),isnegativenumber(N)?(push(w),negate(),w=pop(),push(k),negate(),k=pop(),push(w),push(e),push_rational(1,2),power(),multiply(),push(k),add(),simplify()):push(E)),p1=pop(),push(p1),restore(),!0)}if(!iscons(p1))return push(p1),restore(),!1;for(x=tos,o=!1;iscons(p1);)push(car(p1)),o=o||take_care_of_nested_radicals(),p1=cdr(p1);return list(tos-x),restore(),o},Eval_sin=function(){return push(cadr(p1)),Eval(),sine()},sine=function(){return save(),car(p1=pop())===symbol(ADD)?sine_of_angle_sum():sine_of_angle(),restore()},sine_of_angle_sum=function(){for(p2=cdr(p1);iscons(p2);){if(p4=car(p2),isnpi(p4)){push(p1),push(p4),subtract(),p3=pop(),push(p3),sine(),push(p4),cosine(),multiply(),push(p3),cosine(),push(p4),sine(),multiply(),add();return}p2=cdr(p2)}return sine_of_angle()},sine_of_angle=function(){var r,t;if(car(p1)===symbol(ARCSIN))return void push(cadr(p1));if(isdouble(p1)){1e-10>Math.abs(r=Math.sin(p1.d))&&(r=0),push_double(r);return}if(isnegative(p1)){push(p1),negate(),sine(),negate();return}if(car(p1)===symbol(ARCTAN)){push(cadr(p1)),push_integer(1),push(cadr(p1)),push_integer(2),power(),add(),push_rational(-1,2),power(),multiply();return}if(push(p1),push_integer(180),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),divide(),(t=pop_integer())<0||isNaN(t)){push(symbol(SIN)),push(p1),list(2);return}switch(t%360){case 0:case 180:return push_integer(0);case 30:case 150:return push_rational(1,2);case 210:case 330:return push_rational(-1,2);case 45:case 135:return push_rational(1,2),push_integer(2),push_rational(1,2),power(),multiply();case 225:case 315:return push_rational(-1,2),push_integer(2),push_rational(1,2),power(),multiply();case 60:case 120:return push_rational(1,2),push_integer(3),push_rational(1,2),power(),multiply();case 240:case 300:return push_rational(-1,2),push_integer(3),push_rational(1,2),power(),multiply();case 90:return push_integer(1);case 270:return push_integer(-1);default:return push(symbol(SIN)),push(p1),list(2)}},Eval_sinh=function(){return push(cadr(p1)),Eval(),ysinh()},ysinh=function(){return save(),yysinh(),restore()},yysinh=function(){var r;if(r=0,car(p1=pop())===symbol(ARCSINH))return void push(cadr(p1));if(isdouble(p1)){1e-10>Math.abs(r=Math.sinh(p1.d))&&(r=0),push_double(r);return}return isZeroAtomOrTensor(p1)?void push(zero):(push_symbol(SINH),push(p1),list(2))},subst=function(){var r,t,e,n,o,i,a,s,u;if(save(),o=pop(),(a=pop())===symbol(NIL)||o===symbol(NIL))return void restore();if(istensor(r=pop())){for((i=alloc_tensor(r.tensor.nelem)).tensor.ndim=r.tensor.ndim,t=e=0,s=r.tensor.ndim;0<=s?e<s:e>s;t=0<=s?++e:--e)i.tensor.dim[t]=r.tensor.dim[t];for(t=n=0,u=r.tensor.nelem;0<=u?n<u:n>u;t=0<=u?++n:--n)push(r.tensor.elem[t]),push(a),push(o),subst(),i.tensor.elem[t]=pop(),check_tensor_dimensions(i);push(i)}else equal(r,a)?push(o):iscons(r)?(push(car(r)),push(a),push(o),subst(),push(cdr(r)),push(a),push(o),subst(),cons()):push(r);return restore()},Eval_sum=function(){var r,t,e,n,o,i,a,s;if(t=0,n=0,o=0,r=cadr(p1),issymbol(e=caddr(p1))||stop("sum: 2nd arg?"),push(cadddr(p1)),Eval(),isNaN(n=pop_integer())||(push(caddddr(p1)),Eval(),isNaN(o=pop_integer())))return void push(p1);for(p4=get_binding(e),push_integer(0),t=i=a=n,s=o;a<=s?i<=s:i>=s;t=a<=s?++i:--i)push_integer(t),p5=pop(),set_binding(e,p5),push(r),Eval(),add();return set_binding(e,p4)},Eval_tan=function(){return push(cadr(p1)),Eval(),tangent()},tangent=function(){return save(),yytangent(),restore()},yytangent=function(){var r,t;if(t=0,r=0,car(p1=pop())===symbol(ARCTAN))return void push(cadr(p1));if(isdouble(p1)){1e-10>Math.abs(r=Math.tan(p1.d))&&(r=0),push_double(r);return}if(isnegative(p1)){push(p1),negate(),tangent(),negate();return}if(push(p1),push_integer(180),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),divide(),(t=pop_integer())<0||isNaN(t)){push(symbol(TAN)),push(p1),list(2);return}switch(t%360){case 0:case 180:return push_integer(0);case 30:case 210:return push_rational(1,3),push_integer(3),push_rational(1,2),power(),multiply();case 150:case 330:return push_rational(-1,3),push_integer(3),push_rational(1,2),power(),multiply();case 45:case 225:return push_integer(1);case 135:case 315:return push_integer(-1);case 60:case 240:return push_integer(3),push_rational(1,2),power();case 120:case 300:return push_integer(3),push_rational(1,2),power(),negate();default:return push(symbol(TAN)),push(p1),list(2)}},Eval_tanh=function(){var r;if(r=0,push(cadr(p1)),Eval(),car(p1=pop())===symbol(ARCTANH))return void push(cadr(p1));if(isdouble(p1)){1e-10>Math.abs(r=Math.tanh(p1.d))&&(r=0),push_double(r);return}return isZeroAtomOrTensor(p1)?void push(zero):(push_symbol(TANH),push(p1),list(2))},Eval_taylor=function(){return p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),(p2=pop())===symbol(NIL)?guess():push(p2),p1=cdr(p1),push(car(p1)),Eval(),(p2=pop())===symbol(NIL)?push_integer(24):push(p2),p1=cdr(p1),push(car(p1)),Eval(),(p2=pop())===symbol(NIL)?push_integer(0):push(p2),taylor()},taylor=function(){var r,t,e,n;if(r=0,t=0,save(),p4=pop(),p3=pop(),p2=pop(),p1=pop(),push(p3),isNaN(t=pop_integer())){push_symbol(TAYLOR),push(p1),push(p2),push(p3),push(p4),list(5),restore();return}for(push(p1),push(p2),push(p4),subst(),Eval(),push_integer(1),p5=pop(),r=e=1,n=t;(1<=n?e<=n:e>=n)&&(push(p1),push(p2),derivative(),p1=pop(),!isZeroAtomOrTensor(p1));r=1<=n?++e:--e)push(p5),push(p2),push(p4),subtract(),multiply(),p5=pop(),push(p1),push(p2),push(p4),subst(),Eval(),push(p5),multiply(),push_integer(r),factorial(),divide(),add();return restore()},Eval_tensor=function(){var r,t,e,n,o,i,a,s,u;for(e=0,i=0,a=0,check_tensor_dimensions(p1),a=p1.tensor.nelem,i=p1.tensor.ndim,(p2=alloc_tensor(a)).tensor.ndim=i,e=n=0,s=i;0<=s?n<s:n>s;e=0<=s?++n:--n)p2.tensor.dim[e]=p1.tensor.dim[e];for(r=p1.tensor.elem,t=p2.tensor.elem,check_tensor_dimensions(p2),e=o=0,u=a;0<=u?o<u:o>u;e=0<=u?++o:--o)push(r[e]),Eval(),t[e]=pop();return check_tensor_dimensions(p1),check_tensor_dimensions(p2),push(p2),promote_tensor()},tensor_plus_tensor=function(){var r,t,e,n,o,i,a,s,u,f,l,c;if(n=0,s=0,u=0,save(),p2=pop(),(s=(p1=pop()).tensor.ndim)!==p2.tensor.ndim){push(symbol(NIL)),restore();return}for(n=o=0,f=s;0<=f?o<f:o>f;n=0<=f?++o:--o)if(p1.tensor.dim[n]!==p2.tensor.dim[n]){push(symbol(NIL)),restore();return}for(u=p1.tensor.nelem,(p3=alloc_tensor(u)).tensor.ndim=s,n=i=0,l=s;0<=l?i<l:i>l;n=0<=l?++i:--i)p3.tensor.dim[n]=p1.tensor.dim[n];for(r=p1.tensor.elem,t=p2.tensor.elem,e=p3.tensor.elem,n=a=0,c=u;0<=c?a<c:a>c;n=0<=c?++a:--a)push(r[n]),push(t[n]),add(),e[n]=pop();return push(p3),restore()},tensor_times_scalar=function(){var r,t,e,n,o,i,a,s,u;for(e=0,i=0,a=0,save(),p2=pop(),i=(p1=pop()).tensor.ndim,a=p1.tensor.nelem,(p3=alloc_tensor(a)).tensor.ndim=i,e=n=0,s=i;0<=s?n<s:n>s;e=0<=s?++n:--n)p3.tensor.dim[e]=p1.tensor.dim[e];for(r=p1.tensor.elem,t=p3.tensor.elem,e=o=0,u=a;0<=u?o<u:o>u;e=0<=u?++o:--o)push(r[e]),push(p2),multiply(),t[e]=pop();return push(p3),restore()},scalar_times_tensor=function(){var r,t,e,n,o,i,a,s,u;for(e=0,i=0,a=0,save(),p2=pop(),p1=pop(),i=p2.tensor.ndim,a=p2.tensor.nelem,(p3=alloc_tensor(a)).tensor.ndim=i,e=n=0,s=i;0<=s?n<s:n>s;e=0<=s?++n:--n)p3.tensor.dim[e]=p2.tensor.dim[e];for(r=p2.tensor.elem,t=p3.tensor.elem,e=o=0,u=a;0<=u?o<u:o>u;e=0<=u?++o:--o)push(p1),push(r[e]),multiply(),t[e]=pop();return push(p3),restore()},check_tensor_dimensions=function(r){r.tensor.nelem!==r.tensor.elem.length&&console.log("something wrong in tensor dimensions")},is_square_matrix=function(r){return istensor(r)&&2===r.tensor.ndim&&r.tensor.dim[0]===r.tensor.dim[1]?1:0},d_tensor_tensor=function(){var r,t,e,n,o,i,a,s,u,f,l,c,p;if(n=0,o=0,u=0,f=0,u=p1.tensor.ndim,f=p1.tensor.nelem,u+1>=MAXDIM){push_symbol(DERIVATIVE),push(p1),push(p2),list(3);return}for((p3=alloc_tensor(f*p2.tensor.nelem)).tensor.ndim=u+1,n=i=0,l=u;0<=l?i<l:i>l;n=0<=l?++i:--i)p3.tensor.dim[n]=p1.tensor.dim[n];for(p3.tensor.dim[u]=p2.tensor.dim[0],r=p1.tensor.elem,t=p2.tensor.elem,e=p3.tensor.elem,n=a=0,c=f;0<=c?a<c:a>c;n=0<=c?++a:--a)for(o=s=0,p=p2.tensor.nelem;0<=p?s<p:s>p;o=0<=p?++s:--s)push(r[n]),push(t[o]),derivative(),e[n*p2.tensor.nelem+o]=pop();return push(p3)},d_scalar_tensor=function(){var r,t,e,n,o;for((p3=alloc_tensor(p2.tensor.nelem)).tensor.ndim=1,p3.tensor.dim[0]=p2.tensor.dim[0],r=p2.tensor.elem,t=p3.tensor.elem,e=n=0,o=p2.tensor.nelem;0<=o?n<o:n>o;e=0<=o?++n:--n)push(p1),push(r[e]),derivative(),t[e]=pop();return push(p3)},d_tensor_scalar=function(){var r,t,e,n,o,i,a;for(e=0,(p3=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,e=n=0,i=p1.tensor.ndim;0<=i?n<i:n>i;e=0<=i?++n:--n)p3.tensor.dim[e]=p1.tensor.dim[e];for(r=p1.tensor.elem,t=p3.tensor.elem,e=o=0,a=p1.tensor.nelem;0<=a?o<a:o>a;e=0<=a?++o:--o)push(r[e]),push(p2),derivative(),t[e]=pop();return push(p3)},compare_tensors=function(r,t){var e,n,o,i,a;if(e=0,r.tensor.ndim<t.tensor.ndim)return -1;if(r.tensor.ndim>t.tensor.ndim)return 1;for(e=n=0,i=r.tensor.ndim;0<=i?n<i:n>i;e=0<=i?++n:--n){if(r.tensor.dim[e]<t.tensor.dim[e])return -1;if(r.tensor.dim[e]>t.tensor.dim[e])return 1}for(e=o=0,a=r.tensor.nelem;0<=a?o<a:o>a;e=0<=a?++o:--o)if(!equal(r.tensor.elem[e],t.tensor.elem[e]))if(lessp(r.tensor.elem[e],t.tensor.elem[e]))return -1;else return 1;return 0},power_tensor=function(){var r,t,e,n,o,i,a,s;if(r=0,t=0,o=0,t=p1.tensor.ndim-1,p1.tensor.dim[0]!==p1.tensor.dim[t]||(push(p2),isNaN(o=pop_integer()))){push_symbol(POWER),push(p1),push(p2),list(3);return}if(0===o){for(2!==p1.tensor.ndim&&stop("power(tensor,0) with tensor rank not equal to 2"),o=p1.tensor.dim[0],(p1=alloc_tensor(o*o)).tensor.ndim=2,p1.tensor.dim[0]=o,p1.tensor.dim[1]=o,r=e=0,i=o;0<=i?e<i:e>i;r=0<=i?++e:--e)p1.tensor.elem[o*r+r]=one;check_tensor_dimensions(p1),push(p1);return}for(o<0&&(o=-o,push(p1),inv(),p1=pop()),push(p1),s=[],r=n=1,a=o;(1<=a?n<a:n>a)&&(push(p1),inner(),!isZeroAtomOrTensor(stack[tos-1]));r=1<=a?++n:--n)s.push(void 0);return s},copy_tensor=function(){var r,t,e,n,o;for(r=0,save(),p1=pop(),(p2=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,r=t=0,n=p1.tensor.ndim;0<=n?t<n:t>n;r=0<=n?++t:--t)p2.tensor.dim[r]=p1.tensor.dim[r];for(r=e=0,o=p1.tensor.nelem;0<=o?e<o:e>o;r=0<=o?++e:--e)p2.tensor.elem[r]=p1.tensor.elem[r];return check_tensor_dimensions(p1),check_tensor_dimensions(p2),push(p2),restore()},promote_tensor=function(){var r,t,e,n,o,i,a,s,u,f,l,c,p,x,g;if(r=0,t=0,e=0,s=0,a=0,save(),!istensor(p1=pop())){push(p1),restore();return}for(p2=p1.tensor.elem[0],r=n=1,l=p1.tensor.nelem;1<=l?n<l:n>l;r=1<=l?++n:--n)compatible(p2,p1.tensor.elem[r])||stop("Cannot promote tensor due to inconsistent tensor components.");if(!istensor(p2)){push(p1),restore();return}for((a=p1.tensor.ndim+p2.tensor.ndim)>MAXDIM&&stop("tensor rank > "+MAXDIM),s=p1.tensor.nelem*p2.tensor.nelem,(p3=alloc_tensor(s)).tensor.ndim=a,r=o=0,c=p1.tensor.ndim;0<=c?o<c:o>c;r=0<=c?++o:--o)p3.tensor.dim[r]=p1.tensor.dim[r];for(t=i=0,p=p2.tensor.ndim;0<=p?i<p:i>p;t=0<=p?++i:--i)p3.tensor.dim[r+t]=p2.tensor.dim[t];for(e=0,r=u=0,x=p1.tensor.nelem;0<=x?u<x:u>x;r=0<=x?++u:--u)for(p2=p1.tensor.elem[r],t=f=0,g=p2.tensor.nelem;0<=g?f<g:f>g;t=0<=g?++f:--f)p3.tensor.elem[e++]=p2.tensor.elem[t];return check_tensor_dimensions(p2),check_tensor_dimensions(p3),push(p3),restore()},compatible=function(r,t){var e,n,o;if(!istensor(r)&&!istensor(t))return 1;if(!istensor(r)||!istensor(t)||r.tensor.ndim!==t.tensor.ndim)return 0;for(e=n=0,o=r.tensor.ndim;0<=o?n<o:n>o;e=0<=o?++n:--n)if(r.tensor.dim[e]!==t.tensor.dim[e])return 0;return 1},Eval_test=function(){var r,t;for(t=p1,p1=cdr(p1);iscons(p1);){if(cdr(p1)===symbol(NIL)){push(car(p1)),Eval();return}if(null==(r=isZeroLikeOrNonZeroLikeOrUndetermined(car(p1))))return void push(t);if(r){push(cadr(p1)),Eval();return}p1=cddr(p1)}return push_integer(0)},Eval_testeq=function(){var r,t,e;return(t=p1,push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),subtract(),e=pop(),r=isZeroLikeOrNonZeroLikeOrUndetermined(e))?void push_integer(0):null==r||r?(push(cadr(p1)),Eval(),simplify(),push(caddr(p1)),Eval(),simplify(),subtract(),e=pop(),r=isZeroLikeOrNonZeroLikeOrUndetermined(e))?void push_integer(0):null==r||r?push(t):void push_integer(1):void push_integer(1)},Eval_testge=function(){var r,t;return(t=p1,null==(r=cmp_args()))?void push(t):r>=0?push_integer(1):push_integer(0)},Eval_testgt=function(){var r,t;return(t=p1,null==(r=cmp_args()))?void push(t):r>0?push_integer(1):push_integer(0)},Eval_testle=function(){var r,t;return(t=p1,null==(r=cmp_args()))?void push(t):r<=0?push_integer(1):push_integer(0)},Eval_testlt=function(){var r,t;return(t=p1,null==(r=cmp_args()))?void push(t):r<0?push_integer(1):push_integer(0)},Eval_not=function(){var r,t;return(t=p1,null==(r=isZeroLikeOrNonZeroLikeOrUndetermined(cadr(p1))))?push(t):r?push_integer(0):push_integer(1)},Eval_and=function(){var r,t,e,n;for(r=cdr(n=p1),e=!1;iscons(r);)if(null==(t=isZeroLikeOrNonZeroLikeOrUndetermined(car(r))))e=!0,r=cdr(r);else if(t)r=cdr(r);else if(!t)return void push_integer(0);return e?push(n):push_integer(1)},Eval_or=function(){var r,t,e,n;for(t=cdr(n=p1),e=!1;iscons(t);)if(null==(r=isZeroLikeOrNonZeroLikeOrUndetermined(car(t))))e=!0,t=cdr(t);else{if(r)return void push_integer(1);r||(t=cdr(t))}return e?push(n):push_integer(0)},cmp_args=function(){var r;if(r=0,push(cadr(p1)),Eval(),simplify(),push(caddr(p1)),Eval(),simplify(),subtract(),(p1=pop()).k!==NUM&&p1.k!==DOUBLE&&(push(p1),yyfloat(),Eval(),p1=pop()),isZeroAtomOrTensor(p1))return 0;switch(p1.k){case NUM:r=-1===MSIGN(p1.q.a)?-1:1;break;case DOUBLE:r=p1.d<0?-1:1;break;default:r=null}return r},transform=function(r,t){var e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v;if(d=0,save(),p1=null,p4=pop(),p3=pop(),DEBUG&&console.log("         !!!!!!!!!   transform on: "+p3),saveMetaBindings(),set_binding(symbol(METAX),p4),d=tos,push_integer(1),push(p3),push(p4),polyform(),push(p4),e=tos-2,decomp(t),l=tos-e,DEBUG)for(console.log("  "+l+" decomposed elements ====== "),o=i=0,c=l;0<=c?i<c:i>c;o=0<=c?++i:--i)console.log("  decomposition element "+o+": "+stack[tos-1-o]);if(m=!1,t){if(!isNumericAtom(p3))if(h=r,DEBUG&&console.log("applying transform: "+h),DEBUG&&console.log("scanning table entry "+h),push(h),push(symbol(SYMBOL_A_UNDERSCORE)),push(symbol(METAA)),subst(),push(symbol(SYMBOL_B_UNDERSCORE)),push(symbol(METAB)),subst(),push(symbol(SYMBOL_X_UNDERSCORE)),push(symbol(METAX)),subst(),p5=car(p1=pop()),DEBUG&&console.log("template expression: "+p5),p6=cadr(p1),p7=cddr(p1),f_equals_a(d,t))m=!0;else{for(DEBUG&&console.log("p3 at this point: "+p3),v=[],DEBUG&&console.log("car(p3): "+car(p3)),iscons(p=p3)&&(v.push(car(p3)),p=cdr(p3));iscons(p);)x=car(p),p=cdr(p),DEBUG&&console.log("tos before recursive transform: "+tos),push(x),push_symbol(NIL),DEBUG&&console.log("testing: "+x),DEBUG&&console.log("about to try to simplify other term: "+x),g=transform(r,t),m=m||g,v.push(pop()),DEBUG&&console.log("tried to simplify other term: "+x+" ...successful?: "+g+" ...transformed: "+v[v.length-1]);if(0!==v.length){for(u=0,a=v.length;u<a;u++)o=v[u],push(o);list(v.length),p6=pop()}}}else for(f=0,s=r.length;f<s;f++)if(n=r[f],DEBUG&&(console.log("scanning table entry "+n),(n+"").indexOf("f(sqrt(a+b*x),2/3*1/b*sqrt((a+b*x)^3))")),n&&(scan_meta(n),p5=cadr(p1=pop()),p6=caddr(p1),p7=cdddr(p1),f_equals_a(d,t))){m=!0;break}return moveTos(d),m?(push(p6),Eval(),p1=pop(),m=!0):p1=t?p3:symbol(NIL),restoreMetaBindings(),push(p1),restore(),m},saveMetaBindings=function(){return push(get_binding(symbol(METAA))),push(get_binding(symbol(METAB))),push(get_binding(symbol(METAX)))},restoreMetaBindings=function(){return set_binding(symbol(METAX),pop()),set_binding(symbol(METAB),pop()),set_binding(symbol(METAA),pop())},f_equals_a=function(r,t){var e,n,o,i,a,s,u,f,l;for(e=0,n=0,e=o=s=r,u=tos;s<=u?o<u:o>u;e=s<=u?++o:--o)for(set_binding(symbol(METAA),stack[e]),DEBUG&&console.log("  binding METAA to "+get_binding(symbol(METAA))),n=i=f=r,l=tos;f<=l?i<l:i>l;n=f<=l?++i:--i){for(set_binding(symbol(METAB),stack[n]),DEBUG&&console.log("  binding METAB to "+get_binding(symbol(METAB))),p1=p7;iscons(p1)&&(push(car(p1)),Eval(),p2=pop(),!isZeroAtomOrTensor(p2));)p1=cdr(p1);if(!iscons(p1)&&(push(p3),DEBUG&&console.log("about to evaluate template expression: "+p5+" binding METAA to "+get_binding(symbol(METAA))+" and binding METAB to "+get_binding(symbol(METAB))+" and binding METAX to "+get_binding(symbol(METAX))),push(p5),t&&(a=expanding,expanding=!1),Eval(),t&&(expanding=a),DEBUG&&console.log("  comparing "+stack[tos-1]+" to: "+stack[tos-2]),subtract(),p1=pop(),isZeroAtomOrTensor(p1)))return DEBUG&&(console.log("binding METAA to "+get_binding(symbol(METAA))),console.log("binding METAB to "+get_binding(symbol(METAB))),console.log("binding METAX to "+get_binding(symbol(METAX))),console.log("comparing "+p3+" to: "+p5)),1}return 0},Eval_transpose=function(){return push(cadr(p1)),Eval(),cddr(p1)===symbol(NIL)?(push_integer(1),push_integer(2)):(push(caddr(p1)),Eval(),push(cadddr(p1)),Eval()),transpose()},transpose=function(){var r,t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k,w,M,_,A,S,E,N;for(a=0,f=0,l=0,c=0,x=0,d=0,m=0,N=0,e=[],n=[],a=p=0,q=MAXDIM;0<=q?p<q:p>q;a=0<=q?++p:--p)e[a]=0,n[a]=0;if(save(),p3=pop(),p2=pop(),isNumericAtom(p1=pop())||(isplusone(p2)&&isplustwo(p3)||isplusone(p3)&&isplustwo(p2))&&isidentitymatrix(p1)){push(p1),restore();return}if(istranspose(p1)&&(s=car(cdr(cdr(p1))),u=car(cdr(cdr(cdr(p1)))),equal(s,p3)&&equal(u,p2)||equal(u,p3)&&equal(s,p2)||equal(s,symbol(NIL))&&equal(u,symbol(NIL))&&(isplusone(p3)&&isplustwo(p2)||isplusone(p2)&&isplustwo(p3)))){push(car(cdr(p1))),restore();return}if(expanding&&isadd(p1)){for(p1=cdr(p1),push(zero);iscons(p1);)push(car(p1)),push(p2),push(p3),transpose(),add(),p1=cdr(p1);restore();return}if(expanding&&ismultiply(p1)){for(p1=cdr(p1),push(one);iscons(p1);)push(car(p1)),push(p2),push(p3),transpose(),multiply(),p1=cdr(p1);restore();return}if(expanding&&isinnerordot(p1)){for(p1=cdr(p1),t=[];iscons(p1);)t.push([car(p1),p2,p3]),p1=cdr(p1);for(i=g=k=t.length-1;k<=0?g<=0:g>=0;i=k<=0?++g:--g)push(t[i][0]),push(t[i][1]),push(t[i][2]),transpose(),i!==t.length-1&&inner();restore();return}if(!istensor(p1)){if(!isZeroAtomOrTensor(p1)){push_symbol(TRANSPOSE),push(p1),isplusone(p2)&&isplustwo(p3)||isplusone(p3)&&isplustwo(p2)?list(2):(push(p2),push(p3),list(4)),restore();return}push(zero),restore();return}if(d=p1.tensor.ndim,m=p1.tensor.nelem,1===d){push(p1),restore();return}for(push(p2),c=pop_integer(),push(p3),x=pop_integer(),(c<1||c>d||x<1||x>d)&&stop("transpose: index out of range"),c--,x--,(p2=alloc_tensor(m)).tensor.ndim=d,a=h=0,w=d;0<=w?h<w:h>w;a=0<=w?++h:--h)p2.tensor.dim[a]=p1.tensor.dim[a];for(p2.tensor.dim[c]=p1.tensor.dim[x],p2.tensor.dim[x]=p1.tensor.dim[c],r=p1.tensor.elem,o=p2.tensor.elem,a=v=0,M=d;0<=M?v<M:v>M;a=0<=M?++v:--v)e[a]=0,n[a]=p1.tensor.dim[a];for(a=b=0,_=m;0<=_?b<_:b>_;a=0<=_?++b:--b){for(N=e[c],e[c]=e[x],e[x]=N,N=n[c],n[c]=n[x],n[x]=N,l=0,f=y=0,A=d;0<=A?y<A:y>A;f=0<=A?++y:--y)l=l*n[f]+e[f];for(N=e[c],e[c]=e[x],e[x]=N,N=n[c],n[c]=n[x],n[x]=N,o[l]=r[a],f=E=S=d-1;(S<=0?E<=0:E>=0)&&!(++e[f]<n[f]);f=S<=0?++E:--E)e[f]=0}return push(p2),restore()},Eval_user_function=function(){var r,t;if(DEBUG&&console.log("Eval_user_function evaluating: "+car(p1)),car(p1)===symbol(SYMBOL_D)&&get_binding(symbol(SYMBOL_D))===symbol(SYMBOL_D))return void Eval_derivative();if(push(car(p1)),Eval(),isNumericAtom(r=pop())?stop("expected function invocation, found multiplication instead. Use '*' symbol explicitly for multiplication."):istensor(r)?stop("expected function invocation, found tensor product instead. Use 'dot/inner' explicitly."):isstr(r)&&stop("expected function, found string instead."),p3=car(cdr(r)),p4=car(cdr(cdr(r))),p5=cdr(p1),car(r)!==symbol(FUNCTION)||r===car(p1)){for(t=tos,push(r),p1=p5;iscons(p1);)push(car(p1)),Eval(),p1=cdr(p1);list(tos-t);return}for(p1=p4,p2=p5,t=tos;iscons(p1)&&iscons(p2);)push(car(p1)),push(car(p2)),p1=cdr(p1),p2=cdr(p2);return list(tos-t),p6=pop(),push(p3),iscons(p6)&&(push(p6),rewrite_args()),Eval()},rewrite_args=function(){var r,t;if(t=0,save(),p2=pop(),istensor(p1=pop()))return t=rewrite_args_tensor(),restore(),t;if(iscons(p1)){for(r=tos,car(p1)===car(p2)?(push_symbol(EVAL),push(car(cdr(p2))),list(2)):push(car(p1)),p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),t+=rewrite_args(),p1=cdr(p1);return list(tos-r),restore(),t}if(!issymbol(p1))return push(p1),restore(),0;for(p3=p2;iscons(p3);){if(p1===car(p3))return push(cadr(p3)),restore(),1;p3=cddr(p3)}return p3=get_binding(p1),push(p3),p1!==p3&&(push(p2),0===(t=rewrite_args())&&(pop(),push(p1))),restore(),t},rewrite_args_tensor=function(){var r,t,e,n;for(e=0,r=0,push(p1),copy_tensor(),p1=pop(),r=t=0,n=p1.tensor.nelem;0<=n?t<n:t>n;r=0<=n?++t:--t)push(p1.tensor.elem[r]),push(p2),e+=rewrite_args(),p1.tensor.elem[r]=pop();return check_tensor_dimensions(p1),push(p1),e},Eval_zero=function(){var r,t,e,n,o,i,a,s;for(r=0,t=[],n=0,i=0,r=e=0,a=MAXDIM;0<=a?e<a:e>a;r=0<=a?++e:--e)t[r]=0;for(n=1,i=0,p2=cdr(p1);iscons(p2);){if(push(car(p2)),Eval(),(r=pop_integer())<1||isNaN(r))return void push(zero);n*=r,t[i++]=r,p2=cdr(p2)}if(0===i)return void push(zero);for((p1=alloc_tensor(n)).tensor.ndim=i,r=o=0,s=i;0<=s?o<s:o>s;r=0<=s?++o:--o)p1.tensor.dim[r]=t[r];return push(p1)},allocatedId=0,alloc_tensor=function(r){var t,e,n,o;for(t=0,(n=new U).k=TENSOR,n.tensor=new tensor,n.tensor.nelem=r,t=e=0,o=r;0<=o?e<o:e>o;t=0<=o?++e:--e)n.tensor.elem[t]=zero;return n.tensor.allocatedId=allocatedId,allocatedId++,check_tensor_dimensions(n),n},Find=function(r,t){var e,n,o;if(e=0,equal(r,t))return 1;if(istensor(r)){for(e=n=0,o=r.tensor.nelem;0<=o?n<o:n>o;e=0<=o?++n:--n)if(Find(r.tensor.elem[e],t))return 1;return 0}for(;iscons(r);){if(Find(car(r),t))return 1;r=cdr(r)}return 0},findPossibleClockForm=function(r){var t,e,n;if(t=0,isimaginaryunit(r))return 0;if(car(r)===symbol(POWER)&&!isinteger(caddr(p1))&&Find(cadr(r),imaginaryunit)||car(r)===symbol(POWER)&&equaln(cadr(r),-1)&&!isinteger(caddr(p1)))return 1;if(istensor(r)){for(t=e=0,n=r.tensor.nelem;0<=n?e<n:e>n;t=0<=n?++e:--e)if(findPossibleClockForm(r.tensor.elem[t]))return 1;return 0}for(;iscons(r);){if(findPossibleClockForm(car(r)))return 1;r=cdr(r)}return 0},findPossibleExponentialForm=function(r){var t,e,n;if(t=0,car(r)===symbol(POWER)&&cadr(r)===symbol(E))return Find(caddr(r),imaginaryunit);if(istensor(r)){for(t=e=0,n=r.tensor.nelem;0<=n?e<n:e>n;t=0<=n?++e:--e)if(findPossibleExponentialForm(r.tensor.elem[t]))return 1;return 0}for(;iscons(r);){if(findPossibleExponentialForm(car(r)))return 1;r=cdr(r)}return 0},$.Find=Find,init=function(){var r,t,e;if(r=0,flag=0,reset_after_error(),chainOfUserSymbolsNotFunctionsBeingEvaluated=[],!flag){for(flag=1,r=t=0,e=NSYM;0<=e?t<e:t>e;r=0<=e?++t:--t)symtab[r]=new U,symtab[r].k=SYM,binding[r]=symtab[r],isSymbolReclaimable[r]=!1;return defn()}},defn_str=['version="'+version+'"',"e=exp(1)","i=sqrt(-1)","autoexpand=1","assumeRealVariables=1","trange=[-pi,pi]","xrange=[-10,10]","yrange=[-10,10]","last=0","trace=0","forceFixedPrintout=1","maxFixedPrintoutDigits=6","printLeaveEAlone=1","printLeaveXAlone=0","cross(u,v)=[u[2]*v[3]-u[3]*v[2],u[3]*v[1]-u[1]*v[3],u[1]*v[2]-u[2]*v[1]]","curl(v)=[d(v[3],y)-d(v[2],z),d(v[1],z)-d(v[3],x),d(v[2],x)-d(v[1],y)]","div(v)=d(v[1],x)+d(v[2],y)+d(v[3],z)","ln(x)=log(x)"],defn=function(){var r,t,e,n,o;for(p0=symbol(NIL),p1=symbol(NIL),p2=symbol(NIL),p3=symbol(NIL),p4=symbol(NIL),p5=symbol(NIL),p6=symbol(NIL),p7=symbol(NIL),p8=symbol(NIL),p9=symbol(NIL),std_symbol("abs",ABS),std_symbol("add",ADD),std_symbol("adj",ADJ),std_symbol("and",AND),std_symbol("approxratio",APPROXRATIO),std_symbol("arccos",ARCCOS),std_symbol("arccosh",ARCCOSH),std_symbol("arcsin",ARCSIN),std_symbol("arcsinh",ARCSINH),std_symbol("arctan",ARCTAN),std_symbol("arctanh",ARCTANH),std_symbol("arg",ARG),std_symbol("atomize",ATOMIZE),std_symbol("besselj",BESSELJ),std_symbol("bessely",BESSELY),std_symbol("binding",BINDING),std_symbol("binomial",BINOMIAL),std_symbol("ceiling",CEILING),std_symbol("check",CHECK),std_symbol("choose",CHOOSE),std_symbol("circexp",CIRCEXP),std_symbol("clear",CLEAR),std_symbol("clearall",CLEARALL),std_symbol("clearpatterns",CLEARPATTERNS),std_symbol("clock",CLOCK),std_symbol("coeff",COEFF),std_symbol("cofactor",COFACTOR),std_symbol("condense",CONDENSE),std_symbol("conj",CONJ),std_symbol("contract",CONTRACT),std_symbol("cos",COS),std_symbol("cosh",COSH),std_symbol("decomp",DECOMP),std_symbol("defint",DEFINT),std_symbol("deg",DEGREE),std_symbol("denominator",DENOMINATOR),std_symbol("det",DET),std_symbol("derivative",DERIVATIVE),std_symbol("dim",DIM),std_symbol("dirac",DIRAC),std_symbol("divisors",DIVISORS),std_symbol("do",DO),std_symbol("dot",DOT),std_symbol("draw",DRAW),std_symbol("dsolve",DSOLVE),std_symbol("erf",ERF),std_symbol("erfc",ERFC),std_symbol("eigen",EIGEN),std_symbol("eigenval",EIGENVAL),std_symbol("eigenvec",EIGENVEC),std_symbol("eval",EVAL),std_symbol("exp",EXP),std_symbol("expand",EXPAND),std_symbol("expcos",EXPCOS),std_symbol("expsin",EXPSIN),std_symbol("factor",FACTOR),std_symbol("factorial",FACTORIAL),std_symbol("factorpoly",FACTORPOLY),std_symbol("filter",FILTER),std_symbol("float",FLOATF),std_symbol("floor",FLOOR),std_symbol("for",FOR),std_symbol("function",FUNCTION),std_symbol("Gamma",GAMMA),std_symbol("gcd",GCD),std_symbol("hermite",HERMITE),std_symbol("hilbert",HILBERT),std_symbol("imag",IMAG),std_symbol("component",INDEX),std_symbol("inner",INNER),std_symbol("integral",INTEGRAL),std_symbol("inv",INV),std_symbol("invg",INVG),std_symbol("isinteger",ISINTEGER),std_symbol("isprime",ISPRIME),std_symbol("laguerre",LAGUERRE),std_symbol("lcm",LCM),std_symbol("leading",LEADING),std_symbol("legendre",LEGENDRE),std_symbol("log",LOG),std_symbol("lookup",LOOKUP),std_symbol("mod",MOD),std_symbol("multiply",MULTIPLY),std_symbol("not",NOT),std_symbol("nroots",NROOTS),std_symbol("number",NUMBER),std_symbol("numerator",NUMERATOR),std_symbol("operator",OPERATOR),std_symbol("or",OR),std_symbol("outer",OUTER),std_symbol("pattern",PATTERN),std_symbol("patternsinfo",PATTERNSINFO),std_symbol("polar",POLAR),std_symbol("power",POWER),std_symbol("prime",PRIME),std_symbol("print",PRINT),std_symbol("print2dascii",PRINT2DASCII),std_symbol("printcomputer",PRINTFULL),std_symbol("printlatex",PRINTLATEX),std_symbol("printlist",PRINTLIST),std_symbol("printhuman",PRINTPLAIN),std_symbol("printLeaveEAlone",PRINT_LEAVE_E_ALONE),std_symbol("printLeaveXAlone",PRINT_LEAVE_X_ALONE),std_symbol("product",PRODUCT),std_symbol("quote",QUOTE),std_symbol("quotient",QUOTIENT),std_symbol("rank",RANK),std_symbol("rationalize",RATIONALIZE),std_symbol("real",REAL),std_symbol("rect",YYRECT),std_symbol("roots",ROOTS),std_symbol("round",ROUND),std_symbol("equals",SETQ),std_symbol("sgn",SGN),std_symbol("silentpattern",SILENTPATTERN),std_symbol("simplify",SIMPLIFY),std_symbol("sin",SIN),std_symbol("sinh",SINH),std_symbol("shape",SHAPE),std_symbol("sqrt",SQRT),std_symbol("stop",STOP),std_symbol("subst",SUBST),std_symbol("sum",SUM),std_symbol("symbolsinfo",SYMBOLSINFO),std_symbol("tan",TAN),std_symbol("tanh",TANH),std_symbol("taylor",TAYLOR),std_symbol("test",TEST),std_symbol("testeq",TESTEQ),std_symbol("testge",TESTGE),std_symbol("testgt",TESTGT),std_symbol("testle",TESTLE),std_symbol("testlt",TESTLT),std_symbol("transpose",TRANSPOSE),std_symbol("unit",UNIT),std_symbol("zero",ZERO),std_symbol("nil",NIL),std_symbol("autoexpand",AUTOEXPAND),std_symbol("bake",BAKE),std_symbol("assumeRealVariables",ASSUME_REAL_VARIABLES),std_symbol("last",LAST),std_symbol("lastprint",LAST_PRINT),std_symbol("last2dasciiprint",LAST_2DASCII_PRINT),std_symbol("lastfullprint",LAST_FULL_PRINT),std_symbol("lastlatexprint",LAST_LATEX_PRINT),std_symbol("lastlistprint",LAST_LIST_PRINT),std_symbol("lastplainprint",LAST_PLAIN_PRINT),std_symbol("trace",TRACE),std_symbol("forceFixedPrintout",FORCE_FIXED_PRINTOUT),std_symbol("maxFixedPrintoutDigits",MAX_FIXED_PRINTOUT_DIGITS),std_symbol("~",YYE),std_symbol("$DRAWX",DRAWX),std_symbol("$METAA",METAA),std_symbol("$METAB",METAB),std_symbol("$METAX",METAX),std_symbol("$SECRETX",SECRETX),std_symbol("version",VERSION),std_symbol("pi",PI),std_symbol("a",SYMBOL_A),std_symbol("b",SYMBOL_B),std_symbol("c",SYMBOL_C),std_symbol("d",SYMBOL_D),std_symbol("i",SYMBOL_I),std_symbol("j",SYMBOL_J),std_symbol("n",SYMBOL_N),std_symbol("r",SYMBOL_R),std_symbol("s",SYMBOL_S),std_symbol("t",SYMBOL_T),std_symbol("x",SYMBOL_X),std_symbol("y",SYMBOL_Y),std_symbol("z",SYMBOL_Z),std_symbol("I",SYMBOL_IDENTITY_MATRIX),std_symbol("a_",SYMBOL_A_UNDERSCORE),std_symbol("b_",SYMBOL_B_UNDERSCORE),std_symbol("x_",SYMBOL_X_UNDERSCORE),std_symbol("$C1",C1),std_symbol("$C2",C2),std_symbol("$C3",C3),std_symbol("$C4",C4),std_symbol("$C5",C5),std_symbol("$C6",C6),defineSomeHandyConstants(),n=codeGen,codeGen=!1,t=e=0,o=defn_str.length;0<=o?e<o:e>o;t=0<=o?++e:--e)r=defn_str[t],scan(r),DEBUG&&(console.log("... evaling "+r),console.log("top of stack:"),console.log(print_list(stack[tos-1]))),Eval(),pop();return codeGen=n},defineSomeHandyConstants=function(){return zero=new_integer(0),one=new_integer(1),push_double(1),one_as_double=pop(),push_symbol(POWER),DEBUG&&console.log(print_list(stack[tos-1])),push_integer(-1),DEBUG&&console.log(print_list(stack[tos-1])),push_rational(1,2),DEBUG&&console.log(print_list(stack[tos-1])),list(3),DEBUG&&console.log(print_list(stack[tos-1])),imaginaryunit=pop()},mcmp=function(r,t){return r.compare(t)},mcmpint=function(r,t){var e;return e=bigInt(t),mcmp(r,e)},strcmp=function(r,t){return r===t?0:r>t?1:-1},doubleToReasonableString=function(r){var t,e;return codeGen?""+r:(isZeroAtomOrTensor(get_binding(symbol(FORCE_FIXED_PRINTOUT)))?(e=""+r,e=printMode===PRINTMODE_LATEX?/\d*\.\d*e.*/gm.test(e)?e.replace(/e(.*)/gm,"\\mathrm{e}{$1}"):e.replace(/(\d+)e(.*)/gm,"$1.0\\mathrm{e}{$2}"):/\d*\.\d*e.*/gm.test(e)?e.replace(/e(.*)/gm,"*10^($1)"):e.replace(/(\d+)e(.*)/gm,"$1.0*10^($2)")):(push(get_binding(symbol(MAX_FIXED_PRINTOUT_DIGITS))),t=pop_integer(),-1===(e=(e=(e=""+r.toFixed(t)).replace(/(\.\d*?[1-9])0+$/gm,"$1")).replace(/\.0+$/gm,"")).indexOf(".")&&(e+=".0"),parseFloat(e)!==r&&(e=r.toFixed(t)+"...")),e)},clear_term=function(){},isspace=function(r){return null!=r&&(" "===r||"	"===r||"\n"===r||"\v"===r||"\f"===r||"\r"===r)},isdigit=function(r){return null!=r&&/^\d+$/.test(r)},isalpha=function(r){return null!=r&&-1===r.search(/[^A-Za-z]/)},isalphaOrUnderscore=function(r){return null!=r&&-1===r.search(/[^A-Za-z_]/)},isunderscore=function(r){return null!=r&&-1===r.search(/_/)},isalnumorunderscore=function(r){return null!=r&&(isalphaOrUnderscore(r)||isdigit(r))},count=function(r){var t;if(iscons(r))for(t=0;iscons(r);)t+=count(car(r))+1,r=cdr(r);else t=1;return t},countOccurrencesOfSymbol=function(r,t){var e;if(e=0,iscons(t))for(;iscons(t);)e+=countOccurrencesOfSymbol(r,car(t)),t=cdr(t);else equal(r,t)&&(e=1);return e},countsize=function(r){var t,e,n,o;if(n=0,istensor(r))for(t=e=0,o=r.tensor.nelem;0<=o?e<o:e>o;t=0<=o?++e:--e)n+=r.tensor.elem[t];else if(iscons(r))for(;iscons(r);)n+=count(car(r))+1,r=cdr(r);else n=1;return n},stop=function(r){var t;throw errorMessage+="Stop: ",errorMessage+=r,t=errorMessage,errorMessage="",moveTos(0),Error(t)},findDependenciesInScript=function(r,t){var e,n,o,i,a,s,u,f,l,c,p,x,g,h,d,m,v,b,y,q,k,w,M,_,A,S,E,N,O,P,I,R,T,C,L,B,j,D,z,$,U,F,Z,J,V,X,G,Y,W,Q;for(DEBUG&&console.log("stringToBeParsed: "+r),V=new Date().getTime(),h=!0,codeGen=!0,symbolsDependencies={},symbolsHavingReassignments=[],symbolsInExpressionsWithoutAssignments=[],patternHasBeenFound=!1,g=0,n="",e="",S=0,s={affectsVariables:[],affectedBy:[]},F=r;;){try{errorMessage="",check_stack(),DEBUG&&console.log("findDependenciesInScript: scanning"),S=scan(r.substring(g)),DEBUG&&console.log("scanned"),pop(),check_stack()}catch(r){f=r,PRINTOUTRESULT&&console.log(f),errorMessage=f+"",reset_after_error();break}if(0===S)break;g+=S}for(d in J="",DEBUG&&console.log("all local dependencies ----------------"),J+="All local dependencies: ",symbolsDependencies){for(W=symbolsDependencies[d],DEBUG&&console.log("variable "+d+" depends on: "),s.affectsVariables.push(d),J+=" variable "+d+" depends on: ",m=0,v=W.length;m<v;m++)p=W[m],DEBUG&&console.log("    "+p),"'"!==p[0]&&s.affectedBy.push(p),J+=p+", ";J+="; "}for(J+=". ",DEBUG&&console.log("Symbols with reassignments ----------------"),J+="Symbols with reassignments: ",A=0,b=symbolsHavingReassignments.length;A<b;A++)d=symbolsHavingReassignments[A],-1===s.affectedBy.indexOf(d)&&(s.affectedBy.push(d),J+=d+", ");for(J+=". ",DEBUG&&console.log("Symbols in expressions without assignments ----------------"),J+="Symbols in expressions without assignments: ",E=0,y=symbolsInExpressionsWithoutAssignments.length;E<y;E++)d=symbolsInExpressionsWithoutAssignments[E],-1===s.affectedBy.indexOf(d)&&(s.affectedBy.push(d),J+=d+", ");if(J+=". ",s.affectedBy.push("PATTERN_DEPENDENCY"),patternHasBeenFound&&(s.affectsVariables.push("PATTERN_DEPENDENCY"),J+=" - PATTERN_DEPENDENCY inserted - "),DEBUG&&console.log("All dependencies recursively ----------------"),J+="All dependencies recursively: ",U=["",""],c="",L="",""===errorMessage&&!t){try{n="",e="",U=run(r,!0),n="",e=""}catch(r){f=r,PRINTOUTRESULT&&console.log(f),errorMessage=f+"",init()}if(""===errorMessage)for(d in symbolsDependencies){for(codeGen=!0,DEBUG&&console.log("  variable "+d+" is: "+get_binding(usr_symbol(d)).toString()),codeGen=!1,DEBUG&&console.log("  variable "+d+" depends on: "),J+=" variable "+d+" depends on: ",recursiveDependencies(d,B=[],[],Q=[],[],i=[]),O=0,q=Q.length;O<q;O++)p=Q[O],DEBUG&&console.log("    --\x3e cycle through "+p);for(T=0,k=B.length;T<k;T++)p=B[T],DEBUG&&console.log("    "+p),J+=p+", ";for(J+="; ",C=0,w=i.length;C<w;C++)J+=" "+(p=i[C])+", ";for(DEBUG&&console.log("  code generation:"+d+" is: "+get_binding(usr_symbol(d)).toString()),push(get_binding(usr_symbol(d))),D=[],z=[],$=0,M=B.length;$<M;$++)"'"===(u=B[$])[0]&&(a=u.substring(1),I=usr_symbol(a),N=usr_symbol("AVOID_BINDING_TO_EXTERNAL_SCOPE_VALUE"+a),D.push(I),z.push(N),push(I),push(N),subst(),DEBUG&&console.log("after substitution: "+stack[tos-1]));try{simplifyForCodeGeneration()}catch(r){f=r,PRINTOUTRESULT&&console.log(f),errorMessage=f+"",init()}for(x=Z=0,j=D.length;0<=j?Z<j:Z>j;x=0<=j?++Z:--Z)push(z[x]),push(D[x]),subst();if(clearRenamedVariablesToAvoidBindingToExternalScope(),""===errorMessage){if(X=pop(),collectUserSymbols(X,Y=[]),n="",e="",codeGen=!0,l=X.toString(),codeGen=!1,P=printMode,printMode=PRINTMODE_LATEX,o=X.toString(),printMode=P,-1!==Q.indexOf(d))c+="// "+d+" is part of a cyclic dependency, no code generated.",L+="#"+d+" is part of a cyclic dependency, no code generated.";else if(0!==(Y=(Y=Y.filter(function(r){return -1===predefinedSymbolsInGlobalScope_doNotTrackInDependencies.indexOf(r+"")})).filter(function(r){return -1!==B.indexOf(r+"")||-1!==B.indexOf("'"+r)})).length){for(G=0,R="(",_=Y.length;G<_;G++)(p=Y[G]).printname!==d&&(R+=p.printname+", ");c+=d+" = function "+(R=R.replace(/, $/gm,"")+")")+" { return ( "+l+" ); }",L+=d+R+" = "+o}else c+=d+" = "+l+";",L+=d+" = "+o;c+="\n",L+="\n",DEBUG&&console.log("    "+c)}}}return c=c.replace(/\n$/gm,""),L=L.replace(/\n$/gm,""),symbolsDependencies={},symbolsHavingReassignments=[],patternHasBeenFound=!1,symbolsInExpressionsWithoutAssignments=[],DEBUG&&console.log("testable string: "+J),TIMING_DEBUGS&&console.log("findDependenciesInScript time for: "+F+" : "+(new Date().getTime()-V)+"ms"),[J,U[0],c,L,U[1],errorMessage,s]},recursiveDependencies=function(r,t,e,n,o,i){var a,s,u,f,l,c,p,x;if(e.push(r),null!=symbolsDependencies[o[o.length-1]]&&-1!==symbolsDependencies[o[o.length-1]].indexOf("'"+r))return DEBUG&&console.log("can't keep following the chain of "+r+" because it's actually a variable bound to a parameter"),-1===t.indexOf("'"+r)&&-1===t.indexOf(r)&&t.push(r),t;if(o.push(r),null==symbolsDependencies[r])return -1===t.indexOf(r)&&t.push(r),t;for(f=0,l=(x=symbolsDependencies[r]).length;f<l;f++)if(s=x[f],-1!==o.indexOf(s)){for(DEBUG&&console.log("  found cycle:"),a="",p=0,c=o.length;p<c;p++)u=o[p],-1===n.indexOf(u)&&n.push(u),DEBUG&&console.log(u+" --\x3e "),a+=u+" --\x3e ";DEBUG&&console.log(" ... then "+s+" again"),a+=" ... then "+s+" again",i.push(a),-1===n.indexOf(s)&&n.push(s)}else recursiveDependencies(s,t,e,n,o,i),o.pop();return t},inited=!1,latexErrorSign="\\rlap{\\large\\color{red}\\bigtriangleup}{\\ \\ \\tiny\\color{red}!}",turnErrorMessageToLatex=function(r){return"$$\\text{"+(r=(r=(r=(r=(r=(r=(r=r.replace(/\n/g,"")).replace(/_/g,"} \\_ \\text{")).replace(RegExp(String.fromCharCode(transpose_unicode),"g"),"}{}^{T}\\text{")).replace(RegExp(String.fromCharCode(dotprod_unicode),"g"),"}\\cdot \\text{")).replace("Stop:","}  \\quad \\text{Stop:")).replace("->","}  \\rightarrow \\text{")).replace("?","}\\enspace "+latexErrorSign+" \\enspace  \\text{")).replace(/\n/g,"")+"}$$"},normaliseDots=function(r){return(r=(r=(r=(r=r.replace(RegExp(String.fromCharCode(8901),"g"),String.fromCharCode(dotprod_unicode))).replace(RegExp(String.fromCharCode(8226),"g"),String.fromCharCode(dotprod_unicode))).replace(RegExp(String.fromCharCode(12539),"g"),String.fromCharCode(dotprod_unicode))).replace(RegExp(String.fromCharCode(55296),"g"),String.fromCharCode(dotprod_unicode))).replace(RegExp(String.fromCharCode(65381),"g"),String.fromCharCode(dotprod_unicode))},TIMING_DEBUGS=!1,run=function(r,t=!1){var e,n,o,i,a,s,u,f,l,c,p;if(p=new Date().getTime(),"selftest"===(r=normaliseDots(r)))return void selftest();for(inited||(inited=!0,init()),u=0,l=0,f=0,n="",e="";;){try{errorMessage="",check_stack(),l=scan(r.substring(f)),p1=pop(),check_stack()}catch(r){a=r,PRINTOUTRESULT&&console.log(a),n+=a.message,t&&(e+=turnErrorMessageToLatex(a.message)),reset_after_error();break}if(0===l)break;f+=l,push(p1),s=!1;try{stringsEmittedByUserPrintouts="",top_level_eval(),p2=pop(),check_stack(),isstr(p2)&&(DEBUG&&console.log(p2.str),DEBUG&&console.log("\n")),p2===symbol(NIL)?(i=stringsEmittedByUserPrintouts,t&&(o="$$"+stringsEmittedByUserPrintouts+"$$")):(i=print_expr(p2)+"\n",t&&(o="$$"+collectLatexStringFromReturnValue(p2)+"$$",DEBUG&&console.log("collectedLatexResult: "+o))),n+=i,t&&(e+=o),PRINTOUTRESULT&&(DEBUG&&console.log("printline"),DEBUG&&console.log(i)),PRINTOUTRESULT&&(DEBUG&&console.log("display:"),print2dascii(p2)),t&&(e+="\n")}catch(r){s=!0,i=(a=r).message,t&&(o=turnErrorMessageToLatex(a.message)),PRINTOUTRESULT&&console.log(i),n+=i,""!==i&&(n+="\n"),t&&(e+=o,e+="\n"),init()}}return"\n"===n[n.length-1]&&(n=n.substring(0,n.length-1)),t&&"\n"===e[e.length-1]&&(e=e.substring(0,e.length-1)),t?(DEBUG&&console.log("allReturnedLatexStrings: "+e),c=[n,e]):c=n,TIMING_DEBUGS&&console.log("run time on: "+r+" : "+(new Date().getTime()-p)+"ms"),n="",e="",c},check_stack=function(){if(0!==tos&&stop("stack error"),frame!==TOS&&stop("frame error"),0!==chainOfUserSymbolsNotFunctionsBeingEvaluated.length&&stop("symbols evaluation still ongoing?"),0!==evaluatingAsFloats&&stop("numeric evaluation still ongoing?"),0!==evaluatingPolar)return stop("evaluation of polar still ongoing?")},top_level_eval=function(){var r,t,e;if(DEBUG&&console.log("#### top level eval"),trigmode=0,e=symbol(AUTOEXPAND),expanding=+!isZeroAtomOrTensor(get_binding(e)),t=top(),Eval(),(r=top())!==symbol(NIL)){if(set_binding(symbol(LAST),r),isZeroAtomOrTensor(get_binding(symbol(BAKE)))||(bake(),r=top()),(t===symbol(SYMBOL_I)||t===symbol(SYMBOL_J))&&isimaginaryunit(r));else if(isimaginaryunit(get_binding(symbol(SYMBOL_J))))return push(imaginaryunit),push_symbol(SYMBOL_J),subst();else if(isimaginaryunit(get_binding(symbol(SYMBOL_I))))return push(imaginaryunit),push_symbol(SYMBOL_I),subst()}},check_esc_flag=function(){if(esc_flag)return stop("esc key")},clearAlgebraEnvironment=function(){return do_clearall()},computeDependenciesFromAlgebra=function(r){var t,e,n,o,i,a,s,u;if(DEBUG&&console.log("computeDependenciesFromAlgebra!!!"),s=r,e=!0,called_from_Algebra_block=!0,r=normaliseDots(r),!e){for(n=0,u="",o=(userSimplificationsInListForm=[]).length;n<o;n++)u+="silentpattern("+car(t=userSimplificationsInListForm[n])+","+car(cdr(t))+","+car(cdr(cdr(t)))+")\n";do_clearall(),r=u+r,DEBUG&&console.log("codeFromAlgebraBlock including patterns: "+r)}if(DEBUG){for(console.log("computeDependenciesFromAlgebra: patterns in the list --------------- "),a=0,i=userSimplificationsInListForm.length;a<i;a++)console.log(car(t=userSimplificationsInListForm[a])+","+cdr(t)+")");console.log("...end of list --------------- ")}return called_from_Algebra_block=!1,findDependenciesInScript(r,!0)[6]},computeResultsAndJavaScriptFromAlgebra=function(r){var t,e,n,o,i,a,s,u,f,l,c,p,x,g,h,d;if(l=r,o=!0,called_from_Algebra_block=!0,h=new Date().getTime(),TIMING_DEBUGS&&console.log(" --------- computeResultsAndJavaScriptFromAlgebra input: "+r+" at: "+new Date),x=r=normaliseDots(r),DEBUG){for(console.log("computeResultsAndJavaScriptFromAlgebra: patterns in the list --------------- "),i=0,s=userSimplificationsInListForm.length;i<s;i++)console.log(car(n=userSimplificationsInListForm[i])+","+cdr(n)+")");console.log("...end of list --------------- ")}if(!o){for(f=0,d="",u=(userSimplificationsInListForm=[]).length;f<u;f++)d+="silentpattern("+car(n=userSimplificationsInListForm[f])+","+car(cdr(n))+","+car(cdr(cdr(n)))+")\n";do_clearall(),r=d+r,DEBUG&&console.log("codeFromAlgebraBlock including patterns: "+r)}return[g,p,t,c,a,errorMessage,e]=findDependenciesInScript(r),called_from_Algebra_block=!1,(""!==c||""!==errorMessage)&&(p+="\n"+c,""!==errorMessage&&(p+="\n"+errorMessage),p=p.replace(/\n/g,"\n\n"),a+="\n$$"+c+"$$",""!==errorMessage&&(a+=turnErrorMessageToLatex(errorMessage)),a=a.replace(/\n/g,"\n\n")),a=(a=a.replace(/\n*/,"")).replace(/\$\$\$\$\n*/g,""),t=(t=t.replace(/Math\./g,"")).replace(/\n/g,"\n\n"),TIMING_DEBUGS&&console.log("computeResultsAndJavaScriptFromAlgebra time (total time from notebook and back) for: "+x+" : "+(new Date().getTime()-h)+"ms"),{code:t,result:a,latexResult:a,dependencyInfo:e}},(null!==exports?exports:this).run=run,(null!==exports?exports:this).findDependenciesInScript=findDependenciesInScript,(null!==exports?exports:this).computeDependenciesFromAlgebra=computeDependenciesFromAlgebra,(null!==exports?exports:this).computeResultsAndJavaScriptFromAlgebra=computeResultsAndJavaScriptFromAlgebra,(null!==exports?exports:this).clearAlgebraEnvironment=clearAlgebraEnvironment,tos=0,nil_symbols=0,push=function(r){return r.isZero,r===symbol(NIL)&&(nil_symbols++,DEBUG&&console.log("pushing symbol(NIL) #"+nil_symbols)),tos>=frame&&stop("stack overflow"),stack[tos++]=r},moveTos=function(r){if(tos<=r){tos=r;return}for(;tos>r;)stack[tos]=null,tos--},top=function(){return stack[tos-1]},pop=function(){var r;return 0===tos&&stop("stack underflow"),stack[tos-1],r=stack[--tos],stack[tos]=null,r},push_frame=function(r){var t,e,n,o;for(t=0,(frame-=r)<tos&&stop("frame overflow, circular reference?"),o=[],t=e=0,n=r;0<=n?e<n:e>n;t=0<=n?++e:--e)o.push(stack[frame+t]=symbol(NIL));return o},pop_frame=function(r){if((frame+=r)>TOS)return stop("frame underflow")},save=function(){return(frame-=10)<tos&&stop("frame overflow, circular reference?"),stack[frame+0]=p0,stack[frame+1]=p1,stack[frame+2]=p2,stack[frame+3]=p3,stack[frame+4]=p4,stack[frame+5]=p5,stack[frame+6]=p6,stack[frame+7]=p7,stack[frame+8]=p8,stack[frame+9]=p9},restore=function(){return frame>TOS-10&&stop("frame underflow"),p0=stack[frame+0],p1=stack[frame+1],p2=stack[frame+2],p3=stack[frame+3],p4=stack[frame+4],p5=stack[frame+5],p6=stack[frame+6],p7=stack[frame+7],p8=stack[frame+8],p9=stack[frame+9],frame+=10},swap=function(){var r,t;return r=pop(),t=pop(),push(r),push(t)},dupl=function(){var r;return r=pop(),push(r),push(r)},$.dupl=dupl,$.swap=swap,$.restore=restore,$.save=save,$.push=push,$.pop=pop,Eval_symbolsinfo=function(){var r;return""!==(r=symbolsinfo())?push(new_string(r)):push_symbol(NIL)},symbolsinfo=function(){var r,t,e,n,o,i,a;for(i="",t=e=n=NIL+1,o=symtab.length;n<=o?e<o:e>o;t=n<=o?++e:--e){if(""===symtab[t].printname)if(!1!==isSymbolReclaimable[t])continue;else break;a=symtab[t]+"",r=(binding[t]+"").substring(0,4),i+="symbol: "+a+" size: "+countsize(binding[t])+" value: "+r+"...\n"}return i},std_symbol=function(r,t,e){var n;return((n=symtab[t]).printname=r,null!=e)?n.latexPrint=e:n.latexPrint=r},usr_symbol=function(r){var t,e,n;for(t=0,t=e=0,n=NSYM;0<=n?e<n:e>n;t=0<=n?++e:--e){if(r===symtab[t].printname)return symtab[t];if(""===symtab[t].printname)break}return t===NSYM&&stop("symbol table overflow"),symtab[t]=new U,symtab[t].k=SYM,symtab[t].printname=r,binding[t]=symtab[t],isSymbolReclaimable[t]=!1,symtab[t]},get_printname=function(r){return r.k!==SYM&&stop("symbol error"),r.printname},set_binding=function(r,t){var e;return r.k!==SYM&&stop("symbol error"),e=symtab.indexOf(r),-1!==symtab.indexOf(r,e+1)&&console.log("ops, more than one element!"),DEBUG&&console.log("lookup >> set_binding lookup "+e),isSymbolReclaimable[e]=!1,binding[e]=t},get_binding=function(r){var t;return r.k!==SYM&&stop("symbol error"),t=symtab.indexOf(r),-1!==symtab.indexOf(r,t+1)&&console.log("ops, more than one element!"),DEBUG&&console.log("lookup >> get_binding lookup "+t),binding[t]},is_usr_symbol=function(r){var t;return r.k===SYM&&!!((t=symnum(r))>PI)&&t!==SYMBOL_I&&t!==SYMBOL_IDENTITY_MATRIX},lookupsTotal=0,symnum=function(r){var t;return lookupsTotal++,r.k!==SYM&&stop("symbol error"),t=symtab.indexOf(r),-1!==symtab.indexOf(r,t+1)&&console.log("ops, more than one element!"),DEBUG&&console.log("lookup >> symnum lookup "+t+" lookup # "+lookupsTotal),t},push_symbol=function(r){return push(symtab[r])},clear_symbols=function(){var r,t,e,n,o;for(o=[],r=t=e=NIL+1,n=NSYM;e<=n?t<n:t>n;r=e<=n?++t:--t){if(""===symtab[r].printname)if(!1!==isSymbolReclaimable[r])continue;else break;symtab[r]=new U,symtab[r].k=SYM,binding[r]=symtab[r],o.push(isSymbolReclaimable[r]=!1)}return o},collectUserSymbols=function(r,t=[]){var e,n,o;if(is_usr_symbol(r)&&-1===t.indexOf(r))return void t.push(r);if(istensor(r)){for(e=n=0,o=r.tensor.nelem;0<=o?n<o:n>o;e=0<=o?++n:--n)collectUserSymbols(r.tensor.elem[e],t);return}for(;iscons(r);)collectUserSymbols(car(r),t),r=cdr(r)},$.get_binding=get_binding,$.set_binding=set_binding,$.usr_symbol=usr_symbol,$.symbolsinfo=symbolsinfo,$.collectUserSymbols=collectUserSymbols,inited||(inited=!0,init()),$.init=init,parse_internal=function(r){if("string"==typeof r)return scan(r);if("number"==typeof r)if(r%1==0)return push_integer(r);else return push_double(r);return r instanceof U?push(r):(console.warn("unknown argument type",r),push(symbol(NIL)))},parse=function(r){var t,e;try{parse_internal(r),t=pop(),check_stack()}catch(r){throw e=r,reset_after_error(),e}return t},exec=function(r,...t){var e,n,o,i,a;for(n=get_binding(usr_symbol(r)),check_stack(),push(n),o=0,i=t.length;o<i;o++)parse_internal(t[o]);list(1+t.length),p1=pop(),push(p1);try{top_level_eval(),a=pop(),check_stack()}catch(r){throw e=r,reset_after_error(),e}return a},$.exec=exec,$.parse=parse,function(){var r,t,e,n,o;for(e=0,o=[],n=(r=["abs","add","adj","and","approxratio","arccos","arccosh","arcsin","arcsinh","arctan","arctanh","arg","atomize","besselj","bessely","binding","binomial","ceiling","check","choose","circexp","clear","clearall","clearpatterns","clock","coeff","cofactor","condense","conj","contract","cos","cosh","decomp","defint","deg","denominator","det","derivative","dim","dirac","divisors","do","dot","draw","dsolve","eigen","eigenval","eigenvec","erf","erfc","eval","exp","expand","expcos","expsin","factor","factorial","factorpoly","filter","float","floor","for","Gamma","gcd","hermite","hilbert","imag","component","inner","integral","inv","invg","isinteger","isprime","laguerre","lcm","leading","legendre","log","mod","multiply","not","nroots","number","numerator","operator","or","outer","pattern","patternsinfo","polar","power","prime","print","print2dascii","printcomputer","printlatex","printlist","printhuman","product","quote","quotient","rank","rationalize","real","rect","roots","round","equals","shape","sgn","silentpattern","simplify","sin","sinh","sqrt","stop","subst","sum","symbolsinfo","tan","tanh","taylor","test","testeq","testge","testgt","testle","testlt","transpose","unit","zero"]).length;e<n;e++)t=r[e],o.push($[t]=exec.bind(this,t))}(),freeze=function(){var r,t,e,n,o,i,a;for(n=[],r=[],e=[],t="",o=i=0,a=symtab.length;0<=a?i<a:i>a;o=0<=a?++i:--i)!1===isSymbolReclaimable[o]&&(n.push(symtab[o]),r.push(binding[o]));return[n,r,e=userSimplificationsInListForm.slice(0),zero,one,imaginaryunit,getStateHash()]},unfreeze=function(r){var t,e,n,o,i,a;for([n,t,e,zero,one,imaginaryunit]=r,o=i=0,a=n.length;0<=a?i<a:i>a;o=0<=a?++i:--i)symtab[o]=n[o],binding[o]=t[o];return userSimplificationsInListForm=e.slice(0)},compareState=function(r){return getStateHash()===r},getStateHash=function(){var r,t,e,n,o,i,a;for(r="",t=e=i=NIL+1,a=symtab.length;i<=a?e<a:e>a;t=i<=a?++e:--e){if(""===symtab[t].printname)if(!1!==isSymbolReclaimable[t])continue;else break;r+=" //"+print_list(symtab[t])+" : "+print_list(binding[t])}for(o=0,n=userSimplificationsInListForm.length;o<n;o++)r+=" pattern: "+(t=userSimplificationsInListForm[o]);return DEBUG&&console.log("frozenHash: "+r),r}}).call(this)}),parcelRegister("8gM4d",function(r,t){var e=function(){"use strict";var r=1e7,t=7,n=0x20000000000000,o=p(0x20000000000000),i="0123456789abcdefghijklmnopqrstuvwxyz",a="function"==typeof BigInt;function s(r,t,e,n){return void 0===r?s[0]:void 0!==t&&(10!=+t||e)?Q(r,t,e,n):ro(r)}function u(r,t){this.value=r,this.sign=t,this.isSmall=!1}function f(r){this.value=r,this.sign=r<0,this.isSmall=!0}function l(r){this.value=r}function c(r){return-n<r&&r<n}function p(r){return r<1e7?[r]:r<1e14?[r%1e7,Math.floor(r/1e7)]:[r%1e7,Math.floor(r/1e7)%1e7,Math.floor(r/1e14)]}function x(t){g(t);var e=t.length;if(e<4&&0>T(t,o))switch(e){case 0:return 0;case 1:return t[0];case 2:return t[0]+t[1]*r;default:return t[0]+(t[1]+t[2]*r)*r}return t}function g(r){for(var t=r.length;0===r[--t];);r.length=t+1}function h(r){for(var t=Array(r),e=-1;++e<r;)t[e]=0;return t}function d(r){return r>0?Math.floor(r):Math.ceil(r)}function m(t,e){var n,o,i=t.length,a=e.length,s=Array(i),u=0,f=r;for(o=0;o<a;o++)u=+((n=t[o]+e[o]+u)>=f),s[o]=n-u*f;for(;o<i;)u=+((n=t[o]+u)===f),s[o++]=n-u*f;return u>0&&s.push(u),s}function v(r,t){return r.length>=t.length?m(r,t):m(t,r)}function b(t,e){var n,o,i=t.length,a=Array(i),s=r;for(o=0;o<i;o++)e=Math.floor((n=t[o]-s+e)/s),a[o]=n-e*s,e+=1;for(;e>0;)a[o++]=e%s,e=Math.floor(e/s);return a}function y(t,e){var n,o,i=t.length,a=e.length,s=Array(i),u=0,f=r;for(n=0;n<a;n++)(o=t[n]-u-e[n])<0?(o+=f,u=1):u=0,s[n]=o;for(n=a;n<i;n++){if((o=t[n]-u)<0)o+=f;else{s[n++]=o;break}s[n]=o}for(;n<i;n++)s[n]=t[n];return g(s),s}function q(r,t,e){var n;return(T(r,t)>=0?n=y(r,t):(n=y(t,r),e=!e),"number"==typeof(n=x(n)))?(e&&(n=-n),new f(n)):new u(n,e)}function k(t,e,n){var o,i,a=t.length,s=Array(a),l=-e,c=r;for(o=0;o<a;o++)l=Math.floor((i=t[o]+l)/c),i%=c,s[o]=i<0?i+c:i;return"number"==typeof(s=x(s))?(n&&(s=-s),new f(s)):new u(s,n)}function w(t,e){var n,o,i,a,s=t.length,u=e.length,f=h(s+u),l=r;for(i=0;i<s;++i){a=t[i];for(var c=0;c<u;++c)o=Math.floor((n=a*e[c]+f[i+c])/l),f[i+c]=n-o*l,f[i+c+1]+=o}return g(f),f}function M(t,e){var n,o,i=t.length,a=Array(i),s=r,u=0;for(o=0;o<i;o++)u=Math.floor((n=t[o]*e+u)/s),a[o]=n-u*s;for(;u>0;)a[o++]=u%s,u=Math.floor(u/s);return a}function _(r,t){for(var e=[];t-- >0;)e.push(0);return e.concat(r)}function A(r,t){var e=Math.max(r.length,t.length);if(e<=30)return w(r,t);e=Math.ceil(e/2);var n=r.slice(e),o=r.slice(0,e),i=t.slice(e),a=t.slice(0,e),s=A(o,a),u=A(n,i),f=A(v(o,n),v(a,i)),l=v(v(s,_(y(y(f,s),u),e)),_(u,2*e));return g(l),l}function S(r,t){return -.012*r-.012*t+15e-6*r*t>0}function E(t,e,n){return t<r?new u(M(e,t),n):new u(w(e,p(t)),n)}function N(t){var e,n,o,i,a=t.length,s=h(a+a),u=r;for(o=0;o<a;o++){n=0-(i=t[o])*i;for(var f=o;f<a;f++)n=Math.floor((e=i*t[f]*2+s[o+f]+n)/u),s[o+f]=e-n*u;s[o+a]=n}return g(s),s}function O(t,e){var n,o,i,a,s,u,f,l=t.length,c=e.length,p=r,g=h(e.length),d=e[c-1],m=Math.ceil(p/(2*d)),v=M(t,m),b=M(e,m);for(v.length<=l&&v.push(0),b.push(0),d=b[c-1],o=l-c;o>=0;o--){for(n=p-1,v[o+c]!==d&&(n=Math.floor((v[o+c]*p+v[o+c-1])/d)),i=0,a=0,u=b.length,s=0;s<u;s++)i+=n*b[s],f=Math.floor(i/p),a+=v[o+s]-(i-f*p),i=f,a<0?(v[o+s]=a+p,a=-1):(v[o+s]=a,a=0);for(;0!==a;){for(n-=1,i=0,s=0;s<u;s++)(i+=v[o+s]-p+b[s])<0?(v[o+s]=i+p,i=0):(v[o+s]=i,i=1);a+=i}g[o]=n}return v=I(v,m)[0],[x(g),x(v)]}function P(t,e){for(var n,o,i,a,s,u=t.length,f=e.length,l=[],c=[],p=r;u;){if(c.unshift(t[--u]),g(c),0>T(c,e)){l.push(0);continue}o=c.length,i=c[o-1]*p+c[o-2],a=e[f-1]*p+e[f-2],o>f&&(i=(i+1)*p),n=Math.ceil(i/a);do{if(0>=T(s=M(e,n),c))break;n--}while(n)l.push(n),c=y(c,s)}return l.reverse(),[x(l),x(c)]}function I(t,e){var n,o,i,a,s=t.length,u=h(s),f=r;for(i=0,n=s-1;n>=0;--n)o=d((a=i*f+t[n])/e),i=a-o*e,u[n]=0|o;return[u,0|i]}function R(t,e){var n,o,i=ro(e);if(a)return[new l(t.value/i.value),new l(t.value%i.value)];var c=t.value,g=i.value;if(0===g)throw Error("Cannot divide by zero");if(t.isSmall)return i.isSmall?[new f(d(c/g)),new f(c%g)]:[s[0],t];if(i.isSmall){if(1===g)return[t,s[0]];if(-1==g)return[t.negate(),s[0]];var h=Math.abs(g);if(h<r){n=x((o=I(c,h))[0]);var m=o[1];return(t.sign&&(m=-m),"number"==typeof n)?(t.sign!==i.sign&&(n=-n),[new f(n),new f(m)]):[new u(n,t.sign!==i.sign),new f(m)]}g=p(h)}var v=T(c,g);if(-1===v)return[s[0],t];if(0===v)return[s[t.sign===i.sign?1:-1],s[0]];n=(o=c.length+g.length<=200?O(c,g):P(c,g))[0];var b=t.sign!==i.sign,y=o[1],q=t.sign;return"number"==typeof n?(b&&(n=-n),n=new f(n)):n=new u(n,b),"number"==typeof y?(q&&(y=-y),y=new f(y)):y=new u(y,q),[n,y]}function T(r,t){if(r.length!==t.length)return r.length>t.length?1:-1;for(var e=r.length-1;e>=0;e--)if(r[e]!==t[e])return r[e]>t[e]?1:-1;return 0}function C(r){var t=r.abs();return!t.isUnit()&&(!!(t.equals(2)||t.equals(3)||t.equals(5))||!(t.isEven()||t.isDivisibleBy(3)||t.isDivisibleBy(5))&&(!!t.lesser(49)||void 0))}function L(r,t){for(var n,o,i,a=r.prev(),s=a,u=0;s.isEven();)s=s.divide(2),u++;r:for(o=0;o<t.length;o++)if(!r.lesser(t[o])&&!((i=e(t[o]).modPow(s,r)).isUnit()||i.equals(a))){for(n=u-1;0!=n&&!(i=i.square().mod(r)).isUnit();n--)if(i.equals(a))continue r;return!1}return!0}u.prototype=Object.create(s.prototype),f.prototype=Object.create(s.prototype),l.prototype=Object.create(s.prototype),u.prototype.add=function(r){var t=ro(r);if(this.sign!==t.sign)return this.subtract(t.negate());var e=this.value,n=t.value;return t.isSmall?new u(b(e,Math.abs(n)),this.sign):new u(v(e,n),this.sign)},u.prototype.plus=u.prototype.add,f.prototype.add=function(r){var t=ro(r),e=this.value;if(e<0!==t.sign)return this.subtract(t.negate());var n=t.value;if(t.isSmall){if(c(e+n))return new f(e+n);n=p(Math.abs(n))}return new u(b(n,Math.abs(e)),e<0)},f.prototype.plus=f.prototype.add,l.prototype.add=function(r){return new l(this.value+ro(r).value)},l.prototype.plus=l.prototype.add,u.prototype.subtract=function(r){var t=ro(r);if(this.sign!==t.sign)return this.add(t.negate());var e=this.value,n=t.value;return t.isSmall?k(e,Math.abs(n),this.sign):q(e,n,this.sign)},u.prototype.minus=u.prototype.subtract,f.prototype.subtract=function(r){var t=ro(r),e=this.value;if(e<0!==t.sign)return this.add(t.negate());var n=t.value;return t.isSmall?new f(e-n):k(n,Math.abs(e),e>=0)},f.prototype.minus=f.prototype.subtract,l.prototype.subtract=function(r){return new l(this.value-ro(r).value)},l.prototype.minus=l.prototype.subtract,u.prototype.negate=function(){return new u(this.value,!this.sign)},f.prototype.negate=function(){var r=this.sign,t=new f(-this.value);return t.sign=!r,t},l.prototype.negate=function(){return new l(-this.value)},u.prototype.abs=function(){return new u(this.value,!1)},f.prototype.abs=function(){return new f(Math.abs(this.value))},l.prototype.abs=function(){return new l(this.value>=0?this.value:-this.value)},u.prototype.multiply=function(t){var e,n=ro(t),o=this.value,i=n.value,a=this.sign!==n.sign;if(n.isSmall){if(0===i)return s[0];if(1===i)return this;if(-1===i)return this.negate();if((e=Math.abs(i))<r)return new u(M(o,e),a);i=p(e)}return S(o.length,i.length)?new u(A(o,i),a):new u(w(o,i),a)},u.prototype.times=u.prototype.multiply,f.prototype._multiplyBySmall=function(r){return c(r.value*this.value)?new f(r.value*this.value):E(Math.abs(r.value),p(Math.abs(this.value)),this.sign!==r.sign)},u.prototype._multiplyBySmall=function(r){return 0===r.value?s[0]:1===r.value?this:-1===r.value?this.negate():E(Math.abs(r.value),this.value,this.sign!==r.sign)},f.prototype.multiply=function(r){return ro(r)._multiplyBySmall(this)},f.prototype.times=f.prototype.multiply,l.prototype.multiply=function(r){return new l(this.value*ro(r).value)},l.prototype.times=l.prototype.multiply,u.prototype.square=function(){return new u(N(this.value),!1)},f.prototype.square=function(){var r=this.value*this.value;return c(r)?new f(r):new u(N(p(Math.abs(this.value))),!1)},l.prototype.square=function(r){return new l(this.value*this.value)},u.prototype.divmod=function(r){var t=R(this,r);return{quotient:t[0],remainder:t[1]}},l.prototype.divmod=f.prototype.divmod=u.prototype.divmod,u.prototype.divide=function(r){return R(this,r)[0]},l.prototype.over=l.prototype.divide=function(r){return new l(this.value/ro(r).value)},f.prototype.over=f.prototype.divide=u.prototype.over=u.prototype.divide,u.prototype.mod=function(r){return R(this,r)[1]},l.prototype.mod=l.prototype.remainder=function(r){return new l(this.value%ro(r).value)},f.prototype.remainder=f.prototype.mod=u.prototype.remainder=u.prototype.mod,u.prototype.pow=function(r){var t,e,n,o=ro(r),i=this.value,a=o.value;if(0===a)return s[1];if(0===i)return s[0];if(1===i)return s[1];if(-1===i)return o.isEven()?s[1]:s[-1];if(o.sign)return s[0];if(!o.isSmall)throw Error("The exponent "+o.toString()+" is too large.");if(this.isSmall&&c(t=Math.pow(i,a)))return new f(d(t));for(e=this,n=s[1];!0&a&&(n=n.times(e),--a),0!==a;)a/=2,e=e.square();return n},f.prototype.pow=u.prototype.pow,l.prototype.pow=function(r){var t=ro(r),e=this.value,n=t.value,o=BigInt(0),i=BigInt(1),a=BigInt(2);if(n===o)return s[1];if(e===o)return s[0];if(e===i)return s[1];if(e===BigInt(-1))return t.isEven()?s[1]:s[-1];if(t.isNegative())return new l(o);for(var u=this,f=s[1];(n&i)===i&&(f=f.times(u),--n),n!==o;)n/=a,u=u.square();return f},u.prototype.modPow=function(r,t){if(r=ro(r),(t=ro(t)).isZero())throw Error("Cannot take modPow with modulus 0");var e=s[1],n=this.mod(t);for(r.isNegative()&&(r=r.multiply(s[-1]),n=n.modInv(t));r.isPositive();){if(n.isZero())return s[0];r.isOdd()&&(e=e.multiply(n).mod(t)),r=r.divide(2),n=n.square().mod(t)}return e},l.prototype.modPow=f.prototype.modPow=u.prototype.modPow,u.prototype.compareAbs=function(r){var t=ro(r),e=this.value,n=t.value;return t.isSmall?1:T(e,n)},f.prototype.compareAbs=function(r){var t=ro(r),e=Math.abs(this.value),n=t.value;return t.isSmall?e===(n=Math.abs(n))?0:e>n?1:-1:-1},l.prototype.compareAbs=function(r){var t=this.value,e=ro(r).value;return(t=t>=0?t:-t)===(e=e>=0?e:-e)?0:t>e?1:-1},u.prototype.compare=function(r){if(r===1/0)return -1;if(r===-1/0)return 1;var t=ro(r),e=this.value,n=t.value;return this.sign!==t.sign?t.sign?1:-1:t.isSmall?this.sign?-1:1:T(e,n)*(this.sign?-1:1)},u.prototype.compareTo=u.prototype.compare,f.prototype.compare=function(r){if(r===1/0)return -1;if(r===-1/0)return 1;var t=ro(r),e=this.value,n=t.value;return t.isSmall?e==n?0:e>n?1:-1:e<0!==t.sign?e<0?-1:1:e<0?1:-1},f.prototype.compareTo=f.prototype.compare,l.prototype.compare=function(r){if(r===1/0)return -1;if(r===-1/0)return 1;var t=this.value,e=ro(r).value;return t===e?0:t>e?1:-1},l.prototype.compareTo=l.prototype.compare,u.prototype.equals=function(r){return 0===this.compare(r)},l.prototype.eq=l.prototype.equals=f.prototype.eq=f.prototype.equals=u.prototype.eq=u.prototype.equals,u.prototype.notEquals=function(r){return 0!==this.compare(r)},l.prototype.neq=l.prototype.notEquals=f.prototype.neq=f.prototype.notEquals=u.prototype.neq=u.prototype.notEquals,u.prototype.greater=function(r){return this.compare(r)>0},l.prototype.gt=l.prototype.greater=f.prototype.gt=f.prototype.greater=u.prototype.gt=u.prototype.greater,u.prototype.lesser=function(r){return 0>this.compare(r)},l.prototype.lt=l.prototype.lesser=f.prototype.lt=f.prototype.lesser=u.prototype.lt=u.prototype.lesser,u.prototype.greaterOrEquals=function(r){return this.compare(r)>=0},l.prototype.geq=l.prototype.greaterOrEquals=f.prototype.geq=f.prototype.greaterOrEquals=u.prototype.geq=u.prototype.greaterOrEquals,u.prototype.lesserOrEquals=function(r){return 0>=this.compare(r)},l.prototype.leq=l.prototype.lesserOrEquals=f.prototype.leq=f.prototype.lesserOrEquals=u.prototype.leq=u.prototype.lesserOrEquals,u.prototype.isEven=function(){return(1&this.value[0])==0},f.prototype.isEven=function(){return(1&this.value)==0},l.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},u.prototype.isOdd=function(){return(1&this.value[0])==1},f.prototype.isOdd=function(){return(1&this.value)==1},l.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},u.prototype.isPositive=function(){return!this.sign},f.prototype.isPositive=function(){return this.value>0},l.prototype.isPositive=f.prototype.isPositive,u.prototype.isNegative=function(){return this.sign},f.prototype.isNegative=function(){return this.value<0},l.prototype.isNegative=f.prototype.isNegative,u.prototype.isUnit=function(){return!1},f.prototype.isUnit=function(){return 1===Math.abs(this.value)},l.prototype.isUnit=function(){return this.abs().value===BigInt(1)},u.prototype.isZero=function(){return!1},f.prototype.isZero=function(){return 0===this.value},l.prototype.isZero=function(){return this.value===BigInt(0)},u.prototype.isDivisibleBy=function(r){var t=ro(r);return!t.isZero()&&(!!t.isUnit()||(0===t.compareAbs(2)?this.isEven():this.mod(t).isZero()))},l.prototype.isDivisibleBy=f.prototype.isDivisibleBy=u.prototype.isDivisibleBy,u.prototype.isPrime=function(r){var t=C(this);if(void 0!==t)return t;var n=this.abs(),o=n.bitLength();if(o<=64)return L(n,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var i=Math.log(2)*o.toJSNumber(),a=Math.ceil(!0===r?2*Math.pow(i,2):i),s=[],u=0;u<a;u++)s.push(e(u+2));return L(n,s)},l.prototype.isPrime=f.prototype.isPrime=u.prototype.isPrime,u.prototype.isProbablePrime=function(r,t){var n=C(this);if(void 0!==n)return n;for(var o=this.abs(),i=void 0===r?5:r,a=[],s=0;s<i;s++)a.push(e.randBetween(2,o.minus(2),t));return L(o,a)},l.prototype.isProbablePrime=f.prototype.isProbablePrime=u.prototype.isProbablePrime,u.prototype.modInv=function(r){for(var t,n,o,i=e.zero,a=e.one,s=ro(r),u=this.abs();!u.isZero();)t=s.divide(u),n=i,o=s,i=a,s=u,a=n.subtract(t.multiply(a)),u=o.subtract(t.multiply(u));if(!s.isUnit())throw Error(this.toString()+" and "+r.toString()+" are not co-prime");return(-1===i.compare(0)&&(i=i.add(r)),this.isNegative())?i.negate():i},l.prototype.modInv=f.prototype.modInv=u.prototype.modInv,u.prototype.next=function(){var r=this.value;return this.sign?k(r,1,this.sign):new u(b(r,1),this.sign)},f.prototype.next=function(){var r=this.value;return r+1<n?new f(r+1):new u(o,!1)},l.prototype.next=function(){return new l(this.value+BigInt(1))},u.prototype.prev=function(){var r=this.value;return this.sign?new u(b(r,1),!0):k(r,1,this.sign)},f.prototype.prev=function(){var r=this.value;return r-1>-n?new f(r-1):new u(o,!0)},l.prototype.prev=function(){return new l(this.value-BigInt(1))};for(var B=[1];2*B[B.length-1]<=r;)B.push(2*B[B.length-1]);var j=B.length,D=B[j-1];function z(t){return Math.abs(t)<=r}function $(r,t,n){t=ro(t);for(var o=r.isNegative(),i=t.isNegative(),a=o?r.not():r,s=i?t.not():t,u=0,f=0,l=null,c=null,p=[];!a.isZero()||!s.isZero();)u=(l=R(a,D))[1].toJSNumber(),o&&(u=D-1-u),f=(c=R(s,D))[1].toJSNumber(),i&&(f=D-1-f),a=l[0],s=c[0],p.push(n(u,f));for(var x=0!==n(+!!o,+!!i)?e(-1):e(0),g=p.length-1;g>=0;g-=1)x=x.multiply(D).add(e(p[g]));return x}u.prototype.shiftLeft=function(r){var t=ro(r).toJSNumber();if(!z(t))throw Error(String(t)+" is too large for shifting.");if(t<0)return this.shiftRight(-t);var e=this;if(e.isZero())return e;for(;t>=j;)e=e.multiply(D),t-=j-1;return e.multiply(B[t])},l.prototype.shiftLeft=f.prototype.shiftLeft=u.prototype.shiftLeft,u.prototype.shiftRight=function(r){var t,e=ro(r).toJSNumber();if(!z(e))throw Error(String(e)+" is too large for shifting.");if(e<0)return this.shiftLeft(-e);for(var n=this;e>=j;){if(n.isZero()||n.isNegative()&&n.isUnit())return n;n=(t=R(n,D))[1].isNegative()?t[0].prev():t[0],e-=j-1}return(t=R(n,B[e]))[1].isNegative()?t[0].prev():t[0]},l.prototype.shiftRight=f.prototype.shiftRight=u.prototype.shiftRight,u.prototype.not=function(){return this.negate().prev()},l.prototype.not=f.prototype.not=u.prototype.not,u.prototype.and=function(r){return $(this,r,function(r,t){return r&t})},l.prototype.and=f.prototype.and=u.prototype.and,u.prototype.or=function(r){return $(this,r,function(r,t){return r|t})},l.prototype.or=f.prototype.or=u.prototype.or,u.prototype.xor=function(r){return $(this,r,function(r,t){return r^t})},l.prototype.xor=f.prototype.xor=u.prototype.xor;var U=0x40000000,F=(r&-r)*(r&-r)|0x40000000;function Z(t){var e=t.value,n="number"==typeof e?e|U:"bigint"==typeof e?e|BigInt(U):e[0]+e[1]*r|F;return n&-n}function J(r,t){if(0>=t.compareTo(r)){var n=J(r,t.square(t)),o=n.p,i=n.e,a=o.multiply(t);return 0>=a.compareTo(r)?{p:a,e:2*i+1}:{p:o,e:2*i}}return{p:e(1),e:0}}function V(r,t){return r=ro(r),t=ro(t),r.greater(t)?r:t}function X(r,t){return r=ro(r),t=ro(t),r.lesser(t)?r:t}function G(r,t){if(r=ro(r).abs(),t=ro(t).abs(),r.equals(t))return r;if(r.isZero())return t;if(t.isZero())return r;for(var e,n,o=s[1];r.isEven()&&t.isEven();)e=X(Z(r),Z(t)),r=r.divide(e),t=t.divide(e),o=o.multiply(e);for(;r.isEven();)r=r.divide(Z(r));do{for(;t.isEven();)t=t.divide(Z(t));r.greater(t)&&(n=t,t=r,r=n),t=t.subtract(r)}while(!t.isZero())return o.isUnit()?r:r.multiply(o)}function Y(r,t){return r=ro(r).abs(),t=ro(t).abs(),r.divide(G(r,t)).multiply(t)}function W(t,e,n){t=ro(t);var o=n||Math.random,i=X(t,e=ro(e)),a=V(t,e).subtract(i).add(1);if(a.isSmall)return i.add(Math.floor(o()*a));for(var u=rr(a,r).value,f=[],l=!0,c=0;c<u.length;c++){var p=l?u[c]+(c+1<u.length?u[c+1]/r:0):r,x=d(o()*p);f.push(x),x<u[c]&&(l=!1)}return i.add(s.fromArray(f,r,!1))}u.prototype.bitLength=function(){var r=this;return(0>r.compareTo(e(0))&&(r=r.negate().subtract(e(1))),0===r.compareTo(e(0)))?e(0):e(J(r,e(2)).e).add(e(1))},l.prototype.bitLength=f.prototype.bitLength=u.prototype.bitLength;var Q=function(r,t,e,n){e=e||i,r=String(r),n||(r=r.toLowerCase(),e=e.toLowerCase());var o,a=r.length,s=Math.abs(t),u={};for(o=0;o<e.length;o++)u[e[o]]=o;for(o=0;o<a;o++){var f=r[o];if("-"!==f&&f in u&&u[f]>=s){if("1"===f&&1===s)continue;throw Error(f+" is not a valid digit in base "+t+".")}}t=ro(t);var l=[],c="-"===r[0];for(o=+!!c;o<r.length;o++){var f=r[o];if(f in u)l.push(ro(u[f]));else if("<"===f){var p=o;do o++;while(">"!==r[o]&&o<r.length)l.push(ro(r.slice(p+1,o)))}else throw Error(f+" is not a valid character")}return H(l,t,c)};function H(r,t,e){var n,o=s[0],i=s[1];for(n=r.length-1;n>=0;n--)o=o.add(r[n].times(i)),i=i.times(t);return e?o.negate():o}function K(r,t){return r<(t=t||i).length?t[r]:"<"+r+">"}function rr(r,t){if((t=e(t)).isZero()){if(r.isZero())return{value:[0],isNegative:!1};throw Error("Cannot convert nonzero numbers to base 0.")}if(t.equals(-1)){if(r.isZero())return{value:[0],isNegative:!1};if(r.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-r.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var n=Array.apply(null,Array(r.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return n.unshift([1]),{value:[].concat.apply([],n),isNegative:!1}}var o=!1;if(r.isNegative()&&t.isPositive()&&(o=!0,r=r.abs()),t.isUnit())return r.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(r.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:o};for(var i,a=[],s=r;s.isNegative()||s.compareAbs(t)>=0;){s=(i=s.divmod(t)).quotient;var u=i.remainder;u.isNegative()&&(u=t.minus(u).abs(),s=s.next()),a.push(u.toJSNumber())}return a.push(s.toJSNumber()),{value:a.reverse(),isNegative:o}}function rt(r,t,e){var n=rr(r,t);return(n.isNegative?"-":"")+n.value.map(function(r){return K(r,e)}).join("")}function re(r){if(c(+r)){var e=+r;if(e===d(e))return a?new l(BigInt(e)):new f(e);throw Error("Invalid integer: "+r)}var n="-"===r[0];n&&(r=r.slice(1));var o=r.split(/e/i);if(o.length>2)throw Error("Invalid integer: "+o.join("e"));if(2===o.length){var i=o[1];if("+"===i[0]&&(i=i.slice(1)),(i*=1)!==d(i)||!c(i))throw Error("Invalid integer: "+i+" is not a valid exponent.");var s=o[0],p=s.indexOf(".");if(p>=0&&(i-=s.length-p-1,s=s.slice(0,p)+s.slice(p+1)),i<0)throw Error("Cannot include negative exponent part for integers");s+=Array(i+1).join("0"),r=s}if(!/^([0-9][0-9]*)$/.test(r))throw Error("Invalid integer: "+r);if(a)return new l(BigInt(n?"-"+r:r));for(var x=[],h=r.length,m=t,v=h-m;h>0;)x.push(+r.slice(v,h)),(v-=m)<0&&(v=0),h-=m;return g(x),new u(x,n)}function rn(r){if(a)return new l(BigInt(r));if(c(r)){if(r!==d(r))throw Error(r+" is not an integer.");return new f(r)}return re(r.toString())}function ro(r){return"number"==typeof r?rn(r):"string"==typeof r?re(r):"bigint"==typeof r?new l(r):r}u.prototype.toArray=function(r){return rr(this,r)},f.prototype.toArray=function(r){return rr(this,r)},l.prototype.toArray=function(r){return rr(this,r)},u.prototype.toString=function(r,t){if(void 0===r&&(r=10),10!==r||t)return rt(this,r,t);for(var e,n=this.value,o=n.length,i=String(n[--o]),a="0000000";--o>=0;)i+=a.slice((e=String(n[o])).length)+e;return(this.sign?"-":"")+i},f.prototype.toString=function(r,t){return(void 0===r&&(r=10),10!=r||t)?rt(this,r,t):String(this.value)},l.prototype.toString=f.prototype.toString,l.prototype.toJSON=u.prototype.toJSON=f.prototype.toJSON=function(){return this.toString()},u.prototype.valueOf=function(){return parseInt(this.toString(),10)},u.prototype.toJSNumber=u.prototype.valueOf,f.prototype.valueOf=function(){return this.value},f.prototype.toJSNumber=f.prototype.valueOf,l.prototype.valueOf=l.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};for(var ri=0;ri<1e3;ri++)s[ri]=ro(ri),ri>0&&(s[-ri]=ro(-ri));return s.one=s[1],s.zero=s[0],s.minusOne=s[-1],s.max=V,s.min=X,s.gcd=G,s.lcm=Y,s.isInstance=function(r){return r instanceof u||r instanceof f||r instanceof l},s.randBetween=W,s.fromArray=function(r,t,e){return H(r.map(ro),ro(t||10),e)},s}();r.hasOwnProperty("exports")&&(r.exports=e),"function"==typeof define&&define.amd&&define(function(){return e})});"use strict";"use strict";var $76ad3bc26376f235$exports={},$76ad3bc26376f235$var$_createClass=function(){function r(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),$550dabb799291e20$exports={};Object.defineProperty($550dabb799291e20$exports,"__esModule",{value:!0});"use strict";var $550dabb799291e20$var$_createClass=function(){function r(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),$ce2d889330164756$exports={};Object.defineProperty($ce2d889330164756$exports,"__esModule",{value:!0});var $ce2d889330164756$var$_createClass=function(){function r(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();function $ce2d889330164756$var$_classCallCheck(r,t){if(!(r instanceof t))throw TypeError("Cannot call a class as a function")}var $ce2d889330164756$var$Lexer=function(){function r(t){$ce2d889330164756$var$_classCallCheck(this,r),this.text=t,this.pos=0,this.col=0,this.line=0,this.prev_col=0,this.prev_line=0}return $ce2d889330164756$var$_createClass(r,[{key:"increment",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.pos+=r,this.col+=r}},{key:"error",value:function(r){for(var t=this.text.split("\n")[this.prev_line],e="",n=0;n<this.prev_col;n++)e+=" ";throw Error("Lexer error\n"+t+"\n"+e+"^\nError at line: "+(this.prev_line+1)+" col: "+(this.prev_col+1)+"\n"+r)}},{key:"current_char",value:function(){return this.text.charAt(this.pos)}},{key:"eat",value:function(r){this.current_char()==r?this.pos+=1:this.error("Expected "+r+" found "+this.current_char())}},{key:"number",value:function(){for(var r="",t=!1;this.current_char().match(/[0-9\.]/);){if("."==this.current_char())if(t)break;else t=!0;r+=this.current_char(),this.increment()}var e=Number(r);return isNaN(e)&&this.error("Could not parse number: '"+r+"'"),{type:"number",value:e}}}]),r}();$ce2d889330164756$exports.default=$ce2d889330164756$var$Lexer;"use strict";var $550dabb799291e20$var$_Lexer2=$550dabb799291e20$var$_interopRequireDefault($ce2d889330164756$exports),$c8cf79153f264210$exports={};Object.defineProperty($c8cf79153f264210$exports,"__esModule",{value:!0}),$c8cf79153f264210$exports.default=["sin","cos","tan","arcsin","arccos","arctan","log","ln","sqrt","max","min"];"use strict";var $550dabb799291e20$var$_functions2=$550dabb799291e20$var$_interopRequireDefault($c8cf79153f264210$exports),$f9ed4e5a45c73d7c$exports={};Object.defineProperty($f9ed4e5a45c73d7c$exports,"__esModule",{value:!0}),$f9ed4e5a45c73d7c$exports.letters=void 0,$f9ed4e5a45c73d7c$exports.toUpperCase=$f9ed4e5a45c73d7c$var$toUpperCase,$f9ed4e5a45c73d7c$exports.isUpperCase=$f9ed4e5a45c73d7c$var$isUpperCase,$f9ed4e5a45c73d7c$exports.getSymbol=$f9ed4e5a45c73d7c$var$getSymbol,$f9ed4e5a45c73d7c$exports.getName=$f9ed4e5a45c73d7c$var$getName,$f9ed4e5a45c73d7c$exports.convertSymbols=$f9ed4e5a45c73d7c$var$convertSymbols;"use strict";var $050cb67ccf837d91$exports={};Object.defineProperty($050cb67ccf837d91$exports,"__esModule",{value:!0});var $050cb67ccf837d91$var$_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},$050cb67ccf837d91$var$stackLevelRef=null,$050cb67ccf837d91$var$debug=$050cb67ccf837d91$exports.debug=function(){for(var r=arguments.length,t=Array(r),e=0;e<r;e++)t[e]=arguments[e]},$f9ed4e5a45c73d7c$var$letters=$f9ed4e5a45c73d7c$exports.letters=[{name:"alpha",symbol:""},{name:"beta",symbol:""},{name:"gamma",symbol:""},{name:"delta",symbol:""},{name:"epsilon",symbol:""},{name:"zeta",symbol:""},{name:"eta",symbol:""},{name:"theta",symbol:""},{name:"iota",symbol:""},{name:"kappa",symbol:""},{name:"lambda",symbol:""},{name:"mu",symbol:""},{name:"nu",symbol:""},{name:"omicron",symbol:""},{name:"pi",symbol:""},{name:"rho",symbol:""},{name:"sigma",symbol:""},{name:"tau",symbol:""},{name:"upsilon",symbol:""},{name:"phi",symbol:""},{name:"chi",symbol:""},{name:"psi",symbol:""},{name:"omega",symbol:""}];function $f9ed4e5a45c73d7c$var$toUpperCase(r){return r.charAt(0).toUpperCase()+r.slice(1)}function $f9ed4e5a45c73d7c$var$isUpperCase(r){return r.charAt(0).toUpperCase()===r.charAt(0)}function $f9ed4e5a45c73d7c$var$getSymbol(r){var t=$f9ed4e5a45c73d7c$var$letters.find(function(t){return t.name===r.toLowerCase()});return void 0===t?null:(t=t.symbol,$f9ed4e5a45c73d7c$var$isUpperCase(r)&&(t=$f9ed4e5a45c73d7c$var$toUpperCase(t)),t)}function $f9ed4e5a45c73d7c$var$getName(r){var t=$f9ed4e5a45c73d7c$var$letters.find(function(t){return t.symbol===r.toLowerCase()});return void 0===t?null:(t=t.name,$f9ed4e5a45c73d7c$var$isUpperCase(r)&&(t=$f9ed4e5a45c73d7c$var$toUpperCase(t)),t)}function $f9ed4e5a45c73d7c$var$convertSymbols(r){return(0,$050cb67ccf837d91$exports.debug)("Converting math symbols "+r),$f9ed4e5a45c73d7c$var$letters.forEach(function(t){r=(r=r.split(t.symbol).join(t.name)).split($f9ed4e5a45c73d7c$var$toUpperCase(t.symbol)).join($f9ed4e5a45c73d7c$var$toUpperCase(t.name))}),(0,$050cb67ccf837d91$exports.debug)("Converted math symbols "+r),r}$f9ed4e5a45c73d7c$exports.default=$f9ed4e5a45c73d7c$var$letters;var $550dabb799291e20$var$_greekLetters2=$550dabb799291e20$var$_interopRequireDefault($f9ed4e5a45c73d7c$exports);function $550dabb799291e20$var$_interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}function $550dabb799291e20$var$_classCallCheck(r,t){if(!(r instanceof t))throw TypeError("Cannot call a class as a function")}var $550dabb799291e20$var$ParserLatex=function(){function r(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};$550dabb799291e20$var$_classCallCheck(this,r),this.lexer=new e(t),this.options=n,this.ast=null,this.current_token=null,this.peek_token=null,this.functions=$550dabb799291e20$var$_functions2.default.concat(n.functions||[])}return $550dabb799291e20$var$_createClass(r,[{key:"parse",value:function(){return(0,$050cb67ccf837d91$exports.debug)("\nLatex parser .parse()"),this.ast=this.equation(),this.eat("EOF"),this.ast}},{key:"next_token",value:function(){return null!=this.peek_token?(this.current_token=this.peek_token,this.peek_token=null,(0,$050cb67ccf837d91$exports.debug)("next token from peek",this.current_token)):(this.current_token=this.lexer.next_token(),(0,$050cb67ccf837d91$exports.debug)("next token",this.current_token)),this.current_token}},{key:"peek",value:function(){return null==this.peek_token&&(this.peek_token=this.lexer.next_token()),(0,$050cb67ccf837d91$exports.debug)("next token from peek",this.peek_token),this.peek_token}},{key:"error",value:function(r){for(var t=this.lexer.text.split("\n")[this.lexer.line],e="",n=0;n<this.lexer.col;n++)e+=" ";throw Error("Parser error\n"+t+"\n"+e+"^\nError at line: "+(this.lexer.line+1)+" col: "+(this.lexer.col+1)+"\n"+r)}},{key:"eat",value:function(r){this.next_token().type!=r&&this.error("Expected "+r+" found "+JSON.stringify(this.current_token))}},{key:"equation",value:function(){var r=this.expr();return"equal"!=this.peek().type?r:(this.next_token(),{type:"equation",lhs:r,rhs:this.expr()})}},{key:"expr",value:function(){return((0,$050cb67ccf837d91$exports.debug)("expr"),this.peek(),"number"==this.peek_token.type||"operator"==this.peek_token.type||"variable"==this.peek_token.type||"function"==this.peek_token.type||"keyword"==this.peek_token.type||"bracket"==this.peek_token.type)?this.operator():"bracket"==this.peek_token.type&&!1==this.peek_token.open?null:"EOF"==this.peek_token.type?(this.next_token(),null):void(this.next_token(),this.error("Unexpected token: "+JSON.stringify(this.current_token)))}},{key:"keyword",value:function(){if((0,$050cb67ccf837d91$exports.debug)("keyword"),"keyword"!=this.peek().type)throw Error("Expected keyword found "+JSON.stringify(this.peek_token));var r=this.peek_token.value;return(r=r.toLowerCase(),(0,$050cb67ccf837d91$exports.debug)("keyword -",r),"frac"==r)?this.fraction():"sqrt"==r?this.sqrt():this.functions.includes(r.toLowerCase())?this.function():(this.eat("keyword"),{type:"keyword",value:this.current_token.value})}},{key:"sqrt",value:function(){if((0,$050cb67ccf837d91$exports.debug)("sqrt"),this.eat("keyword"),"sqrt"!=this.current_token.value&&this.error("Expected sqrt found "+JSON.stringify(this.current_token)),"["!=this.peek().value)return{type:"function",value:"sqrt",content:this.group()};this.eat("bracket"),"["!=this.current_token.value&&this.error('Expected "[" bracket, found '+JSON.stringify(this.current_token));var r=this.number();return this.eat("bracket"),"]"!=this.current_token.value&&this.error('Expected "]" bracket, found '+JSON.stringify(this.current_token)),{type:"operator",operator:"exponent",lhs:this.group(),rhs:{type:"operator",operator:"divide",lhs:{type:"number",value:1},rhs:r}}}},{key:"fraction",value:function(){return(0,$050cb67ccf837d91$exports.debug)("fraction"),this.eat("keyword"),"frac"!=this.current_token.value&&this.error("Expected fraction found "+JSON.stringify(this.current_token)),{type:"operator",operator:"divide",lhs:this.group(),rhs:this.group()}}},{key:"function",value:function(){(0,$050cb67ccf837d91$exports.debug)("function"),this.eat("keyword");var r=this.current_token.value,t=void 0;return{type:"function",value:r,content:t="bracket"==this.peek().type?this.group():this.number()}}},{key:"group",value:function(){(0,$050cb67ccf837d91$exports.debug)("start group"),this.eat("bracket"),!0!=this.current_token.open&&this.error("Expected opening bracket found "+this.current_token);var r=this.expr();return this.eat("bracket"),!1!=this.current_token.open&&this.error("Expected closing bracket found "+this.current_token),(0,$050cb67ccf837d91$exports.debug)("end group"),r}},{key:"operator",value:function(){(0,$050cb67ccf837d91$exports.debug)("operator left");var r=this.operator_multiply(),t=this.peek();if("operator"!=t.type||"plus"!=t.value&&"minus"!=t.value)return(0,$050cb67ccf837d91$exports.debug)("operator only left side"),r;this.next_token(),(0,$050cb67ccf837d91$exports.debug)("operator right");var e=this.operator();return{type:"operator",operator:t.value,lhs:r,rhs:e}}},{key:"operator_multiply",value:function(){(0,$050cb67ccf837d91$exports.debug)("op mul left");var r=this.operator_divide(),t=this.peek();if("number"==t.type||"variable"==t.type||"keyword"==t.type||"bracket"==t.type&&"("==t.value)t={type:"operator",value:"multiply"};else{if("operator"!=t.type||"multiply"!=t.value&&"divide"!=t.value)return(0,$050cb67ccf837d91$exports.debug)("term only left side"),r;this.next_token()}(0,$050cb67ccf837d91$exports.debug)("op mul right");var e=this.operator_multiply();return{type:"operator",operator:t.value,lhs:r,rhs:e}}},{key:"operator_divide",value:function(){(0,$050cb67ccf837d91$exports.debug)("operator_divide");var r=this.operator_mod();return this.operator_divide_prime(r)}},{key:"operator_divide_prime",value:function(r){var t=this.peek();if("operator"!=t.type||"divide"!=t.value)return(0,$050cb67ccf837d91$exports.debug)("operator_divide_prime - epsilon"),r;this.next_token(),(0,$050cb67ccf837d91$exports.debug)("operator_divide_prime - next operator");var e=this.operator_mod();return this.operator_divide_prime({type:"operator",operator:"divide",lhs:r,rhs:e})}},{key:"operator_mod",value:function(){(0,$050cb67ccf837d91$exports.debug)("modulus left");var r=this.operator_exp(),t=this.peek();return"operator"!=t.type||"modulus"!=t.value?((0,$050cb67ccf837d91$exports.debug)("modulus only left side"),r):(this.next_token(),(0,$050cb67ccf837d91$exports.debug)("modulus right"),{type:"operator",operator:"modulus",lhs:r,rhs:this.operator_mod()})}},{key:"operator_exp",value:function(){var r=this.subscript(),t=this.peek();return"operator"!=t.type||"exponent"!=t.value?((0,$050cb67ccf837d91$exports.debug)("modulus only left side"),r):(this.next_token(),{type:"operator",operator:"exponent",lhs:r,rhs:this.operator_exp()})}},{key:"variable",value:function(){return this.eat("variable"),{type:"variable",value:this.current_token.value}}},{key:"subscript",value:function(){var r=this.number();return"underscore"==this.peek().type?(this.eat("underscore"),{type:"subscript",base:r,subscript:this.subscript()}):r}},{key:"number",value:function(){return((0,$050cb67ccf837d91$exports.debug)("number"),this.peek(),"number"==this.peek_token.type)?(this.next_token(),{type:this.current_token.type,value:this.current_token.value}):"operator"==this.peek_token.type?this.uni_operator():"variable"==this.peek_token.type?this.variable():"keyword"==this.peek_token.type?this.keyword():"bracket"==this.peek_token.type?this.group():void(this.next_token(),this.error("Expected number, variable, function, group, or + - found "+JSON.stringify(this.current_token)))}},{key:"uni_operator",value:function(){if(this.eat("operator"),"plus"==this.current_token.value||"minus"==this.current_token.value){var r=this.current_token.value,t=this.number();return"number"==t.type?{type:"number",value:"minus"==r?-t.value:t.value}:{type:"uni-operator",operator:r,value:t}}}}]),r}();$550dabb799291e20$exports.default=$550dabb799291e20$var$ParserLatex;"use strict";var $76ad3bc26376f235$var$_Parser2=$76ad3bc26376f235$var$_interopRequireDefault($550dabb799291e20$exports),$574ac2d85c3975ed$exports={};Object.defineProperty($574ac2d85c3975ed$exports,"__esModule",{value:!0});var $574ac2d85c3975ed$var$_createClass=function(){function r(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),$574ac2d85c3975ed$var$greekLetters=$574ac2d85c3975ed$var$_interopRequireWildcard($f9ed4e5a45c73d7c$exports);function $574ac2d85c3975ed$var$_interopRequireWildcard(r){if(r&&r.__esModule)return r;var t={};if(null!=r)for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e]);return t.default=r,t}function $574ac2d85c3975ed$var$_classCallCheck(r,t){if(!(r instanceof t))throw TypeError("Cannot call a class as a function")}var $574ac2d85c3975ed$var$MathFormatter=function(){function r(t){$574ac2d85c3975ed$var$_classCallCheck(this,r),this.ast=t}return $574ac2d85c3975ed$var$_createClass(r,[{key:"format",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.ast;if(null==r)return"";switch(r.type){case"operator":return this.operator(r);case"number":return this.number(r);case"function":return this.function(r);case"variable":return this.variable(r);case"equation":return this.equation(r);case"subscript":return this.subscript(r);case"uni-operator":return this.uni_operator(r);default:throw Error("Unexpected type: "+r.type)}}},{key:"operator",value:function(r){var t=r.operator;switch(t){case"plus":t="+";break;case"minus":t="-";break;case"multiply":t="*";break;case"divide":t="/";break;case"modulus":t="%";break;case"exponent":t="^"}var e=this.format(r.lhs),n=this.format(r.rhs),o=[["modulus"],["exponent"],["multiply","divide"],["plus","minus"]],i=function(r,t){var e=function(r){return o.findIndex(function(t){return t.includes(r)})};return e(t)>e(r)},a=function(t){return"operator"==t.type&&i(r.operator,t.operator)},s=a(r.lhs),u=a(r.rhs);return u=u||"/"==t&&"operator"==r.rhs.type,"exponent"==r.operator&&"number"==r.rhs.type&&r.rhs.value<0&&(u=!0),(e=s?"("+e+")":e)+t+(n=u?"("+n+")":n)}},{key:"number",value:function(r){return""+r.value}},{key:"function",value:function(r){return r.value+"("+this.format(r.content)+")"}},{key:"variable",value:function(r){var t=$574ac2d85c3975ed$var$greekLetters.getSymbol(r.value);return t||""+r.value}},{key:"equation",value:function(r){return this.format(r.lhs)+"="+this.format(r.rhs)}},{key:"subscript",value:function(r){return"variable"==r.subscript.type&&1==r.subscript.value.length?this.format(r.base)+"_"+this.format(r.subscript):this.format(r.base)+"_("+this.format(r.subscript)+")"}},{key:"uni_operator",value:function(r){return"minus"==r.operator?"-"+this.format(r.value):this.format(r.value)}}]),r}();$574ac2d85c3975ed$exports.default=$574ac2d85c3975ed$var$MathFormatter;"use strict";var $76ad3bc26376f235$var$_FormatterMath2=$76ad3bc26376f235$var$_interopRequireDefault($574ac2d85c3975ed$exports),$6fd5a896dad7506b$exports={};Object.defineProperty($6fd5a896dad7506b$exports,"__esModule",{value:!0});var $6fd5a896dad7506b$var$_createClass=function(){function r(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),$6fd5a896dad7506b$var$_greekLetters2=$6fd5a896dad7506b$var$_interopRequireDefault($f9ed4e5a45c73d7c$exports);function $6fd5a896dad7506b$var$_interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}function $6fd5a896dad7506b$var$_classCallCheck(r,t){if(!(r instanceof t))throw TypeError("Cannot call a class as a function")}var $6fd5a896dad7506b$var$LatexFormatter=function(){function r(t){$6fd5a896dad7506b$var$_classCallCheck(this,r),this.ast=t}return $6fd5a896dad7506b$var$_createClass(r,[{key:"format",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.ast;if(null==r)return"";switch(r.type){case"operator":return this.operator(r);case"number":return this.number(r);case"function":return this.function(r);case"variable":return this.variable(r);case"equation":return this.equation(r);case"subscript":return this.subscript(r);case"uni-operator":return this.uni_operator(r);default:throw Error("Unexpected type: "+r.type)}}},{key:"operator",value:function(r){var t=r.operator;switch(t){case"plus":t="+";break;case"minus":t="-";break;case"multiply":t="\\cdot ";break;case"divide":return this.fragment(r);case"modulus":t="%";break;case"exponent":t="^"}var e=this.format(r.lhs),n=this.format(r.rhs),o=[["modulus"],["exponent"],["multiply"],["plus","minus"]],i=function(r,t){var e=function(r){return o.findIndex(function(t){return t.includes(r)})};return e(t)>e(r)},a=function(t){return"operator"==t.type&&i(r.operator,t.operator)},s=a(r.lhs),u=a(r.rhs);return""+(e=s?"\\left("+e+"\\right)":e)+t+(n="exponent"==r.operator?(u=!0,"{"+n+"}"):u?"\\left("+n+"\\right)":n)}},{key:"fragment",value:function(r){return"\\frac{"+this.format(r.lhs)+"}{"+this.format(r.rhs)+"}"}},{key:"number",value:function(r){return""+r.value}},{key:"function",value:function(r){return"sqrt"==r.value?"\\"+r.value+"{"+this.format(r.content)+"}":"\\"+r.value+"\\left("+this.format(r.content)+"\\right)"}},{key:"variable",value:function(r){return $6fd5a896dad7506b$var$_greekLetters2.default.map(function(r){return r.name}).includes(r.value.toLowerCase())?"\\"+r.value:""+r.value}},{key:"equation",value:function(r){return this.format(r.lhs)+"="+this.format(r.rhs)}},{key:"subscript",value:function(r){return"variable"==r.subscript.type&&1==r.subscript.value.length?this.format(r.base)+"_"+this.format(r.subscript):this.format(r.base)+"_{"+this.format(r.subscript)+"}"}},{key:"uni_operator",value:function(r){return"minus"==r.operator?"-"+this.format(r.value):this.format(r.value)}}]),r}();$6fd5a896dad7506b$exports.default=$6fd5a896dad7506b$var$LatexFormatter;"use strict";var $76ad3bc26376f235$var$_FormatterLatex2=$76ad3bc26376f235$var$_interopRequireDefault($6fd5a896dad7506b$exports),$76ad3bc26376f235$var$greekLetters=$76ad3bc26376f235$var$_interopRequireWildcard($f9ed4e5a45c73d7c$exports),$13c73e2bff2f447d$exports={};Object.defineProperty($13c73e2bff2f447d$exports,"__esModule",{value:!0});var $13c73e2bff2f447d$var$_createClass=function(){function r(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),$13c73e2bff2f447d$var$_Lexer3=$13c73e2bff2f447d$var$_interopRequireDefault($ce2d889330164756$exports),$13c73e2bff2f447d$var$_greekLetters2=$13c73e2bff2f447d$var$_interopRequireDefault($f9ed4e5a45c73d7c$exports);function $13c73e2bff2f447d$var$_interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}function $13c73e2bff2f447d$var$_classCallCheck(r,t){if(!(r instanceof t))throw TypeError("Cannot call a class as a function")}function $13c73e2bff2f447d$var$_possibleConstructorReturn(r,t){if(!r)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:r}function $13c73e2bff2f447d$var$_inherits(r,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(r,t):r.__proto__=t)}var $13c73e2bff2f447d$var$LatexLexer=function(r){function t(r){return $13c73e2bff2f447d$var$_classCallCheck(this,t),$13c73e2bff2f447d$var$_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r))}return $13c73e2bff2f447d$var$_inherits(t,r),$13c73e2bff2f447d$var$_createClass(t,[{key:"next_token",value:function(){if(this.prev_col=this.col,this.prev_line=this.line,this.pos>=this.text.length)return{type:"EOF"};"\n"==this.current_char()&&(this.col=0,this.line++);var r=[" ","\n","\\ ","\\!","&","\\,","\\:","\\;","\\quad","\\qquad"],t=!0,e=!1,n=void 0;try{for(var o,i=r[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;if(this.text.startsWith(a,this.pos))return this.increment(a.length),this.next_token()}}catch(r){e=!0,n=r}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}return"\\"==this.current_char()?this.keyword():this.current_char().match(/[0-9]/)?this.number():this.current_char().match(/[a-zA-Z]/)?this.variable():"{"==this.current_char()?(this.increment(),{type:"bracket",open:!0,value:"{"}):"}"==this.current_char()?(this.increment(),{type:"bracket",open:!1,value:"}"}):"("==this.current_char()?(this.increment(),{type:"bracket",open:!0,value:"("}):")"==this.current_char()?(this.increment(),{type:"bracket",open:!1,value:")"}):"["==this.current_char()?(this.increment(),{type:"bracket",open:!0,value:"["}):"]"==this.current_char()?(this.increment(),{type:"bracket",open:!1,value:"]"}):"+"==this.current_char()?(this.increment(),{type:"operator",value:"plus"}):"-"==this.current_char()?(this.increment(),{type:"operator",value:"minus"}):"*"==this.current_char()?(this.increment(),{type:"operator",value:"multiply"}):"/"==this.current_char()?(this.increment(),{type:"operator",value:"divide"}):"^"==this.current_char()?(this.increment(),{type:"operator",value:"exponent"}):"="==this.current_char()?(this.increment(),{type:"equal"}):"_"==this.current_char()?(this.increment(),{type:"underscore"}):void this.error("Unknown symbol: "+this.current_char())}},{key:"keyword",value:function(){this.eat("\\");var r=this.variable();if("cdot"==r.value)return{type:"operator",value:"multiply"};if("mod"==r.value)return{type:"operator",value:"modulus"};if("left"==r.value){var t=this.next_token();return"bracket"!=t.type&&!0!=t.open&&this.error("Expected opening bracket found "+JSON.stringify(t)),t}if("right"==r.value){var e=this.next_token();return"bracket"!=e.type&&!1!=e.open&&this.error("Expected closing bracket found "+JSON.stringify(e)),e}return $13c73e2bff2f447d$var$_greekLetters2.default.map(function(r){return r.name}).includes(r.value.toLowerCase())?{type:"variable",value:r.value}:{type:"keyword",value:r.value}}},{key:"variable",value:function(){for(var r="";this.current_char().match(/[a-zA-Z]/)&&this.pos<=this.text.length;)r+=this.current_char(),this.increment();return{type:"variable",value:r}}}]),t}($13c73e2bff2f447d$var$_Lexer3.default);$13c73e2bff2f447d$exports.default=$13c73e2bff2f447d$var$LatexLexer;"use strict";var $76ad3bc26376f235$var$_LexerLatex2=$76ad3bc26376f235$var$_interopRequireDefault($13c73e2bff2f447d$exports),$c0b348ef3c527396$exports={};Object.defineProperty($c0b348ef3c527396$exports,"__esModule",{value:!0});var $c0b348ef3c527396$var$_createClass=function(){function r(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),$c0b348ef3c527396$var$_Lexer3=$c0b348ef3c527396$var$_interopRequireDefault($ce2d889330164756$exports),$c0b348ef3c527396$var$_functions2=$c0b348ef3c527396$var$_interopRequireDefault($c8cf79153f264210$exports);function $c0b348ef3c527396$var$_interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}function $c0b348ef3c527396$var$_classCallCheck(r,t){if(!(r instanceof t))throw TypeError("Cannot call a class as a function")}function $c0b348ef3c527396$var$_possibleConstructorReturn(r,t){if(!r)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:r}function $c0b348ef3c527396$var$_inherits(r,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(r,t):r.__proto__=t)}var $c0b348ef3c527396$var$LatexLexer=function(r){function t(r){return $c0b348ef3c527396$var$_classCallCheck(this,t),$c0b348ef3c527396$var$_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r))}return $c0b348ef3c527396$var$_inherits(t,r),$c0b348ef3c527396$var$_createClass(t,[{key:"next_token",value:function(){if(this.prev_col=this.col,this.prev_line=this.line,this.pos>=this.text.length)return{type:"EOF"};"\n"==this.current_char()&&(this.col=0,this.line++);var r=[" ","\n"],t=!0,e=!1,n=void 0;try{for(var o,i=r[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;if(this.text.startsWith(a,this.pos))return this.increment(a.length),this.next_token()}}catch(r){e=!0,n=r}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}return this.current_char().match(/[0-9]/)?this.number():this.current_char().match(/[a-zA-Z]/)?this.alphabetic():"("==this.current_char()?(this.increment(),{type:"bracket",open:!0,value:"("}):")"==this.current_char()?(this.increment(),{type:"bracket",open:!1,value:")"}):"+"==this.current_char()?(this.increment(),{type:"operator",value:"plus"}):"-"==this.current_char()?(this.increment(),{type:"operator",value:"minus"}):"*"==this.current_char()?(this.increment(),{type:"operator",value:"multiply"}):"/"==this.current_char()?(this.increment(),{type:"operator",value:"divide"}):"^"==this.current_char()?(this.increment(),{type:"operator",value:"exponent"}):"="==this.current_char()?(this.increment(),{type:"equal"}):"_"==this.current_char()?(this.increment(),{type:"underscore"}):void this.error("Unknown symbol: "+this.current_char())}},{key:"alphabetic",value:function(){for(var r="";this.current_char().match(/[a-zA-Z]/)&&this.pos<=this.text.length;)r+=this.current_char(),this.increment();return $c0b348ef3c527396$var$_functions2.default.includes(r)?{type:"keyword",value:r}:{type:"variable",value:r}}}]),t}($c0b348ef3c527396$var$_Lexer3.default);$c0b348ef3c527396$exports.default=$c0b348ef3c527396$var$LatexLexer;var $76ad3bc26376f235$var$_LexerMath2=$76ad3bc26376f235$var$_interopRequireDefault($c0b348ef3c527396$exports);function $76ad3bc26376f235$var$_interopRequireWildcard(r){if(r&&r.__esModule)return r;var t={};if(null!=r)for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e]);return t.default=r,t}function $76ad3bc26376f235$var$_interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}function $76ad3bc26376f235$var$_classCallCheck(r,t){if(!(r instanceof t))throw TypeError("Cannot call a class as a function")}var $76ad3bc26376f235$var$AlgebraLatex=function(){function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$76ad3bc26376f235$var$_classCallCheck(this,r),this.options=t}return $76ad3bc26376f235$var$_createClass(r,[{key:"parseLatex",value:function(r){return r=r.replace(/,/g,"."),this.input=r,this.parser=new $76ad3bc26376f235$var$_Parser2.default(r,$76ad3bc26376f235$var$_LexerLatex2.default,this.options),this.parser.parse(),this}},{key:"parseMath",value:function(r){return r=r.replace(/,/g,"."),this.input=r,this.parser=new $76ad3bc26376f235$var$_Parser2.default(r,$76ad3bc26376f235$var$_LexerMath2.default,this.options),this.parser.parse(),this}},{key:"getAst",value:function(){return this.parser.ast}},{key:"toMath",value:function(){return new $76ad3bc26376f235$var$_FormatterMath2.default(this.getAst()).format()}},{key:"toLatex",value:function(){return new $76ad3bc26376f235$var$_FormatterLatex2.default(this.getAst()).format()}},{key:"toTex",value:function(){return self.toLatex()}},{key:"toAlgebra",value:function(r){if(null===r)throw Error("Algebra.js must be passed as a parameter for toAlgebra");var t=this.toMath();return t=$76ad3bc26376f235$var$greekLetters.convertSymbols(t),r.parse(t)}},{key:"toAlgebrite",value:function(r){if(null===r)return Error("Algebrite must be passed as a parameter for toAlgebrite");if(this.isEquation())return Error("Algebrite can not handle equations, only expressions");var t=this.toMath();return t=$76ad3bc26376f235$var$greekLetters.convertSymbols(t),r.eval(t)}},{key:"toCoffeequate",value:function(r){if(null===r)return Error("Coffeequante must be passed as a parameter for toCoffeequante");var t=this.toMath();return r(t=t.replace(/\^/g,"**"))}},{key:"isEquation",value:function(){return this.input.includes("=")}}]),r}();$76ad3bc26376f235$exports=$76ad3bc26376f235$var$AlgebraLatex,window.Algebrite=parcelRequire("1ijf9"),window.latexToMath=function(r){if(!r||"string"!=typeof r)return r;if(/\\[a-zA-Z]+/.test(r))try{let t=new($parcel$interopDefault($76ad3bc26376f235$exports))().parseLatex(r).toAlgebrite(Algebrite);return String(t)}catch(r){window.console.warn("LaTeX conversion failed:",r)}return r}})();
//# sourceMappingURL=index.js.map
